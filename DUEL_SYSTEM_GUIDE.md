# โ๏ธ ะกะธััะตะผะฐ ะทะฐัะฒะพะบ ะฝะฐ ะดััะปั ะฒ TigerRozetka

## ๐ฏ ะะฐะบ ัะฐะฑะพัะฐะตั ะทะฐัะฒะบะฐ ะฝะฐ ะดััะปั

### ๐ ะจะฐะณ 1: ะะฝะธัะธะฐัะธั ะดััะปะธ

1. **ะะณัะพะบ ะฝะฐะถะธะผะฐะตั "โ๏ธ ะััะปั"** ะฒ ะณะปะฐะฒะฝะพะผ ะผะตะฝั
2. **ะัะบััะฒะฐะตััั `DuelInviteScreen`** - ัะบัะฐะฝ ะฒัะฑะพัะฐ ัะพะฟะตัะฝะธะบะฐ
3. **ะะฐะณััะถะฐัััั ะบะพะฝัะฐะบัั** ะธะท Telegram ะธะปะธ ะฟะพะบะฐะทัะฒะฐัััั ัะตััะพะฒัะต

### ๐ฅ ะจะฐะณ 2: ะัะฑะพั ัะพะฟะตัะฝะธะบะฐ

```tsx
// ะััะพัะฝะธะบะธ ะบะพะฝัะฐะบัะพะฒ:
- ๐ฑ Telegram API (ัะตะฐะปัะฝัะต ะบะพะฝัะฐะบัั)
- ๐งช ะขะตััะพะฒัะต ะบะพะฝัะฐะบัั (ะดะปั ัะฐะทัะฐะฑะพัะบะธ)
- ๐ซ ะััะทัั ะฒ Telegram
- ๐ฎ ะะตะดะฐะฒะฝะธะต ะธะณัะพะบะธ
```

### ๐ฉ ะจะฐะณ 3: ะัะฟัะฐะฒะบะฐ ะฟัะธะณะปะฐัะตะฝะธั

```typescript
const sendDuelInvite = async (contact: TelegramContact) => {
  // 1. ะกะพะทะดะฐะตััั ัะฝะธะบะฐะปัะฝัะน ID ะฟัะธะณะปะฐัะตะฝะธั
  const inviteId = `duel_${Date.now()}_${user.id}_${contact.id}`;
  
  // 2. ะคะพัะผะธััะตััั ัะพะพะฑัะตะฝะธะต
  const inviteMessage = 
    `๐ฎโ๏ธ ะะฃะญะะฌ TIGERROZETKA!
    ${user.first_name} (ะฃัะพะฒะตะฝั ${player.level}) ะฒัะทัะฒะฐะตั ะฒะฐั ะฝะฐ ะดััะปั!
    
    โก ะะณัะฐ ะฝะฐ 60 ัะตะบัะฝะด
    ๐ ะัะพ ะฝะฐะฑะตัะตั ะฑะพะปััะต ะพัะบะพะฒ - ัะพั ะฟะพะฑะตะดะธะป!`;
  
  // 3. ะัะฟัะฐะฒะบะฐ ัะตัะตะท Telegram WebApp API
  webApp.sendData(JSON.stringify({
    type: 'duel_invite',
    inviteId,
    fromUser: { id: user.id, name: user.first_name, level: player.level },
    toUserId: contact.id,
    message: inviteMessage
  }));
  
  // 4. ะะพะบะฐะปัะฝะพะต ัะพััะฐะฝะตะฝะธะต ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั
  const invite = {
    id: inviteId,
    status: 'pending',
    createdAt: Date.now(),
    expiresAt: Date.now() + (5 * 60 * 1000) // 5 ะผะธะฝัั
  };
}
```

### ๐จ ะจะฐะณ 4: ะะพะปััะตะฝะธะต ะธ ะพะฑัะฐะฑะพัะบะฐ ะฟัะธะณะปะฐัะตะฝะธะน

**ะะพะผะฟะพะฝะตะฝั `DuelInviteReceiver`** ัะฐะฑะพัะฐะตั ะณะปะพะฑะฐะปัะฝะพ:

```typescript
// 1. ะกะปััะฐะตั ะฒัะพะดััะธะต ะฟัะธะณะปะฐัะตะฝะธั
useEffect(() => {
  // ะัะพะฒะตัะบะฐ URL ะฟะฐัะฐะผะตััะพะฒ (ะดะปั ัะตััะธัะพะฒะฐะฝะธั)
  const urlParams = new URLSearchParams(window.location.search);
  const inviteId = urlParams.get('duel_invite');
  
  if (inviteId) {
    // ะกะธะผัะปััะธั ะฒัะพะดััะตะณะพ ะฟัะธะณะปะฐัะตะฝะธั
    handleIncomingInvite(mockInvite);
  }
  
  // ะ ัะตะฐะปัะฝะพะน ะฒะตััะธะธ: ะฟะพะดะฟะธัะบะฐ ะฝะฐ Telegram WebApp ัะพะฑััะธั
}, []);

// 2. ะะพะบะฐะท ัะฒะตะดะพะผะปะตะฝะธั ะพ ะฟัะธะณะปะฐัะตะฝะธะธ
const handleIncomingInvite = (invite) => {
  // ะะพะฑะฐะฒะปะตะฝะธะต ะฒ ัะฟะธัะพะบ ะฐะบัะธะฒะฝัั ะฟัะธะณะปะฐัะตะฝะธะน
  setIncomingInvites(prev => [...prev, newInvite]);
  
  // ะฃะฒะตะดะพะผะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั
  webApp.showAlert(`๐ฎ ะะพะฒะพะต ะฟัะธะณะปะฐัะตะฝะธะต ะฝะฐ ะดััะปั ะพั ${invite.fromUserName}!`);
  
  // ะะธะฑัะฐัะธั
  hapticManager.heavy();
};
```

### โโ ะจะฐะณ 5: ะัะฒะตั ะฝะฐ ะฟัะธะณะปะฐัะตะฝะธะต

```typescript
const respondToInvite = async (invite, accept: boolean) => {
  if (accept) {
    // โ ะะะะะฏะขะะ
    webApp.sendData(JSON.stringify({
      type: 'duel_response',
      inviteId: invite.id,
      response: 'accepted',
      fromUserId: currentUser.id
    }));
    
    // ะะฐะฟััะบ ัะตะฐะปัะฝะพะน ะดััะปะธ
    startRealDuel();
    
  } else {
    // โ ะะขะะะะะะะะ
    webApp.sendData(JSON.stringify({
      type: 'duel_response',
      inviteId: invite.id,
      response: 'declined'
    }));
  }
  
  // ะฃะดะฐะปะตะฝะธะต ะฟัะธะณะปะฐัะตะฝะธั ะธะท ัะฟะธัะบะฐ
  setIncomingInvites(prev => prev.filter(i => i.id !== invite.id));
};
```

## ๐ ะะพะปะฝัะน Flow ะดััะปะธ

```
๐ฑ ะะณัะพะบ A                          ๐ฑ ะะณัะพะบ B
     โ                                   โ
     โโ ะะฐะถะธะผะฐะตั "ะััะปั"                 โ
     โโ ะัะฑะธัะฐะตั ะะณัะพะบะฐ B                โ
     โโ ะัะฟัะฐะฒะปัะตั ะฟัะธะณะปะฐัะตะฝะธะต โโโโโโโโโโโค
     โโ ะกัะฐััั: "ะะถะธะดะฐะฝะธะต ะพัะฒะตัะฐ"        โโ ะะพะปััะฐะตั ัะฒะตะดะพะผะปะตะฝะธะต
     โ                                   โโ ะะธะดะธั pop-up ั ะฟัะธะณะปะฐัะตะฝะธะตะผ
     โ                                   โโ ะัะฑะธัะฐะตั: โ ะัะธะฝััั / โ ะัะบะปะพะฝะธัั
     โ                                   โ
     โโ ะะพะปััะฐะตั ะพัะฒะตั โโโโโโโโโโโโโโโโโโโค
     โ                                   โ
     โโ ะัะปะธ ะฟัะธะฝััะพ: ะะฐะฟััะบ ะดััะปะธ โโโโโโโผโ ะะฐะฟััะบ ะดััะปะธ
     โโ 60-ัะตะบัะฝะดะฝัะน ะผะฐัั                โโ 60-ัะตะบัะฝะดะฝัะน ะผะฐัั
     โโ ะะพะดััะตั ะพัะบะพะฒ                    โโ ะะพะดััะตั ะพัะบะพะฒ  
     โโ ะะฟัะตะดะตะปะตะฝะธะต ะฟะพะฑะตะดะธัะตะปั โโโโโโโโโโโผโ ะะพะบะฐะท ัะตะทัะปััะฐัะฐ
```

## โฐ ะฃะฟัะฐะฒะปะตะฝะธะต ะฒัะตะผะตะฝะตะผ

- **โณ ะัะตะผั ะถะธะทะฝะธ ะฟัะธะณะปะฐัะตะฝะธั**: 5 ะผะธะฝัั
- **๐ ะะฒัะพะผะฐัะธัะตัะบะพะต ะธััะตัะตะฝะธะต**: ะัะธะณะปะฐัะตะฝะธั ัะดะฐะปััััั ัะตัะตะท 5 ะผะธะฝัั
- **โก ะัััััะน ะพัะฒะตั**: ะะตะบะพะผะตะฝะดัะตััั ะพัะฒะตัะฐัั ะฒ ัะตัะตะฝะธะต 1-2 ะผะธะฝัั

## ๐ฎ ะขะธะฟั ะดััะปะตะน

1. **๐ซ ะะตะฐะปัะฝัะต ะธะณัะพะบะธ**: ะงะตะปะพะฒะตะบ vs ะงะตะปะพะฒะตะบ (ัะตัะตะท ะฟัะธะณะปะฐัะตะฝะธั)
2. **๐ค ะัะฐะบัะธะบะฐ ั ะะ**: ะงะตะปะพะฒะตะบ vs ะะ (ะผะณะฝะพะฒะตะฝะฝัะน ะทะฐะฟััะบ)
3. **๐ฏ ะขััะฝะธัั**: ะะฝะพะถะตััะฒะตะฝะฝัะต ะดััะปะธ (ะฑัะดััะฐั ััะฝะบัะธั)

## ๐ง ะขะตัะฝะธัะตัะบะฐั ัะตะฐะปะธะทะฐัะธั

### ะะพะผะฟะพะฝะตะฝัั:
- **`DuelInviteScreen.tsx`** - ะพัะฟัะฐะฒะบะฐ ะฟัะธะณะปะฐัะตะฝะธะน
- **`DuelInviteReceiver.tsx`** - ะฟะพะปััะตะฝะธะต ะฟัะธะณะปะฐัะตะฝะธะน  
- **`DuelScreen.tsx`** - ัะฐะผะฐ ะธะณัะฐ
- **`useDuelConnection.ts`** - WebSocket ัะธะผัะปััะธั

### API Integration:
- **Telegram WebApp SDK** - ะพัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธะน
- **URL Parameters** - ัะตััะธัะพะฒะฐะฝะธะต ะฟัะธะณะปะฐัะตะฝะธะน
- **Local Storage** - ัะพััะฐะฝะตะฝะธะต ัะพััะพัะฝะธั
- **Node.js Backend** - ะฑัะดััะฐั real-time ัะธััะตะผะฐ

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### ะะพะบะฐะปัะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต:
```bash
# 1. ะะฐะฟััะบ ัะตัะฒะตัะพะฒ
./start-all.ps1

# 2. ะัะบัััะธะต ะธะณัั
http://localhost:5173/

# 3. ะขะตััะธัะพะฒะฐะฝะธะต ะฟัะธะณะปะฐัะตะฝะธั ัะตัะตะท URL
http://localhost:5173/?duel_invite=test123
```

### ะ Telegram Mini App:
1. ะะฐัััะพะนัะต ะฑะพัะฐ ัะตัะตะท @BotFather
2. ะัะฟะพะปัะทัะนัะต URL: `https://orspiritus.github.io/tigerrosette/`
3. ะัะฟัะฐะฒะปัะนัะต ัะตะฐะปัะฝัะต ะฟัะธะณะปะฐัะตะฝะธั ะดััะทััะผ

## ๐ ะกัะฐััั ัะตะฐะปะธะทะฐัะธะธ

- โ **ะัะฟัะฐะฒะบะฐ ะฟัะธะณะปะฐัะตะฝะธะน** - ะณะพัะพะฒะพ
- โ **ะะพะปััะตะฝะธะต ะฟัะธะณะปะฐัะตะฝะธะน** - ะณะพัะพะฒะพ  
- โ **ะัะธะฝััะธะต/ะพัะบะปะพะฝะตะฝะธะต** - ะณะพัะพะฒะพ
- โ **ะะฒัะพะผะฐัะธัะตัะบะพะต ะธััะตัะตะฝะธะต** - ะณะพัะพะฒะพ
- โ **Telegram ะธะฝัะตะณัะฐัะธั** - ะณะพัะพะฒะพ
- โ **ะะตะฐะปัะฝัะต ะดััะปะธ** - ะณะพัะพะฒะพ
- ๐ **Backend real-time** - ะฒ ัะฐะทัะฐะฑะพัะบะต
- ๐ **ะขััะฝะธัั** - ะฟะปะฐะฝะธััะตััั
