const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cbh_XOmO.js","assets/pointsCloudSystem-2vcS-S4d.js","assets/index-rhFFGTpy.js","assets/motion-3WHHzQTP.js","assets/vendor-CIP6LD3P.js","assets/index-DdXHf9oj.css","assets/nativeXRFrame-DgHx7Vcb.js","assets/bumpVertex-CO1be_N_.js","assets/vertexColorMixing-CmRbdHdF.js","assets/helperFunctions-Dt8Ez0m5.js","assets/default.fragment-B-kdUbSd.js","assets/defaultUboDeclaration-C5WGJzzr.js","assets/oitFragment-COwarqmx.js","assets/mainUVVaryingDeclaration-kAMx1wwy.js","assets/easing-CYNgw8CS.js","assets/animationGroup-CmNY7dur.js","assets/dds-C64e2J1b.js","assets/khronosTextureContainer2-DKf4UHYP.js","assets/flowGraphSetDelayBlock-BBfSTBoS.js","assets/oitFragment-C1qnXpVq.js","assets/default.fragment-CtvPXGlm.js","assets/defaultUboDeclaration-mfzMqo_r.js","assets/mainUVVaryingDeclaration-BftUusui.js","assets/pbr.fragment-CxtSokwZ.js","assets/harmonicsFunctions-BiMv5FUV.js","assets/pbr.fragment-jox_Wzt1.js","assets/harmonicsFunctions-C2rlzhtf.js","assets/hdr-6elhj4O4.js","assets/tga-BWmadVoa.js","assets/default.vertex-kA04vKVP.js","assets/postprocess.vertex-DIr9NoBj.js","assets/dataReader-DPhJthB_.js","assets/flowGraphJsonPointerParserBlock-CAnLRrmw.js","assets/flowGraphCachedOperationBlock-ByGHbGUe.js","assets/flowGraphConsoleLogBlock-5lumJm4F.js","assets/flowGraphBranchBlock-peq7SHeE.js","assets/flowGraphDoNBlock-Cw0MCZY_.js","assets/flowGraphForLoopBlock-DFb4jPHE.js","assets/flowGraphThrottleBlock-DSWZx77Z.js","assets/flowGraphMultiGateBlock-CFHMOiDs.js","assets/flowGraphSwitchBlock-C1_GlPCW.js","assets/flowGraphWaitAllBlock-DaOfx9s5.js","assets/flowGraphCounterBlock-C3E0kQJV.js","assets/flowGraphWhileLoopBlock-CrKmMf0V.js","assets/flowGraphDebounceBlock-BD27J6wA.js","assets/flowGraphFlipFlopBlock-BeUAb8kC.js","assets/flowGraphSequenceBlock-CAUFTA3B.js","assets/flowGraphCancelDelayBlock-BDMNcw84.js","assets/flowGraphPlayAnimationBlock-Bn5vAf3k.js","assets/flowGraphStopAnimationBlock-BFnaBB8T.js","assets/flowGraphPauseAnimationBlock-CGPBCzif.js","assets/flowGraphInterpolationBlock-DCCdvI-3.js","assets/flowGraphEasingBlock-Cg0myAZj.js","assets/flowGraphBezierCurveEasingBlock-D8e5lRJR.js","assets/flowGraphConditionalDataBlock-CXbcBt68.js","assets/flowGraphGetVariableBlock-DhlcrG-o.js","assets/flowGraphSetVariableBlock-B1MhHVxv.js","assets/flowGraphTransformCoordinatesSystemBlock-DNGdu7-D.js","assets/flowGraphGetPropertyBlock-TnE7q6og.js","assets/flowGraphSetPropertyBlock-DXJsQY2Q.js","assets/flowGraphConstantBlock-DysdAuT5.js","assets/flowGraphGetAssetBlock-BLmhj2X4.js","assets/flowGraphDataSwitchBlock-DvJwFjXa.js","assets/flowGraphMathBlocks-C4x3is-T.js","assets/flowGraphBinaryOperationBlock-DZCn6KPT.js","assets/flowGraphUnaryOperationBlock-BvbmF_Vi.js","assets/flowGraphTernaryOperationBlock-Cd2lmfhN.js","assets/flowGraphMathCombineExtractBlocks-BlJzkMI0.js","assets/flowGraphMatrixMathBlocks-dFiznv_Q.js","assets/flowGraphVectorMathBlocks-VcTsQTKK.js","assets/flowGraphTypeToTypeBlocks-B2Nx7lWr.js","assets/flowGraphContextBlock-CSQiKo5X.js","assets/flowGraphArrayIndexBlock-GiVbpSS7.js","assets/flowGraphCodeExecutionBlock-H1yX0hqA.js","assets/flowGraphIndexOfBlock-CUZxmyHg.js","assets/flowGraphFunctionReferenceBlock-Dmuyl_SX.js","assets/flowGraphMeshPickEventBlock-DsWTRMRq.js","assets/flowGraphSceneReadyEventBlock-D0WxwWod.js","assets/flowGraphReceiveCustomEventBlock-pMlatOPN.js","assets/flowGraphSendCustomEventBlock-5_bDlDSf.js","assets/flowGraphSceneTickEventBlock-LT0lNSWj.js","assets/flowGraphPointerOutEventBlock-Crq0OLtx.js","assets/flowGraphPointerOverEventBlock-BjEu_EeF.js","assets/iesTextureLoader-kPQN6WPk.js","assets/pbr.vertex-C6clv1jW.js","assets/pbr.vertex-C_PHP_eE.js","assets/ddsTextureLoader-ClSrghAN.js","assets/envTextureLoader-CsQU9Zxe.js","assets/ktxTextureLoader-D2KSEczx.js","assets/tgaTextureLoader-oyntu75g.js","assets/hdrTextureLoader-Dr-h7uMN.js","assets/basisTextureLoader-CUPe6yBq.js","assets/basis-DDOcy81u.js","assets/exrTextureLoader-B-9p8Lmj.js","assets/exrLoader.configuration-BDKsI_eb.js","assets/default.vertex-Ao6IQZKy.js","assets/mesh.vertexData.functions-CojAmKRV.js","assets/lodCube.fragment-D_gIz9a5.js","assets/lod.fragment-CVDCt30G.js","assets/lodCube.fragment-Ds6X7yQ8.js","assets/lod.fragment-C6sl9DjL.js","assets/rgbdDecode.fragment-Dd8vf-n0.js","assets/rgbdEncode.fragment-C5jKXevo.js","assets/rgbdDecode.fragment-B9rvcZQ2.js","assets/rgbdEncode.fragment-CC1-xNHs.js","assets/pass.fragment-D7l-dmRx.js","assets/passCube.fragment-sEcb3B-6.js","assets/pass.fragment-B8b0gssu.js","assets/passCube.fragment-_Y3ijnqO.js","assets/index-KdCQAYTE.js"])))=>i.map(i=>d[i]);
var T=Object.defineProperty;var k=(r,e,t)=>e in r?T(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var l=(r,e,t)=>k(r,typeof e!="symbol"?e+"":e,t);import{e as u,_ as P}from"./index-rhFFGTpy.js";import{j as y}from"./motion-3WHHzQTP.js";import{r as f}from"./vendor-CIP6LD3P.js";import{S as R,C as w,T as M,V as S,a as x,P as D}from"./pointsCloudSystem-2vcS-S4d.js";import{M as C,G as F,P as _}from"./nativeXRFrame-DgHx7Vcb.js";import"./animationGroup-CmNY7dur.js";import"./easing-CYNgw8CS.js";import"./flowGraphConsoleLogBlock-5lumJm4F.js";import"./flowGraphBranchBlock-peq7SHeE.js";import"./flowGraphDoNBlock-Cw0MCZY_.js";import"./flowGraphForLoopBlock-DFb4jPHE.js";import"./flowGraphThrottleBlock-DSWZx77Z.js";import"./flowGraphMultiGateBlock-CFHMOiDs.js";import"./flowGraphSwitchBlock-C1_GlPCW.js";import"./flowGraphWaitAllBlock-DaOfx9s5.js";import"./flowGraphCounterBlock-C3E0kQJV.js";import"./flowGraphWhileLoopBlock-CrKmMf0V.js";import"./flowGraphDebounceBlock-BD27J6wA.js";import"./flowGraphFlipFlopBlock-BeUAb8kC.js";import"./flowGraphSequenceBlock-CAUFTA3B.js";import"./flowGraphSetDelayBlock-BBfSTBoS.js";import"./flowGraphCancelDelayBlock-BDMNcw84.js";import"./flowGraphPlayAnimationBlock-Bn5vAf3k.js";import"./flowGraphStopAnimationBlock-BFnaBB8T.js";import"./flowGraphPauseAnimationBlock-CGPBCzif.js";import"./flowGraphInterpolationBlock-DCCdvI-3.js";import"./flowGraphEasingBlock-Cg0myAZj.js";import"./flowGraphBezierCurveEasingBlock-D8e5lRJR.js";import"./flowGraphConditionalDataBlock-CXbcBt68.js";import"./flowGraphGetVariableBlock-DhlcrG-o.js";import"./flowGraphSetVariableBlock-B1MhHVxv.js";import"./flowGraphTransformCoordinatesSystemBlock-DNGdu7-D.js";import"./flowGraphGetPropertyBlock-TnE7q6og.js";import"./flowGraphSetPropertyBlock-DXJsQY2Q.js";import"./flowGraphConstantBlock-DysdAuT5.js";import"./flowGraphGetAssetBlock-BLmhj2X4.js";import"./flowGraphDataSwitchBlock-DvJwFjXa.js";import"./flowGraphMathBlocks-C4x3is-T.js";import"./flowGraphMathCombineExtractBlocks-BlJzkMI0.js";import"./flowGraphMatrixMathBlocks-dFiznv_Q.js";import"./flowGraphVectorMathBlocks-VcTsQTKK.js";import"./flowGraphJsonPointerParserBlock-CAnLRrmw.js";import"./flowGraphTypeToTypeBlocks-B2Nx7lWr.js";import"./flowGraphContextBlock-CSQiKo5X.js";import"./flowGraphArrayIndexBlock-GiVbpSS7.js";import"./flowGraphIndexOfBlock-CUZxmyHg.js";import"./flowGraphFunctionReferenceBlock-Dmuyl_SX.js";import"./flowGraphMeshPickEventBlock-DsWTRMRq.js";import"./flowGraphSceneReadyEventBlock-D0WxwWod.js";import"./flowGraphReceiveCustomEventBlock-pMlatOPN.js";import"./flowGraphSendCustomEventBlock-5_bDlDSf.js";import"./flowGraphSceneTickEventBlock-LT0lNSWj.js";import"./flowGraphPointerOutEventBlock-Crq0OLtx.js";import"./flowGraphPointerOverEventBlock-BjEu_EeF.js";import"./pbr.vertex-C6clv1jW.js";import"./pbr.fragment-jox_Wzt1.js";import"./pbr.vertex-C_PHP_eE.js";import"./pbr.fragment-CxtSokwZ.js";import"./dds-C64e2J1b.js";import"./khronosTextureContainer2-DKf4UHYP.js";import"./hdr-6elhj4O4.js";import"./basis-DDOcy81u.js";import"./exrLoader.configuration-BDKsI_eb.js";import"./vertexColorMixing-CmRbdHdF.js";import"./bumpVertex-CO1be_N_.js";import"./helperFunctions-Dt8Ez0m5.js";import"./oitFragment-COwarqmx.js";import"./oitFragment-C1qnXpVq.js";import"./default.fragment-B-kdUbSd.js";import"./default.fragment-CtvPXGlm.js";import"./default.vertex-kA04vKVP.js";import"./default.vertex-Ao6IQZKy.js";import"./lodCube.fragment-D_gIz9a5.js";import"./lod.fragment-CVDCt30G.js";import"./lodCube.fragment-Ds6X7yQ8.js";import"./lod.fragment-C6sl9DjL.js";import"./rgbdDecode.fragment-Dd8vf-n0.js";import"./rgbdEncode.fragment-C5jKXevo.js";import"./rgbdDecode.fragment-B9rvcZQ2.js";import"./rgbdEncode.fragment-CC1-xNHs.js";import"./postprocess.vertex-DIr9NoBj.js";import"./pass.fragment-D7l-dmRx.js";import"./passCube.fragment-sEcb3B-6.js";import"./pass.fragment-B8b0gssu.js";import"./passCube.fragment-_Y3ijnqO.js";import"./tga-BWmadVoa.js";import"./flowGraphCachedOperationBlock-ByGHbGUe.js";import"./flowGraphBinaryOperationBlock-DZCn6KPT.js";import"./flowGraphUnaryOperationBlock-BvbmF_Vi.js";import"./flowGraphTernaryOperationBlock-Cd2lmfhN.js";import"./harmonicsFunctions-C2rlzhtf.js";import"./mainUVVaryingDeclaration-kAMx1wwy.js";import"./harmonicsFunctions-BiMv5FUV.js";import"./mainUVVaryingDeclaration-BftUusui.js";import"./defaultUboDeclaration-C5WGJzzr.js";import"./defaultUboDeclaration-mfzMqo_r.js";const b=class b{constructor(){l(this,"engine",null);l(this,"scene",null);l(this,"features",[]);l(this,"disposers",[]);l(this,"ready",!1);l(this,"canvas",null)}static get instance(){return this._i||(this._i=new b)}registerFeature(e){if(this.ready&&this.engine&&this.scene&&this.canvas){const t=e({engine:this.engine,scene:this.scene,canvas:this.canvas});typeof t=="function"&&this.disposers.push(t)}else this.features.push(e)}init(e,t,o){this.engine=e,this.scene=t,this.canvas=o,this.ready=!0;for(const a of this.features){const s=a({engine:e,scene:t,canvas:o});typeof s=="function"&&this.disposers.push(s)}this.features=[]}dispose(){var e,t;for(const o of this.disposers)try{o()}catch{}this.disposers=[];try{(e=this.scene)==null||e.dispose()}catch{}try{(t=this.engine)==null||t.dispose()}catch{}this.engine=null,this.scene=null,this.ready=!1,this.canvas=null}};l(b,"_i");let E=b;const g=E.instance,I=({scene:r})=>{const e=C.CreateBox("energyBox",{size:1.2},r),t=new R("energyMat",r);t.emissiveColor=new w(1,.5,.15),e.material=t;let o=null;try{o=new F("glow",r,{blurKernelSize:32}),o.intensity=.6,o.addIncludedOnlyMesh(e)}catch{}const a=r.onBeforeRenderObservable.add(()=>{e.rotation.y+=.01,e.rotation.x+=.005});return()=>{r.onBeforeRenderObservable.remove(a);try{e.dispose()}catch{}try{o==null||o.dispose()}catch{}}},L=({scene:r})=>{const e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==",t=new _("fxParticles",4e3,r);t.particleTexture=new M(e,r,!0,!1,M.NEAREST_SAMPLINGMODE),t.emitter=new S(0,0,0),t.minEmitPower=.3,t.maxEmitPower=2.2,t.minSize=.05,t.maxSize=.35,t.minLifeTime=.3,t.maxLifeTime=1.2,t.emitRate=0,t.color1=new x(1,.65,.25,1),t.color2=new x(1,.35,.1,1),t.colorDead=new x(.2,.1,.05,0),t.updateSpeed=.012,t.start();function o(i){const c=t.emitRate;t.emitRate=i,setTimeout(()=>{t.emitRate=c},60)}const a=u.on("levelUp",({level:i})=>o(400+i*40)),s=u.on("shock",({severity:i})=>{o(i==="critical"?600:i==="severe"?420:i==="moderate"?300:180)}),m=u.on("stageAdvance",({stage:i})=>o(500+i*60)),n=u.on("itemDrop",({level:i})=>o(260+i*30)),d=u.on("aiAttack",({voltage:i})=>o(300+Math.min(600,i)));return()=>{a(),s(),m(),n(),d();try{t.dispose()}catch{}}},O=({scene:r})=>{const e=C.CreateBox("outletBase",{width:2.2,height:3,depth:.25},r);e.position=new S(0,0,0);const t=new R("outletMat",r);t.diffuseColor=new w(.12,.12,.14),t.specularColor=new w(.05,.05,.05),e.material=t;const o={t:0},a=r.onBeforeRenderObservable.add(()=>{if(o.t>0){o.t-=r.getEngine().getDeltaTime()*.004;const n=Math.max(0,o.t);t.emissiveColor=new w(.8+.2*n,.45+.4*n,.15+.2*n)}else t.emissiveColor=new w(.8,.45,.15)}),s=u.on("outletClick",()=>{o.t=1}),m=u.on("shock",({severity:n})=>{o.t=n==="critical"?2.2:n==="severe"?1.6:1.1});return()=>{s(),m(),r.onBeforeRenderObservable.remove(a);try{e.dispose()}catch{}}},z=({scene:r})=>{let e=0;const t=new D("shockDistortion",`
    precision highp float;
    varying vec2 vUV;
    uniform float iTime; uniform float iIntensity;
    float hash(vec2 p){return fract(sin(dot(p,vec2(41.3,289.1)))*43758.5453);} 
    void main(){
      vec2 uv=vUV; 
      float n = hash(floor(uv*vec2(64.0))+floor(iTime*10.0));
      uv += (n-0.5)*0.02*iIntensity;
      gl_FragColor = texture2D(textureSampler, uv);
    }
  `,["iTime","iIntensity"],null,1,null,void 0,r.getEngine(),!0);let o=performance.now();t.onApply=s=>{const m=(performance.now()-o)/1e3;e=Math.max(0,e-r.getEngine().getDeltaTime()*6e-4),s.setFloat("iTime",m),s.setFloat("iIntensity",e)};const a=u.on("shock",({severity:s})=>{e=s==="critical"?1.6:s==="severe"?1.2:s==="moderate"?.8:.5});return()=>{a();try{t.dispose()}catch{}}},G=({scene:r})=>{const e=C.CreateBox("opponentBar",{width:.3,height:.1,depth:.3},r);e.position=new S(1.6,1.2,0);const t=new R("opponentMat",r);t.emissiveColor=new w(.2,.5,1),e.material=t;const o=u.on("duelState",({players:a})=>{const s=Object.values(a);if(!s.length)return;const m=s.reduce((i,c)=>c.score>i?c.score:i,1),n=s[0],d=.3+Math.min(2.5,n.score/(m||1)*1.5);e.scaling.y=d,e.position.y=.5+d/2,t.emissiveColor=new w(.2+n.streak*.05%.5,.5,1-Math.min(.7,n.volts/1e3))});return()=>{o();try{e.dispose()}catch{}}},Te=()=>{const r=f.useRef(null),[e,t]=f.useState({mode:"loading",message:"Initializing...",frames:0}),[o,a]=f.useState(0),s=f.useRef(performance.now()),m=f.useRef(0),n=f.useRef(0);return f.useEffect(()=>{let d=!1;(async()=>{if(r.current)try{const i=await P(()=>import("./index-Cbh_XOmO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108]));await P(()=>import("./index-KdCQAYTE.js"),__vite__mapDeps([109,1,2,3,4,5,31]));const c=r.current;let h=null;if(navigator.gpu&&i.WebGPUEngine)try{const p=new i.WebGPUEngine(c,{adaptToDeviceRatio:!0});await p.initAsync(),h=p,t(A=>({...A,mode:"webgpu",message:"Babylon WebGPU"}))}catch(p){console.warn("WebGPU init failed",p)}h||(h=new i.Engine(c,!0),t(p=>({...p,mode:"webgl",message:"Babylon WebGL"})));const v=new i.Scene(h);new i.ArcRotateCamera("cam",Math.PI/4,Math.PI/3,6,i.Vector3.Zero(),v).attachControl(c,!0),new i.HemisphericLight("hl",new i.Vector3(0,1,0),v),g.init(h,v,c),g.registerFeature(I),g.registerFeature(O),g.registerFeature(L),g.registerFeature(z),g.registerFeature(G),h.runRenderLoop(()=>{v.render(),n.current++,m.current++;const p=performance.now();p-s.current>1e3&&(a(Math.round(m.current*1e3/(p-s.current))),m.current=0,s.current=p),n.current%60===0&&t(A=>({...A,frames:n.current}))});const B=()=>h.resize();return window.addEventListener("resize",B),d?void 0:()=>{d=!0,window.removeEventListener("resize",B),g.dispose()}}catch(i){t({mode:"error",message:(i==null?void 0:i.message)||"Init error",frames:0})}})()},[]),y.jsxs("div",{style:{border:"1px solid #334",padding:8,borderRadius:8,background:"#0d0f15",color:"#eaeaea"},children:[y.jsxs("div",{style:{fontSize:12,marginBottom:6},children:["Mod Babylon: ",e.message," frames:",e.frames," fps:",o]}),y.jsx("canvas",{ref:r,style:{width:"100%",height:300,display:"block",background:"#050608"}})]})};export{Te as BabylonStageAdvanced,Te as default};
//# sourceMappingURL=BabylonStageAdvanced-DCFzqzTU.js.map
