{"version":3,"mappings":";0HAGA,MAAMA,EAAc,SAAY,CAC9B,MAAMC,EAAO,MAAAC,EAAA,IAAM,OAAO,qBAAiB,4VAC3C,aAAAA,EAAA,IAAM,OAAO,qBAAoB,uCAC1BD,CACT,EAIaE,EAAyB,IAAM,CAC1C,MAAMC,EAAYC,SAAiC,IAAI,EACjD,CAACC,EAAQC,CAAS,EAAIC,WAAwB,CAAE,KAAM,UAAW,QAAS,kBAAmB,EAC7FC,EAAWJ,SAAO,CAAC,EACnBK,EAAsBL,SAAO,EAAK,EAExCM,mBAAU,IAAM,CACd,IAAIC,EAAW,GACbC,EAAc,KACdC,EAAa,MAEhB,SAAY,CACT,GAAKV,EAAU,QACf,GAAI,CACF,MAAMW,EAAI,MAAMf,EAAA,EACVgB,EAASZ,EAAU,QAEzB,GAAK,UAAkB,KAAOW,EAAE,aAC9B,GAAI,CACF,MAAME,EAAS,IAAIF,EAAE,aAAaC,CAAM,EACxC,MAAMC,EAAO,YACbJ,EAASI,EACTV,EAAU,CAAE,KAAM,SAAU,QAAS,iBAAkB,CACzD,OAASW,EAAG,CACV,QAAQ,KAAK,2CAA4CA,CAAC,CAC5D,CAEGL,IACHA,EAAS,IAAIE,EAAE,OAAOC,EAAQ,EAAI,EAClCT,EAAUY,GAAQA,EAAK,OAAO,SAAUA,EAAO,CAAE,KAAM,QAAS,QAAS,gBAAiB,GAE5FL,EAAQ,IAAIC,EAAE,MAAMF,CAAM,EACX,IAAIE,EAAE,gBAAgB,MAAO,KAAK,GAAG,EAAG,KAAK,GAAG,EAAG,EAAGA,EAAE,QAAQ,OAAQD,CAAK,EACrF,cAAcE,EAAQ,EAAI,EACjC,IAAID,EAAE,iBAAiB,IAAK,IAAIA,EAAE,QAAQ,EAAE,EAAE,CAAC,EAAGD,CAAK,EACvD,MAAMM,EAAML,EAAE,YAAY,UAAU,MAAM,CAAE,KAAK,KAAOD,CAAK,EACvDO,EAAM,IAAIN,EAAE,iBAAiB,IAAKD,CAAK,EAC7CO,EAAI,cAAgB,IAAIN,EAAE,OAAO,EAAE,GAAI,GAAI,EAC3CK,EAAI,SAAWC,EAGf,GAAI,CAEF,MAAMC,EAAO,IAAIP,EAAE,UAAU,OAAQD,EAAO,CAAE,eAAgB,GAAI,EAClEQ,EAAK,UAAY,GACjBA,EAAK,oBAAoBF,CAAG,CAC9B,OAASF,EAAG,CACV,QAAQ,KAAK,yBAA0BA,CAAC,CAC1C,CAGA,IAAIK,EAAe,GACnB,GAAI,CACF,MAAMC,EAAa,qHACnB,IAAIC,EACCV,EAAU,mBAAsBA,EAAU,kBAAkB,aAC/DU,EAAK,IAAKV,EAAU,kBAAkB,eAAgB,CAAE,SAAU,KAAQD,CAAK,EAC/ES,EAAe,IAEfE,EAAK,IAAIV,EAAE,eAAe,eAAgB,IAAMD,CAAK,EAEvDW,EAAG,gBAAkB,IAAIV,EAAE,QAAQS,EAAYV,EAAO,GAAM,GAAOC,EAAE,QAAQ,oBAAoB,EACjGU,EAAG,QAAUL,EACbK,EAAG,aAAe,GAClBA,EAAG,aAAe,EAChBA,EAAG,QAAU,IAAMA,EAAG,QAAU,IAClCA,EAAG,YAAc,GAAKA,EAAG,YAAc,IACvCA,EAAG,SAAW,KACdA,EAAG,WAAa,IAAIV,EAAE,QAAQ,IAAK,IAAK,GAAI,EAC5CU,EAAG,WAAa,IAAIV,EAAE,QAAQ,GAAI,GAAI,EAAG,EACzCU,EAAG,WAAa,IAAIV,EAAE,QAAQ,IAAM,IAAK,GAAI,EAC7CU,EAAG,WAAa,IAAIV,EAAE,QAAQ,GAAK,IAAK,EAAG,EAC3CU,EAAG,OAAS,IAAIV,EAAE,OAAO,EAAE,GAAI,GAAI,CAAC,EACpCU,EAAG,OAAS,IAAIV,EAAE,OAAO,EAAE,GAAI,IAAK,CAAC,EACrCU,EAAG,UAAY,IAAIV,EAAE,OAAO,GAAI,GAAI,IAAK,CAAC,EAC1CU,EAAG,YAAc,IACjBA,EAAG,QACHlB,EAAUmB,IAAM,CAAE,GAAGA,EAAG,aAAAH,GAAe,CACzC,OAASL,EAAG,CACV,QAAQ,KAAK,8BAA+BA,CAAC,CAC/C,CAEAL,EAAO,cAAc,IAAM,CACzBO,EAAI,SAAS,GAAK,IAClBA,EAAI,SAAS,GAAK,KAClBN,EAAM,SACNL,EAAS,UAEL,CAACC,EAAoB,SAAWD,EAAS,QAAU,GACrDC,EAAoB,QAAU,GAC9BH,EAAUmB,IAAM,CAAE,GAAGA,EAAG,aAAc,YAAY,MAAO,OAAQ,GAAI,GAC5DjB,EAAS,QAAU,KAAO,GAEnCF,MAAgB,CAAE,GAAGmB,EAAG,OAAQjB,EAAS,SAAU,CAEvD,CAAC,EAED,WAAW,IAAM,CACVC,EAAoB,SACvBH,EAAUmB,IAAM,CAAE,GAAGA,EAAG,QAASA,EAAE,QAAU,qCAAsC,CAEvF,EAAG,GAAI,EACP,MAAMC,EAAW,IAAMd,GAAA,YAAAA,EAAQ,SAE/B,OADA,OAAO,iBAAiB,SAAUc,CAAQ,EACtCf,EAAU,OACP,IAAM,OACXA,EAAW,GACX,OAAO,oBAAoB,SAAUe,CAAQ,EAC7C,GAAI,EAAEC,EAAAf,GAAA,YAAAA,EAAQ,UAAR,MAAAe,EAAA,KAAAf,EAAqB,MAAQ,CAAC,CACtC,CACF,OAAS,EAAO,CACdN,EAAU,CAAE,KAAM,QAAS,SAAS,iBAAG,UAAW,aAAc,CAClE,CACF,IACF,EAAG,EAAE,EAGHsB,OAAC,OAAI,MAAO,CAAC,OAAO,iBAAkB,QAAQ,EAAG,aAAa,EAAG,WAAW,UAAW,MAAM,QAC3F,UAAAA,OAAC,OAAI,MAAO,CAAC,SAAS,GAAI,aAAa,GAAI,sBAC/BvB,EAAO,QAChBA,EAAO,eAAiB,QACvBuB,OAAC,QAAK,MAAO,CAAC,WAAW,EAAG,QAAQ,IAAM,wBAAYvB,EAAO,aAAe,MAAQ,OAAM,GAE9F,QACC,UAAO,IAAKF,EAAW,GAAG,uBAAuB,cAAaE,EAAO,KAAM,MAAO,CAAC,MAAM,OAAQ,OAAO,IAAK,WAAW,WAAY,EACrIuB,OAAC,OAAI,MAAO,CAAC,SAAS,GAAI,UAAU,EAAG,QAAQ,IAC5C,UAAAvB,EAAO,SAAW,QAAauB,OAAC,QAAK,qBAASvB,EAAO,QAAO,EAC5DA,EAAO,cAAgBwB,MAAC,QAAK,MAAO,CAAC,WAAW,GAAI,kBAAM,GAC7D,GACF,CAEJ","names":["loadBabylon","core","__vitePreload","BabylonStage","canvasRef","useRef","status","setStatus","useState","frameRef","firstFrameLoggedRef","useEffect","disposed","engine","scene","B","canvas","webgpu","e","prev","box","mat","glow","gpuParticles","whitePixel","ps","s","onResize","_a","jsxs","jsx"],"ignoreList":[],"sources":["../../src/components/BabylonStage.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\n\r\n// Lazy dynamic imports to reduce initial bundle\r\nconst loadBabylon = async () => {\r\n  const core = await import('@babylonjs/core');\r\n  await import('@babylonjs/loaders');\r\n  return core;\r\n};\r\n\r\ninterface BabylonStatus { mode: 'loading'|'webgpu'|'webgl'|'error'; message: string; gpuParticles?: boolean; frames?: number; firstFrameAt?: number }\r\n\r\nexport const BabylonStage: React.FC = () => {\r\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\r\n  const [status, setStatus] = useState<BabylonStatus>({ mode: 'loading', message: 'Initializing...' });\r\n  const frameRef = useRef(0);\r\n  const firstFrameLoggedRef = useRef(false);\r\n\r\n  useEffect(() => {\r\n    let disposed = false;\r\n  let engine: any = null;\r\n  let scene: any = null;\r\n\r\n  (async () => {\r\n      if (!canvasRef.current) return;\r\n      try {\r\n        const B = await loadBabylon();\r\n        const canvas = canvasRef.current;\r\n        // Try WebGPU\r\n        if ((navigator as any).gpu && B.WebGPUEngine) {\r\n          try {\r\n            const webgpu = new B.WebGPUEngine(canvas);\r\n            await webgpu.initAsync();\r\n            engine = webgpu;\r\n            setStatus({ mode: 'webgpu', message: 'Babylon WebGPU' });\r\n          } catch (e) {\r\n            console.warn('Babylon WebGPU failed, fallback to WebGL', e);\r\n          }\r\n        }\r\n        if (!engine) {\r\n          engine = new B.Engine(canvas, true);\r\n          setStatus(prev => prev.mode==='webgpu'? prev : { mode: 'webgl', message: 'Babylon WebGL' });\r\n        }\r\n        scene = new B.Scene(engine);\r\n        const camera = new B.ArcRotateCamera('cam', Math.PI/4, Math.PI/3, 6, B.Vector3.Zero(), scene);\r\n        camera.attachControl(canvas, true);\r\n        new B.HemisphericLight('h', new B.Vector3(0,1,0), scene);\r\n        const box = B.MeshBuilder.CreateBox('box',{ size:1.2 }, scene);\r\n        const mat = new B.StandardMaterial('m', scene);\r\n        mat.emissiveColor = new B.Color3(1,0.5,0.15);\r\n        box.material = mat;\r\n\r\n        // Glow / bloom pipeline\r\n        try {\r\n          // Simple glow layer (lighter weight than full pipeline)\r\n          const glow = new B.GlowLayer('glow', scene, { blurKernelSize: 32 });\r\n          glow.intensity = 0.6;\r\n          glow.addIncludedOnlyMesh(box);\r\n        } catch (e) {\r\n          console.warn('Glow layer init failed', e);\r\n        }\r\n\r\n        // GPU Particle System (fallback to CPU if unsupported)\r\n        let gpuParticles = false;\r\n        try {\r\n          const whitePixel = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==\";\r\n          let ps: any;\r\n          if ((B as any).GPUParticleSystem && (B as any).GPUParticleSystem.IsSupported) {\r\n            ps = new (B as any).GPUParticleSystem('gpuParticles', { capacity: 8000 }, scene);\r\n            gpuParticles = true;\r\n          } else {\r\n            ps = new B.ParticleSystem('cpuParticles', 4000, scene);\r\n          }\r\n          ps.particleTexture = new B.Texture(whitePixel, scene, true, false, B.Texture.NEAREST_SAMPLINGMODE);\r\n          ps.emitter = box;\r\n          ps.minEmitPower = 0.5;\r\n          ps.maxEmitPower = 2.0;\r\n            ps.minSize = 0.05; ps.maxSize = 0.25;\r\n          ps.minLifeTime = 0.4; ps.maxLifeTime = 1.2;\r\n          ps.emitRate = 1500;\r\n          ps.minEmitBox = new B.Vector3(-0.4,-0.4,-0.4);\r\n          ps.maxEmitBox = new B.Vector3(0.4,0.4,0.4);\r\n          ps.direction1 = new B.Vector3(-0.5, 1.2, -0.5);\r\n          ps.direction2 = new B.Vector3(0.5, 1.6, 0.5);\r\n          ps.color1 = new B.Color4(1,0.6,0.2,1);\r\n          ps.color2 = new B.Color4(1,0.3,0.05,1);\r\n          ps.colorDead = new B.Color4(0.2,0.1,0.05,0);\r\n          ps.updateSpeed = 0.01;\r\n          ps.start();\r\n          setStatus(s => ({ ...s, gpuParticles }));\r\n        } catch (e) {\r\n          console.warn('Particle system init failed', e);\r\n        }\r\n        // Simple animation\r\n        engine.runRenderLoop(() => {\r\n          box.rotation.y += 0.01;\r\n          box.rotation.x += 0.005;\r\n          scene.render();\r\n          frameRef.current++;\r\n          // First frame mark\r\n          if (!firstFrameLoggedRef.current && frameRef.current > 0) {\r\n            firstFrameLoggedRef.current = true;\r\n            setStatus(s => ({ ...s, firstFrameAt: performance.now(), frames: 1 }));\r\n          } else if (frameRef.current % 60 === 0) {\r\n            // Update every ~1s @60fps\r\n            setStatus(s => ({ ...s, frames: frameRef.current }));\r\n          }\r\n        });\r\n        // If no frame after 3s, mark as error-like diagnostic\r\n        setTimeout(() => {\r\n          if (!firstFrameLoggedRef.current) {\r\n            setStatus(s => ({ ...s, message: s.message + ' (no frames yet â€“ WebGL blocked?)' }));\r\n          }\r\n        }, 3000);\r\n        const onResize = () => engine?.resize();\r\n        window.addEventListener('resize', onResize);\r\n        if (disposed) return;\r\n        return () => {\r\n          disposed = true;\r\n          window.removeEventListener('resize', onResize);\r\n          try { engine?.dispose?.(); } catch {}\r\n        };\r\n      } catch (e:any) {\r\n        setStatus({ mode: 'error', message: e?.message || 'Init error' });\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  return (\r\n    <div style={{border:'1px solid #333', padding:8, borderRadius:8, background:'#101013', color:'#eee'}}>\r\n      <div style={{fontSize:12, marginBottom:6}}>\r\n        Babylon: {status.message}\r\n        {status.gpuParticles !== undefined && (\r\n          <span style={{marginLeft:8, opacity:0.8}}>Particles: {status.gpuParticles ? 'GPU' : 'CPU'}</span>\r\n        )}\r\n      </div>\r\n      <canvas ref={canvasRef} id=\"babylon-stage-canvas\" data-engine={status.mode} style={{width:'100%', height:300, background:'#08080a'}} />\r\n      <div style={{fontSize:10, marginTop:4, opacity:0.7}}>\r\n        {status.frames !== undefined && <span>frames: {status.frames}</span>}\r\n        {status.firstFrameAt && <span style={{marginLeft:8}}>active</span>}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BabylonStage;\r\n"],"file":"assets/BabylonStage-DTqXF1d6.js"}