var ge=Object.defineProperty;var fe=(r,a,s)=>a in r?ge(r,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[a]=s;var F=(r,a,s)=>fe(r,typeof a!="symbol"?a+"":a,s);import{j as e,m,A as U}from"./motion-3WHHzQTP.js";import{a as pe,r as u,g as ve,R as ne}from"./vendor-CIP6LD3P.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function t(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}})();var Y={},Q=pe;Y.createRoot=Q.createRoot,Y.hydrateRoot=Q.hydrateRoot;const ye={},Z=r=>{let a;const s=new Set,t=(g,p)=>{const x=typeof g=="function"?g(a):g;if(!Object.is(x,a)){const f=a;a=p??(typeof x!="object"||x===null)?x:Object.assign({},a,x),s.forEach(c=>c(a,f))}},i=()=>a,o={setState:t,getState:i,getInitialState:()=>h,subscribe:g=>(s.add(g),()=>s.delete(g)),destroy:()=>{(ye?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},h=a=r(t,i,o);return o},be=r=>r?Z(r):Z;var oe={exports:{}},ce={},de={exports:{}},me={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O=u;function je(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var we=typeof Object.is=="function"?Object.is:je,Ne=O.useState,ke=O.useEffect,Se=O.useLayoutEffect,Ee=O.useDebugValue;function Me(r,a){var s=a(),t=Ne({inst:{value:s,getSnapshot:a}}),i=t[0].inst,l=t[1];return Se(function(){i.value=s,i.getSnapshot=a,K(i)&&l({inst:i})},[r,s,a]),ke(function(){return K(i)&&l({inst:i}),r(function(){K(i)&&l({inst:i})})},[r]),Ee(s),s}function K(r){var a=r.getSnapshot;r=r.value;try{var s=a();return!we(r,s)}catch{return!0}}function Ce(r,a){return a()}var Te=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Ce:Me;me.useSyncExternalStore=O.useSyncExternalStore!==void 0?O.useSyncExternalStore:Te;de.exports=me;var Ie=de.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G=u,Ae=Ie;function De(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var Re=typeof Object.is=="function"?Object.is:De,$e=Ae.useSyncExternalStore,Le=G.useRef,Pe=G.useEffect,Fe=G.useMemo,_e=G.useDebugValue;ce.useSyncExternalStoreWithSelector=function(r,a,s,t,i){var l=Le(null);if(l.current===null){var n={hasValue:!1,value:null};l.current=n}else n=l.current;l=Fe(function(){function o(f){if(!h){if(h=!0,g=f,f=t(f),i!==void 0&&n.hasValue){var c=n.value;if(i(c,f))return p=c}return p=f}if(c=p,Re(g,f))return c;var v=t(f);return i!==void 0&&i(c,v)?(g=f,c):(g=f,p=v)}var h=!1,g,p,x=s===void 0?null:s;return[function(){return o(a())},x===null?void 0:function(){return o(x())}]},[a,s,t,i]);var d=$e(r,l[0],l[1]);return Pe(function(){n.hasValue=!0,n.value=d},[d]),_e(d),d};oe.exports=ce;var Ue=oe.exports;const qe=ve(Ue),xe={},{useDebugValue:He}=ne,{useSyncExternalStoreWithSelector:Ve}=qe;let ee=!1;const Be=r=>r;function Oe(r,a=Be,s){(xe?"production":void 0)!=="production"&&s&&!ee&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),ee=!0);const t=Ve(r.subscribe,r.getState,r.getServerState||r.getInitialState,a,s);return He(t),t}const te=r=>{(xe?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const a=typeof r=="function"?be(r):r,s=(t,i)=>Oe(a,t,i);return Object.assign(s,a),s},We=r=>r?te(r):te,H=[{level:1,requiredExperience:0,voltsReward:0,title:"Новичок",description:"Первые шаги с электричеством"},{level:2,requiredExperience:5e3,voltsReward:50,title:"Ученик",description:"Осваиваете основы"},{level:3,requiredExperience:15e3,voltsReward:75,title:"Практикант",description:"⚠️ Опасно! Теперь удар током отнимает очки"},{level:4,requiredExperience:35e3,voltsReward:100,title:"Любитель",description:"🔥 Критично! Напряжение отнимается от очков"},{level:5,requiredExperience:7e4,voltsReward:150,title:"Энтузиаст",description:"Проявляете смелость в опасной игре"},{level:6,requiredExperience:125e3,voltsReward:200,title:"Смельчак",description:"Не боитесь рисковать"},{level:7,requiredExperience:2e5,voltsReward:250,title:"Храбрец",description:"Идете на оправданный риск"},{level:8,requiredExperience:3e5,voltsReward:300,title:"Отважный",description:"Покоряете сложности"},{level:9,requiredExperience:45e4,voltsReward:400,title:"Безрассудный",description:"Играете с опасностью"},{level:10,requiredExperience:65e4,voltsReward:500,title:"Профессионал",description:"Мастерски владеете риском"},{level:11,requiredExperience:9e5,voltsReward:600,title:"Эксперт",description:"Знаете все тонкости"},{level:12,requiredExperience:12e5,voltsReward:750,title:"Мастер",description:"Превосходите ожидания"},{level:13,requiredExperience:16e5,voltsReward:900,title:"Виртуоз",description:"Играете как художник"},{level:14,requiredExperience:21e5,voltsReward:1100,title:"Гуру",description:"Достигли просветления"},{level:15,requiredExperience:27e5,voltsReward:1300,title:"Сенсей",description:"Учите других"},{level:16,requiredExperience:35e5,voltsReward:1500,title:"Легенда",description:"О вас слагают легенды"},{level:17,requiredExperience:45e5,voltsReward:1750,title:"Миф",description:"Недостижимый идеал"},{level:18,requiredExperience:58e5,voltsReward:2e3,title:"Титан",description:"Сверхчеловеческие способности"},{level:19,requiredExperience:75e5,voltsReward:2300,title:"Бог Электричества",description:"Повелеваете молниями"},{level:20,requiredExperience:1e7,voltsReward:2500,title:"Зевс",description:"Абсолютная власть над током"}];function B(r){let a=H[0];for(let s=H.length-1;s>=0;s--)if(r>=H[s].requiredExperience){a=H[s];break}return a}function ue(r){const a=B(r),s=H.findIndex(i=>i.level===a.level)+1;if(s>=H.length)return{current:r,required:r,remaining:0,nextLevel:null};const t=H[s];return{current:r-a.requiredExperience,required:t.requiredExperience-a.requiredExperience,remaining:t.requiredExperience-r,nextLevel:t}}function ze(r){const{current:a,required:s}=ue(r);return s===0?100:Math.min(100,a/s*100)}const _={SAFE_CLICK:1,RISKY_CLICK:2,EXTREME_CLICK:3,STREAK_5:5,STREAK_10:12,STREAK_25:30,STREAK_50:60,SHOCK_SURVIVAL:1};function V(r){const a="/tigerrosette/";return r<=3?`${a}Media/Pictures/tigrrozetka_1.png`:r<=7?`${a}Media/Pictures/tigrrozetka_2.png`:r<=12?`${a}Media/Pictures/tigrrozetka_3.png`:`${a}Media/Pictures/tigrrozetka_4.png`}const se="http://localhost:3001/api";class Ge{constructor(){F(this,"token",null);this.token=localStorage.getItem("auth_token"),this.initializeTelegramAuth()}initializeTelegramAuth(){var a,s;if(typeof window<"u"&&((a=window.Telegram)!=null&&a.WebApp)){const t=window.Telegram.WebApp;(s=t.initDataUnsafe)!=null&&s.user&&this.authenticateWithTelegram(t.initData)}}async authenticateWithTelegram(a){try{const t=await(await fetch(`${se}/auth/telegram`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initData:a})})).json();t.token&&(this.token=t.token,localStorage.setItem("auth_token",t.token))}catch(s){console.error("Telegram authentication failed:",s)}}async makeRequest(a,s={}){try{const t={"Content-Type":"application/json",...s.headers};this.token&&(t.Authorization=`Bearer ${this.token}`);const i=await fetch(`${se}${a}`,{...s,headers:t}),l=await i.json();return i.ok?{success:!0,data:l}:{error:l.error||`HTTP ${i.status}`}}catch(t){return console.error("API request failed:",t),{error:t instanceof Error?t.message:"Network error"}}}async submitScore(a){return this.makeRequest("/game/score",{method:"POST",body:JSON.stringify(a)})}async getUserStats(){return this.makeRequest("/game/stats")}async getLeaderboard(a="level",s=10){return this.makeRequest(`/game/leaderboard?type=${a}&limit=${s}`)}async refillEnergy(){return this.makeRequest("/game/refill-energy",{method:"POST"})}isAuthenticated(){return!!this.token}setToken(a){this.token=a,localStorage.setItem("auth_token",a)}clearToken(){this.token=null,localStorage.removeItem("auth_token")}}const L=new Ge,ae={mode:"menu",isPlaying:!1,isPaused:!1,gameTime:0,score:0},Ke={id:"player1",name:"Смельчак",volts:0,level:1,experience:0,streak:0,totalClicks:0,successfulClicks:0,shockedClicks:0,luckCoefficient:50,luckIndicatorHidden:!1,luckHiddenUntil:0,survivalTime:0},re={difficulty:"easy",aiPattern:"regular",currentRisk:"low",streakCount:0,timeInSafeZone:0,lastClickTime:0,dangerLevel:0,warningSignsActive:!1,aiElectricianActive:!1,nextDischargeTime:0,dischargeWarningTime:0,isDischarging:!1,dischargeDuration:5e3},Ye={volume:.7,enabled:!0,backgroundMusicEnabled:!0},Je=[{id:"first_click",title:"Первое прикосновение",description:"Нажми на розетку впервые",icon:"⚡",requirement:1,progress:0,completed:!1,reward:50,category:"special"},{id:"survivor_5",title:"Живчик",description:"Серия из 5 успешных нажатий",icon:"🏃",requirement:5,progress:0,completed:!1,reward:100,category:"streak"},{id:"survivor_25",title:"Неубиваемый",description:"Серия из 25 успешных нажатий",icon:"🛡️",requirement:25,progress:0,completed:!1,reward:500,category:"streak"},{id:"risk_taker",title:"Безрассудный",description:"50 нажатий в режиме High Risk",icon:"🔥",requirement:50,progress:0,completed:!1,reward:500,category:"risk"},{id:"time_survivor",title:"Выживальщик",description:"Выживи 5 минут без поражения",icon:"⏰",requirement:300,progress:0,completed:!1,reward:1e3,category:"survival"}],I=We((r,a)=>({gameState:ae,player:Ke,singleMode:re,achievements:Je,sounds:Ye,showElectricSparks:!1,sparksIntensity:"medium",showScreenShake:!1,aiElectrician:{name:"Иван Электрик",energy:100,maxEnergy:100,voltage:0,maxVoltage:500,voltageChargeRate:2,lastAttackTime:0,equipment:{battery:100,capacitor:100,wires:100,generator:100},mood:"confident",experience:50,isActive:!1,lastMessage:"Готов к работе!",messageTime:0,failuresCount:0,successfulDischarges:0,playerAttacksReceived:0,workingEfficiency:100,canWork:!0},levelUpNotification:{isVisible:!1,level:null,voltsReward:0},startSingleMode:s=>{console.log("startSingleMode: Starting with difficulty:",s),a().fixPlayerLevel(),r({gameState:{...a().gameState,mode:"single",isPlaying:!0,gameTime:0,score:0},singleMode:{...re,difficulty:s}}),setTimeout(()=>{console.log("startSingleMode: Starting AI Electrician after 3s delay"),a().startAIElectrician()},3e3)},startMultiplayerMode:s=>{let t="multiplayer";s==="duel"&&(t="duel-invite"),r({gameState:{...a().gameState,mode:t,isPlaying:!1,gameTime:0,score:0}}),console.log(`Starting multiplayer mode: ${s}`)},startRealDuel:()=>{r({gameState:{...a().gameState,mode:"duel",isPlaying:!0,gameTime:0,score:0}}),console.log("Starting real duel with another player")},goToMenu:()=>{r({gameState:{...ae,mode:"menu"}})},clickOutlet:()=>{const s=a(),t=Date.now(),i=t-s.singleMode.lastClickTime;let l="low";i<1e3?l="extreme":i<2e3?l="high":i<3e3&&(l="medium");const n=Math.min(100,s.singleMode.streakCount*2+(l==="extreme"?40:l==="high"?25:l==="medium"?15:5)+(s.player.luckCoefficient<30?20:0)),d=n>60;r({player:{...s.player,totalClicks:s.player.totalClicks+1},singleMode:{...s.singleMode,lastClickTime:t,currentRisk:l,dangerLevel:n,warningSignsActive:d}}),a().updateLuckCoefficient()},updateScore:s=>{const t=a(),i=t.gameState.score+s.totalPoints,l=t.player.volts+s.totalPoints,n=s.reason!=="Поражение током"&&s.reason!=="Клик во время разряда!"&&s.totalPoints>0,d=n?t.player.streak+1:0,o=n?t.singleMode.streakCount+1:0;let h=0;n?(h=_.SAFE_CLICK,s.riskMultiplier>=2&&(h=_.RISKY_CLICK),s.riskMultiplier>=3&&(h=_.EXTREME_CLICK),d===5&&(h+=_.STREAK_5),d===10&&(h+=_.STREAK_10),d===25&&(h+=_.STREAK_25),d===50&&(h+=_.STREAK_50)):h=_.SHOCK_SURVIVAL;const g=n?t.player.successfulClicks+1:t.player.successfulClicks,p=n?t.player.shockedClicks:t.player.shockedClicks+1,x=g+p,f=x>0?Math.round(g/x*100):50;r({gameState:{...t.gameState,score:i},player:{...t.player,volts:l,streak:d,successfulClicks:g,shockedClicks:p,luckCoefficient:f},singleMode:{...t.singleMode,streakCount:o}});const{addExperience:c}=a();c(h);const{unlockAchievement:v}=a();t.player.totalClicks===0&&v("first_click"),d===5&&v("survivor_5"),d===10&&v("survivor_10"),d===25&&v("survivor_25")},calculateShockImpact:s=>{let t,i,l,n;s<50?(t=Math.floor(s*.1)+1,i="mild",l=1e3,n=2e3):s<150?(t=Math.floor(s*.15)+5,i="moderate",l=1500,n=3e3):s<300?(t=Math.floor(s*.2)+10,i="severe",l=2e3,n=5e3):(t=Math.floor(s*.25)+20,i="critical",l=3e3,n=8e3);const d=Math.floor(s*.7);return{damage:t,voltsDrained:d,duration:l,severity:i,luckHideDuration:n}},triggerShock:()=>{const s=a();if(!s.gameState.isPlaying)return;const t=s.calculateShockImpact(s.player.volts);r({player:{...s.player,volts:Math.max(0,s.player.volts-t.voltsDrained),shockedClicks:s.player.shockedClicks+1,totalClicks:s.player.totalClicks+1,streak:0,luckIndicatorHidden:!0,luckHiddenUntil:Date.now()+t.luckHideDuration},showElectricSparks:!0,sparksIntensity:t.severity==="critical"?"extreme":t.severity==="severe"?"high":t.severity==="moderate"?"medium":"low",showScreenShake:!0,gameState:{...s.gameState,score:Math.max(0,s.gameState.score-t.damage)},singleMode:{...s.singleMode,streakCount:0}}),setTimeout(()=>{r({showElectricSparks:!1,showScreenShake:!1})},t.duration),a().updateLuckCoefficient()},endGame:()=>{a().stopAIElectrician(),r({gameState:{...a().gameState,mode:"menu",isPlaying:!1}})},unlockAchievement:s=>{const t=a(),i=t.achievements.find(l=>l.id===s);i&&!i.completed&&r({achievements:t.achievements.map(l=>l.id===s?{...l,completed:!0,progress:l.requirement}:l),player:{...t.player,volts:t.player.volts+i.reward}})},updatePlayerStats:s=>{const t=a();r({player:{...t.player,...s}})},addExperience:s=>{const t=a(),i=t.player.experience+s,l=B(t.player.experience),n=B(i);if(console.log("addExperience:",{amount:s,oldExperience:t.player.experience,newExperience:i,oldLevel:l.level,newLevel:n.level,playerLevel:t.player.level}),n.level>l.level){console.log("LEVEL UP!",{from:l.level,to:n.level,voltsReward:n.voltsReward});const d=t.player.volts+n.voltsReward;r({player:{...t.player,experience:i,level:n.level,volts:d}});const{showLevelUpNotification:o}=a();o(n,n.voltsReward)}else r({player:{...t.player,experience:i,level:n.level}})},getCurrentLevelInfo:()=>{const s=a();return{currentLevel:B(s.player.experience),progressInfo:ue(s.player.experience)}},fixPlayerLevel:()=>{const s=a(),t=B(s.player.experience);console.log("fixPlayerLevel:",{currentStoredLevel:s.player.level,correctLevel:t.level,experience:s.player.experience}),s.player.level!==t.level&&(console.log("Fixing player level from",s.player.level,"to",t.level),r({player:{...s.player,level:t.level}}))},showLevelUpNotification:(s,t)=>{r({levelUpNotification:{isVisible:!0,level:s,voltsReward:t}})},hideLevelUpNotification:()=>{r({levelUpNotification:{isVisible:!1,level:null,voltsReward:0}})},updateLuckCoefficient:()=>{const s=a(),t=s.player.totalClicks,i=s.player.successfulClicks,l=t>0?Math.round(i/t*100):50,n=s.player.luckIndicatorHidden&&Date.now()>=s.player.luckHiddenUntil;r({player:{...s.player,luckCoefficient:l,luckIndicatorHidden:n?!1:s.player.luckIndicatorHidden}})},startAIElectrician:()=>{const s=a();if(!s.gameState.isPlaying){console.log("startAIElectrician: Game not playing, aborting");return}console.log("startAIElectrician: Starting AI Electrician"),r({singleMode:{...s.singleMode,aiElectricianActive:!0},aiElectrician:{...s.aiElectrician,isActive:!0,lastMessage:a().getAIElectricianMessage(),messageTime:Date.now()}});const t=setInterval(()=>{const i=a();if(!i.singleMode.aiElectricianActive||!i.gameState.isPlaying){console.log("startAIElectrician: Clearing AI update interval"),clearInterval(t);return}a().updateAIElectrician(),Math.random()<.3&&r({aiElectrician:{...a().aiElectrician,lastMessage:a().getAIElectricianMessage(),messageTime:Date.now()}})},2e3);console.log("startAIElectrician: Scheduling first discharge"),a().scheduleNextDischarge()},stopAIElectrician:()=>{r(s=>({singleMode:{...s.singleMode,aiElectricianActive:!1,nextDischargeTime:0,dischargeWarningTime:0,isDischarging:!1},aiElectrician:{...s.aiElectrician,isActive:!1,lastMessage:"Смена закончена, иду домой!",messageTime:Date.now()}}))},scheduleNextDischarge:()=>{const s=a();if(console.log("scheduleNextDischarge: Starting, AI active:",s.singleMode.aiElectricianActive),!s.singleMode.aiElectricianActive)return;const t=Date.now(),l=(()=>{const o={easy:{min:3e3,max:8e3},medium:{min:2500,max:6e3},hard:{min:2e3,max:4e3},extreme:{min:1500,max:3e3}}[s.singleMode.difficulty];let h=1;if(s.singleMode.aiPattern==="burst")h=.7;else if(s.singleMode.aiPattern==="random")h=Math.random()*.8+.6;else if(s.singleMode.aiPattern==="adaptive"){const x=s.player.luckCoefficient;h=x>70?.8:x<30?1.3:1}const g=o.min*h,p=o.max*h;return Math.random()*(p-g)+g})(),n=t+l,d=n-3e3;console.log("scheduleNextDischarge: Scheduled discharge",{interval:l/1e3+"s",nextDischargeTime:n,dischargeWarningTime:d,timeFromNow:(n-t)/1e3+"s"}),r({singleMode:{...s.singleMode,nextDischargeTime:n,dischargeWarningTime:d}}),setTimeout(()=>{console.log("scheduleNextDischarge: Timer triggered, checking discharge"),a().checkForDischarge()},l)},checkForDischarge:()=>{const s=a();if(!s.singleMode.aiElectricianActive||!s.gameState.isPlaying){console.log("checkForDischarge: AI inactive or game not playing",{aiActive:s.singleMode.aiElectricianActive,isPlaying:s.gameState.isPlaying});return}const t=Date.now();console.log("checkForDischarge: Checking discharge timing",{now:t,nextDischargeTime:s.singleMode.nextDischargeTime,timeUntilDischarge:s.singleMode.nextDischargeTime-t,isDischarging:s.singleMode.isDischarging,warningSignsActive:s.singleMode.warningSignsActive,dischargeWarningTime:s.singleMode.dischargeWarningTime}),!s.singleMode.warningSignsActive&&t>=s.singleMode.dischargeWarningTime&&(console.log("checkForDischarge: Activating warning signs"),r({singleMode:{...s.singleMode,warningSignsActive:!0,dangerLevel:85}})),t>=s.singleMode.nextDischargeTime&&!s.singleMode.isDischarging&&(console.log("checkForDischarge: STARTING DISCHARGE!"),r({singleMode:{...s.singleMode,isDischarging:!0},showElectricSparks:!0,sparksIntensity:"high"}),r({aiElectrician:{...s.aiElectrician,successfulDischarges:s.aiElectrician.successfulDischarges+1,lastMessage:"Отличный разряд! Все по плану!",messageTime:t}}),Math.random()<.3&&a().damageAIElectrician("equipment",Math.random()*5+2),setTimeout(()=>{console.log("checkForDischarge: ENDING DISCHARGE after",s.singleMode.dischargeDuration,"ms");const i=a();r({singleMode:{...i.singleMode,isDischarging:!1,warningSignsActive:!1,dangerLevel:0},showElectricSparks:!1}),a().updateAIElectrician(),a().aiElectrician.canWork?(console.log("checkForDischarge: Scheduling next discharge after ending current one"),a().scheduleNextDischarge()):(r({aiElectrician:{...a().aiElectrician,lastMessage:a().getAIElectricianMessage(),messageTime:Date.now()}}),a().stopAIElectrician())},s.singleMode.dischargeDuration))},updateAIElectrician:()=>{const s=a();if(!s.aiElectrician.isActive)return;const t=s.aiElectrician,i=Date.now(),l=t.workingEfficiency>80?.1:.2,n=Math.max(0,t.energy-l),d=t.voltageChargeRate*(t.workingEfficiency/100),o=Math.min(t.maxVoltage,t.voltage+d),h=Math.random()*.05,g={battery:Math.max(0,t.equipment.battery-h),capacitor:Math.max(0,t.equipment.capacitor-h*.5),wires:Math.max(0,t.equipment.wires-h*.3),generator:Math.max(0,t.equipment.generator-h*.7)},p=(g.battery+g.capacitor+g.wires+g.generator)/4,x=Math.min(100,n*.7+p*.3);let f=t.mood;x<20?f="broken":x<40?f="tired":t.failuresCount>t.successfulDischarges?f="frustrated":t.playerAttacksReceived>3?f="angry":x>80&&(f="confident");const c=n>10&&p>15;o>=100&&(t.playerAttacksReceived>2||f==="angry"||Math.random()<.05)&&i-t.lastAttackTime>3e4&&setTimeout(()=>{a().aiElectricianAttackPlayer()},Math.random()*5e3),r({aiElectrician:{...t,energy:n,voltage:o,equipment:g,workingEfficiency:x,mood:f,canWork:c}})},damageAIElectrician:(s,t=10,i=!1)=>{const n=a().aiElectrician;if(s==="energy"){const d=Math.max(0,n.energy-t);let o;if(i){const h=["Ой! Да ты что, обалдел?! 😱","Эй, это больно! Мы же команда! 😭","Предательство! А я думал мы друзья... 💔","Ауууу! За что меня?! 😵","Ну и зачем ты меня шарахнул?! ⚡","Больно же! Я ведь стараюсь для тебя! 😢","Мама дорогая! Меня ударило током! 🤕","Это что, месть за разряды?! 😤","Ладно-ладно, я понял намек... 😅","Ай-ай-ай! Теперь у меня всё болит! 🤒","Обидно! Я же честно работаю! 😭","Ты серьезно?! Я же электрик, а не мишень! 🎯","Больше так не делай, договорились? 🥺","Кто научил тебя так драться?! 😰","Ну вот, теперь у меня мигрень... 🤕","Так, теперь я разозлился! Готовься к ответке! 😠","Больно! Но ничего, я тебе это припомню... 😈"];o=h[Math.floor(Math.random()*h.length)]}else o=d<=0?"Энергия кончилась! Нужен отдых...":"Ауч! Меня ударило током!";r({aiElectrician:{...n,energy:d,failuresCount:n.failuresCount+1,playerAttacksReceived:i?n.playerAttacksReceived+1:n.playerAttacksReceived,lastMessage:o,messageTime:Date.now()}})}else{const d=["battery","capacitor","wires","generator"],o=d[Math.floor(Math.random()*d.length)],h={...n.equipment,[o]:Math.max(0,n.equipment[o]-t)};let g;if(i){const p=[`Ты сломал мой ${o==="battery"?"аккумулятор":o==="capacitor"?"конденсатор":o==="wires"?"провода":"генератор"}! Теперь что делать?! 😱`,`Поломка! Мой ${o==="battery"?"аккумулятор":o==="capacitor"?"конденсатор":o==="wires"?"провода":"генератор"} дымится! 💨`,`О нет! Без ${o==="battery"?"аккумулятора":o==="capacitor"?"конденсатора":o==="wires"?"проводов":"генератора"} я не смогу работать! 😭`,`Ты же понимаешь, что ${o==="battery"?"аккумулятор":o==="capacitor"?"конденсатор":o==="wires"?"провода":"генератор"} стоит денег?! 💸`,"Вот это ты меня достал! Теперь ремонтировать придется... 🔧"];g=p[Math.floor(Math.random()*p.length)]}else g=`Сломался ${o==="battery"?"аккумулятор":o==="capacitor"?"конденсатор":o==="wires"?"провода":"генератор"}!`;r({aiElectrician:{...n,equipment:h,failuresCount:n.failuresCount+1,lastMessage:g,messageTime:Date.now()}})}a().updateAIElectrician()},repairAIElectrician:s=>{const i=a().aiElectrician;if(s==="energy"){const l=Math.min(i.maxEnergy,i.energy+25),n=["Спасибо! Чувствую прилив сил!","Отлично! Теперь я могу работать дольше!","Энергия восстановлена! Готов к работе!","Вау! Как будто заново родился!"];r({aiElectrician:{...i,energy:l,lastMessage:n[Math.floor(Math.random()*n.length)],messageTime:Date.now()}})}else{const l={battery:Math.min(100,i.equipment.battery+20),capacitor:Math.min(100,i.equipment.capacitor+20),wires:Math.min(100,i.equipment.wires+20),generator:Math.min(100,i.equipment.generator+20)},n=["Отремонтировал оборудование, теперь работает лучше!","Техника как новая! Спасибо за помощь!","Все детали заменены, можно продолжать!","Оборудование восстановлено! Теперь все будет работать!"];r({aiElectrician:{...i,equipment:l,lastMessage:n[Math.floor(Math.random()*n.length)],messageTime:Date.now()}})}a().updateAIElectrician()},aiElectricianAttackPlayer:()=>{const s=a(),t=s.aiElectrician;if(!t.isActive||t.voltage<100)return;console.log("AI Electrician attacking player!",{aiVoltage:t.voltage,playerVolts:s.player.volts});const i=20,l=Math.floor(t.voltage/20),n=i+l,d=[`Получай! ${t.voltage} вольт прямо в тебя! ⚡😈`,`А вот и ответка за твои выходки! ${t.voltage}В! 💀`,`Думал я не отвечу? Вот тебе ${t.voltage} вольт! ⚡😤`,`Месть электрика! ${t.voltage} вольт возмездия! ⚡👿`,`Получи разряд в ${t.voltage}В! Это тебе урок! 😠⚡`,`Вот что бывает с теми, кто нападает на электрика! ${t.voltage}В! 💥`,`Ответный удар! ${t.voltage} вольт прямо в цель! ⚡🎯`,`Хватит меня трогать! Держи ${t.voltage} вольт! 😡⚡`];r({aiElectrician:{...t,voltage:0,lastAttackTime:Date.now(),lastMessage:d[Math.floor(Math.random()*d.length)],messageTime:Date.now(),playerAttacksReceived:Math.max(0,t.playerAttacksReceived-1)}});const o=Math.max(0,s.player.volts-n);r({player:{...s.player,volts:o}}),r({showElectricSparks:!0,sparksIntensity:"extreme"}),setTimeout(()=>{r({showElectricSparks:!1})},2e3)},getAIElectricianMessage:()=>{const t=a().aiElectrician,i={confident:["Я лучший электрик в городе!","Эта работа мне по плечу!","Никто не справится лучше меня!","У меня золотые руки!","Электричество - моя стихия!","Я знаю все о токе и напряжении!","Розетки трепещут от моего мастерства!"],frustrated:["Что-то сегодня не мой день...","Техника подводит, как всегда...","Может быть, стоит сменить профессию?","Опять что-то пошло не так!","Почему ничего не работает как надо?","Кто вообще проектировал эту схему?!","Каждый день одни проблемы..."],tired:["Устал я уже...","Нужен перерыв на кофе","Сил больше нет работать","Хочется домой...","Рабочий день слишком длинный","Глаза уже слипаются","Может, хватит на сегодня?"],broken:["Все сломалось! Ничего не работает!","Это конец! Я больше не могу!","Вызывайте другого электрика...","Техника в хлам, а я без сил!","Аварийное отключение! Все пропало!","Системный сбой! Помогите!","Я сломался как старая лампочка!"],angry:["Да что ж такое?! Опять сбой!","Кто проектировал эту схему?!","Руки бы поотрывать создателям!","Нервы уже на пределе!","Сколько можно терпеть эту ерунду?!","Где мой молоток?! Сейчас все исправлю!","Противная техника! Ненавижу!","Лучше бы пошел в программисты!"]},l=i[t.mood]||i.confident;return l[Math.floor(Math.random()*l.length)]},submitGameToServer:async()=>{const s=a();if(!L.isAuthenticated())return console.warn("User not authenticated, skipping server submission"),{success:!1,error:"Not authenticated"};try{const t={score:s.gameState.score,level:Xe(s.singleMode.difficulty),timePlayed:Math.floor(s.gameState.gameTime/1e3)};console.log("Submitting game data to server:",t);const i=await L.submitScore(t);if(i.error)return console.error("Failed to submit score:",i.error),{success:!1,error:i.error};if(i.data){const l=i.data;if(r({player:{...s.player,volts:l.totalVolts,experience:l.totalExperience,level:l.newLevel}}),l.leveledUp){const{showLevelUpNotification:n}=a();n({level:l.newLevel},l.levelUpReward)}return console.log("Successfully submitted score and synced with server"),{success:!0}}return{success:!0}}catch(t){const i=t instanceof Error?t.message:"Unknown error";return console.error("Error submitting game to server:",i),{success:!1,error:i}}},syncWithServer:async()=>{if(!L.isAuthenticated())return{success:!1,error:"Not authenticated"};try{const s=await L.getUserStats();if(s.error)return{success:!1,error:s.error};if(s.data){const t=s.data;return r({player:{...a().player,volts:t.totalVolts,experience:t.totalExperience,level:t.level}}),console.log("Successfully synced with server"),{success:!0}}return{success:!0}}catch(s){const t=s instanceof Error?s.message:"Unknown error";return console.error("Error syncing with server:",t),{success:!1,error:t}}},loadStatsFromServer:async()=>{if(!L.isAuthenticated())return{success:!1,error:"Not authenticated"};try{const s=await L.getUserStats();if(s.error)return{success:!1,error:s.error};if(s.data){const t=s.data;return r({player:{...a().player,volts:t.totalVolts,experience:t.totalExperience,level:t.level}}),console.log("Successfully loaded stats from server"),{success:!0}}return{success:!0}}catch(s){const t=s instanceof Error?s.message:"Unknown error";return console.error("Error loading stats from server:",t),{success:!1,error:t}}}}));function Xe(r){switch(r){case"easy":return 1;case"medium":return 2;case"hard":return 3;case"extreme":return 4;default:return 1}}class Qe{constructor(){F(this,"hapticFeedback",null);F(this,"isEnabled",!0);F(this,"isTelegramEnvironment",!1);this.initializeTelegramHaptics()}initializeTelegramHaptics(){var a;try{if(typeof window<"u"&&((a=window.Telegram)!=null&&a.WebApp)){this.isTelegramEnvironment=!0;const s=window.Telegram.WebApp;s.HapticFeedback?(this.hapticFeedback=s.HapticFeedback,console.log("Telegram Haptic Feedback initialized")):console.log("HapticFeedback not available in this Telegram version")}else console.log("Not in Telegram environment, haptics disabled")}catch(s){console.warn("Failed to initialize Telegram haptics:",s)}}setEnabled(a){this.isEnabled=a}isAvailable(){return(this.isTelegramEnvironment&&this.hapticFeedback!==null||typeof window<"u"&&"navigator"in window&&"vibrate"in navigator)&&this.isEnabled}light(){this.isAvailable()?this.hapticFeedback.impactOccurred("light"):this.fallbackVibration(50)}medium(){this.isAvailable()?this.hapticFeedback.impactOccurred("medium"):this.fallbackVibration(100)}heavy(){this.isAvailable()?this.hapticFeedback.impactOccurred("heavy"):this.fallbackVibration(150)}soft(){this.isAvailable()?this.hapticFeedback.impactOccurred("soft"):this.fallbackVibration(30)}rigid(){this.isAvailable()?this.hapticFeedback.impactOccurred("rigid"):this.fallbackVibration(200)}success(){this.isAvailable()?this.hapticFeedback.notificationOccurred("success"):this.customPattern([100,50,100])}error(){this.isAvailable()?this.hapticFeedback.notificationOccurred("error"):this.customPattern([200,100,200,100,200])}warning(){this.isAvailable()?this.hapticFeedback.notificationOccurred("warning"):this.customPattern([150,50,150])}selection(){this.isAvailable()?this.hapticFeedback.selectionChanged():this.fallbackVibration(25)}outletPress(){this.medium()}survivalSuccess(){this.success()}electricShock(){this.isEnabled&&(this.rigid(),setTimeout(()=>{this.isEnabled&&this.heavy()},50))}electricWarning(){this.isEnabled&&(this.light(),setTimeout(()=>{this.isEnabled&&this.light()},100))}levelUp(){this.success(),setTimeout(()=>this.medium(),150),setTimeout(()=>this.success(),300)}dangerWarning(){this.isEnabled&&(this.light(),setTimeout(()=>{this.isEnabled&&this.light()},100))}extremeDangerWarning(){this.isEnabled&&(this.light(),setTimeout(()=>{this.isEnabled&&this.medium()},150),setTimeout(()=>{this.isEnabled&&this.heavy()},300))}rewardReceived(){this.light(),setTimeout(()=>this.medium(),100)}streakAchievement(a){a>=25?(this.heavy(),setTimeout(()=>this.heavy(),200),setTimeout(()=>this.heavy(),400)):a>=10?(this.medium(),setTimeout(()=>this.medium(),150)):a>=5&&(this.light(),setTimeout(()=>this.light(),100))}itemUsed(){this.soft()}shopPurchase(){this.medium(),setTimeout(()=>this.light(),100)}gameInvitation(){this.warning(),setTimeout(()=>this.light(),500),setTimeout(()=>this.light(),1e3)}roundStart(){this.light()}gameEnd(a){a?(this.success(),setTimeout(()=>this.medium(),200),setTimeout(()=>this.success(),400)):this.error()}fallbackVibration(a){if("navigator"in window&&"vibrate"in navigator)try{navigator.vibrate(a),console.log(`🔹 Fallback vibration: ${a}ms`)}catch(s){console.warn("Vibration not supported:",s)}else console.log(`📳 Haptic feedback: ${a}ms (visual only)`),this.visualFeedback(a)}visualFeedback(a){const s=document.createElement("div");if(s.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: #FF6B35;
      color: white;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      z-index: 10000;
      pointer-events: none;
      animation: pulse 0.3s ease-in-out;
    `,s.textContent=`📳 ${a}ms`,!document.querySelector("#haptic-style")){const t=document.createElement("style");t.id="haptic-style",t.textContent=`
        @keyframes pulse {
          0% { transform: scale(0.8); opacity: 0; }
          50% { transform: scale(1.1); opacity: 1; }
          100% { transform: scale(1); opacity: 0.8; }
        }
      `,document.head.appendChild(t)}document.body.appendChild(s),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},Math.max(a,500))}customPattern(a){if("navigator"in window&&"vibrate"in navigator)try{navigator.vibrate(a),console.log(`🔹 Vibration pattern: [${a.join(", ")}]ms`)}catch(s){console.warn("Vibration pattern not supported:",s)}else console.log(`📳 Haptic pattern: [${a.join(", ")}]ms (visual only)`),this.visualPatternFeedback(a)}visualPatternFeedback(a){let s=0;for(let t=0;t<a.length;t+=2){const i=a[t],l=a[t+1]||0;setTimeout(()=>{this.visualFeedback(i)},s),s+=i+l}}test(){this.medium(),setTimeout(()=>this.light(),200),setTimeout(()=>this.heavy(),400)}}const w=new Qe,Ze=({onClose:r})=>{const{player:a,singleMode:s,gameState:t}=I();return e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50",onClick:r,children:e.jsxs(m.div,{initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.9},className:"glass-effect p-6 max-w-2xl mx-auto relative max-h-[90vh] overflow-y-auto",onClick:i=>i.stopPropagation(),children:[e.jsx("button",{onClick:r,className:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors text-2xl",children:"✕"}),e.jsx("h3",{className:"text-2xl font-bold text-center mb-6 text-primary-orange",children:"📊 Система очков и уровней"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"ТЕКУЩАЯ СЕРИЯ"}),e.jsx("div",{className:"text-xl font-bold text-yellow-400",children:s.streakCount})]}),e.jsxs("div",{className:"text-center glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"КОЭФФИЦИЕНТ УДАЧИ"}),e.jsxs("div",{className:`text-xl font-bold ${a.luckCoefficient>=70?"text-green-400":a.luckCoefficient>=50?"text-yellow-400":a.luckCoefficient>=30?"text-orange-400":"text-red-400"}`,children:[a.luckCoefficient,"%"]})]}),e.jsxs("div",{className:"text-center glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"ТЕКУЩИЙ СЧЕТ"}),e.jsxs("div",{className:"text-xl font-bold text-green-400",children:[t.score,"⚡"]})]}),e.jsxs("div",{className:"text-center glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"ВСЕГО ВОЛЬТ"}),e.jsxs("div",{className:"text-xl font-bold text-blue-400",children:[a.volts,"⚡"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"🍀 Статистика удачи"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"УСПЕШНЫХ"}),e.jsx("div",{className:"text-lg font-bold text-green-400",children:a.successfulClicks})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"УДАРОВ ТОКОМ"}),e.jsx("div",{className:"text-lg font-bold text-red-400",children:a.shockedClicks})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"ВСЕГО КЛИКОВ"}),e.jsx("div",{className:"text-lg font-bold text-blue-400",children:a.totalClicks})]})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsx("div",{className:"text-sm text-gray-300",children:"💡 Удача рассчитывается как процент успешных нажатий"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"📈 Система опыта и уровней"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-green-400 font-bold",children:"🟢 Безопасное нажатие:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+10 опыта"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-yellow-400 font-bold",children:"🟡 Рискованное (2x+):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+15 опыта"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"🔴 Экстремальное (3x+):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+25 опыта"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-orange-400 font-bold",children:"💥 Поражение током:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+5 опыта"})]})]}),e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("div",{className:"text-sm text-yellow-400 font-semibold",children:"🏆 За повышение уровня вы получаете бонусные вольты!"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Уровень 2: +50⚡ • Уровень 5: +150⚡ • Уровень 10: +500⚡"}),e.jsx("div",{className:"text-xs text-blue-300 mt-2",children:"🎨 Изображение розетки меняется каждые 5 уровней!"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"⚡ Базовые очки за нажатие"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-green-400 font-bold",children:"🟢 Безопасное нажатие:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+10⚡ (базовые очки)"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"💥 Поражение током:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"-8⚡ до -25⚡ (случайно)"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"🎯 Множители за риск"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-green-400 font-bold",children:"🟢 Лёгкий (15% риск):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×1.0 (базовые очки)"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-yellow-400 font-bold",children:"🟡 Средний (25% риск):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×1.5 множитель"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-orange-400 font-bold",children:"🟠 Сложный (35% риск):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×2.0 множитель"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"🔴 Экстрим (50% риск):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×3.0 множитель"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"🔥 Бонусы за серии"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-gray-400 font-bold",children:"0-4 нажатий:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×1.0 (без бонуса)"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-yellow-400 font-bold",children:"5+ нажатий:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×1.2 бонус"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-orange-400 font-bold",children:"10+ нажатий:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×1.5 бонус"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"25+ нажатий:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×2.0 бонус"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-purple-400 font-bold",children:"50+ нажатий:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×3.0 бонус"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"🧮 Формула расчёта"}),e.jsx("div",{className:"glass-effect p-4 rounded-lg bg-gradient-to-r from-blue-500/10 to-purple-500/10",children:e.jsxs("div",{className:"text-center text-lg font-mono",children:[e.jsx("span",{className:"text-white",children:"Итоговые очки"})," =",e.jsx("span",{className:"text-green-400",children:" 10⚡"})," ×",e.jsx("span",{className:"text-orange-400",children:" Риск"})," ×",e.jsx("span",{className:"text-yellow-400",children:" Серия"})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"💡 Примеры расчётов"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-green-400 font-bold",children:"🟢 Безопасная игра:"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["10⚡ × 1.0 (низкий риск) × 1.2 (5+ серия) = ",e.jsx("span",{className:"text-white font-bold",children:"12⚡"})]})]}),e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-orange-400 font-bold",children:"🟠 Рискованная игра:"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["10⚡ × 2.0 (высокий риск) × 1.5 (10+ серия) = ",e.jsx("span",{className:"text-white font-bold",children:"30⚡"})]})]}),e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"🔴 Экстремальная игра:"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["10⚡ × 3.0 (экстрим риск) × 2.0 (25+ серия) = ",e.jsx("span",{className:"text-white font-bold",children:"60⚡"})]})]}),e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"💥 Поражение током:"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["Случайно от 8⚡ до 25⚡ + ",e.jsx("span",{className:"text-red-400",children:"серия сбрасывается"})]})]})]})]})]}),e.jsx("div",{className:"mt-6 text-center text-xs text-gray-400",children:"💡 Совет: Балансируйте между риском и безопасностью для максимального заработка!"})]})})},et=()=>{const{player:r,getCurrentLevelInfo:a}=I(),{currentLevel:s,progressInfo:t}=a(),i=ze(r.experience),l=V(s.level),n=t.nextLevel?V(t.nextLevel.level):null,d=n&&n!==l;return e.jsxs("div",{className:"glass-effect p-4 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:V(s.level),alt:`Розетка уровня ${s.level}`,className:"w-12 h-12 rounded-lg border-2 border-primary-orange shadow-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide",children:"Уровень"}),e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("span",{className:"text-2xl font-bold text-primary-orange",children:s.level}),e.jsx("span",{className:"text-sm text-gray-300",children:s.title})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Опыт"}),e.jsx("div",{className:"text-lg font-bold text-accent-blue",children:r.experience.toLocaleString()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[e.jsx("span",{children:t.current}),e.jsx("span",{children:t.nextLevel?`${t.remaining} до ${t.nextLevel.level} уровня`:"Максимум"}),e.jsx("span",{children:t.required})]}),e.jsxs("div",{className:"relative w-full bg-gray-700 rounded-full h-2 overflow-hidden",children:[e.jsx(m.div,{className:"h-full bg-gradient-to-r from-accent-blue to-primary-orange rounded-full",initial:{width:0},animate:{width:`${i}%`},transition:{duration:.8,ease:"easeOut"}}),i>0&&e.jsx(m.div,{className:"absolute top-0 right-0 w-1 h-full bg-white opacity-80",style:{right:`${100-i}%`},animate:{opacity:[.8,.3,.8]},transition:{repeat:1/0,duration:1.5}})]})]}),e.jsx("div",{className:"text-xs text-gray-400 italic text-center",children:s.description}),t.nextLevel&&e.jsxs("div",{className:"text-center pt-2 border-t border-gray-600",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Следующий уровень"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-accent-lime font-semibold",children:t.nextLevel.title}),e.jsx("span",{className:"text-gray-400",children:" • "}),e.jsxs("span",{className:"text-yellow-400",children:["+",t.nextLevel.voltsReward,"⚡"]})]}),d&&e.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-2",children:[e.jsx("span",{className:"text-xs text-blue-300",children:"🎨 Новая розетка:"}),e.jsx("img",{src:n,alt:`Розетка уровня ${t.nextLevel.level}`,className:"w-6 h-6 rounded border border-blue-400 shadow-sm"})]})]})]})},tt=({isVisible:r,onClose:a})=>{const[s,t]=u.useState(!0),[i,l]=u.useState(null);u.useEffect(()=>{const o=localStorage.getItem("hapticEnabled");if(o!==null){const h=JSON.parse(o);t(h),w.setEnabled(h)}},[]);const n=()=>{const o=!s;t(o),w.setEnabled(o),localStorage.setItem("hapticEnabled",JSON.stringify(o)),o&&w.test()},d=(o,h)=>{l(o),h(),setTimeout(()=>l(null),500)};return r?e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:a,children:e.jsxs(m.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl p-6 max-w-sm w-full border border-primary-orange/20",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary-orange",children:"Вибрация"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white text-2xl",children:"×"})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center p-4 bg-gray-800/50 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Включить вибрацию"}),e.jsx("p",{className:"text-sm text-gray-400",children:w.isAvailable()?"Поддерживается вашим устройством":"Недоступно на вашем устройстве"})]}),e.jsx(m.button,{onClick:n,className:`w-12 h-6 rounded-full p-1 transition-colors ${s?"bg-primary-orange":"bg-gray-600"}`,whileTap:{scale:.95},children:e.jsx(m.div,{className:"w-4 h-4 bg-white rounded-full",animate:{x:s?24:0},transition:{type:"spring",stiffness:500,damping:30}})})]})}),s&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Тест вибрации"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300",children:"Игровые события"}),e.jsx(m.button,{onClick:()=>d("press",()=>w.outletPress()),className:`w-full p-3 rounded-lg border transition-colors ${i==="press"?"bg-blue-500/30 border-blue-400 text-blue-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"🔌 Нажатие на розетку"}),e.jsx(m.button,{onClick:()=>d("success",()=>w.survivalSuccess()),className:`w-full p-3 rounded-lg border transition-colors ${i==="success"?"bg-green-500/30 border-green-400 text-green-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"✅ Успешное выживание"}),e.jsx(m.button,{onClick:()=>d("shock",()=>w.electricShock()),className:`w-full p-3 rounded-lg border transition-colors ${i==="shock"?"bg-red-500/30 border-red-400 text-red-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"⚡ Удар током"}),e.jsx(m.button,{onClick:()=>d("levelup",()=>w.levelUp()),className:`w-full p-3 rounded-lg border transition-colors ${i==="levelup"?"bg-yellow-500/30 border-yellow-400 text-yellow-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"🆙 Повышение уровня"})]}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300",children:"Интенсивность"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(m.button,{onClick:()=>d("light",()=>w.light()),className:`p-2 rounded-lg border text-sm transition-colors ${i==="light"?"bg-gray-500/30 border-gray-400 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"Легкая"}),e.jsx(m.button,{onClick:()=>d("medium",()=>w.medium()),className:`p-2 rounded-lg border text-sm transition-colors ${i==="medium"?"bg-gray-500/30 border-gray-400 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"Средняя"}),e.jsx(m.button,{onClick:()=>d("heavy",()=>w.heavy()),className:`p-2 rounded-lg border text-sm transition-colors ${i==="heavy"?"bg-gray-500/30 border-gray-400 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"Сильная"}),e.jsx(m.button,{onClick:()=>d("rigid",()=>w.rigid()),className:`p-2 rounded-lg border text-sm transition-colors ${i==="rigid"?"bg-gray-500/30 border-gray-400 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"Резкая"})]})]})]}),e.jsx("div",{className:"mt-6 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-300 text-center",children:"💡 Вибрация доступна только в Telegram Mini App на поддерживаемых устройствах"})})]})}):null},he=u.createContext({webApp:null,user:null,isInTelegram:!1,platform:"unknown",colorScheme:"dark"}),J=()=>u.useContext(he),st=({children:r})=>{const[a,s]=u.useState(null),[t,i]=u.useState(null),[l,n]=u.useState(!1),[d,o]=u.useState("unknown"),[h,g]=u.useState("dark");u.useEffect(()=>{var x,f,c;if(typeof window<"u"&&((x=window.Telegram)!=null&&x.WebApp)){const v=window.Telegram.WebApp;v.ready(),v.expand(),s(v),n(!0),o(v.platform||"unknown"),g(v.colorScheme||"dark"),(f=v.initDataUnsafe)!=null&&f.user&&(i(v.initDataUnsafe.user),console.log("Telegram user:",v.initDataUnsafe.user)),v.setHeaderColor("#000000"),v.setBackgroundColor("#000000"),v.disableClosingConfirmation(),console.log("Telegram WebApp initialized successfully"),v.ready(),v.expand(),console.log("Telegram WebApp Context initialized:",{platform:v.platform,colorScheme:v.colorScheme,user:(c=v.initDataUnsafe)==null?void 0:c.user,version:v.version})}},[]);const p={webApp:a,user:t,isInTelegram:l,platform:d,colorScheme:h};return e.jsx(he.Provider,{value:p,children:r})},at=()=>{var i;const{user:r,isInTelegram:a,platform:s,colorScheme:t}=J();return a?e.jsx(m.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-500/30 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[r!=null&&r.photo_url?e.jsx("img",{src:r.photo_url,alt:"Avatar",className:"w-8 h-8 rounded-full border border-blue-400/50"}):e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:((i=r==null?void 0:r.first_name)==null?void 0:i[0])||"?"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-white",children:[r==null?void 0:r.first_name," ",r==null?void 0:r.last_name,(r==null?void 0:r.is_premium)&&e.jsx("span",{className:"ml-1 text-yellow-400",children:"⭐"})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["@",(r==null?void 0:r.username)||"no_username"," • ",s]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:`text-xs px-2 py-1 rounded-full border ${t==="dark"?"bg-gray-800 border-gray-600 text-gray-300":"bg-gray-200 border-gray-400 text-gray-700"}`,children:[t==="dark"?"🌙":"☀️"," ",t]})})]})}):e.jsx("div",{className:"text-xs text-gray-500 text-center p-2",children:"💻 Веб-версия (не в Telegram)"})};function X(){const[r,a]=u.useState({data:null,loading:!1,error:null}),[s,t]=u.useState({data:null,loading:!1,error:null}),[i,l]=u.useState({data:null,loading:!1,error:null}),n=u.useCallback(async g=>{a({data:null,loading:!0,error:null});try{const p=await L.submitScore(g);return p.error?(a({data:null,loading:!1,error:p.error}),{success:!1,error:p.error}):(a({data:p.data,loading:!1,error:null}),{success:!0,data:p.data})}catch(p){const x=p instanceof Error?p.message:"Unknown error";return a({data:null,loading:!1,error:x}),{success:!1,error:x}}},[]),d=u.useCallback(async()=>{t({data:null,loading:!0,error:null});try{const g=await L.getUserStats();return g.error?(t({data:null,loading:!1,error:g.error}),{success:!1,error:g.error}):(t({data:g.data,loading:!1,error:null}),{success:!0,data:g.data})}catch(g){const p=g instanceof Error?g.message:"Unknown error";return t({data:null,loading:!1,error:p}),{success:!1,error:p}}},[]),o=u.useCallback(async(g="level",p=10)=>{l({data:null,loading:!0,error:null});try{const x=await L.getLeaderboard(g,p);return x.error?(l({data:null,loading:!1,error:x.error}),{success:!1,error:x.error}):(l({data:x.data,loading:!1,error:null}),{success:!0,data:x.data})}catch(x){const f=x instanceof Error?x.message:"Unknown error";return l({data:null,loading:!1,error:f}),{success:!1,error:f}}},[]),h=u.useCallback(async()=>{try{const g=await L.refillEnergy();return g.error?{success:!1,error:g.error}:{success:!0,data:g.data}}catch(g){return{success:!1,error:g instanceof Error?g.message:"Unknown error"}}},[]);return{submitScore:n,getUserStats:d,getLeaderboard:o,refillEnergy:h,submitState:r,statsState:s,leaderboardState:i,isAuthenticated:L.isAuthenticated()}}function rt(){const[r,a]=u.useState(navigator.onLine);return u.useState(()=>{const s=()=>a(!0),t=()=>a(!1);return window.addEventListener("online",s),window.addEventListener("offline",t),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",t)}}),{isOnline:r}}const it=()=>{const{player:r,startSingleMode:a,startMultiplayerMode:s,addExperience:t,loadStatsFromServer:i}=I(),{isAuthenticated:l}=X(),[n,d]=u.useState(!1),[o,h]=u.useState(!1),[g,p]=u.useState(!1);u.useEffect(()=>{(async()=>{if(l&&!g){p(!0);try{const v=await i();v.success?console.log("✅ Статистика загружена с сервера"):console.warn("⚠️ Не удалось загрузить статистику с сервера:",v.error)}catch(v){console.error("❌ Ошибка при загрузке статистики:",v)}finally{p(!1)}}})()},[l,i,g]);const x=()=>{t(100)},f=c=>{w.medium(),a(c)};return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-background-dark to-background-darker",children:[e.jsxs(m.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},transition:{duration:.8},className:"text-center mb-8",children:[e.jsx("h1",{className:"text-6xl font-bold text-primary-orange tiger-stripes bg-clip-text text-transparent mb-4",children:"ТИГР"}),e.jsx("h2",{className:"text-4xl font-bold text-accent-blue mb-2",children:"РОЗЕТКА"}),e.jsx("p",{className:"text-lg text-gray-300",children:"Telegram Mini App Game"})]}),e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"mb-6",children:e.jsx(et,{})}),l&&g&&e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},className:"mb-4 text-center text-blue-400 text-sm",children:[e.jsx("span",{className:"inline-block animate-spin mr-2",children:"⏳"}),"Синхронизация с сервером..."]}),!l&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},className:"mb-4 text-center text-yellow-400 text-sm",children:"⚠️ Игра в автономном режиме"}),e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.25},className:"mb-4 w-full max-w-md",children:e.jsx(at,{})}),e.jsxs(m.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.3},className:"glass-effect p-6 mb-8 text-center",children:[e.jsxs("div",{className:"text-sm text-gray-300 mb-2",children:["Добро пожаловать, ",r.name,"!"]}),e.jsxs("div",{className:"flex justify-center space-x-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"ВОЛЬТЫ"}),e.jsxs("div",{className:"text-xl font-bold text-primary-orange",children:[r.volts,"⚡"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"УРОВЕНЬ"}),e.jsx("div",{className:"text-xl font-bold text-accent-blue",children:r.level})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"ВСЕГО НАЖАТИЙ"}),e.jsx("div",{className:"text-xl font-bold text-accent-lime",children:r.totalClicks})]})]})]}),e.jsxs(m.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},className:"w-full max-w-md space-y-4",children:[e.jsx("h3",{className:"text-2xl font-bold text-center text-white mb-6",children:"⚡ Одиночный режим"}),e.jsx("p",{className:"text-center text-gray-300 text-sm mb-4",children:"Выберите сложность игры против ИИ электрика"}),e.jsx(m.button,{onClick:()=>f("easy"),className:"w-full glass-effect p-4 rounded-xl hover:bg-green-500/20 transition-colors",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-green-400",children:"ЛЁГКИЙ"}),e.jsx("div",{className:"text-sm text-gray-300",children:"15% шанс разряда • 2 сек предупреждение"})]}),e.jsx("div",{className:"text-2xl",children:"🟢"})]})}),e.jsx(m.button,{onClick:()=>f("medium"),className:"w-full glass-effect p-4 rounded-xl hover:bg-yellow-500/20 transition-colors",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-400",children:"СРЕДНИЙ"}),e.jsx("div",{className:"text-sm text-gray-300",children:"25% шанс разряда • 1.5 сек предупреждение"})]}),e.jsx("div",{className:"text-2xl",children:"🟡"})]})}),e.jsx(m.button,{onClick:()=>f("hard"),className:"w-full glass-effect p-4 rounded-xl hover:bg-orange-500/20 transition-colors",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-orange-400",children:"СЛОЖНЫЙ"}),e.jsx("div",{className:"text-sm text-gray-300",children:"35% шанс разряда • 1 сек предупреждение"})]}),e.jsx("div",{className:"text-2xl",children:"🟠"})]})}),e.jsx(m.button,{onClick:()=>f("extreme"),className:"w-full glass-effect p-4 rounded-xl hover:bg-red-500/20 transition-colors",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-red-400",children:"ЭКСТРИМ"}),e.jsx("div",{className:"text-sm text-gray-300",children:"50% шанс разряда • 0.5 сек предупреждение"})]}),e.jsx("div",{className:"text-2xl",children:"🔴"})]})}),e.jsxs(m.div,{className:"w-full border-t border-white/10 pt-6 mt-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.7},children:[e.jsx("h4",{className:"text-xl font-bold text-center text-white mb-4",children:"🎮 Многопользовательский режим"}),e.jsx(m.button,{onClick:()=>{w.medium(),s("duel")},className:"w-full glass-effect p-4 rounded-xl hover:bg-purple-500/20 transition-colors border border-purple-400/30",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-purple-400",children:"ДУЭЛЬ"}),e.jsx("div",{className:"text-sm text-gray-300",children:"Соревнование 1v1 • Real-time бой"})]}),e.jsx("div",{className:"text-2xl",children:"⚔️"})]})}),e.jsx(m.button,{onClick:()=>{w.medium(),s("tournament")},className:"w-full glass-effect p-4 rounded-xl hover:bg-blue-500/20 transition-colors border border-blue-400/30 mt-3",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-blue-400",children:"ТУРНИР"}),e.jsx("div",{className:"text-sm text-gray-300",children:"До 8 игроков • Браккет система"})]}),e.jsx("div",{className:"text-2xl",children:"🏆"})]})}),e.jsx(m.button,{onClick:()=>{w.medium(),s("coop")},className:"w-full glass-effect p-4 rounded-xl hover:bg-green-500/20 transition-colors border border-green-400/30 mt-3",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-green-400",children:"КООП"}),e.jsx("div",{className:"text-sm text-gray-300",children:"Командная игра • Против ИИ"})]}),e.jsx("div",{className:"text-2xl",children:"🤝"})]})})]}),e.jsx(m.button,{onClick:()=>{w.light(),d(!0)},className:"w-full glass-effect p-3 rounded-xl hover:bg-blue-500/20 transition-colors border border-blue-400/30",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:"📊"}),e.jsx("span",{className:"text-lg font-semibold text-blue-400",children:"Очки и уровни"})]})}),e.jsx(m.button,{onClick:()=>{w.light(),h(!0)},className:"w-full glass-effect p-3 rounded-xl hover:bg-purple-500/20 transition-colors border border-purple-400/30",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:"📳"}),e.jsx("span",{className:"text-lg font-semibold text-purple-400",children:"Вибрация"})]})})]}),n&&e.jsx(Ze,{onClose:()=>d(!1)}),o&&e.jsx(tt,{isVisible:o,onClose:()=>h(!1)}),e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:1},className:"mt-8 text-center text-gray-400 text-sm space-y-2",children:[e.jsx("p",{children:"⚡ Играй осторожно! ⚡"}),e.jsx("p",{className:"mt-2",children:"v1.1.0 | Single Mode + Multiplayer Preview"}),e.jsx("button",{onClick:()=>{w.light(),x()},className:"mt-2 px-3 py-1 text-xs bg-purple-600/30 hover:bg-purple-600/50 text-purple-300 rounded transition-colors",children:"🔧 +100 опыта (тест)"})]})]})};class lt{constructor(){F(this,"audioContext",null);F(this,"sounds",new Map);F(this,"volume",.7);F(this,"enabled",!0);this.init()}async init(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(a){console.warn("Web Audio API not supported:",a)}}async loadSound(a,s){if(this.audioContext)try{const i=await(await fetch(s)).arrayBuffer(),l=await this.audioContext.decodeAudioData(i);this.sounds.set(a,l)}catch(t){console.warn(`Failed to load sound ${a}:`,t)}}playSound(a,s=1){if(!this.enabled||!this.audioContext)return;const t=this.sounds.get(a);if(!t)return;const i=this.audioContext.createBufferSource(),l=this.audioContext.createGain();i.buffer=t,l.gain.value=this.volume*s,i.connect(l),l.connect(this.audioContext.destination),i.start()}generateSparkSound(a){if(!this.enabled||!this.audioContext)return;const s={low:.1,medium:.2,high:.3,extreme:.5}[a],t={low:2e3,medium:3e3,high:4e3,extreme:5e3}[a],i=this.audioContext.sampleRate*s,l=this.audioContext.createBuffer(1,i,this.audioContext.sampleRate),n=l.getChannelData(0);for(let h=0;h<i;h++){const g=h/this.audioContext.sampleRate,p=Math.exp(-g*10),x=(Math.random()*2-1)*p,f=Math.sin(2*Math.PI*t*g*(1+Math.random()*.5));n[h]=x*f*.3}const d=this.audioContext.createBufferSource(),o=this.audioContext.createGain();d.buffer=l,o.gain.value=this.volume*(a==="extreme"?.8:.5),d.connect(o),o.connect(this.audioContext.destination),d.start()}generateShockSound(){if(!this.enabled||!this.audioContext)return;const s=this.audioContext.sampleRate*.8,t=this.audioContext.createBuffer(1,s,this.audioContext.sampleRate),i=t.getChannelData(0);for(let d=0;d<s;d++){const o=d/this.audioContext.sampleRate,h=Math.exp(-o*3),g=Math.sin(2*Math.PI*100*o),p=Math.sin(2*Math.PI*800*o)*.5,x=(Math.random()*2-1)*.3;i[d]=(g+p+x)*h*.6}const l=this.audioContext.createBufferSource(),n=this.audioContext.createGain();l.buffer=t,n.gain.value=this.volume,l.connect(n),n.connect(this.audioContext.destination),l.start()}generateWarningSound(){if(!this.enabled||!this.audioContext)return;const a=.3,s=this.audioContext.sampleRate*a,t=this.audioContext.createBuffer(1,s,this.audioContext.sampleRate),i=t.getChannelData(0);for(let d=0;d<s;d++){const o=d/this.audioContext.sampleRate,h=1e3+Math.sin(o*20)*200,g=Math.sin(Math.PI*o/a);i[d]=Math.sin(2*Math.PI*h*o)*g*.4}const l=this.audioContext.createBufferSource(),n=this.audioContext.createGain();l.buffer=t,n.gain.value=this.volume*.6,l.connect(n),n.connect(this.audioContext.destination),l.start()}async playTigerSound(){if(this.enabled)try{const a=new Audio("/tigerrosette/Media/sound/re_-tigra.mp3");a.volume=this.volume*.8,a.preload="auto",await a.play(),console.log("SoundManager: Tiger sound played successfully")}catch(a){console.warn("Failed to play tiger sound:",a)}}setVolume(a){this.volume=Math.max(0,Math.min(1,a))}setEnabled(a){this.enabled=a}getVolume(){return this.volume}isEnabled(){return this.enabled}}const z=new lt,nt=({score:r,reason:a,isVisible:s,position:t,type:i,experience:l=0})=>{const n=()=>{switch(i){case"success":return r>=30?"text-yellow-300":r>=20?"text-green-300":"text-blue-300";case"shock":return"text-red-300";case"bonus":return"text-purple-300";default:return"text-white"}},d=()=>{switch(i){case"success":return r>=30?"🔥":r>=20?"⚡":"✨";case"shock":return"💥";case"bonus":return"🎉";default:return"⚡"}};return e.jsx(U,{children:s&&e.jsx(m.div,{className:`absolute pointer-events-none z-50 ${n()}`,initial:{opacity:0,scale:.5,x:t.x,y:t.y},animate:{opacity:[0,1,1,0],scale:[.5,1.2,1,.8],y:t.y-80,x:t.x+(Math.random()-.5)*40},transition:{duration:2,ease:"easeOut"},children:e.jsx("div",{className:"bg-black/80 backdrop-blur-sm rounded-lg px-3 py-2 border border-current",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:d()}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-lg",children:["+",r,"⚡"]}),l>0&&e.jsxs("div",{className:"text-xs text-blue-300",children:["+",l," опыта"]}),e.jsx("div",{className:"text-xs opacity-80",children:a})]})]})})})})},ot=({isActive:r,intensity:a="medium",onComplete:s})=>{const[t,i]=u.useState([]);u.useEffect(()=>{r?l():i([])},[r,a]);const l=()=>{const n={low:6,medium:12,high:18,extreme:25}[a],d=["#3B82F6","#EF4444","#FFFFFF","#FBBF24","#8B5CF6"],o=[];for(let h=0;h<n;h++)o.push({id:h,x:Math.random()*100,y:Math.random()*100,angle:Math.random()*360,length:20+Math.random()*60,delay:Math.random()*.3,color:d[Math.floor(Math.random()*d.length)]});i(o),setTimeout(()=>{i([]),s==null||s()},1e3)};return e.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[e.jsx(U,{children:t.map(n=>e.jsxs(m.div,{className:"absolute",style:{left:`${n.x}%`,top:`${n.y}%`,transform:`rotate(${n.angle}deg)`},initial:{opacity:0,scale:0},animate:{opacity:[0,1,.7,0],scale:[0,1,.8,0],x:[0,Math.cos(n.angle*Math.PI/180)*n.length],y:[0,Math.sin(n.angle*Math.PI/180)*n.length]},transition:{duration:.6,delay:n.delay,ease:"easeOut"},children:[e.jsx("div",{className:"w-1 bg-gradient-to-r opacity-90 rounded-full shadow-lg",style:{height:`${n.length}px`,backgroundColor:n.color,boxShadow:`0 0 8px ${n.color}, 0 0 16px ${n.color}40`}}),e.jsx("div",{className:"absolute top-0 left-0 w-1 blur-sm opacity-60 rounded-full",style:{height:`${n.length}px`,backgroundColor:n.color}})]},n.id))}),e.jsx(U,{children:r&&e.jsx(m.svg,{className:"absolute inset-0 w-full h-full",initial:{opacity:0},animate:{opacity:[0,1,.8,.2,.9,0]},transition:{duration:.8,times:[0,.1,.3,.5,.7,1]},children:Array.from({length:3},(n,d)=>{const o=20+Math.random()*60,h=20+Math.random()*60,g=5+Math.floor(Math.random()*5);let p=`M ${o} ${h}`,x=o,f=h;for(let c=0;c<g;c++)x+=(Math.random()-.5)*40,f+=(Math.random()-.5)*40,p+=` L ${x} ${f}`;return e.jsx(m.path,{d:p,stroke:"#FFFFFF",strokeWidth:Math.random()*2+1,fill:"none",opacity:.8,filter:"drop-shadow(0 0 4px #3B82F6)",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.3,delay:d*.1,ease:"easeOut"}},d)})})}),e.jsx(U,{children:r&&e.jsx(m.div,{className:"absolute inset-0 bg-white mix-blend-screen",initial:{opacity:0},animate:{opacity:[0,.4,.1,.3,0]},transition:{duration:.5,times:[0,.1,.3,.6,1]}})})]})},ct=({isActive:r,onComplete:a})=>{const s=u.useRef(null);return u.useEffect(()=>{const t=s.current;if(!t)return;console.log("SimpleVideoPlayer: Effect triggered",{isActive:r});const i=()=>{console.log("SimpleVideoPlayer: Video state",{src:t.src,readyState:t.readyState,networkState:t.networkState,error:t.error,canPlay:t.readyState>=3})},l=()=>console.log("SimpleVideoPlayer: loadstart"),n=()=>console.log("SimpleVideoPlayer: canplay"),d=o=>{console.error("SimpleVideoPlayer: Video error",o.target.error)};if(t.addEventListener("loadstart",l),t.addEventListener("canplay",n),t.addEventListener("error",d),i(),r){console.log("SimpleVideoPlayer: Starting video"),t.currentTime=0,t.style.display="block",z.playTigerSound().catch(h=>{console.warn("SimpleVideoPlayer: Failed to play tiger sound:",h)}),setTimeout(()=>{i(),t.play().then(()=>{console.log("SimpleVideoPlayer: Video started successfully")}).catch(h=>{console.error("SimpleVideoPlayer: Play error:",h)})},100);const o=()=>{console.log("SimpleVideoPlayer: Video ended"),t.style.display="none",a==null||a()};return t.addEventListener("ended",o),()=>{t.removeEventListener("ended",o),t.removeEventListener("loadstart",l),t.removeEventListener("canplay",n),t.removeEventListener("error",d)}}else t.style.display="none"},[r,a]),e.jsx("video",{ref:s,src:"/tigerrosette/Media/video/electric_shock.mp4",className:"absolute inset-0 w-full h-full object-cover rounded-2xl",style:{display:"none"},muted:!0,playsInline:!0,preload:"auto"})},dt=()=>{const{player:r}=I(),[a,s]=u.useState(V(r.level)),[t,i]=u.useState(!1);return u.useEffect(()=>{const l=V(r.level);console.log(`Player level: ${r.level}, Image path: ${l}`),l!==a&&(i(!0),setTimeout(()=>{s(l),i(!1)},300))},[r.level,a]),{currentImage:a,isAnimating:t}},mt=({className:r="",onShock:a})=>{const{clickOutlet:s,singleMode:t,gameState:i,player:l,updateScore:n,triggerShock:d}=I(),{currentImage:o,isAnimating:h}=dt(),[g,p]=u.useState([]),[x,f]=u.useState(!1),[c,v]=u.useState(1),[b,k]=u.useState(!1),[N,D]=u.useState(!1),[R,y]=u.useState({visible:!1,score:0,reason:"",type:"success"}),S=u.useCallback((C,j,E)=>{y({visible:!0,score:C,reason:j,type:E}),setTimeout(()=>{y(M=>({...M,visible:!1}))},2e3)},[]),T=u.useCallback(()=>{console.log("TigerOutlet: Shock video completed"),D(!1)},[]),$=u.useCallback(C=>{const j={low:3,medium:6,high:12,extreme:20}[C],E=Array.from({length:j},(M,A)=>({id:`spark-${Date.now()}-${A}`,x:Math.random()*200-100,y:Math.random()*200-100,intensity:C,timestamp:Date.now(),duration:300+Math.random()*200,color:C==="extreme"?"#E8FF00":C==="high"?"#00D4FF":C==="medium"?"#8A2BE2":"#FF6B35"}));p(M=>[...M,...E]),E.forEach(M=>{setTimeout(()=>{p(A=>A.filter(W=>W.id!==M.id))},M.duration)})},[]),P=u.useCallback(()=>{if(!i.isPlaying)return;if(N){console.log("TigerOutlet: Click during shock video - applying additional penalty!"),w.electricShock(),z.generateShockSound();const j={basePoints:-20,riskMultiplier:1,streakBonus:0,timeBonus:0,totalPoints:-20,reason:"Клик во время разряда!"};n(j),S(j.totalPoints,j.reason,"shock"),$("extreme"),v(4);return}t.warningSignsActive&&(t.dangerLevel>80?w.extremeDangerWarning():t.dangerLevel>60&&w.dangerWarning()),w.outletPress(),f(!0),s();const C=t.isDischarging;if(console.log("TigerOutlet: Click handled",{isShocked:C,dangerLevel:t.dangerLevel,isDischarging:t.isDischarging,currentRisk:t.currentRisk,gameState:i.isPlaying,aiElectricianActive:t.aiElectricianActive,nextDischargeTime:t.nextDischargeTime,now:Date.now(),timeUntilDischarge:t.nextDischargeTime-Date.now(),singleModeState:t}),C)console.log("TigerOutlet: Electric shock triggered!"),k(!0),D(!0),v(3),a==null||a(),w.electricShock(),z.generateShockSound(),d(),setTimeout(()=>{k(!1)},1e3),setTimeout(()=>{const j=window.lastPenaltyMessage;if(j)S(0,j,"shock"),window.lastPenaltyMessage=null;else{const E=B(l.experience).level,M=E>=3?-15:5,A={low:1,medium:1.5,high:2,extreme:2.5}[t.currentRisk],W=E>=3?Math.floor(M*A):M+Math.floor(Math.random()*10),q={basePoints:M,riskMultiplier:A,streakBonus:0,timeBonus:0,totalPoints:W,reason:"Поражение током"};n(q),S(q.totalPoints,q.reason,"shock")}},100);else{const j=t.currentRisk==="extreme"?"extreme":t.currentRisk==="high"?"high":t.currentRisk==="medium"?"medium":"low";$(j),v(2),w.survivalSuccess(),z.generateSparkSound(j);const E=5,M={low:1,medium:2,high:3.5,extreme:6}[t.currentRisk],A=t.streakCount>=50?4:t.streakCount>=25?3:t.streakCount>=10?2:t.streakCount>=5?1.5:1,W=Math.floor(E*M*A),q={basePoints:E,riskMultiplier:M,streakBonus:A,timeBonus:0,totalPoints:W,reason:`Выживание (${t.currentRisk} риск)`};n(q),S(q.totalPoints,q.reason,"success"),t.streakCount>0&&t.streakCount%5===0&&w.streakAchievement(t.streakCount)}setTimeout(()=>{f(!1),v(1)},200)},[i.isPlaying,t,s,$,n]);return e.jsxs("div",{className:`relative ${r}`,children:[N&&e.jsx(m.div,{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-20",initial:{opacity:0},animate:{opacity:[0,1,0]},transition:{duration:.5,repeat:1/0},children:e.jsx("div",{className:"bg-red-600/80 text-white px-4 py-2 rounded-lg border-2 border-red-300 font-bold text-sm",children:"⚡ DANGER! -20 points per click ⚡"})}),e.jsxs(m.button,{onClick:P,disabled:!i.isPlaying,className:`relative w-64 h-64 rounded-2xl overflow-hidden bg-gray-800 ${N?"cursor-pointer animate-pulse":"cursor-pointer"}`,style:{opacity:i.isPlaying?1:.5,boxShadow:N?`0 0 ${40*c}px rgba(255, 0, 0, 0.8)`:`0 0 ${20*c}px rgba(255, 107, 53, ${.5*c})`},whileTap:{scale:.95},whileHover:{scale:1.05},animate:{scale:x?.9:N?[1,1.05,1]:1,filter:`brightness(${c}) saturate(${c})`,rotateY:h?[0,180,360]:0},transition:{rotateY:{duration:.6,ease:"easeInOut"},scale:N?{duration:.3,repeat:1/0}:{duration:.1}},children:[N?e.jsx(ct,{isActive:N,onComplete:T}):e.jsx("img",{src:o,alt:"Tiger Outlet",className:"absolute inset-0 w-full h-full object-cover rounded-2xl",onError:C=>{console.error("Image failed to load:",o),console.error("Error event:",C),console.error("Current window location:",window.location.href),console.error("Trying full path:",`${window.location.origin}${o}`),C.currentTarget.style.display="none"},onLoad:()=>{console.log("Image loaded successfully:",o)}}),N&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 bg-red-500/20 rounded-2xl flex items-center justify-center z-10",children:e.jsx("div",{className:"bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold",children:"⚡ РАЗРЯД ⚡"})}),e.jsx("div",{className:"absolute inset-0 tiger-stripes opacity-20 mix-blend-overlay"}),e.jsx(m.div,{className:"absolute inset-0 rounded-2xl",animate:{boxShadow:t.warningSignsActive?`0 0 ${30*c}px #FF0000, inset 0 0 ${30*c}px #FF0000`:`0 0 ${15*c}px #FF6B35, inset 0 0 ${15*c}px #FF6B35`},transition:{duration:t.warningSignsActive?.1:.2}}),t.dangerLevel>50&&e.jsx(m.div,{className:"absolute -top-12 left-1/2 transform -translate-x-1/2",initial:{opacity:0,scale:0},animate:{opacity:[.7,1,.7,1],scale:[.8,1.2,.8,1.2]},transition:{duration:1,repeat:1/0,ease:"easeInOut"},children:e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-bold ${t.dangerLevel>80?"bg-red-500 text-white":t.dangerLevel>70?"bg-orange-500 text-white":"bg-yellow-500 text-black"}`,children:t.dangerLevel>80?"🔴 КРИТИЧНО":t.dangerLevel>70?"🟠 ОПАСНО":"🟡 РИСК"})}),e.jsx(ot,{isActive:b,intensity:"extreme",onComplete:()=>k(!1)})]}),e.jsx(U,{children:g.map(C=>e.jsx(m.div,{className:"absolute w-2 h-2 rounded-full pointer-events-none",style:{backgroundColor:C.color,boxShadow:`0 0 10px ${C.color}`,left:"50%",top:"50%"},initial:{x:0,y:0,scale:0,opacity:1},animate:{x:C.x,y:C.y,scale:[0,1.5,.8,0],opacity:[1,1,.5,0],rotate:[0,180,360]},transition:{duration:C.duration/1e3,ease:"easeOut"}},C.id))}),e.jsx("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2",children:e.jsxs("div",{className:`px-3 py-1 rounded-full text-xs font-bold ${t.currentRisk==="extreme"?"bg-red-500 text-white":t.currentRisk==="high"?"bg-orange-500 text-white":t.currentRisk==="medium"?"bg-yellow-500 text-black":"bg-green-500 text-white"}`,children:[t.currentRisk==="extreme"?"ЭКСТРИМ":t.currentRisk==="high"?"ВЫСОКИЙ":t.currentRisk==="medium"?"СРЕДНИЙ":"НИЗКИЙ"," РИСК"]})}),e.jsx(nt,{score:R.score,reason:R.reason,isVisible:R.visible,position:{x:0,y:-32},type:R.type})]})},xt=({className:r="",disabled:a=!1})=>{const{player:s,singleMode:t,aiElectrician:i,damageAIElectrician:l,gameState:n}=I(),[d,o]=u.useState(!1),[h,g]=u.useState(0),[p,x]=u.useState(!1),f=50,c=n.isPlaying&&t.aiElectricianActive&&i.isActive&&!a&&h===0&&s.volts>=f,v=async()=>{if(!c||d)return;o(!0),x(!0),w.electricShock(),z.generateShockSound();const b=s.volts,k=10,N=Math.floor(b/10),D=k+N;console.log("Counter attack!",{playerVoltage:b,baseDamage:k,voltageDamage:N,totalDamage:D}),l("energy",D,!0),b>=200?l("equipment",Math.random()*15+10,!0):b>=100&&Math.random()<.5&&l("equipment",Math.random()*10+5,!0);const R=I.getState();I.setState({player:{...R.player,volts:0}}),g(15);const y=setInterval(()=>{g(S=>S<=1?(clearInterval(y),0):S-1)},1e3);setTimeout(()=>{x(!1),o(!1)},1e3)};return e.jsxs("div",{className:`relative ${r}`,children:[e.jsx(U,{children:p&&e.jsx(m.div,{className:"absolute inset-0 pointer-events-none z-10",initial:{scale:0,rotate:0},animate:{scale:[0,1.5,1],rotate:[0,180,360],opacity:[0,1,0]},exit:{opacity:0},transition:{duration:1},children:e.jsx("div",{className:"w-full h-full bg-yellow-400 rounded-full shadow-lg flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"⚡"})})})}),e.jsxs(m.button,{onClick:v,disabled:!c||d,className:`
          relative w-16 h-16 rounded-full border-2 transition-all duration-200
          ${c?"bg-gradient-to-br from-yellow-400 to-orange-500 border-yellow-300 shadow-lg hover:shadow-xl cursor-pointer":"bg-gray-600 border-gray-500 cursor-not-allowed opacity-50"}
          ${h>0?"animate-pulse":""}
        `,whileTap:c?{scale:.9}:{},whileHover:c?{scale:1.1,rotate:5}:{},style:{boxShadow:c?"0 0 20px rgba(255, 193, 7, 0.6)":"none"},children:[e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:h>0?e.jsx("span",{className:"text-white font-bold text-sm",children:h}):e.jsx("span",{className:"text-2xl",children:d?"💥":s.level>=5?"⚡":"🦷"})}),c&&e.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2",children:e.jsxs("div",{className:"bg-black/80 text-white text-xs px-1 py-0.5 rounded",children:[s.volts,"⚡ → 0⚡"]})})]}),!c&&!d&&e.jsx("div",{className:"absolute -top-12 left-1/2 transform -translate-x-1/2 pointer-events-none",children:e.jsx("div",{className:"bg-black/80 text-white text-xs px-2 py-1 rounded whitespace-nowrap",children:s.volts<f?`Нужно ${f-s.volts} вольт`:n.isPlaying?t.aiElectricianActive?"Контратака недоступна":"ИИ электрик неактивен":"Игра не запущена"})})]})},ut=({className:r=""})=>{const{isAuthenticated:a}=X(),{isOnline:s}=rt(),i=s?a?{text:"Подключено к серверу",color:"text-green-400",icon:"✅",bgColor:"bg-green-500/10"}:{text:"Автономный режим",color:"text-yellow-400",icon:"⚠️",bgColor:"bg-yellow-500/10"}:{text:"Нет подключения",color:"text-red-400",icon:"❌",bgColor:"bg-red-500/10"};return e.jsx(m.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:`glass-effect p-2 rounded-lg ${i.bgColor} ${r}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:i.icon}),e.jsx("span",{className:`text-xs font-medium ${i.color}`,children:i.text})]})})},ht=()=>{const{player:r,gameState:a,singleMode:s,aiElectrician:t,repairAIElectrician:i}=I();return e.jsxs("div",{className:"fixed top-0 left-0 right-0 z-10 bg-black/20 backdrop-blur-sm border-b border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center p-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(m.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"СЧЁТ"}),e.jsx("div",{className:"text-xl font-bold text-accent-lime",children:a.score.toLocaleString()})]}),e.jsxs(m.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"ВОЛЬТЫ"}),e.jsxs("div",{className:"text-xl font-bold text-primary-orange",children:[r.volts.toLocaleString(),"⚡"]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs(m.div,{className:"glass-effect px-4 py-2",animate:{scale:s.streakCount>0?[1,1.1,1]:1,boxShadow:s.streakCount>=5?"0 0 20px #E8FF00":"0 0 10px rgba(255,255,255,0.2)"},transition:{duration:.3},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"СЕРИЯ"}),e.jsx("div",{className:`text-xl font-bold ${s.streakCount>=25?"text-red-400":s.streakCount>=10?"text-orange-400":s.streakCount>=5?"text-yellow-400":"text-white"}`,children:s.streakCount})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(m.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},animate:{opacity:r.luckIndicatorHidden&&Date.now()<r.luckHiddenUntil?.3:1},transition:{duration:.3},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"УДАЧА"}),e.jsx("div",{className:`text-sm font-bold ${r.luckIndicatorHidden&&Date.now()<r.luckHiddenUntil?"text-gray-500":r.luckCoefficient>=70?"text-green-400":r.luckCoefficient>=50?"text-yellow-400":r.luckCoefficient>=30?"text-orange-400":"text-red-400"}`,children:r.luckIndicatorHidden&&Date.now()<r.luckHiddenUntil?"???":`${r.luckCoefficient}%`})]}),e.jsxs(m.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"СЛОЖНОСТЬ"}),e.jsx("div",{className:`text-sm font-bold ${s.difficulty==="extreme"?"text-red-400":s.difficulty==="hard"?"text-orange-400":s.difficulty==="medium"?"text-yellow-400":"text-green-400"}`,children:s.difficulty==="extreme"?"ЭКСТРИМ":s.difficulty==="hard"?"СЛОЖНЫЙ":s.difficulty==="medium"?"СРЕДНИЙ":"ЛЁГКИЙ"})]}),e.jsxs(m.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},animate:{boxShadow:s.dangerLevel>80?"0 0 20px #ff4444":s.dangerLevel>60?"0 0 15px #ff8800":s.dangerLevel>40?"0 0 10px #ffaa00":"0 0 5px rgba(255,255,255,0.2)"},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"ОПАСНОСТЬ"}),e.jsxs("div",{className:`text-sm font-bold ${s.dangerLevel>80?"text-red-400":s.dangerLevel>60?"text-orange-400":s.dangerLevel>40?"text-yellow-400":"text-green-400"}`,children:[s.dangerLevel,"%"]})]}),e.jsxs(m.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},animate:{boxShadow:s.isDischarging?"0 0 20px #ff0000":s.warningSignsActive?"0 0 15px #ff8800":s.aiElectricianActive?"0 0 10px #00ffff":"0 0 5px rgba(255,255,255,0.2)",scale:s.isDischarging?[1,1.05,1]:1},transition:{duration:.3,repeat:s.isDischarging?1/0:0},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"ИИ ЭЛЕКТРИК"}),e.jsx("div",{className:`text-sm font-bold ${s.isDischarging?"text-red-400":s.warningSignsActive?"text-orange-400":s.aiElectricianActive?"text-cyan-400":"text-gray-500"}`,children:s.isDischarging?"⚡ РАЗРЯД!":s.warningSignsActive?"⚠️ ВНИМАНИЕ!":s.aiElectricianActive?"🤖 АКТИВЕН":"😴 СПИТ"})]}),e.jsxs(m.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"НАЖАТИЙ"}),e.jsx("div",{className:"text-lg font-bold text-accent-blue",children:r.totalClicks})]}),e.jsx(ut,{})]})]}),s.warningSignsActive&&e.jsx(m.div,{className:"bg-yellow-500/80 text-black px-4 py-2 text-center font-bold",initial:{opacity:0,y:-20},animate:{opacity:[0,1,.7,1,.7,1],y:0},transition:{duration:.5},children:"⚠️ ОПАСНОСТЬ! ВЫСОКИЙ РИСК РАЗРЯДА! ⚠️"}),s.dangerLevel>30&&e.jsxs(m.div,{className:`px-4 py-1 text-center text-xs font-semibold ${s.dangerLevel>70?"bg-red-500/60 text-white":s.dangerLevel>50?"bg-orange-500/60 text-white":"bg-yellow-500/60 text-black"}`,initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:["🔥 УРОВЕНЬ ОПАСНОСТИ: ",s.dangerLevel,"% 🔥"]}),s.aiElectricianActive&&e.jsx(m.div,{className:"bg-black/40 border-t border-white/10 px-4 py-3",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-cyan-400 font-bold",children:["⚡ ",t.name]}),e.jsx("div",{className:`text-xs ${t.mood==="confident"?"text-green-400":t.mood==="frustrated"?"text-orange-400":t.mood==="tired"?"text-yellow-400":t.mood==="broken"?"text-red-400":"text-red-600"}`,children:t.lastMessage})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-1",children:"ЭНЕРГИЯ"}),e.jsx("div",{className:"w-20 h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx(m.div,{className:`h-full rounded-full ${t.energy>60?"bg-green-500":t.energy>30?"bg-yellow-500":"bg-red-500"}`,initial:{width:0},animate:{width:`${t.energy}%`},transition:{duration:.5}})}),e.jsxs("div",{className:"text-xs text-white",children:[Math.round(t.energy),"%"]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-1",children:"НАПРЯЖЕНИЕ"}),e.jsx("div",{className:"w-20 h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx(m.div,{className:`h-full rounded-full ${t.voltage>300?"bg-red-500":t.voltage>200?"bg-orange-500":t.voltage>100?"bg-yellow-500":"bg-blue-500"}`,initial:{width:0},animate:{width:`${t.voltage/t.maxVoltage*100}%`,boxShadow:t.voltage>=100?"0 0 10px rgba(255, 0, 0, 0.8)":"none"},transition:{duration:.5}})}),e.jsxs("div",{className:`text-xs font-bold ${t.voltage>=100?"text-red-400":"text-white"}`,children:[Math.round(t.voltage),"⚡"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"БАТ"}),e.jsxs("div",{className:`text-xs font-bold ${t.equipment.battery>70?"text-green-400":t.equipment.battery>30?"text-yellow-400":"text-red-400"}`,children:[Math.round(t.equipment.battery),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"КОН"}),e.jsxs("div",{className:`text-xs font-bold ${t.equipment.capacitor>70?"text-green-400":t.equipment.capacitor>30?"text-yellow-400":"text-red-400"}`,children:[Math.round(t.equipment.capacitor),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"ПРВ"}),e.jsxs("div",{className:`text-xs font-bold ${t.equipment.wires>70?"text-green-400":t.equipment.wires>30?"text-yellow-400":"text-red-400"}`,children:[Math.round(t.equipment.wires),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"ГЕН"}),e.jsxs("div",{className:`text-xs font-bold ${t.equipment.generator>70?"text-green-400":t.equipment.generator>30?"text-yellow-400":"text-red-400"}`,children:[Math.round(t.equipment.generator),"%"]})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"ЭФФЕКТ"}),e.jsxs("div",{className:`text-sm font-bold ${t.workingEfficiency>80?"text-green-400":t.workingEfficiency>50?"text-yellow-400":"text-red-400"}`,children:[Math.round(t.workingEfficiency),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"УСПЕХ/НЕУДАЧ"}),e.jsx("div",{className:"text-xs text-green-400",children:t.successfulDischarges}),e.jsx("div",{className:"text-xs text-red-400",children:t.failuresCount})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:`text-sm font-bold ${t.canWork?"text-green-400":"text-red-400"}`,children:t.canWork?"✅ РАБОТАЕТ":"❌ НЕ РАБОТАЕТ"})})]}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsx(m.button,{className:"glass-effect px-3 py-1 text-xs text-green-400 hover:text-green-300 disabled:text-gray-500 disabled:cursor-not-allowed",onClick:()=>{r.volts>=50&&(i("energy"),I.getState().updatePlayerStats({volts:r.volts-50}))},disabled:r.volts<50||t.energy>=90,whileHover:{scale:1.05},whileTap:{scale:.95},children:"⚡ Зарядить (50⚡)"}),e.jsx(m.button,{className:"glass-effect px-3 py-1 text-xs text-blue-400 hover:text-blue-300 disabled:text-gray-500 disabled:cursor-not-allowed",onClick:()=>{r.volts>=100&&(i("equipment"),I.getState().updatePlayerStats({volts:r.volts-100}))},disabled:r.volts<100||Object.values(t.equipment).every(l=>l>=95),whileHover:{scale:1.05},whileTap:{scale:.95},children:"🔧 Починить (100⚡)"})]})]})})]})},gt=({isActive:r,intensity:a="medium",duration:s=500,onComplete:t})=>{const i={low:5,medium:10,high:15,extreme:20}[a];return u.useEffect(()=>{if(r&&t){const l=setTimeout(t,s);return()=>clearTimeout(l)}},[r,s,t]),r?e.jsx(m.div,{className:"fixed inset-0 pointer-events-none z-50",initial:{x:0,y:0},animate:{x:[0,-i,i,-i,i,0],y:[0,i,-i,i,-i,0]},transition:{duration:s/1e3,times:[0,.1,.2,.3,.4,1],ease:"easeInOut"},children:e.jsx(m.div,{className:"absolute inset-0 bg-red-500 mix-blend-multiply",initial:{opacity:0},animate:{opacity:[0,.3,0,.2,0]},transition:{duration:s/1e3}})}):null},ft=()=>{const{gameState:r,singleMode:a,endGame:s,player:t,submitGameToServer:i}=I(),{isAuthenticated:l}=X(),[n,d]=u.useState(0),[o,h]=u.useState(!1),[g,p]=u.useState(!1),[x,f]=u.useState(!1),c=u.useCallback(()=>{f(!0),setTimeout(()=>{f(!1)},600)},[]);u.useEffect(()=>{if(!r.isPlaying)return;const k=setInterval(()=>{d(N=>N+1)},1e3);return()=>clearInterval(k)},[r.isPlaying]),u.useEffect(()=>{n>=600&&h(!0)},[n]);const v=async()=>{if(h(!1),d(0),l&&r.score>0){p(!0);try{const k=I.getState();k.gameState.gameTime=n*1e3;const N=await i();N.success?console.log("✅ Игра успешно сохранена на сервер"):console.warn("⚠️ Не удалось сохранить игру на сервер:",N.error)}catch(k){console.error("❌ Ошибка при сохранении игры:",k)}finally{p(!1)}}s()},b=k=>{const N=Math.floor(k/60),D=k%60;return`${N.toString().padStart(2,"0")}:${D.toString().padStart(2,"0")}`};return o?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background-dark to-background-darker",children:e.jsxs(m.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"glass-effect p-8 text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold text-primary-orange mb-4",children:"Игра окончена!"}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Время игры:"}),e.jsx("span",{className:"font-bold",children:b(n)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Финальный счёт:"}),e.jsx("span",{className:"font-bold text-accent-lime",children:r.score.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Получено вольт:"}),e.jsxs("span",{className:"font-bold text-primary-orange",children:[r.score,"⚡"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Всего нажатий:"}),e.jsx("span",{className:"font-bold text-accent-blue",children:t.totalClicks})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Лучшая серия:"}),e.jsx("span",{className:"font-bold text-yellow-400",children:t.streak})]})]}),l&&r.score>0&&e.jsx("div",{className:"mb-4 text-center",children:g?e.jsxs("div",{className:"text-blue-400 text-sm",children:[e.jsx("span",{className:"inline-block animate-spin mr-2",children:"⏳"}),"Сохранение результатов..."]}):e.jsx("div",{className:"text-green-400 text-sm",children:"✅ Результаты будут сохранены на сервер"})}),!l&&r.score>0&&e.jsx("div",{className:"mb-4 text-center text-yellow-400 text-sm",children:"⚠️ Результаты сохраняются только локально"}),e.jsx(m.button,{onClick:v,disabled:g,className:"w-full glass-effect p-3 rounded-xl hover:bg-primary-orange/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",whileHover:{scale:g?1:1.05},whileTap:{scale:g?1:.95},children:e.jsx("span",{className:"font-bold",children:g?"Сохранение...":"Вернуться в меню"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{isActive:x}),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background-dark to-background-darker relative",children:[e.jsx(ht,{}),e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen pt-24 pb-8",children:[e.jsx(m.div,{className:"glass-effect px-6 py-3 mb-8",animate:{scale:n%10===0&&n>0?[1,1.1,1]:1},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"ВРЕМЯ ИГРЫ"}),e.jsx("div",{className:"text-2xl font-bold text-white font-mono",children:b(n)})]})}),e.jsxs("div",{className:"relative flex items-center justify-center space-x-8 mb-8",children:[e.jsx(xt,{className:"order-1"}),e.jsx(mt,{className:"order-2",onShock:c}),e.jsx("div",{className:"w-16 h-16 order-3 opacity-0"})]}),e.jsx("div",{className:"flex space-x-4 text-center",children:e.jsxs(m.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"ПОСЛЕДНИЙ РИСК"}),e.jsx("div",{className:`text-sm font-bold ${a.currentRisk==="extreme"?"text-red-400":a.currentRisk==="high"?"text-orange-400":a.currentRisk==="medium"?"text-yellow-400":"text-green-400"}`,children:a.currentRisk==="extreme"?"ЭКСТРИМ":a.currentRisk==="high"?"ВЫСОКИЙ":a.currentRisk==="medium"?"СРЕДНИЙ":"НИЗКИЙ"})]})}),e.jsx(m.button,{onClick:v,className:"mt-8 glass-effect px-6 py-3 rounded-xl hover:bg-red-500/20 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx("span",{className:"text-red-300 font-bold",children:"Завершить игру"})})]}),e.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden",children:e.jsx(m.div,{className:"absolute inset-0 opacity-10",animate:{backgroundPosition:["0% 0%","100% 100%"]},transition:{duration:20,repeat:1/0,ease:"linear"},style:{backgroundImage:`
              linear-gradient(0deg, transparent 24%, rgba(255, 107, 53, 0.05) 25%, rgba(255, 107, 53, 0.05) 26%, transparent 27%, transparent 74%, rgba(255, 107, 53, 0.05) 75%, rgba(255, 107, 53, 0.05) 76%, transparent 77%, transparent),
              linear-gradient(90deg, transparent 24%, rgba(255, 107, 53, 0.05) 25%, rgba(255, 107, 53, 0.05) 26%, transparent 27%, transparent 74%, rgba(255, 107, 53, 0.05) 75%, rgba(255, 107, 53, 0.05) 76%, transparent 77%, transparent)
            `,backgroundSize:"50px 50px"}})})]})]})},pt=()=>{const r=()=>{w.light(),I.getState().endGame()};return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-background-dark to-background-darker",children:[e.jsxs(m.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-primary-orange mb-4",children:"🎮 Многопользовательский режим"}),e.jsx("p",{className:"text-xl text-gray-300 mb-8",children:"Скоро здесь будут эпические дуэли!"})]}),e.jsxs(m.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.2},className:"glass-effect p-8 rounded-xl text-center max-w-md",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🚧"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"В разработке"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Мы работаем над захватывающими многопользовательскими режимами:"}),e.jsxs("div",{className:"space-y-3 text-left mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-purple-400",children:"⚔️"}),e.jsx("span",{className:"text-gray-300",children:"Дуэли 1v1 в реальном времени"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-blue-400",children:"🏆"}),e.jsx("span",{className:"text-gray-300",children:"Турниры до 8 игроков"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-green-400",children:"🤝"}),e.jsx("span",{className:"text-gray-300",children:"Кооперативные режимы"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-yellow-400",children:"📊"}),e.jsx("span",{className:"text-gray-300",children:"Глобальные таблицы лидеров"})]})]}),e.jsx(m.button,{onClick:r,className:"w-full glass-effect p-3 rounded-xl hover:bg-orange-500/20 transition-colors border border-orange-400/30",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsx("span",{className:"text-lg font-semibold text-orange-400",children:"← Назад в меню"})})]}),e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4},className:"mt-8 text-center text-gray-400 text-sm",children:e.jsx("p",{children:"🔔 Подпишитесь на уведомления, чтобы узнать о запуске первыми!"})})]})},vt=()=>{const{player:r}=I(),[a,s]=u.useState(!1),[t,i]=u.useState(null),[l,n]=u.useState(null),[d,o]=u.useState([]),h=u.useRef(null),g=u.useRef([]),p=u.useRef(null),x=u.useRef(0),f=u.useCallback(()=>{console.log("🔌 Подключение к серверу дуэлей..."),setTimeout(()=>{s(!0),console.log("✅ Подключено к серверу дуэлей"),h.current=setInterval(()=>{if(g.current.length>0){const y=g.current.shift();y&&o(S=>[...S,y])}},100)},1e3)},[]),c=u.useCallback(()=>{h.current&&(clearInterval(h.current),h.current=null),p.current&&(clearInterval(p.current),p.current=null),s(!1),i(null),n(null),o([]),console.log("🔌 Отключено от сервера дуэлей")},[]),v=u.useCallback(async()=>{if(!a)throw new Error("Не подключен к серверу");return console.log("🔍 Поиск дуэли..."),new Promise(y=>{setTimeout(()=>{const S={id:`duel_${Date.now()}`,players:[r.id,"bot_opponent"],status:"waiting",createdAt:Date.now()},T={id:"bot_opponent",name:`Соперник ${Math.floor(Math.random()*1e3)}`,level:Math.max(1,r.level-2+Math.floor(Math.random()*5)),volts:Math.floor(Math.random()*500)+100,isReady:!1,score:0,streak:0};i(S),n(T),console.log("✅ Дуэль найдена!",S),y(S)},2e3+Math.random()*3e3)})},[a,r.id,r.level]),b=u.useCallback(y=>{if(!a||!t){console.warn("⚠️ Не удалось отправить сообщение: нет соединения или комнаты");return}const S={...y,timestamp:Date.now()};if(console.log("📤 Отправка сообщения:",S),y.type==="player_ready"&&setTimeout(()=>{g.current.push({type:"player_ready",playerId:"bot_opponent",timestamp:Date.now()})},1e3+Math.random()*2e3),y.type==="player_action"){const T=Date.now();T-x.current>2e3&&Math.random()<.3&&(x.current=T,setTimeout(()=>{Math.random()<.25?g.current.push({type:"player_shocked",playerId:"bot_opponent",data:{damage:20+Math.random()*30},timestamp:Date.now()}):g.current.push({type:"player_action",playerId:"bot_opponent",data:{points:Math.floor(Math.random()*50)+15,volts:Math.floor(Math.random()*30)+10},timestamp:Date.now()})},800+Math.random()*1500))}},[a,t]),k=u.useCallback(()=>{b({type:"player_ready",playerId:r.id}),setTimeout(()=>{p.current=setInterval(()=>{const y=Date.now();Math.random()<.4&&(Math.random()<.25?g.current.push({type:"player_shocked",playerId:"bot_opponent",data:{damage:20+Math.random()*30},timestamp:y}):g.current.push({type:"player_action",playerId:"bot_opponent",data:{points:Math.floor(Math.random()*50)+15,volts:Math.floor(Math.random()*30)+10},timestamp:y}))},2e3+Math.random()*1500)},3e3)},[b,r.id]),N=u.useCallback((y,S)=>{b({type:"player_action",playerId:r.id,data:{points:y,volts:S}})},[b,r.id]),D=u.useCallback(y=>{b({type:"player_shocked",playerId:r.id,data:{damage:y}})},[b,r.id]),R=u.useCallback(()=>{t&&b({type:"game_end",playerId:r.id,data:{reason:"left"}}),p.current&&(clearInterval(p.current),p.current=null),i(null),n(null),o([])},[t,b,r.id]);return u.useEffect(()=>()=>{c()},[c]),{isConnected:a,currentRoom:t,opponent:l,messages:d,connect:f,disconnect:c,findDuel:v,setReady:k,sendPlayerAction:N,sendPlayerShocked:D,leaveDuel:R,setOpponent:n}},yt=()=>{const{player:r,endGame:a}=I(),{isConnected:s,currentRoom:t,opponent:i,messages:l,connect:n,disconnect:d,findDuel:o,setReady:h,sendPlayerAction:g,sendPlayerShocked:p,leaveDuel:x,setOpponent:f}=vt(),[c,v]=u.useState({status:"connecting",timeLeft:60,winner:null,roundNumber:1,maxRounds:3}),[b,k]=u.useState({id:r.id,name:r.name,volts:r.volts,level:r.level,isReady:!1,isAlive:!0,score:0,streak:0}),[N,D]=u.useState(0),[R,y]=u.useState(0);u.useEffect(()=>(n(),()=>{d()}),[n,d]),u.useEffect(()=>{s&&c.status==="connecting"&&(v(j=>({...j,status:"searching"})),o().then(()=>{v(j=>({...j,status:"found"})),w.medium()}))},[s,c.status,o]),u.useEffect(()=>{const j=l[l.length-1];if(j)switch(j.type){case"player_ready":j.playerId!==r.id&&f(E=>E?{...E,isReady:!0}:null);break;case"player_action":if(j.playerId!==r.id&&i){const{points:E,volts:M}=j.data;f(A=>A?{...A,score:A.score+E,volts:A.volts+M,streak:A.streak+1}:null)}break;case"player_shocked":if(j.playerId!==r.id&&i){const{damage:E}=j.data;f(M=>M?{...M,volts:Math.max(0,M.volts-E),streak:0}:null)}break;case"game_start":v(E=>({...E,status:"countdown"})),D(3);break;case"game_end":v(E=>({...E,status:"finished"}));break}},[l,r.id,i,f]),u.useEffect(()=>{c.status==="found"&&b.isReady&&(i!=null&&i.isReady)&&(v(j=>({...j,status:"countdown"})),D(3))},[c.status,b.isReady,i==null?void 0:i.isReady]),u.useEffect(()=>{if(c.status==="countdown"&&N>0){const j=setTimeout(()=>{D(E=>E-1),w.light()},1e3);return()=>clearTimeout(j)}else c.status==="countdown"&&N===0&&(v(j=>({...j,status:"playing"})),y(c.timeLeft),w.heavy())},[c.status,N,c.timeLeft]),u.useEffect(()=>{if(c.status==="playing"&&R>0){const j=setTimeout(()=>{y(E=>E-1)},1e3);return()=>clearTimeout(j)}else if(c.status==="playing"&&R===0){const j=b.score>((i==null?void 0:i.score)||0)?b.id:((i==null?void 0:i.score)||0)>b.score?i==null?void 0:i.id:null;v(E=>({...E,status:"finished",winner:j}))}},[c.status,R,b.score,i==null?void 0:i.score]);const S=()=>{k(j=>({...j,isReady:!0})),h(),w.medium()},T=u.useCallback(()=>{if(c.status!=="playing")return;const j=Math.floor(Math.random()*80)+20;Math.random()<.25?(k(A=>({...A,volts:Math.max(0,A.volts-30),streak:0})),p(30),w.heavy()):(k(M=>({...M,score:M.score+j,volts:M.volts+j,streak:M.streak+1})),g(j,j),w.light())},[c.status,g,p]),$=()=>{w.light(),x(),a()},P=()=>{switch(c.status){case"connecting":return"Подключение к серверу...";case"searching":return"Поиск соперника...";case"found":return"Соперник найден!";case"ready":return"Приготовьтесь!";case"countdown":return`Начинаем через ${N}`;case"playing":return`Осталось: ${R}с`;case"finished":return c.winner?c.winner===b.id?"Победа!":"Поражение":"Ничья!";default:return""}},C=()=>s?t?"🟢 В дуэли":"🟡 Подключен":"🔴 Не подключен";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background-dark to-background-darker",children:[e.jsx("div",{className:"bg-black/40 border-b border-white/10 p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:$,className:"text-gray-400 hover:text-white transition-colors",children:"← Назад"}),e.jsx("h1",{className:"text-xl font-bold text-primary-orange",children:"⚔️ ДУЭЛЬ REAL-TIME"}),e.jsx("div",{className:"text-sm text-gray-400",children:C()})]})}),e.jsxs("div",{className:"bg-black/30 p-4 text-center",children:[e.jsx(m.div,{className:"text-2xl font-bold text-white",animate:{scale:c.status==="countdown"?[1,1.2,1]:1},transition:{duration:.5,repeat:c.status==="countdown"?1/0:0},children:P()}),t&&e.jsxs("div",{className:"text-sm text-gray-400 mt-2",children:["Комната: ",t.id.slice(-8)]})]}),(c.status==="found"||c.status==="ready"||c.status==="countdown"||c.status==="playing"||c.status==="finished")&&i&&e.jsxs("div",{className:"flex justify-between items-center p-4 bg-black/20",children:[e.jsx(m.div,{className:"glass-effect p-4 rounded-xl flex-1 mr-2",animate:{borderColor:b.isReady?"#10B981":"#6B7280",boxShadow:b.streak>0?"0 0 20px #10B981":"none"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-400",children:b.name}),e.jsxs("div",{className:"text-sm text-gray-300",children:["Уровень ",b.level]}),e.jsx("div",{className:"text-2xl font-bold text-white mt-2",children:b.score}),e.jsx("div",{className:"text-xs text-gray-400",children:"Очки"}),e.jsxs("div",{className:"text-sm text-yellow-400 mt-1",children:["Серия: ",b.streak]}),e.jsxs("div",{className:"text-sm text-blue-400",children:[b.volts,"⚡"]}),b.isReady&&e.jsx("div",{className:"text-xs text-green-400 mt-1",children:"✓ Готов"})]})}),e.jsx("div",{className:"px-4",children:e.jsx("div",{className:"text-3xl font-bold text-red-400",children:"VS"})}),e.jsx(m.div,{className:"glass-effect p-4 rounded-xl flex-1 ml-2",animate:{borderColor:i.isReady?"#10B981":"#6B7280",boxShadow:i.streak>0?"0 0 20px #EF4444":"none"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-400",children:i.name}),e.jsxs("div",{className:"text-sm text-gray-300",children:["Уровень ",i.level]}),e.jsx("div",{className:"text-2xl font-bold text-white mt-2",children:i.score}),e.jsx("div",{className:"text-xs text-gray-400",children:"Очки"}),e.jsxs("div",{className:"text-sm text-yellow-400 mt-1",children:["Серия: ",i.streak]}),e.jsxs("div",{className:"text-sm text-blue-400",children:[i.volts,"⚡"]}),i.isReady&&e.jsx("div",{className:"text-xs text-green-400 mt-1",children:"✓ Готов"})]})})]}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center p-4",children:e.jsxs(U,{mode:"wait",children:[(c.status==="connecting"||c.status==="searching")&&e.jsxs(m.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:c.status==="connecting"?"�":"�🔍"}),e.jsx("div",{className:"text-xl text-gray-300 mb-4",children:c.status==="connecting"?"Подключение к серверу...":"Ищем достойного соперника..."}),e.jsx("div",{className:"animate-spin text-4xl",children:"⚡"})]},"searching"),c.status==="found"&&e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚔️"}),e.jsx("div",{className:"text-xl text-white mb-6",children:"Соперник найден!"}),e.jsxs("div",{className:"text-lg text-gray-300 mb-4",children:[i==null?void 0:i.name," (Уровень ",i==null?void 0:i.level,")"]}),e.jsx(m.button,{onClick:S,disabled:b.isReady,className:`px-8 py-4 rounded-xl font-bold text-lg transition-colors ${b.isReady?"bg-green-600 text-white cursor-default":"bg-orange-600 hover:bg-orange-500 text-white"}`,whileHover:{scale:b.isReady?1:1.05},whileTap:{scale:b.isReady?1:.95},children:b.isReady?"✓ Готов! Ждем соперника...":"Готов к бою!"})]},"found"),c.status==="countdown"&&e.jsx(m.div,{initial:{opacity:0,scale:2},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},className:"text-center",children:e.jsx(m.div,{className:"text-9xl font-bold text-red-400",animate:{scale:[1,1.2,1]},transition:{duration:.5},children:N||"⚡"})},"countdown"),c.status==="playing"&&e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"w-full max-w-md",children:[e.jsx("div",{className:"w-full h-48 bg-orange-500 rounded-lg cursor-pointer flex items-center justify-center hover:bg-orange-600 transition-colors",onClick:T,children:e.jsx("span",{className:"text-white text-2xl font-bold",children:"⚡ КЛИК ⚡"})}),e.jsx("div",{className:"text-center mt-4 text-white",children:"🔥 Real-time дуэль! Кликайте быстро! 🔥"}),e.jsxs("div",{className:"text-center mt-2 text-gray-400 text-sm",children:["Время: ",R,"с | Ваш счет: ",b.score," | Соперник: ",(i==null?void 0:i.score)||0]})]},"playing"),c.status==="finished"&&e.jsxs(m.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:c.winner===b.id?"🏆":c.winner===(i==null?void 0:i.id)?"💀":"🤝"}),e.jsx("div",{className:"text-3xl font-bold text-white mb-4",children:P()}),e.jsxs("div",{className:"text-lg text-gray-300 mb-6",children:["Финальный счет: ",b.score," - ",(i==null?void 0:i.score)||0]}),c.winner===b.id&&e.jsxs("div",{className:"text-green-400 text-lg mb-4",children:["+",Math.floor(b.score*.1)," опыта за победу!"]}),e.jsx(m.button,{onClick:$,className:"px-8 py-4 bg-orange-600 hover:bg-orange-500 text-white rounded-xl font-bold text-lg transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Вернуться в меню"})]},"finished")]})})]})},bt=()=>{const{player:r,goToMenu:a}=I(),{webApp:s,user:t,isInTelegram:i}=J(),[l,n]=u.useState([]),[d,o]=u.useState([]),[h,g]=u.useState(null),[p,x]=u.useState("idle"),[f,c]=u.useState(!1);u.useEffect(()=>{i&&s&&t?v(t.id):n([])},[i,s,t]);const v=async y=>{c(!0);try{const T=await(await fetch(`http://localhost:3001/api/duels/players/${y}`)).json();T.success?(n(T.players),console.log(`✅ Загружено ${T.players.length} реальных игроков`)):(console.error("Ошибка загрузки игроков:",T.error),n([]))}catch(S){console.error("Ошибка запроса игроков:",S),n([])}finally{c(!1)}},b=async y=>{if(!i||!s||!t){alert("Дуэли доступны только в Telegram!");return}x("sending"),w.medium();try{const T=await(await fetch("http://localhost:3001/api/duels/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUserId:t.id,toUserId:y.id,message:`${t.first_name} (Уровень ${r.level}) вызывает вас на дуэль!`})})).json();if(T.success){const $={id:T.duelId,fromUserId:t.id,toUserId:y.id,status:"pending",createdAt:Date.now(),expiresAt:Date.now()+3e5};o(P=>[...P,$]),x("sent"),s.showAlert&&s.showAlert(`Приглашение отправлено ${y.firstName}! Ожидаем ответа...`),setTimeout(()=>{x("waiting")},2e3)}else throw new Error(T.error||"Ошибка отправки приглашения")}catch(S){console.error("Ошибка отправки приглашения:",S),x("idle"),s!=null&&s.showAlert&&s.showAlert("Ошибка отправки приглашения. Попробуйте еще раз.")}},k=y=>{g(y),w.light()},N=()=>{h&&b(h)},D=()=>{w.light(),a()},R=y=>{const S=y.lastName?`${y.firstName} ${y.lastName}`:y.firstName;return y.username?`${S} (@${y.username})`:S};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background-dark to-background-darker",children:[e.jsxs("div",{className:"bg-black/40 border-b border-white/10 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:D,className:"text-gray-400 hover:text-white transition-colors",children:"← Назад"}),e.jsx("h1",{className:"text-white text-xl font-bold",children:"⚔️ Приглашения на дуэль"}),e.jsx("div",{})]}),!i&&e.jsx("div",{className:"text-sm text-yellow-400 mt-2 text-center",children:"⚠️ Для дуэлей откройте игру в Telegram"})]}),e.jsx("div",{className:"p-4",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-white text-lg mb-4 font-bold",children:"👥 Игроки онлайн:"}),f?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin text-orange-400 text-4xl mb-4",children:"⚡"}),e.jsx("div",{className:"text-gray-400",children:"Загружаем игроков..."})]}):l.length>0?e.jsx("div",{className:"space-y-3",children:l.map(y=>e.jsx(m.div,{className:`glass-effect p-4 rounded-xl cursor-pointer transition-all ${(h==null?void 0:h.id)===y.id?"border-2 border-green-400 bg-green-400/10":"border border-white/20 hover:border-orange-400"}`,onClick:()=>k(y),whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center text-white font-bold text-lg",children:y.firstName.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:R(y)}),e.jsxs("div",{className:"text-gray-400 text-sm",children:["Уровень ",y.level||1," • Побед: ",y.wins||0,"/",y.totalGames||0]})]})]}),(h==null?void 0:h.id)===y.id&&e.jsx("div",{className:"text-green-400 text-2xl",children:"✓"})]})},y.id))}):e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"😔"}),e.jsx("div",{className:"text-lg mb-2",children:"Нет доступных игроков"}),e.jsx("div",{className:"text-sm",children:"Пригласите друзей подписаться на бота для дуэлей!"})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📱"}),e.jsx("div",{className:"text-xl text-white mb-4",children:"Откройте игру в Telegram"}),e.jsx("div",{className:"text-gray-400 mb-6",children:"Дуэли доступны только подписчикам бота в Telegram"}),e.jsx("a",{href:"https://orspiritus.github.io/tigerrosette/",target:"_blank",rel:"noopener noreferrer",className:"bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors",children:"🚀 Открыть в Telegram"})]})}),h&&p==="idle"&&e.jsx("div",{className:"fixed bottom-6 left-4 right-4",children:e.jsxs(m.button,{onClick:N,className:"w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-4 rounded-xl font-bold text-lg",whileHover:{scale:1.02},whileTap:{scale:.98},initial:{opacity:0,y:50},animate:{opacity:1,y:0},children:["⚔️ Отправить вызов на дуэль ",h.firstName]})}),p==="waiting"&&e.jsx("div",{className:"fixed bottom-6 left-4 right-4",children:e.jsxs("div",{className:"bg-black/60 backdrop-blur-sm rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-white text-lg mb-2",children:"⏳ Ожидаем ответа..."}),e.jsx("div",{className:"text-gray-400 text-sm",children:"Приглашение действительно 5 минут"}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"animate-pulse text-orange-400",children:"⚡⚔️⚡"})})]})}),d.length>0&&e.jsxs("div",{className:"p-4 mt-4",children:[e.jsx("div",{className:"text-white text-lg mb-3 font-bold",children:"📋 Активные приглашения:"}),d.map(y=>{const S=l.find(P=>P.id===y.toUserId),T=Math.max(0,y.expiresAt-Date.now()),$=Math.floor(T/6e4);return e.jsxs("div",{className:"glass-effect p-3 rounded-lg mb-2",children:[e.jsx("div",{className:"text-white",children:S?R(S):"Неизвестный пользователь"}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Статус: ",y.status," • Осталось: ",$,"м"]})]},y.id)})]})]})},jt=()=>{const{player:r,startMultiplayerMode:a}=I(),{webApp:s,user:t,isInTelegram:i}=J(),[l,n]=u.useState([]),[d,o]=u.useState(null);u.useEffect(()=>{if(i&&s){const x=new URLSearchParams(window.location.search),f=x.get("duel")||x.get("duel_invite");console.log("🔍 URL parameters:",window.location.search),console.log("🎯 Duel ID found:",f),f&&(console.log("🎯 Found duel ID in URL, fetching duel info..."),h(f)),console.log("Слушаем приглашения на дуэли...")}},[i,s]);const h=async x=>{var f,c,v;try{console.log("🔍 Fetching duel info for ID:",x);const k=await(await fetch(`http://localhost:3001/api/duels/info/${x}`)).json();if(k.success&&k.duel){console.log("✅ Duel info received:",k.duel);const N=k.duel,D={id:x,fromUserId:N.player1_id,fromUserName:((f=N.fromUser)==null?void 0:f.firstName)||"Игрок",fromUserLevel:((c=N.fromUser)==null?void 0:c.level)||1,message:`Приглашение на дуэль от ${((v=N.fromUser)==null?void 0:v.firstName)||"игрока"}!`,receivedAt:Date.now(),expiresAt:new Date(N.expires_at).getTime()};g(D)}else{console.error("❌ Failed to fetch duel info:",k.error);const N={id:x,fromUserId:12345,fromUserName:"Игрок",fromUserLevel:1,message:"Приглашение на дуэль!",receivedAt:Date.now(),expiresAt:Date.now()+5*60*1e3};g(N)}}catch(b){console.error("❌ Error fetching duel info:",b),g({id:x,fromUserId:12345,fromUserName:"Игрок",fromUserLevel:1,message:"Приглашение на дуэль!"})}},g=x=>{var c,v,b;const f={id:x.inviteId||x.id,fromUserId:((c=x.fromUser)==null?void 0:c.id)||x.fromUserId,fromUserName:((v=x.fromUser)==null?void 0:v.name)||x.fromUserName,fromUserLevel:((b=x.fromUser)==null?void 0:b.level)||x.fromUserLevel,message:x.message,receivedAt:Date.now(),expiresAt:Date.now()+3e5};n(k=>[...k,f]),s!=null&&s.showAlert&&s.showAlert(`🎮 Новое приглашение на дуэль от ${f.fromUserName}!`),w.heavy()},p=async(x,f)=>{o(x.id),w.medium();try{if(f){if(s!=null&&s.sendData){const c={type:"duel_response",inviteId:x.id,accepted:!0,fromUserId:t==null?void 0:t.id,fromUserName:t==null?void 0:t.first_name,fromUserLevel:r.level};s.sendData(JSON.stringify(c))}s!=null&&s.showAlert&&s.showAlert(`Дуэль принята! Подготовка к бою с ${x.fromUserName}...`),n(c=>c.filter(v=>v.id!==x.id)),setTimeout(()=>{a("duel")},2e3)}else{if(s!=null&&s.sendData){const c={type:"duel_response",inviteId:x.id,accepted:!1,fromUserId:t==null?void 0:t.id};s.sendData(JSON.stringify(c))}s!=null&&s.showAlert&&s.showAlert(`Приглашение от ${x.fromUserName} отклонено.`),n(c=>c.filter(v=>v.id!==x.id))}}catch(c){console.error("Ошибка ответа на приглашение:",c)}finally{o(null)}};return u.useEffect(()=>{const x=setInterval(()=>{const f=Date.now();n(c=>c.filter(v=>v.expiresAt>f))},3e4);return()=>clearInterval(x)},[]),l.length===0?null:e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(m.div,{className:"bg-gradient-to-br from-gray-900 to-black rounded-2xl p-6 max-w-md w-full border border-orange-400/30",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-4xl mb-2",children:"⚔️"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Приглашение на дуэль!"}),e.jsxs("div",{className:"text-orange-400 text-sm",children:[l.length," активных приглашений"]})]}),l.map(x=>{const f=Math.max(0,x.expiresAt-Date.now()),c=Math.floor(f/6e4),v=Math.floor(f%6e4/1e3);return e.jsxs(m.div,{className:"bg-black/40 rounded-xl p-4 mb-4 border border-white/10",initial:{x:-20,opacity:0},animate:{x:0,opacity:1},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold text-lg",children:x.fromUserName}),e.jsxs("div",{className:"text-gray-400 text-sm",children:["Уровень ",x.fromUserLevel]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-orange-400 text-sm font-medium",children:["⏰ ",c,":",v.toString().padStart(2,"0")]}),e.jsx("div",{className:"text-gray-500 text-xs",children:"до истечения"})]})]}),e.jsxs("div",{className:"text-gray-300 text-sm mb-4 bg-black/20 rounded-lg p-3",children:["🎮 Дуэль на 60 секунд",e.jsx("br",{}),"🏆 Побеждает тот, кто наберет больше очков",e.jsx("br",{}),"⚡ Удачи и осторожности!"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(m.button,{onClick:()=>p(x,!1),disabled:d===x.id,className:"flex-1 bg-gray-600 hover:bg-gray-500 text-white py-3 px-4 rounded-xl font-medium transition-colors disabled:opacity-50",whileHover:{scale:1.02},whileTap:{scale:.98},children:d===x.id?"...":"❌ Отклонить"}),e.jsx(m.button,{onClick:()=>p(x,!0),disabled:d===x.id,className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-400 hover:to-emerald-400 text-white py-3 px-4 rounded-xl font-medium transition-all disabled:opacity-50",whileHover:{scale:1.02},whileTap:{scale:.98},children:d===x.id?"⏳ Принимаем...":"✅ Принять"})]})]},x.id)}),e.jsx("div",{className:"text-center text-gray-400 text-xs mt-4",children:"💡 Приглашения автоматически истекают через 5 минут"})]})})},wt=({isVisible:r,newLevel:a,voltsReward:s,onClose:t})=>{if(u.useEffect(()=>{r&&w.levelUp()},[r]),!a||!a.level)return r&&console.warn("LevelUpNotification: newLevel is invalid",a),null;const i=V(a.level),l=V(a.level-1),n=i!==l;return e.jsx(U,{children:r&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",onClick:t,children:e.jsxs(m.div,{initial:{scale:.5,opacity:0,rotateY:-90},animate:{scale:1,opacity:1,rotateY:0},exit:{scale:.5,opacity:0,rotateY:90},transition:{type:"spring",stiffness:300,damping:20,duration:.6},className:"glass-effect p-8 max-w-md mx-4 text-center relative overflow-hidden",onClick:d=>d.stopPropagation(),children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(20)].map((d,o)=>e.jsx(m.div,{className:"absolute w-1 h-1 bg-yellow-300 rounded-full",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`},animate:{opacity:[0,1,0],scale:[0,1,0]},transition:{duration:2,repeat:1/0,delay:Math.random()*2}},o))}),e.jsxs(m.div,{animate:{scale:[1,1.1,1]},transition:{duration:.6,delay:.3},children:[e.jsx("div",{className:"text-6xl mb-4",children:"🎉"}),e.jsx(m.h2,{className:"text-3xl font-bold text-primary-orange mb-2",animate:{textShadow:["0 0 10px rgba(255, 107, 53, 0.5)","0 0 20px rgba(255, 107, 53, 0.8)","0 0 10px rgba(255, 107, 53, 0.5)"]},transition:{duration:1.5,repeat:1/0},children:"НОВЫЙ УРОВЕНЬ!"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-5xl font-bold text-accent-blue mb-2",children:a.level}),e.jsx("div",{className:"text-xl text-yellow-300 font-semibold mb-1",children:a.title}),e.jsx("div",{className:"text-sm text-gray-300 italic",children:a.description})]}),e.jsxs(m.div,{className:"glass-effect p-4 rounded-lg bg-gradient-to-r from-yellow-500/20 to-orange-500/20",animate:{boxShadow:["0 0 20px rgba(255, 193, 7, 0.3)","0 0 30px rgba(255, 193, 7, 0.6)","0 0 20px rgba(255, 193, 7, 0.3)"]},transition:{duration:2,repeat:1/0},children:[e.jsx("div",{className:"text-lg font-bold text-yellow-300 mb-1",children:"Награда за уровень:"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:["+",s,"⚡ Вольт"]}),n&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-yellow-400/30",children:[e.jsx("div",{className:"text-sm font-bold text-blue-300 mb-2",children:"🎨 Новое изображение розетки!"}),e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Было:"}),e.jsx("img",{src:l,alt:"Предыдущая розетка",className:"w-8 h-8 rounded border border-gray-600"})]}),e.jsx("div",{className:"text-yellow-400",children:"→"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Стало:"}),e.jsx("img",{src:i,alt:"Новая розетка",className:"w-8 h-8 rounded border border-blue-400"})]})]})]})]})]}),e.jsx(m.button,{onClick:t,className:"mt-6 px-6 py-3 bg-primary-orange hover:bg-primary-orange/80 text-white font-bold rounded-lg transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Продолжить"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[...Array(15)].map((d,o)=>e.jsx(m.div,{className:"absolute w-2 h-2 rounded-full",style:{backgroundColor:["#FFD700","#FF6B35","#00D4FF","#E8FF00","#8A2BE2"][o%5],left:`${50+(Math.random()-.5)*60}%`,top:"20%"},animate:{y:["0vh","80vh"],x:[(Math.random()-.5)*200,(Math.random()-.5)*400],rotate:[0,360],opacity:[1,0]},transition:{duration:3,delay:Math.random()*.5,ease:"easeOut"}},`confetti-${o}`))})]})})})};function Nt(){const{gameState:r,levelUpNotification:a,hideLevelUpNotification:s}=I();return u.useEffect(()=>{var t,i;if(typeof window<"u"&&((t=window.Telegram)!=null&&t.WebApp)){const l=window.Telegram.WebApp;l.ready(),l.expand(),l.setHeaderColor("#FF6B35"),l.setBackgroundColor("#1A1A1A"),l.enableClosingConfirmation(),l.MainButton&&(l.MainButton.setText("🎮 Играть"),l.MainButton.color="#FF6B35",l.MainButton.textColor="#FFFFFF"),console.log("Telegram WebApp initialized:",{platform:l.platform,version:l.version,colorScheme:l.colorScheme,user:(i=l.initDataUnsafe)==null?void 0:i.user})}else console.log("Running outside Telegram environment")},[]),console.log("App rendering, mode:",r.mode),e.jsx(st,{children:e.jsxs("div",{className:"App",children:[r.mode==="menu"&&e.jsx(it,{}),r.mode==="single"&&e.jsx(ft,{}),r.mode==="multiplayer"&&e.jsx(pt,{}),r.mode==="duel-invite"&&e.jsx(bt,{}),r.mode==="duel"&&e.jsx(yt,{}),e.jsx(jt,{}),a.level&&e.jsx(wt,{isVisible:a.isVisible,newLevel:a.level,voltsReward:a.voltsReward||0,onClose:s})]})})}var ie,le;if(typeof window<"u"&&((ie=window.Telegram)!=null&&ie.WebApp)){const r=window.Telegram.WebApp;r.ready(),r.expand(),r.setHeaderColor("#000000"),r.setBackgroundColor("#000000"),r.BackButton.hide(),r.HapticFeedback&&r.HapticFeedback.selectionChanged(),console.log("Telegram WebApp initialized:",{version:r.version,platform:r.platform,colorScheme:r.colorScheme,user:(le=r.initDataUnsafe)==null?void 0:le.user})}Y.createRoot(document.getElementById("root")).render(e.jsx(ne.StrictMode,{children:e.jsx(Nt,{})}));
//# sourceMappingURL=index-CSf46zwG.js.map
