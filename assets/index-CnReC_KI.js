var ge=Object.defineProperty;var fe=(i,a,s)=>a in i?ge(i,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[a]=s;var _=(i,a,s)=>fe(i,typeof a!="symbol"?a+"":a,s);import{j as e,m as d,A as $}from"./motion-3WHHzQTP.js";import{a as pe,r as u,g as ve,R as z}from"./vendor-CIP6LD3P.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function t(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}})();var J={},Z=pe;J.createRoot=Z.createRoot,J.hydrateRoot=Z.hydrateRoot;const ye={},ee=i=>{let a;const s=new Set,t=(f,b)=>{const m=typeof f=="function"?f(a):f;if(!Object.is(m,a)){const v=a;a=b??(typeof m!="object"||m===null)?m:Object.assign({},a,m),s.forEach(x=>x(a,v))}},r=()=>a,c={setState:t,getState:r,getInitialState:()=>g,subscribe:f=>(s.add(f),()=>s.delete(f)),destroy:()=>{(ye?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},g=a=i(t,r,c);return c},be=i=>i?ee(i):ee;var oe={exports:{}},ce={},de={exports:{}},me={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O=u;function je(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var we=typeof Object.is=="function"?Object.is:je,Ne=O.useState,ke=O.useEffect,Se=O.useLayoutEffect,Ee=O.useDebugValue;function Me(i,a){var s=a(),t=Ne({inst:{value:s,getSnapshot:a}}),r=t[0].inst,l=t[1];return Se(function(){r.value=s,r.getSnapshot=a,Y(r)&&l({inst:r})},[i,s,a]),ke(function(){return Y(r)&&l({inst:r}),i(function(){Y(r)&&l({inst:r})})},[i]),Ee(s),s}function Y(i){var a=i.getSnapshot;i=i.value;try{var s=a();return!we(i,s)}catch{return!0}}function Ce(i,a){return a()}var Ie=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Ce:Me;me.useSyncExternalStore=O.useSyncExternalStore!==void 0?O.useSyncExternalStore:Ie;de.exports=me;var Te=de.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K=u,Ae=Te;function De(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var Pe=typeof Object.is=="function"?Object.is:De,Le=Ae.useSyncExternalStore,Re=K.useRef,$e=K.useEffect,Fe=K.useMemo,_e=K.useDebugValue;ce.useSyncExternalStoreWithSelector=function(i,a,s,t,r){var l=Re(null);if(l.current===null){var n={hasValue:!1,value:null};l.current=n}else n=l.current;l=Fe(function(){function c(v){if(!g){if(g=!0,f=v,v=t(v),r!==void 0&&n.hasValue){var x=n.value;if(r(x,v))return b=x}return b=v}if(x=b,Pe(f,v))return x;var y=t(v);return r!==void 0&&r(x,y)?(f=v,x):(f=v,b=y)}var g=!1,f,b,m=s===void 0?null:s;return[function(){return c(a())},m===null?void 0:function(){return c(m())}]},[a,s,t,r]);var o=Le(i,l[0],l[1]);return $e(function(){n.hasValue=!0,n.value=o},[o]),_e(o),o};oe.exports=ce;var Ve=oe.exports;const Ue=ve(Ve),xe={},{useDebugValue:qe}=z,{useSyncExternalStoreWithSelector:He}=Ue;let te=!1;const Be=i=>i;function Oe(i,a=Be,s){(xe?"production":void 0)!=="production"&&s&&!te&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),te=!0);const t=He(i.subscribe,i.getState,i.getServerState||i.getInitialState,a,s);return qe(t),t}const se=i=>{(xe?"production":void 0)!=="production"&&typeof i!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const a=typeof i=="function"?be(i):i,s=(t,r)=>Oe(a,t,r);return Object.assign(s,a),s},We=i=>i?se(i):se,q=[{level:1,requiredExperience:0,voltsReward:0,title:"–ù–æ–≤–∏—á–æ–∫",description:"–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏ —Å —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ–º"},{level:2,requiredExperience:5e3,voltsReward:50,title:"–£—á–µ–Ω–∏–∫",description:"–û—Å–≤–∞–∏–≤–∞–µ—Ç–µ –æ—Å–Ω–æ–≤—ã"},{level:3,requiredExperience:15e3,voltsReward:75,title:"–ü—Ä–∞–∫—Ç–∏–∫–∞–Ω—Ç",description:"‚ö†Ô∏è –û–ø–∞—Å–Ω–æ! –¢–µ–ø–µ—Ä—å —É–¥–∞—Ä —Ç–æ–∫–æ–º –æ—Ç–Ω–∏–º–∞–µ—Ç –æ—á–∫–∏"},{level:4,requiredExperience:35e3,voltsReward:100,title:"–õ—é–±–∏—Ç–µ–ª—å",description:"üî• –ö—Ä–∏—Ç–∏—á–Ω–æ! –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –æ—Ç–Ω–∏–º–∞–µ—Ç—Å—è –æ—Ç –æ—á–∫–æ–≤"},{level:5,requiredExperience:7e4,voltsReward:150,title:"–≠–Ω—Ç—É–∑–∏–∞—Å—Ç",description:"–ü—Ä–æ—è–≤–ª—è–µ—Ç–µ —Å–º–µ–ª–æ—Å—Ç—å –≤ –æ–ø–∞—Å–Ω–æ–π –∏–≥—Ä–µ"},{level:6,requiredExperience:125e3,voltsReward:200,title:"–°–º–µ–ª—å—á–∞–∫",description:"–ù–µ –±–æ–∏—Ç–µ—Å—å —Ä–∏—Å–∫–æ–≤–∞—Ç—å"},{level:7,requiredExperience:2e5,voltsReward:250,title:"–•—Ä–∞–±—Ä–µ—Ü",description:"–ò–¥–µ—Ç–µ –Ω–∞ –æ–ø—Ä–∞–≤–¥–∞–Ω–Ω—ã–π —Ä–∏—Å–∫"},{level:8,requiredExperience:3e5,voltsReward:300,title:"–û—Ç–≤–∞–∂–Ω—ã–π",description:"–ü–æ–∫–æ—Ä—è–µ—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏"},{level:9,requiredExperience:45e4,voltsReward:400,title:"–ë–µ–∑—Ä–∞—Å—Å—É–¥–Ω—ã–π",description:"–ò–≥—Ä–∞–µ—Ç–µ —Å –æ–ø–∞—Å–Ω–æ—Å—Ç—å—é"},{level:10,requiredExperience:65e4,voltsReward:500,title:"–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª",description:"–ú–∞—Å—Ç–µ—Ä—Å–∫–∏ –≤–ª–∞–¥–µ–µ—Ç–µ —Ä–∏—Å–∫–æ–º"},{level:11,requiredExperience:9e5,voltsReward:600,title:"–≠–∫—Å–ø–µ—Ä—Ç",description:"–ó–Ω–∞–µ—Ç–µ –≤—Å–µ —Ç–æ–Ω–∫–æ—Å—Ç–∏"},{level:12,requiredExperience:12e5,voltsReward:750,title:"–ú–∞—Å—Ç–µ—Ä",description:"–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç–µ –æ–∂–∏–¥–∞–Ω–∏—è"},{level:13,requiredExperience:16e5,voltsReward:900,title:"–í–∏—Ä—Ç—É–æ–∑",description:"–ò–≥—Ä–∞–µ—Ç–µ –∫–∞–∫ —Ö—É–¥–æ–∂–Ω–∏–∫"},{level:14,requiredExperience:21e5,voltsReward:1100,title:"–ì—É—Ä—É",description:"–î–æ—Å—Ç–∏–≥–ª–∏ –ø—Ä–æ—Å–≤–µ—Ç–ª–µ–Ω–∏—è"},{level:15,requiredExperience:27e5,voltsReward:1300,title:"–°–µ–Ω—Å–µ–π",description:"–£—á–∏—Ç–µ –¥—Ä—É–≥–∏—Ö"},{level:16,requiredExperience:35e5,voltsReward:1500,title:"–õ–µ–≥–µ–Ω–¥–∞",description:"–û –≤–∞—Å —Å–ª–∞–≥–∞—é—Ç –ª–µ–≥–µ–Ω–¥—ã"},{level:17,requiredExperience:45e5,voltsReward:1750,title:"–ú–∏—Ñ",description:"–ù–µ–¥–æ—Å—Ç–∏–∂–∏–º—ã–π –∏–¥–µ–∞–ª"},{level:18,requiredExperience:58e5,voltsReward:2e3,title:"–¢–∏—Ç–∞–Ω",description:"–°–≤–µ—Ä—Ö—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏"},{level:19,requiredExperience:75e5,voltsReward:2300,title:"–ë–æ–≥ –≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–∞",description:"–ü–æ–≤–µ–ª–µ–≤–∞–µ—Ç–µ –º–æ–ª–Ω–∏—è–º–∏"},{level:20,requiredExperience:1e7,voltsReward:2500,title:"–ó–µ–≤—Å",description:"–ê–±—Å–æ–ª—é—Ç–Ω–∞—è –≤–ª–∞—Å—Ç—å –Ω–∞–¥ —Ç–æ–∫–æ–º"}];function B(i){let a=q[0];for(let s=q.length-1;s>=0;s--)if(i>=q[s].requiredExperience){a=q[s];break}return a}function ue(i){const a=B(i),s=q.findIndex(r=>r.level===a.level)+1;if(s>=q.length)return{current:i,required:i,remaining:0,nextLevel:null};const t=q[s];return{current:i-a.requiredExperience,required:t.requiredExperience-a.requiredExperience,remaining:t.requiredExperience-i,nextLevel:t}}function ze(i){const{current:a,required:s}=ue(i);return s===0?100:Math.min(100,a/s*100)}const V={SAFE_CLICK:3,RISKY_CLICK:8,EXTREME_CLICK:15,STREAK_5:25,STREAK_10:60,STREAK_25:150,STREAK_50:300,SHOCK_SURVIVAL:5};function H(i){const a="/tigerrosette/";return i<=3?`${a}Media/Pictures/tigrrozetka_1.png`:i<=7?`${a}Media/Pictures/tigrrozetka_2.png`:i<=12?`${a}Media/Pictures/tigrrozetka_3.png`:`${a}Media/Pictures/tigrrozetka_4.png`}const ae="http://localhost:3001/api";class Ge{constructor(){_(this,"token",null);this.token=localStorage.getItem("auth_token"),this.initializeTelegramAuth()}initializeTelegramAuth(){var a,s;if(typeof window<"u"&&((a=window.Telegram)!=null&&a.WebApp)){const t=window.Telegram.WebApp;(s=t.initDataUnsafe)!=null&&s.user&&this.authenticateWithTelegram(t.initData)}}async authenticateWithTelegram(a){try{const t=await(await fetch(`${ae}/auth/telegram`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initData:a})})).json();t.token&&(this.token=t.token,localStorage.setItem("auth_token",t.token))}catch(s){console.error("Telegram authentication failed:",s)}}async makeRequest(a,s={}){try{const t={"Content-Type":"application/json",...s.headers};this.token&&(t.Authorization=`Bearer ${this.token}`);const r=await fetch(`${ae}${a}`,{...s,headers:t}),l=await r.json();return r.ok?{success:!0,data:l}:{error:l.error||`HTTP ${r.status}`}}catch(t){return console.error("API request failed:",t),{error:t instanceof Error?t.message:"Network error"}}}async submitScore(a){return this.makeRequest("/game/score",{method:"POST",body:JSON.stringify(a)})}async getUserStats(){return this.makeRequest("/game/stats")}async getLeaderboard(a="level",s=10){return this.makeRequest(`/game/leaderboard?type=${a}&limit=${s}`)}async refillEnergy(){return this.makeRequest("/game/refill-energy",{method:"POST"})}isAuthenticated(){return!!this.token}setToken(a){this.token=a,localStorage.setItem("auth_token",a)}clearToken(){this.token=null,localStorage.removeItem("auth_token")}}const R=new Ge,ie={mode:"menu",isPlaying:!1,isPaused:!1,gameTime:0,score:0},Ke={id:"player1",name:"–°–º–µ–ª—å—á–∞–∫",volts:0,level:1,experience:0,streak:0,totalClicks:0,successfulClicks:0,shockedClicks:0,luckCoefficient:50,luckIndicatorHidden:!1,luckHiddenUntil:0,survivalTime:0,protection:{gloves:{level:0,protection:0,durability:0,maxDurability:0},boots:{level:0,protection:0,durability:0,maxDurability:0},suit:{level:0,protection:0,durability:0,maxDurability:0},helmet:{level:0,protection:0,durability:0,maxDurability:0}}},re={difficulty:"easy",aiPattern:"regular",currentRisk:"low",streakCount:0,timeInSafeZone:0,lastClickTime:0,dangerLevel:0,warningSignsActive:!1,stage:1,aiElectricianActive:!1,nextDischargeTime:0,dischargeWarningTime:0,isDischarging:!1,dischargeDuration:5e3},Ye={volume:.7,enabled:!0,backgroundMusicEnabled:!0},Je=[{id:"first_click",title:"–ü–µ—Ä–≤–æ–µ –ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏–µ",description:"–ù–∞–∂–º–∏ –Ω–∞ —Ä–æ–∑–µ—Ç–∫—É –≤–ø–µ—Ä–≤—ã–µ",icon:"‚ö°",requirement:1,progress:0,completed:!1,reward:50,category:"special"},{id:"survivor_5",title:"–ñ–∏–≤—á–∏–∫",description:"–°–µ—Ä–∏—è –∏–∑ 5 —É—Å–ø–µ—à–Ω—ã—Ö –Ω–∞–∂–∞—Ç–∏–π",icon:"üèÉ",requirement:5,progress:0,completed:!1,reward:100,category:"streak"},{id:"survivor_25",title:"–ù–µ—É–±–∏–≤–∞–µ–º—ã–π",description:"–°–µ—Ä–∏—è –∏–∑ 25 —É—Å–ø–µ—à–Ω—ã—Ö –Ω–∞–∂–∞—Ç–∏–π",icon:"üõ°Ô∏è",requirement:25,progress:0,completed:!1,reward:500,category:"streak"},{id:"risk_taker",title:"–ë–µ–∑—Ä–∞—Å—Å—É–¥–Ω—ã–π",description:"50 –Ω–∞–∂–∞—Ç–∏–π –≤ —Ä–µ–∂–∏–º–µ High Risk",icon:"üî•",requirement:50,progress:0,completed:!1,reward:500,category:"risk"},{id:"time_survivor",title:"–í—ã–∂–∏–≤–∞–ª—å—â–∏–∫",description:"–í—ã–∂–∏–≤–∏ 5 –º–∏–Ω—É—Ç –±–µ–∑ –ø–æ—Ä–∞–∂–µ–Ω–∏—è",icon:"‚è∞",requirement:300,progress:0,completed:!1,reward:1e3,category:"survival"}],D=We((i,a)=>({gameState:ie,player:Ke,singleMode:re,achievements:Je,sounds:Ye,showElectricSparks:!1,sparksIntensity:"medium",showScreenShake:!1,aiElectrician:{name:"–ò–≤–∞–Ω –≠–ª–µ–∫—Ç—Ä–∏–∫",energy:100,maxEnergy:100,voltage:0,maxVoltage:500,voltageChargeRate:2,lastAttackTime:0,equipment:{battery:100,capacitor:100,wires:100,generator:100},mood:"confident",experience:50,isActive:!1,lastMessage:"–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!",messageTime:0,failuresCount:0,successfulDischarges:0,playerAttacksReceived:0,workingEfficiency:100,canWork:!0,fatigueLevel:0,points:0,maxPoints:0},levelUpNotification:{isVisible:!1,level:null,voltsReward:0},startSingleMode:s=>{console.log("startSingleMode: Starting with difficulty:",s),a().fixPlayerLevel();const t=a().compensateExperience();t>0&&console.log(`Compensated ${t} experience points based on current score`),i({gameState:{...a().gameState,mode:"single",isPlaying:!0,gameTime:0,score:0},singleMode:{...re,difficulty:s}}),i(r=>({aiElectrician:{...r.aiElectrician,points:a().getAIMaxPointsForStage(a().singleMode.stage||1),maxPoints:a().getAIMaxPointsForStage(a().singleMode.stage||1)}})),setTimeout(()=>{console.log("startSingleMode: Starting AI Electrician after 3s delay"),a().startAIElectrician()},3e3)},startMultiplayerMode:s=>{let t="multiplayer";s==="duel"&&(t="duel-invite"),i({gameState:{...a().gameState,mode:t,isPlaying:!1,gameTime:0,score:0}}),console.log(`Starting multiplayer mode: ${s}`)},startRealDuel:()=>{i({gameState:{...a().gameState,mode:"duel",isPlaying:!0,gameTime:0,score:0}}),console.log("Starting real duel with another player")},goToMenu:()=>{i({gameState:{...ie,mode:"menu"}})},clickOutlet:()=>{const s=a(),t=Date.now(),r=t-s.singleMode.lastClickTime;let l="low";r<1e3?l="extreme":r<2e3?l="high":r<3e3&&(l="medium");const n=Math.min(100,s.singleMode.streakCount*2+(l==="extreme"?40:l==="high"?25:l==="medium"?15:5)+(s.player.luckCoefficient<30?20:0)),o=n>60;i({player:{...s.player,totalClicks:s.player.totalClicks+1},singleMode:{...s.singleMode,lastClickTime:t,currentRisk:l,dangerLevel:n,warningSignsActive:o}}),a().updateLuckCoefficient()},updateScore:s=>{const t=a(),r=t.gameState.score+s.totalPoints,l=t.player.volts+s.totalPoints,n=s.reason!=="–ü–æ—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–∫–æ–º"&&s.reason!=="–ö–ª–∏–∫ –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä—è–¥–∞!"&&s.totalPoints>0,o=n?t.player.streak+1:0,c=n?t.singleMode.streakCount+1:0;let g=0;if(n){g=V.SAFE_CLICK,s.riskMultiplier>=2&&(g=V.RISKY_CLICK),s.riskMultiplier>=3&&(g=V.EXTREME_CLICK),o===5&&(g+=V.STREAK_5),o===10&&(g+=V.STREAK_10),o===25&&(g+=V.STREAK_25),o===50&&(g+=V.STREAK_50);const h=Math.floor(Math.max(0,s.totalPoints)/10);g+=h}else g=V.SHOCK_SURVIVAL;const f=n?t.player.successfulClicks+1:t.player.successfulClicks,b=n?t.player.shockedClicks:t.player.shockedClicks+1,m=f+b,v=m>0?Math.round(f/m*100):50;if(i({gameState:{...t.gameState,score:r},player:{...t.player,volts:l,streak:o,successfulClicks:f,shockedClicks:b,luckCoefficient:v},singleMode:{...t.singleMode,streakCount:c}}),n&&s.totalPoints>0){const h=a().aiElectrician,j=Math.max(1,Math.floor(s.totalPoints/2));i({aiElectrician:{...h,points:Math.max(0,h.points-j)}}),a().onAIPointsChanged()}const{addExperience:x}=a();x(g);const{unlockAchievement:y}=a();t.player.totalClicks===0&&y("first_click"),o===5&&y("survivor_5"),o===10&&y("survivor_10"),o===25&&y("survivor_25")},calculateShockImpact:s=>{let t,r,l,n;s<50?(t=Math.floor(s*.1)+1,r="mild",l=1e3,n=2e3):s<150?(t=Math.floor(s*.15)+5,r="moderate",l=1500,n=3e3):s<300?(t=Math.floor(s*.2)+10,r="severe",l=2e3,n=5e3):(t=Math.floor(s*.25)+20,r="critical",l=3e3,n=8e3);const o=Math.floor(s*.7);return{damage:t,voltsDrained:o,duration:l,severity:r,luckHideDuration:n}},triggerShock:()=>{const s=a();if(!s.gameState.isPlaying)return;const t=s.calculateShockImpact(s.player.volts),l=(100-s.getTotalProtection())/100,n=Math.floor(t.damage*l);s.damageProtection(t.damage),i({player:{...s.player,volts:Math.max(0,s.player.volts-t.voltsDrained),shockedClicks:s.player.shockedClicks+1,totalClicks:s.player.totalClicks+1,streak:0,luckIndicatorHidden:!0,luckHiddenUntil:Date.now()+t.luckHideDuration},showElectricSparks:!0,sparksIntensity:t.severity==="critical"?"extreme":t.severity==="severe"?"high":t.severity==="moderate"?"medium":"low",showScreenShake:!0,gameState:{...s.gameState,score:Math.max(0,s.gameState.score-n)},singleMode:{...s.singleMode,streakCount:0}}),i(o=>({aiElectrician:{...o.aiElectrician,points:Math.min(o.aiElectrician.maxPoints,o.aiElectrician.points+Math.max(1,Math.floor(n/2)))}})),a().onAIPointsChanged(),setTimeout(()=>{i({showElectricSparks:!1,showScreenShake:!1})},t.duration),a().updateLuckCoefficient()},endGame:()=>{a().stopAIElectrician(),i({gameState:{...a().gameState,mode:"menu",isPlaying:!1}})},unlockAchievement:s=>{const t=a(),r=t.achievements.find(l=>l.id===s);r&&!r.completed&&i({achievements:t.achievements.map(l=>l.id===s?{...l,completed:!0,progress:l.requirement}:l),player:{...t.player,volts:t.player.volts+r.reward}})},updatePlayerStats:s=>{const t=a();i({player:{...t.player,...s}})},addExperience:s=>{const t=a(),r=t.player.experience+s,l=B(t.player.experience),n=B(r);if(console.log("addExperience:",{amount:s,oldExperience:t.player.experience,newExperience:r,oldLevel:l.level,newLevel:n.level,playerLevel:t.player.level}),n.level>l.level){console.log("LEVEL UP!",{from:l.level,to:n.level,voltsReward:n.voltsReward});const o=t.player.volts+n.voltsReward;i({player:{...t.player,experience:r,level:n.level,volts:o}});const{showLevelUpNotification:c}=a();c(n,n.voltsReward)}else i({player:{...t.player,experience:r,level:n.level}})},getCurrentLevelInfo:()=>{const s=a();return{currentLevel:B(s.player.experience),progressInfo:ue(s.player.experience)}},fixPlayerLevel:()=>{const s=a(),t=B(s.player.experience);console.log("fixPlayerLevel:",{currentStoredLevel:s.player.level,correctLevel:t.level,experience:s.player.experience}),s.player.level!==t.level&&(console.log("Fixing player level from",s.player.level,"to",t.level),i({player:{...s.player,level:t.level}}))},compensateExperience:()=>{const s=a(),t=s.gameState.score,r=s.player.experience,l=Math.floor(t/5),n=Math.max(0,l-r);return console.log("compensateExperience:",{currentScore:t,currentExperience:r,expectedExperience:l,missingExperience:n}),n>0?(console.log(`Compensating ${n} experience points`),a().addExperience(n),n):0},showLevelUpNotification:(s,t)=>{i({levelUpNotification:{isVisible:!0,level:s,voltsReward:t}})},getAIMaxPointsForStage(s){const t=a().singleMode.difficulty,r=t==="extreme"?250:t==="hard"?200:t==="medium"?150:120;return r+Math.floor((s-1)*r*.25)},hideLevelUpNotification:()=>{i({levelUpNotification:{isVisible:!1,level:null,voltsReward:0}})},updateLuckCoefficient:()=>{const s=a(),t=s.player.totalClicks,r=s.player.successfulClicks,l=t>0?Math.round(r/t*100):50,n=s.player.luckIndicatorHidden&&Date.now()>=s.player.luckHiddenUntil;i({player:{...s.player,luckCoefficient:l,luckIndicatorHidden:n?!1:s.player.luckIndicatorHidden}})},startAIElectrician:()=>{const s=a();if(!s.gameState.isPlaying){console.log("startAIElectrician: Game not playing, aborting");return}console.log("startAIElectrician: Starting AI Electrician"),i({singleMode:{...s.singleMode,aiElectricianActive:!0},aiElectrician:{...s.aiElectrician,isActive:!0,lastMessage:a().getAIElectricianMessage(),messageTime:Date.now()}});const t=setInterval(()=>{const r=a();if(!r.singleMode.aiElectricianActive||!r.gameState.isPlaying){console.log("startAIElectrician: Clearing AI update interval"),clearInterval(t);return}a().updateAIElectrician(),Math.random()<.3&&i({aiElectrician:{...a().aiElectrician,lastMessage:a().getAIElectricianMessage(),messageTime:Date.now()}})},2e3);console.log("startAIElectrician: Scheduling first discharge"),a().scheduleNextDischarge()},onAIPointsChanged:()=>{const s=a(),t=s.aiElectrician;if(s.gameState.isPlaying){if(t.points<=0){const r=s.singleMode.stage+1,l=a().getAIMaxPointsForStage(r),n=50+r*10;i({player:{...s.player,volts:s.player.volts+n},singleMode:{...s.singleMode,stage:r},aiElectrician:{...t,points:l,maxPoints:l,lastMessage:"–≠—Ç–∞–ø –ø—Ä–æ–π–¥–µ–Ω! –Ø –≤—ã–¥–æ—Ö—Å—è...",messageTime:Date.now()}}),Math.random()<.5&&setTimeout(()=>a().dropElectricianItem(),400);return}if(t.points>=t.maxPoints){a().aiElectricianAttackPlayer();const r=Math.floor(t.maxPoints*.6);i({aiElectrician:{...t,points:r}})}}},advanceStage:()=>{const s=a(),t=s.singleMode.stage+1,r=a().getAIMaxPointsForStage(t);i({singleMode:{...s.singleMode,stage:t},aiElectrician:{...s.aiElectrician,points:r,maxPoints:r}})},dropElectricianItem:()=>{const s=a(),t=Math.floor(s.aiElectrician.fatigueLevel),l=(j=>j>=8?[{type:"suit",level:3,chance:.2,message:"ü•Ω –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ –æ—Ç —É—Å—Ç–∞–ª–æ—Å—Ç–∏ —Å–Ω—è–ª –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ—Å—Ç—é–º!"},{type:"gloves",level:3,chance:.3,message:"üß§ –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ —É—Ä–æ–Ω–∏–ª –¥–∏—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä—á–∞—Ç–∫–∏!"},{type:"boots",level:2,chance:.3,message:"üë¢ –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ –æ—Å—Ç–∞–≤–∏–ª –¥–∏—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–∞–ø–æ–≥–∏!"},{type:"helmet",level:2,chance:.2,message:"‚õëÔ∏è –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ –∑–∞–±—ã–ª –¥–∏—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫—É—é –∫–∞—Å–∫—É!"}]:j>=5?[{type:"gloves",level:2,chance:.4,message:"üß§ –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ –ø–æ—Ç–µ—Ä—è–ª —É—Å–∏–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä—á–∞—Ç–∫–∏!"},{type:"boots",level:2,chance:.3,message:"üë¢ –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ –æ—Å—Ç–∞–≤–∏–ª –¥–∏—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–∞–ø–æ–≥–∏!"},{type:"suit",level:1,chance:.2,message:"ü•Ω –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ —Å–Ω—è–ª –∏–∑–æ–ª–∏—Ä—É—é—â–∏–π –∫–æ—Å—Ç—é–º!"},{type:"helmet",level:1,chance:.1,message:"‚õëÔ∏è –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ –∑–∞–±—ã–ª –∫–∞—Å–∫—É!"}]:j>=2?[{type:"gloves",level:1,chance:.5,message:"üß§ –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ —É—Ä–æ–Ω–∏–ª —Ä–µ–∑–∏–Ω–æ–≤—ã–µ –ø–µ—Ä—á–∞—Ç–∫–∏!"},{type:"boots",level:1,chance:.3,message:"üë¢ –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ –æ—Å—Ç–∞–≤–∏–ª —Ä–µ–∑–∏–Ω–æ–≤—ã–µ —Å–∞–ø–æ–≥–∏!"},{type:"helmet",level:1,chance:.2,message:"‚õëÔ∏è –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ –∑–∞–±—ã–ª –∑–∞—â–∏—Ç–Ω—É—é –∫–∞—Å–∫—É!"}]:[{type:"gloves",level:1,chance:.7,message:"ÔøΩ –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ —É—Ä–æ–Ω–∏–ª —Ä–∞–±–æ—á–∏–µ –ø–µ—Ä—á–∞—Ç–∫–∏!"},{type:"boots",level:1,chance:.3,message:"üë¢ –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ –ø–æ—Ç–µ—Ä—è–ª —Å–∞–ø–æ–≥!"}])(t),n=Math.random();let o=0,c=null;for(const j of l)if(o+=j.chance,n<=o){c=j;break}if(!c)return;const{type:g,level:f,message:b}=c,m=g;if(s.player.protection[m].level>=f){console.log("Player already has better protection item:",g,f);const j=f*25;i({player:{...s.player,volts:s.player.volts+j},aiElectrician:{...s.aiElectrician,lastMessage:`üí∞ –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ –¥–∞–ª ${j} –≤–æ–ª—å—Ç –≤–º–µ—Å—Ç–æ –Ω–µ–Ω—É–∂–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞!`,messageTime:Date.now()}});return}const y=s.getShopItems().find(j=>j.type===m&&j.level===f);if(!y){console.error("Item stats not found for:",g,f);return}i({player:{...s.player,protection:{...s.player.protection,[m]:{level:y.level,protection:y.protection,durability:y.durability,maxDurability:y.durability}}},aiElectrician:{...s.aiElectrician,lastMessage:b,messageTime:Date.now()}}),console.log(`Dropped item: ${y.name} (${y.protection}% protection) at fatigue level ${t}`);const h=25*f;a().addExperience(h)},restartAIElectrician:()=>{const s=a();if(!s.gameState.isPlaying){console.log("restartAIElectrician: Game not playing");return}if(s.aiElectrician.isActive){console.log("restartAIElectrician: AI already active");return}console.log("restartAIElectrician: Restarting AI Electrician"),i({aiElectrician:{...s.aiElectrician,energy:Math.max(50,s.aiElectrician.energy),equipment:{battery:Math.max(50,s.aiElectrician.equipment.battery),capacitor:Math.max(50,s.aiElectrician.equipment.capacitor),wires:Math.max(50,s.aiElectrician.equipment.wires),generator:Math.max(50,s.aiElectrician.equipment.generator)},lastMessage:"–û—Ç–¥–æ—Ö–Ω—É–ª, —Å–Ω–æ–≤–∞ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!",messageTime:Date.now()}}),a().startAIElectrician()},stopAIElectrician:()=>{i(s=>({singleMode:{...s.singleMode,aiElectricianActive:!1,nextDischargeTime:0,dischargeWarningTime:0,isDischarging:!1},aiElectrician:{...s.aiElectrician,isActive:!1,lastMessage:"–°–º–µ–Ω–∞ –∑–∞–∫–æ–Ω—á–µ–Ω–∞, –∏–¥—É –¥–æ–º–æ–π!",messageTime:Date.now()}}))},scheduleNextDischarge:()=>{const s=a();if(console.log("scheduleNextDischarge: Starting, AI active:",s.singleMode.aiElectricianActive),!s.singleMode.aiElectricianActive)return;const t=Date.now(),l=(()=>{const c={easy:{min:3e3,max:8e3},medium:{min:2500,max:6e3},hard:{min:2e3,max:4e3},extreme:{min:1500,max:3e3}}[s.singleMode.difficulty];let g=1;if(s.singleMode.aiPattern==="burst")g=.7;else if(s.singleMode.aiPattern==="random")g=Math.random()*.8+.6;else if(s.singleMode.aiPattern==="adaptive"){const m=s.player.luckCoefficient;g=m>70?.8:m<30?1.3:1}const f=c.min*g,b=c.max*g;return Math.random()*(b-f)+f})(),n=t+l,o=n-3e3;console.log("scheduleNextDischarge: Scheduled discharge",{interval:l/1e3+"s",nextDischargeTime:n,dischargeWarningTime:o,timeFromNow:(n-t)/1e3+"s"}),i({singleMode:{...s.singleMode,nextDischargeTime:n,dischargeWarningTime:o}}),setTimeout(()=>{console.log("scheduleNextDischarge: Timer triggered, checking discharge"),a().checkForDischarge()},l)},checkForDischarge:()=>{const s=a();if(!s.singleMode.aiElectricianActive||!s.gameState.isPlaying){console.log("checkForDischarge: AI inactive or game not playing",{aiActive:s.singleMode.aiElectricianActive,isPlaying:s.gameState.isPlaying});return}const t=Date.now();console.log("checkForDischarge: Checking discharge timing",{now:t,nextDischargeTime:s.singleMode.nextDischargeTime,timeUntilDischarge:s.singleMode.nextDischargeTime-t,isDischarging:s.singleMode.isDischarging,warningSignsActive:s.singleMode.warningSignsActive,dischargeWarningTime:s.singleMode.dischargeWarningTime}),!s.singleMode.warningSignsActive&&t>=s.singleMode.dischargeWarningTime&&(console.log("checkForDischarge: Activating warning signs"),i({singleMode:{...s.singleMode,warningSignsActive:!0,dangerLevel:85}})),t>=s.singleMode.nextDischargeTime&&!s.singleMode.isDischarging&&(console.log("checkForDischarge: STARTING DISCHARGE!"),i({singleMode:{...s.singleMode,isDischarging:!0},showElectricSparks:!0,sparksIntensity:"high"}),i({aiElectrician:{...s.aiElectrician,successfulDischarges:s.aiElectrician.successfulDischarges+1,lastMessage:"–û—Ç–ª–∏—á–Ω—ã–π —Ä–∞–∑—Ä—è–¥! –í—Å–µ –ø–æ –ø–ª–∞–Ω—É!",messageTime:t}}),Math.random()<.3&&a().damageAIElectrician("equipment",Math.random()*5+2),setTimeout(()=>{console.log("checkForDischarge: ENDING DISCHARGE after",s.singleMode.dischargeDuration,"ms");const r=a();i({singleMode:{...r.singleMode,isDischarging:!1,warningSignsActive:!1,dangerLevel:0},showElectricSparks:!1}),a().updateAIElectrician(),a().aiElectrician.canWork?(console.log("checkForDischarge: Scheduling next discharge after ending current one"),a().scheduleNextDischarge()):(console.log("checkForDischarge: AI electrician is tired/broken, scheduling with delay"),i({aiElectrician:{...a().aiElectrician,lastMessage:a().getAIElectricianMessage(),messageTime:Date.now()}}),setTimeout(()=>{a().singleMode.aiElectricianActive&&a().gameState.isPlaying&&(console.log("checkForDischarge: Tired AI attempting to work again"),a().scheduleNextDischarge())},3e4))},s.singleMode.dischargeDuration))},updateAIElectrician:()=>{const s=a();if(!s.aiElectrician.isActive){console.log("updateAIElectrician: AI not active, skipping");return}const t=s.aiElectrician,r=Date.now();console.log("updateAIElectrician: Current state",{energy:t.energy.toFixed(1),voltage:t.voltage.toFixed(1),efficiency:t.workingEfficiency.toFixed(1),mood:t.mood,canWork:t.canWork});const l=t.workingEfficiency>80?.1:.2;let n=Math.max(0,t.energy-l),o=t.fatigueLevel;const c=t.energy>10,g=n<=10;g&&c&&(o=Math.min(10,t.fatigueLevel+.1)),g?(n=Math.min(t.maxEnergy,n+.5),console.log("updateAIElectrician: AI resting, energy recovery:",n.toFixed(1)),Math.floor(o)>Math.floor(t.fatigueLevel)&&Math.random()<.5&&(console.log(`AI fatigue level increased to ${Math.floor(o)}, dropping item`),a().dropElectricianItem())):n>50&&(o=Math.max(0,t.fatigueLevel-.05));const f=t.voltageChargeRate*(t.workingEfficiency/100),b=Math.min(t.maxVoltage,t.voltage+f),m=Math.random()*.05,v={battery:Math.max(0,t.equipment.battery-m),capacitor:Math.max(0,t.equipment.capacitor-m*.5),wires:Math.max(0,t.equipment.wires-m*.3),generator:Math.max(0,t.equipment.generator-m*.7)},x=(v.battery+v.capacitor+v.wires+v.generator)/4;x<30&&(v.battery=Math.min(100,v.battery+.1),v.capacitor=Math.min(100,v.capacitor+.1),v.wires=Math.min(100,v.wires+.1),v.generator=Math.min(100,v.generator+.1),console.log("updateAIElectrician: Equipment self-repair activated"));const y=Math.min(100,n*.7+x*.3);let h=t.mood;y<20?h="broken":y<40?h="tired":t.failuresCount>t.successfulDischarges?h="frustrated":t.playerAttacksReceived>3?h="angry":y>80&&(h="confident");const j=n>10&&x>15;b>=100&&(t.playerAttacksReceived>2||h==="angry"||Math.random()<.05)&&r-t.lastAttackTime>3e4&&setTimeout(()=>{a().aiElectricianAttackPlayer()},Math.random()*5e3),i({aiElectrician:{...t,energy:n,voltage:b,equipment:v,workingEfficiency:y,mood:h,canWork:j,fatigueLevel:o}})},damageAIElectrician:(s,t=10,r=!1)=>{const n=a().aiElectrician;if(s==="energy"){const o=Math.max(0,n.energy-t);let c;if(r){const g=["–û–π! –î–∞ —Ç—ã —á—Ç–æ, –æ–±–∞–ª–¥–µ–ª?! üò±","–≠–π, —ç—Ç–æ –±–æ–ª—å–Ω–æ! –ú—ã –∂–µ –∫–æ–º–∞–Ω–¥–∞! üò≠","–ü—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ! –ê —è –¥—É–º–∞–ª –º—ã –¥—Ä—É–∑—å—è... üíî","–ê—É—É—É—É! –ó–∞ —á—Ç–æ –º–µ–Ω—è?! üòµ","–ù—É –∏ –∑–∞—á–µ–º —Ç—ã –º–µ–Ω—è —à–∞—Ä–∞—Ö–Ω—É–ª?! ‚ö°","–ë–æ–ª—å–Ω–æ –∂–µ! –Ø –≤–µ–¥—å —Å—Ç–∞—Ä–∞—é—Å—å –¥–ª—è —Ç–µ–±—è! üò¢","–ú–∞–º–∞ –¥–æ—Ä–æ–≥–∞—è! –ú–µ–Ω—è —É–¥–∞—Ä–∏–ª–æ —Ç–æ–∫–æ–º! ü§ï","–≠—Ç–æ —á—Ç–æ, –º–µ—Å—Ç—å –∑–∞ —Ä–∞–∑—Ä—è–¥—ã?! üò§","–õ–∞–¥–Ω–æ-–ª–∞–¥–Ω–æ, —è –ø–æ–Ω—è–ª –Ω–∞–º–µ–∫... üòÖ","–ê–π-–∞–π-–∞–π! –¢–µ–ø–µ—Ä—å —É –º–µ–Ω—è –≤—Å—ë –±–æ–ª–∏—Ç! ü§í","–û–±–∏–¥–Ω–æ! –Ø –∂–µ —á–µ—Å—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é! üò≠","–¢—ã —Å–µ—Ä—å–µ–∑–Ω–æ?! –Ø –∂–µ —ç–ª–µ–∫—Ç—Ä–∏–∫, –∞ –Ω–µ –º–∏—à–µ–Ω—å! üéØ","–ë–æ–ª—å—à–µ —Ç–∞–∫ –Ω–µ –¥–µ–ª–∞–π, –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å? ü•∫","–ö—Ç–æ –Ω–∞—É—á–∏–ª —Ç–µ–±—è —Ç–∞–∫ –¥—Ä–∞—Ç—å—Å—è?! üò∞","–ù—É –≤–æ—Ç, —Ç–µ–ø–µ—Ä—å —É –º–µ–Ω—è –º–∏–≥—Ä–µ–Ω—å... ü§ï","–¢–∞–∫, —Ç–µ–ø–µ—Ä—å —è —Ä–∞–∑–æ–∑–ª–∏–ª—Å—è! –ì–æ—Ç–æ–≤—å—Å—è –∫ –æ—Ç–≤–µ—Ç–∫–µ! üò†","–ë–æ–ª—å–Ω–æ! –ù–æ –Ω–∏—á–µ–≥–æ, —è —Ç–µ–±–µ —ç—Ç–æ –ø—Ä–∏–ø–æ–º–Ω—é... üòà"];c=g[Math.floor(Math.random()*g.length)]}else c=o<=0?"–≠–Ω–µ—Ä–≥–∏—è –∫–æ–Ω—á–∏–ª–∞—Å—å! –ù—É–∂–µ–Ω –æ—Ç–¥—ã—Ö...":"–ê—É—á! –ú–µ–Ω—è —É–¥–∞—Ä–∏–ª–æ —Ç–æ–∫–æ–º!";i({aiElectrician:{...n,energy:o,failuresCount:n.failuresCount+1,playerAttacksReceived:r?n.playerAttacksReceived+1:n.playerAttacksReceived,lastMessage:c,messageTime:Date.now()}})}else{const o=["battery","capacitor","wires","generator"],c=o[Math.floor(Math.random()*o.length)],g={...n.equipment,[c]:Math.max(0,n.equipment[c]-t)};let f;if(r){const b=[`–¢—ã —Å–ª–æ–º–∞–ª –º–æ–π ${c==="battery"?"–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä":c==="capacitor"?"–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä":c==="wires"?"–ø—Ä–æ–≤–æ–¥–∞":"–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä"}! –¢–µ–ø–µ—Ä—å —á—Ç–æ –¥–µ–ª–∞—Ç—å?! üò±`,`–ü–æ–ª–æ–º–∫–∞! –ú–æ–π ${c==="battery"?"–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä":c==="capacitor"?"–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä":c==="wires"?"–ø—Ä–æ–≤–æ–¥–∞":"–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä"} –¥—ã–º–∏—Ç—Å—è! üí®`,`–û –Ω–µ—Ç! –ë–µ–∑ ${c==="battery"?"–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–∞":c==="capacitor"?"–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–∞":c==="wires"?"–ø—Ä–æ–≤–æ–¥–æ–≤":"–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞"} —è –Ω–µ —Å–º–æ–≥—É —Ä–∞–±–æ—Ç–∞—Ç—å! üò≠`,`–¢—ã –∂–µ –ø–æ–Ω–∏–º–∞–µ—à—å, —á—Ç–æ ${c==="battery"?"–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä":c==="capacitor"?"–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä":c==="wires"?"–ø—Ä–æ–≤–æ–¥–∞":"–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä"} —Å—Ç–æ–∏—Ç –¥–µ–Ω–µ–≥?! üí∏`,"–í–æ—Ç —ç—Ç–æ —Ç—ã –º–µ–Ω—è –¥–æ—Å—Ç–∞–ª! –¢–µ–ø–µ—Ä—å —Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–¥–µ—Ç—Å—è... üîß"];f=b[Math.floor(Math.random()*b.length)]}else f=`–°–ª–æ–º–∞–ª—Å—è ${c==="battery"?"–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä":c==="capacitor"?"–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä":c==="wires"?"–ø—Ä–æ–≤–æ–¥–∞":"–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä"}!`;i({aiElectrician:{...n,equipment:g,failuresCount:n.failuresCount+1,lastMessage:f,messageTime:Date.now()}})}a().updateAIElectrician()},repairAIElectrician:s=>{const r=a().aiElectrician;if(s==="energy"){const l=Math.min(r.maxEnergy,r.energy+25),n=["–°–ø–∞—Å–∏–±–æ! –ß—É–≤—Å—Ç–≤—É—é –ø—Ä–∏–ª–∏–≤ —Å–∏–ª!","–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —è –º–æ–≥—É —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ–ª—å—à–µ!","–≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞! –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!","–í–∞—É! –ö–∞–∫ –±—É–¥—Ç–æ –∑–∞–Ω–æ–≤–æ —Ä–æ–¥–∏–ª—Å—è!"];i({aiElectrician:{...r,energy:l,lastMessage:n[Math.floor(Math.random()*n.length)],messageTime:Date.now()}})}else{const l={battery:Math.min(100,r.equipment.battery+20),capacitor:Math.min(100,r.equipment.capacitor+20),wires:Math.min(100,r.equipment.wires+20),generator:Math.min(100,r.equipment.generator+20)},n=["–û—Ç—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–ª –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ!","–¢–µ—Ö–Ω–∏–∫–∞ –∫–∞–∫ –Ω–æ–≤–∞—è! –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–º–æ—â—å!","–í—Å–µ –¥–µ—Ç–∞–ª–∏ –∑–∞–º–µ–Ω–µ–Ω—ã, –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å!","–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—Å–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!"];i({aiElectrician:{...r,equipment:l,lastMessage:n[Math.floor(Math.random()*n.length)],messageTime:Date.now()}})}a().updateAIElectrician()},aiElectricianAttackPlayer:()=>{const s=a(),t=s.aiElectrician;if(!t.isActive||t.voltage<100)return;console.log("AI Electrician attacking player!",{aiVoltage:t.voltage,playerVolts:s.player.volts});const r=20,l=Math.floor(t.voltage/20),n=r+l,o=[`–ü–æ–ª—É—á–∞–π! ${t.voltage} –≤–æ–ª—å—Ç –ø—Ä—è–º–æ –≤ —Ç–µ–±—è! ‚ö°üòà`,`–ê –≤–æ—Ç –∏ –æ—Ç–≤–µ—Ç–∫–∞ –∑–∞ —Ç–≤–æ–∏ –≤—ã—Ö–æ–¥–∫–∏! ${t.voltage}–í! üíÄ`,`–î—É–º–∞–ª —è –Ω–µ –æ—Ç–≤–µ—á—É? –í–æ—Ç —Ç–µ–±–µ ${t.voltage} –≤–æ–ª—å—Ç! ‚ö°üò§`,`–ú–µ—Å—Ç—å —ç–ª–µ–∫—Ç—Ä–∏–∫–∞! ${t.voltage} –≤–æ–ª—å—Ç –≤–æ–∑–º–µ–∑–¥–∏—è! ‚ö°üëø`,`–ü–æ–ª—É—á–∏ —Ä–∞–∑—Ä—è–¥ –≤ ${t.voltage}–í! –≠—Ç–æ —Ç–µ–±–µ —É—Ä–æ–∫! üò†‚ö°`,`–í–æ—Ç —á—Ç–æ –±—ã–≤–∞–µ—Ç —Å —Ç–µ–º–∏, –∫—Ç–æ –Ω–∞–ø–∞–¥–∞–µ—Ç –Ω–∞ —ç–ª–µ–∫—Ç—Ä–∏–∫–∞! ${t.voltage}–í! üí•`,`–û—Ç–≤–µ—Ç–Ω—ã–π —É–¥–∞—Ä! ${t.voltage} –≤–æ–ª—å—Ç –ø—Ä—è–º–æ –≤ —Ü–µ–ª—å! ‚ö°üéØ`,`–•–≤–∞—Ç–∏—Ç –º–µ–Ω—è —Ç—Ä–æ–≥–∞—Ç—å! –î–µ—Ä–∂–∏ ${t.voltage} –≤–æ–ª—å—Ç! üò°‚ö°`];i({singleMode:{...s.singleMode,isDischarging:!0,warningSignsActive:!0,dangerLevel:100}}),i({aiElectrician:{...t,voltage:0,lastAttackTime:Date.now(),lastMessage:o[Math.floor(Math.random()*o.length)],messageTime:Date.now(),playerAttacksReceived:Math.max(0,t.playerAttacksReceived-1)}});const c=Math.max(0,s.player.volts-n);i({player:{...s.player,volts:c}}),i({showElectricSparks:!0,sparksIntensity:"extreme"}),setTimeout(()=>{i({showElectricSparks:!1,singleMode:{...a().singleMode,isDischarging:!1,warningSignsActive:!1,dangerLevel:0}}),a().singleMode.aiElectricianActive&&a().gameState.isPlaying&&(console.log("AI attack complete, restarting discharge scheduling"),a().scheduleNextDischarge())},3e3)},getAIElectricianMessage:()=>{const t=a().aiElectrician,r={confident:["–Ø –ª—É—á—à–∏–π —ç–ª–µ–∫—Ç—Ä–∏–∫ –≤ –≥–æ—Ä–æ–¥–µ!","–≠—Ç–∞ —Ä–∞–±–æ—Ç–∞ –º–Ω–µ –ø–æ –ø–ª–µ—á—É!","–ù–∏–∫—Ç–æ –Ω–µ —Å–ø—Ä–∞–≤–∏—Ç—Å—è –ª—É—á—à–µ –º–µ–Ω—è!","–£ –º–µ–Ω—è –∑–æ–ª–æ—Ç—ã–µ —Ä—É–∫–∏!","–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ - –º–æ—è —Å—Ç–∏—Ö–∏—è!","–Ø –∑–Ω–∞—é –≤—Å–µ –æ —Ç–æ–∫–µ –∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–∏!","–†–æ–∑–µ—Ç–∫–∏ —Ç—Ä–µ–ø–µ—â—É—Ç –æ—Ç –º–æ–µ–≥–æ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞!"],frustrated:["–ß—Ç–æ-—Ç–æ —Å–µ–≥–æ–¥–Ω—è –Ω–µ –º–æ–π –¥–µ–Ω—å...","–¢–µ—Ö–Ω–∏–∫–∞ –ø–æ–¥–≤–æ–¥–∏—Ç, –∫–∞–∫ –≤—Å–µ–≥–¥–∞...","–ú–æ–∂–µ—Ç –±—ã—Ç—å, —Å—Ç–æ–∏—Ç —Å–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏—é?","–û–ø—è—Ç—å —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫!","–ü–æ—á–µ–º—É –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞–¥–æ?","–ö—Ç–æ –≤–æ–æ–±—â–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–ª —ç—Ç—É —Å—Ö–µ–º—É?!","–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –æ–¥–Ω–∏ –ø—Ä–æ–±–ª–µ–º—ã..."],tired:["–£—Å—Ç–∞–ª —è —É–∂–µ...","–ù—É–∂–µ–Ω –ø–µ—Ä–µ—Ä—ã–≤ –Ω–∞ –∫–æ—Ñ–µ","–°–∏–ª –±–æ–ª—å—à–µ –Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å","–•–æ—á–µ—Ç—Å—è –¥–æ–º–æ–π...","–†–∞–±–æ—á–∏–π –¥–µ–Ω—å —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π","–ì–ª–∞–∑–∞ —É–∂–µ —Å–ª–∏–ø–∞—é—Ç—Å—è","–ú–æ–∂–µ—Ç, —Ö–≤–∞—Ç–∏—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è?"],broken:["–í—Å–µ —Å–ª–æ–º–∞–ª–æ—Å—å! –ù–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!","–≠—Ç–æ –∫–æ–Ω–µ—Ü! –Ø –±–æ–ª—å—à–µ –Ω–µ –º–æ–≥—É!","–í—ã–∑—ã–≤–∞–π—Ç–µ –¥—Ä—É–≥–æ–≥–æ —ç–ª–µ–∫—Ç—Ä–∏–∫–∞...","–¢–µ—Ö–Ω–∏–∫–∞ –≤ —Ö–ª–∞–º, –∞ —è –±–µ–∑ —Å–∏–ª!","–ê–≤–∞—Ä–∏–π–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ! –í—Å–µ –ø—Ä–æ–ø–∞–ª–æ!","–°–∏—Å—Ç–µ–º–Ω—ã–π —Å–±–æ–π! –ü–æ–º–æ–≥–∏—Ç–µ!","–Ø —Å–ª–æ–º–∞–ª—Å—è –∫–∞–∫ —Å—Ç–∞—Ä–∞—è –ª–∞–º–ø–æ—á–∫–∞!"],angry:["–î–∞ —á—Ç–æ –∂ —Ç–∞–∫–æ–µ?! –û–ø—è—Ç—å —Å–±–æ–π!","–ö—Ç–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–ª —ç—Ç—É —Å—Ö–µ–º—É?!","–†—É–∫–∏ –±—ã –ø–æ–æ—Ç—Ä—ã–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç–µ–ª—è–º!","–ù–µ—Ä–≤—ã —É–∂–µ –Ω–∞ –ø—Ä–µ–¥–µ–ª–µ!","–°–∫–æ–ª—å–∫–æ –º–æ–∂–Ω–æ —Ç–µ—Ä–ø–µ—Ç—å —ç—Ç—É –µ—Ä—É–Ω–¥—É?!","–ì–¥–µ –º–æ–π –º–æ–ª–æ—Ç–æ–∫?! –°–µ–π—á–∞—Å –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª—é!","–ü—Ä–æ—Ç–∏–≤–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞! –ù–µ–Ω–∞–≤–∏–∂—É!","–õ—É—á—à–µ –±—ã –ø–æ—à–µ–ª –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã!"]},l=r[t.mood]||r.confident;return l[Math.floor(Math.random()*l.length)]},submitGameToServer:async()=>{const s=a();if(!R.isAuthenticated())return console.warn("User not authenticated, skipping server submission"),{success:!1,error:"Not authenticated"};try{const t={score:s.gameState.score,level:Xe(s.singleMode.difficulty),timePlayed:Math.floor(s.gameState.gameTime/1e3)};console.log("Submitting game data to server:",t);const r=await R.submitScore(t);if(r.error)return console.error("Failed to submit score:",r.error),{success:!1,error:r.error};if(r.data){const l=r.data;if(i({player:{...s.player,volts:l.totalVolts,experience:l.totalExperience,level:l.newLevel}}),l.leveledUp){const{showLevelUpNotification:n}=a();n({level:l.newLevel},l.levelUpReward)}return console.log("Successfully submitted score and synced with server"),{success:!0}}return{success:!0}}catch(t){const r=t instanceof Error?t.message:"Unknown error";return console.error("Error submitting game to server:",r),{success:!1,error:r}}},syncWithServer:async()=>{if(!R.isAuthenticated())return{success:!1,error:"Not authenticated"};try{const s=await R.getUserStats();if(s.error)return{success:!1,error:s.error};if(s.data){const t=s.data;return i({player:{...a().player,volts:t.totalVolts,experience:t.totalExperience,level:t.level}}),console.log("Successfully synced with server"),{success:!0}}return{success:!0}}catch(s){const t=s instanceof Error?s.message:"Unknown error";return console.error("Error syncing with server:",t),{success:!1,error:t}}},loadStatsFromServer:async()=>{if(!R.isAuthenticated())return{success:!1,error:"Not authenticated"};try{const s=await R.getUserStats();if(s.error)return{success:!1,error:s.error};if(s.data){const t=s.data;return i({player:{...a().player,volts:t.totalVolts,experience:t.totalExperience,level:t.level}}),console.log("Successfully loaded stats from server"),{success:!0}}return{success:!0}}catch(s){const t=s instanceof Error?s.message:"Unknown error";return console.error("Error loading stats from server:",t),{success:!1,error:t}}},buyProtectionItem:(s,t)=>{const l=a().getShopItems().find(o=>o.type===s&&o.level===t);return!l||a().player.volts<l.price?!1:(i(o=>({player:{...o.player,volts:o.player.volts-l.price,protection:{...o.player.protection,[s]:{level:l.level,protection:l.protection,durability:l.durability,maxDurability:l.durability}}}})),!0)},getShopItems:()=>[{id:"gloves-1",type:"gloves",level:1,protection:10,price:50,durability:100,name:"–†–µ–∑–∏–Ω–æ–≤—ã–µ –ø–µ—Ä—á–∞—Ç–∫–∏",description:"–ë–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–±–æ–ª—å—à–∏—Ö —Ä–∞–∑—Ä—è–¥–æ–≤",icon:"üß§"},{id:"gloves-2",type:"gloves",level:2,protection:20,price:150,durability:200,name:"–£—Å–∏–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä—á–∞—Ç–∫–∏",description:"–£–ª—É—á—à–µ–Ω–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–ª—è —Å—Ä–µ–¥–Ω–∏—Ö —Ä–∞–∑—Ä—è–¥–æ–≤",icon:"üß§"},{id:"gloves-3",type:"gloves",level:3,protection:35,price:400,durability:300,name:"–î–∏—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä—á–∞—Ç–∫–∏",description:"–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –≤—ã—Å–æ–∫–æ–≥–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è",icon:"üß§"},{id:"boots-1",type:"boots",level:1,protection:15,price:80,durability:150,name:"–†–µ–∑–∏–Ω–æ–≤—ã–µ —Å–∞–ø–æ–≥–∏",description:"–ó–∞—â–∏—Ç–∞ –Ω–æ–≥ –æ—Ç –∑–∞–∑–µ–º–ª–µ–Ω–∏—è",icon:"üë¢"},{id:"boots-2",type:"boots",level:2,protection:25,price:200,durability:250,name:"–î–∏—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–∞–ø–æ–≥–∏",description:"–£–ª—É—á—à–µ–Ω–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –æ—Ç –∑–µ–º–ª–∏",icon:"üë¢"},{id:"boots-3",type:"boots",level:3,protection:40,price:500,durability:350,name:"–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–∞–ø–æ–≥–∏",description:"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–∑–µ–º–ª–µ–Ω–∏—è",icon:"üë¢"},{id:"suit-1",type:"suit",level:1,protection:20,price:200,durability:120,name:"–ò–∑–æ–ª–∏—Ä—É—é—â–∏–π –∫–æ—Å—Ç—é–º",description:"–ó–∞—â–∏—Ç–∞ —Ç–µ–ª–∞ –æ—Ç —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑—Ä—è–¥–æ–≤",icon:"ü•Ω"},{id:"suit-2",type:"suit",level:2,protection:35,price:500,durability:200,name:"–ó–∞—â–∏—Ç–Ω—ã–π –∫–æ—Å—Ç—é–º",description:"–£—Å–∏–ª–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –≤—Å–µ–≥–æ —Ç–µ–ª–∞",icon:"ü•Ω"},{id:"suit-3",type:"suit",level:3,protection:50,price:1e3,durability:300,name:"–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ—Å—Ç—é–º",description:"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–ª—è —ç–ª–µ–∫—Ç—Ä–∏–∫–æ–≤",icon:"ü•Ω"},{id:"helmet-1",type:"helmet",level:1,protection:10,price:100,durability:200,name:"–ó–∞—â–∏—Ç–Ω–∞—è –∫–∞—Å–∫–∞",description:"–ó–∞—â–∏—Ç–∞ –≥–æ–ª–æ–≤—ã –æ—Ç —É–¥–∞—Ä–æ–≤ —Ç–æ–∫–æ–º",icon:"‚õëÔ∏è"},{id:"helmet-2",type:"helmet",level:2,protection:20,price:300,durability:300,name:"–î–∏—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∞—è –∫–∞—Å–∫–∞",description:"–£–ª—É—á—à–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –≥–æ–ª–æ–≤—ã",icon:"‚õëÔ∏è"},{id:"helmet-3",type:"helmet",level:3,protection:30,price:600,durability:400,name:"–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫–∞—Å–∫–∞",description:"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –≥–æ–ª–æ–≤—ã",icon:"‚õëÔ∏è"}],getTotalProtection:()=>{const s=a().player.protection;let t=0;return Object.values(s).forEach(r=>{if(r.durability>0){const l=r.durability/r.maxDurability;t+=r.protection*l}}),Math.min(t,80)},damageProtection:s=>{i(t=>{const r={...t.player.protection};return Object.keys(r).forEach(l=>{const n=r[l];n.durability>0&&Math.random()<.3&&(n.durability=Math.max(0,n.durability-Math.floor(s/4)))}),{player:{...t.player,protection:r}}})}}));function Xe(i){switch(i){case"easy":return 1;case"medium":return 2;case"hard":return 3;case"extreme":return 4;default:return 1}}class Qe{constructor(){_(this,"hapticFeedback",null);_(this,"isEnabled",!0);_(this,"isTelegramEnvironment",!1);this.initializeTelegramHaptics()}initializeTelegramHaptics(){var a;try{if(typeof window<"u"&&((a=window.Telegram)!=null&&a.WebApp)){this.isTelegramEnvironment=!0;const s=window.Telegram.WebApp;s.HapticFeedback?(this.hapticFeedback=s.HapticFeedback,console.log("Telegram Haptic Feedback initialized")):console.log("HapticFeedback not available in this Telegram version")}else console.log("Not in Telegram environment, haptics disabled")}catch(s){console.warn("Failed to initialize Telegram haptics:",s)}}setEnabled(a){this.isEnabled=a}isAvailable(){return(this.isTelegramEnvironment&&this.hapticFeedback!==null||typeof window<"u"&&"navigator"in window&&"vibrate"in navigator)&&this.isEnabled}light(){this.isAvailable()?this.hapticFeedback.impactOccurred("light"):this.fallbackVibration(50)}medium(){this.isAvailable()?this.hapticFeedback.impactOccurred("medium"):this.fallbackVibration(100)}heavy(){this.isAvailable()?this.hapticFeedback.impactOccurred("heavy"):this.fallbackVibration(150)}soft(){this.isAvailable()?this.hapticFeedback.impactOccurred("soft"):this.fallbackVibration(30)}rigid(){this.isAvailable()?this.hapticFeedback.impactOccurred("rigid"):this.fallbackVibration(200)}success(){this.isAvailable()?this.hapticFeedback.notificationOccurred("success"):this.customPattern([100,50,100])}error(){this.isAvailable()?this.hapticFeedback.notificationOccurred("error"):this.customPattern([200,100,200,100,200])}warning(){this.isAvailable()?this.hapticFeedback.notificationOccurred("warning"):this.customPattern([150,50,150])}selection(){this.isAvailable()?this.hapticFeedback.selectionChanged():this.fallbackVibration(25)}outletPress(){this.medium()}survivalSuccess(){this.success()}electricShock(){this.isEnabled&&(this.rigid(),setTimeout(()=>{this.isEnabled&&this.heavy()},50))}electricWarning(){this.isEnabled&&(this.light(),setTimeout(()=>{this.isEnabled&&this.light()},100))}levelUp(){this.success(),setTimeout(()=>this.medium(),150),setTimeout(()=>this.success(),300)}dangerWarning(){this.isEnabled&&(this.light(),setTimeout(()=>{this.isEnabled&&this.light()},100))}extremeDangerWarning(){this.isEnabled&&(this.light(),setTimeout(()=>{this.isEnabled&&this.medium()},150),setTimeout(()=>{this.isEnabled&&this.heavy()},300))}rewardReceived(){this.light(),setTimeout(()=>this.medium(),100)}streakAchievement(a){a>=25?(this.heavy(),setTimeout(()=>this.heavy(),200),setTimeout(()=>this.heavy(),400)):a>=10?(this.medium(),setTimeout(()=>this.medium(),150)):a>=5&&(this.light(),setTimeout(()=>this.light(),100))}itemUsed(){this.soft()}shopPurchase(){this.medium(),setTimeout(()=>this.light(),100)}gameInvitation(){this.warning(),setTimeout(()=>this.light(),500),setTimeout(()=>this.light(),1e3)}roundStart(){this.light()}gameEnd(a){a?(this.success(),setTimeout(()=>this.medium(),200),setTimeout(()=>this.success(),400)):this.error()}fallbackVibration(a){if("navigator"in window&&"vibrate"in navigator)try{navigator.vibrate(a),console.log(`üîπ Fallback vibration: ${a}ms`)}catch(s){console.warn("Vibration not supported:",s)}else console.log(`üì≥ Haptic feedback: ${a}ms (visual only)`),this.visualFeedback(a)}visualFeedback(a){const s=document.createElement("div");if(s.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: #FF6B35;
      color: white;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      z-index: 10000;
      pointer-events: none;
      animation: pulse 0.3s ease-in-out;
    `,s.textContent=`üì≥ ${a}ms`,!document.querySelector("#haptic-style")){const t=document.createElement("style");t.id="haptic-style",t.textContent=`
        @keyframes pulse {
          0% { transform: scale(0.8); opacity: 0; }
          50% { transform: scale(1.1); opacity: 1; }
          100% { transform: scale(1); opacity: 0.8; }
        }
      `,document.head.appendChild(t)}document.body.appendChild(s),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},Math.max(a,500))}customPattern(a){if("navigator"in window&&"vibrate"in navigator)try{navigator.vibrate(a),console.log(`üîπ Vibration pattern: [${a.join(", ")}]ms`)}catch(s){console.warn("Vibration pattern not supported:",s)}else console.log(`üì≥ Haptic pattern: [${a.join(", ")}]ms (visual only)`),this.visualPatternFeedback(a)}visualPatternFeedback(a){let s=0;for(let t=0;t<a.length;t+=2){const r=a[t],l=a[t+1]||0;setTimeout(()=>{this.visualFeedback(r)},s),s+=r+l}}test(){this.medium(),setTimeout(()=>this.light(),200),setTimeout(()=>this.heavy(),400)}}const k=new Qe,Ze=({onClose:i})=>{const{player:a,singleMode:s,gameState:t}=D();return e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50",onClick:i,children:e.jsxs(d.div,{initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.9},className:"glass-effect p-6 max-w-2xl mx-auto relative max-h-[90vh] overflow-y-auto",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{onClick:i,className:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors text-2xl",children:"‚úï"}),e.jsx("h3",{className:"text-2xl font-bold text-center mb-6 text-primary-orange",children:"üìä –°–∏—Å—Ç–µ–º–∞ –æ—á–∫–æ–≤ –∏ —É—Ä–æ–≤–Ω–µ–π"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"–¢–ï–ö–£–©–ê–Ø –°–ï–†–ò–Ø"}),e.jsx("div",{className:"text-xl font-bold text-yellow-400",children:s.streakCount})]}),e.jsxs("div",{className:"text-center glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"–ö–û–≠–§–§–ò–¶–ò–ï–ù–¢ –£–î–ê–ß–ò"}),e.jsxs("div",{className:`text-xl font-bold ${a.luckCoefficient>=70?"text-green-400":a.luckCoefficient>=50?"text-yellow-400":a.luckCoefficient>=30?"text-orange-400":"text-red-400"}`,children:[a.luckCoefficient,"%"]})]}),e.jsxs("div",{className:"text-center glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"–¢–ï–ö–£–©–ò–ô –°–ß–ï–¢"}),e.jsxs("div",{className:"text-xl font-bold text-green-400",children:[t.score,"‚ö°"]})]}),e.jsxs("div",{className:"text-center glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"–í–°–ï–ì–û –í–û–õ–¨–¢"}),e.jsxs("div",{className:"text-xl font-bold text-blue-400",children:[a.volts,"‚ö°"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"üçÄ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–¥–∞—á–∏"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"–£–°–ü–ï–®–ù–´–•"}),e.jsx("div",{className:"text-lg font-bold text-green-400",children:a.successfulClicks})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"–£–î–ê–†–û–í –¢–û–ö–û–ú"}),e.jsx("div",{className:"text-lg font-bold text-red-400",children:a.shockedClicks})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"–í–°–ï–ì–û –ö–õ–ò–ö–û–í"}),e.jsx("div",{className:"text-lg font-bold text-blue-400",children:a.totalClicks})]})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsx("div",{className:"text-sm text-gray-300",children:"üí° –£–¥–∞—á–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –Ω–∞–∂–∞—Ç–∏–π"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"üìà –°–∏—Å—Ç–µ–º–∞ –æ–ø—ã—Ç–∞ –∏ —É—Ä–æ–≤–Ω–µ–π"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-green-400 font-bold",children:"üü¢ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+10 –æ–ø—ã—Ç–∞"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-yellow-400 font-bold",children:"üü° –†–∏—Å–∫–æ–≤–∞–Ω–Ω–æ–µ (2x+):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+15 –æ–ø—ã—Ç–∞"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"üî¥ –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–µ (3x+):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+25 –æ–ø—ã—Ç–∞"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-orange-400 font-bold",children:"üí• –ü–æ—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–∫–æ–º:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+5 –æ–ø—ã—Ç–∞"})]})]}),e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("div",{className:"text-sm text-yellow-400 font-semibold",children:"üèÜ –ó–∞ –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –±–æ–Ω—É—Å–Ω—ã–µ –≤–æ–ª—å—Ç—ã!"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"–£—Ä–æ–≤–µ–Ω—å 2: +50‚ö° ‚Ä¢ –£—Ä–æ–≤–µ–Ω—å 5: +150‚ö° ‚Ä¢ –£—Ä–æ–≤–µ–Ω—å 10: +500‚ö°"}),e.jsx("div",{className:"text-xs text-blue-300 mt-2",children:"üé® –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–æ–∑–µ—Ç–∫–∏ –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —É—Ä–æ–≤–Ω–µ–π!"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"‚ö° –ë–∞–∑–æ–≤—ã–µ –æ—á–∫–∏ –∑–∞ –Ω–∞–∂–∞—Ç–∏–µ"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-green-400 font-bold",children:"üü¢ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+10‚ö° (–±–∞–∑–æ–≤—ã–µ –æ—á–∫–∏)"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"üí• –ü–æ—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–∫–æ–º:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"-8‚ö° –¥–æ -25‚ö° (—Å–ª—É—á–∞–π–Ω–æ)"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"üéØ –ú–Ω–æ–∂–∏—Ç–µ–ª–∏ –∑–∞ —Ä–∏—Å–∫"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-green-400 font-bold",children:"üü¢ –õ—ë–≥–∫–∏–π (15% —Ä–∏—Å–∫):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"√ó1.0 (–±–∞–∑–æ–≤—ã–µ –æ—á–∫–∏)"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-yellow-400 font-bold",children:"üü° –°—Ä–µ–¥–Ω–∏–π (25% —Ä–∏—Å–∫):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"√ó1.5 –º–Ω–æ–∂–∏—Ç–µ–ª—å"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-orange-400 font-bold",children:"üü† –°–ª–æ–∂–Ω—ã–π (35% —Ä–∏—Å–∫):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"√ó2.0 –º–Ω–æ–∂–∏—Ç–µ–ª—å"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"üî¥ –≠–∫—Å—Ç—Ä–∏–º (50% —Ä–∏—Å–∫):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"√ó3.0 –º–Ω–æ–∂–∏—Ç–µ–ª—å"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"üî• –ë–æ–Ω—É—Å—ã –∑–∞ —Å–µ—Ä–∏–∏"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-gray-400 font-bold",children:"0-4 –Ω–∞–∂–∞—Ç–∏–π:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"√ó1.0 (–±–µ–∑ –±–æ–Ω—É—Å–∞)"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-yellow-400 font-bold",children:"5+ –Ω–∞–∂–∞—Ç–∏–π:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"√ó1.2 –±–æ–Ω—É—Å"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-orange-400 font-bold",children:"10+ –Ω–∞–∂–∞—Ç–∏–π:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"√ó1.5 –±–æ–Ω—É—Å"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"25+ –Ω–∞–∂–∞—Ç–∏–π:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"√ó2.0 –±–æ–Ω—É—Å"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-purple-400 font-bold",children:"50+ –Ω–∞–∂–∞—Ç–∏–π:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"√ó3.0 –±–æ–Ω—É—Å"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"üßÆ –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á—ë—Ç–∞"}),e.jsx("div",{className:"glass-effect p-4 rounded-lg bg-gradient-to-r from-blue-500/10 to-purple-500/10",children:e.jsxs("div",{className:"text-center text-lg font-mono",children:[e.jsx("span",{className:"text-white",children:"–ò—Ç–æ–≥–æ–≤—ã–µ –æ—á–∫–∏"})," =",e.jsx("span",{className:"text-green-400",children:" 10‚ö°"})," √ó",e.jsx("span",{className:"text-orange-400",children:" –†–∏—Å–∫"})," √ó",e.jsx("span",{className:"text-yellow-400",children:" –°–µ—Ä–∏—è"})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"üí° –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–æ–≤"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-green-400 font-bold",children:"üü¢ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–≥—Ä–∞:"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["10‚ö° √ó 1.0 (–Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫) √ó 1.2 (5+ —Å–µ—Ä–∏—è) = ",e.jsx("span",{className:"text-white font-bold",children:"12‚ö°"})]})]}),e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-orange-400 font-bold",children:"üü† –†–∏—Å–∫–æ–≤–∞–Ω–Ω–∞—è –∏–≥—Ä–∞:"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["10‚ö° √ó 2.0 (–≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫) √ó 1.5 (10+ —Å–µ—Ä–∏—è) = ",e.jsx("span",{className:"text-white font-bold",children:"30‚ö°"})]})]}),e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"üî¥ –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –∏–≥—Ä–∞:"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["10‚ö° √ó 3.0 (—ç–∫—Å—Ç—Ä–∏–º —Ä–∏—Å–∫) √ó 2.0 (25+ —Å–µ—Ä–∏—è) = ",e.jsx("span",{className:"text-white font-bold",children:"60‚ö°"})]})]}),e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"üí• –ü–æ—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–∫–æ–º:"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["–°–ª—É—á–∞–π–Ω–æ –æ—Ç 8‚ö° –¥–æ 25‚ö° + ",e.jsx("span",{className:"text-red-400",children:"—Å–µ—Ä–∏—è —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è"})]})]})]})]})]}),e.jsx("div",{className:"mt-6 text-center text-xs text-gray-400",children:"üí° –°–æ–≤–µ—Ç: –ë–∞–ª–∞–Ω—Å–∏—Ä—É–π—Ç–µ –º–µ–∂–¥—É —Ä–∏—Å–∫–æ–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞!"})]})})},et=()=>{const{player:i,getCurrentLevelInfo:a}=D(),{currentLevel:s,progressInfo:t}=a(),r=ze(i.experience),l=H(s.level),n=t.nextLevel?H(t.nextLevel.level):null,o=n&&n!==l;return e.jsxs("div",{className:"glass-effect p-4 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:H(s.level),alt:`–†–æ–∑–µ—Ç–∫–∞ —É—Ä–æ–≤–Ω—è ${s.level}`,className:"w-12 h-12 rounded-lg border-2 border-primary-orange shadow-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide",children:"–£—Ä–æ–≤–µ–Ω—å"}),e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("span",{className:"text-2xl font-bold text-primary-orange",children:s.level}),e.jsx("span",{className:"text-sm text-gray-300",children:s.title})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"–û–ø—ã—Ç"}),e.jsx("div",{className:"text-lg font-bold text-accent-blue",children:i.experience.toLocaleString()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[e.jsx("span",{children:t.current}),e.jsx("span",{children:t.nextLevel?`${t.remaining} –¥–æ ${t.nextLevel.level} —É—Ä–æ–≤–Ω—è`:"–ú–∞–∫—Å–∏–º—É–º"}),e.jsx("span",{children:t.required})]}),e.jsxs("div",{className:"relative w-full bg-gray-700 rounded-full h-2 overflow-hidden",children:[e.jsx(d.div,{className:"h-full bg-gradient-to-r from-accent-blue to-primary-orange rounded-full",initial:{width:0},animate:{width:`${r}%`},transition:{duration:.8,ease:"easeOut"}}),r>0&&e.jsx(d.div,{className:"absolute top-0 right-0 w-1 h-full bg-white opacity-80",style:{right:`${100-r}%`},animate:{opacity:[.8,.3,.8]},transition:{repeat:1/0,duration:1.5}})]})]}),e.jsx("div",{className:"text-xs text-gray-400 italic text-center",children:s.description}),t.nextLevel&&e.jsxs("div",{className:"text-center pt-2 border-t border-gray-600",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-accent-lime font-semibold",children:t.nextLevel.title}),e.jsx("span",{className:"text-gray-400",children:" ‚Ä¢ "}),e.jsxs("span",{className:"text-yellow-400",children:["+",t.nextLevel.voltsReward,"‚ö°"]})]}),o&&e.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-2",children:[e.jsx("span",{className:"text-xs text-blue-300",children:"üé® –ù–æ–≤–∞—è —Ä–æ–∑–µ—Ç–∫–∞:"}),e.jsx("img",{src:n,alt:`–†–æ–∑–µ—Ç–∫–∞ —É—Ä–æ–≤–Ω—è ${t.nextLevel.level}`,className:"w-6 h-6 rounded border border-blue-400 shadow-sm"})]})]})]})},tt=({isVisible:i,onClose:a})=>{const[s,t]=u.useState(!0),[r,l]=u.useState(null);u.useEffect(()=>{const c=localStorage.getItem("hapticEnabled");if(c!==null){const g=JSON.parse(c);t(g),k.setEnabled(g)}},[]);const n=()=>{const c=!s;t(c),k.setEnabled(c),localStorage.setItem("hapticEnabled",JSON.stringify(c)),c&&k.test()},o=(c,g)=>{l(c),g(),setTimeout(()=>l(null),500)};return i?e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:a,children:e.jsxs(d.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl p-6 max-w-sm w-full border border-primary-orange/20",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary-orange",children:"–í–∏–±—Ä–∞—Ü–∏—è"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white text-2xl",children:"√ó"})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center p-4 bg-gray-800/50 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"–í–∫–ª—é—á–∏—Ç—å –≤–∏–±—Ä–∞—Ü–∏—é"}),e.jsx("p",{className:"text-sm text-gray-400",children:k.isAvailable()?"–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º":"–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ"})]}),e.jsx(d.button,{onClick:n,className:`w-12 h-6 rounded-full p-1 transition-colors ${s?"bg-primary-orange":"bg-gray-600"}`,whileTap:{scale:.95},children:e.jsx(d.div,{className:"w-4 h-4 bg-white rounded-full",animate:{x:s?24:0},transition:{type:"spring",stiffness:500,damping:30}})})]})}),s&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"–¢–µ—Å—Ç –≤–∏–±—Ä–∞—Ü–∏–∏"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300",children:"–ò–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è"}),e.jsx(d.button,{onClick:()=>o("press",()=>k.outletPress()),className:`w-full p-3 rounded-lg border transition-colors ${r==="press"?"bg-blue-500/30 border-blue-400 text-blue-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"üîå –ù–∞–∂–∞—Ç–∏–µ –Ω–∞ —Ä–æ–∑–µ—Ç–∫—É"}),e.jsx(d.button,{onClick:()=>o("success",()=>k.survivalSuccess()),className:`w-full p-3 rounded-lg border transition-colors ${r==="success"?"bg-green-500/30 border-green-400 text-green-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–∂–∏–≤–∞–Ω–∏–µ"}),e.jsx(d.button,{onClick:()=>o("shock",()=>k.electricShock()),className:`w-full p-3 rounded-lg border transition-colors ${r==="shock"?"bg-red-500/30 border-red-400 text-red-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"‚ö° –£–¥–∞—Ä —Ç–æ–∫–æ–º"}),e.jsx(d.button,{onClick:()=>o("levelup",()=>k.levelUp()),className:`w-full p-3 rounded-lg border transition-colors ${r==="levelup"?"bg-yellow-500/30 border-yellow-400 text-yellow-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"üÜô –ü–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è"})]}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300",children:"–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(d.button,{onClick:()=>o("light",()=>k.light()),className:`p-2 rounded-lg border text-sm transition-colors ${r==="light"?"bg-gray-500/30 border-gray-400 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"–õ–µ–≥–∫–∞—è"}),e.jsx(d.button,{onClick:()=>o("medium",()=>k.medium()),className:`p-2 rounded-lg border text-sm transition-colors ${r==="medium"?"bg-gray-500/30 border-gray-400 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"–°—Ä–µ–¥–Ω—è—è"}),e.jsx(d.button,{onClick:()=>o("heavy",()=>k.heavy()),className:`p-2 rounded-lg border text-sm transition-colors ${r==="heavy"?"bg-gray-500/30 border-gray-400 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"–°–∏–ª—å–Ω–∞—è"}),e.jsx(d.button,{onClick:()=>o("rigid",()=>k.rigid()),className:`p-2 rounded-lg border text-sm transition-colors ${r==="rigid"?"bg-gray-500/30 border-gray-400 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"–†–µ–∑–∫–∞—è"})]})]})]}),e.jsx("div",{className:"mt-6 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-300 text-center",children:"üí° –í–∏–±—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ Telegram Mini App –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö"})})]})}):null},he=u.createContext({webApp:null,user:null,isInTelegram:!1,platform:"unknown",colorScheme:"dark"}),X=()=>u.useContext(he),st=({children:i})=>{const[a,s]=u.useState(null),[t,r]=u.useState(null),[l,n]=u.useState(!1),[o,c]=u.useState("unknown"),[g,f]=u.useState("dark");u.useEffect(()=>{var m,v,x;if(typeof window<"u"&&((m=window.Telegram)!=null&&m.WebApp)){const y=window.Telegram.WebApp;y.ready(),y.expand(),s(y),n(!0),c(y.platform||"unknown"),f(y.colorScheme||"dark"),(v=y.initDataUnsafe)!=null&&v.user&&(r(y.initDataUnsafe.user),console.log("Telegram user:",y.initDataUnsafe.user)),y.setHeaderColor("#000000"),y.setBackgroundColor("#000000"),y.disableClosingConfirmation(),console.log("Telegram WebApp initialized successfully"),y.ready(),y.expand(),console.log("Telegram WebApp Context initialized:",{platform:y.platform,colorScheme:y.colorScheme,user:(x=y.initDataUnsafe)==null?void 0:x.user,version:y.version})}},[]);const b={webApp:a,user:t,isInTelegram:l,platform:o,colorScheme:g};return e.jsx(he.Provider,{value:b,children:i})},at=()=>{var r;const{user:i,isInTelegram:a,platform:s,colorScheme:t}=X();return a?e.jsx(d.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-500/30 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[i!=null&&i.photo_url?e.jsx("img",{src:i.photo_url,alt:"Avatar",className:"w-8 h-8 rounded-full border border-blue-400/50"}):e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:((r=i==null?void 0:i.first_name)==null?void 0:r[0])||"?"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-white",children:[i==null?void 0:i.first_name," ",i==null?void 0:i.last_name,(i==null?void 0:i.is_premium)&&e.jsx("span",{className:"ml-1 text-yellow-400",children:"‚≠ê"})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["@",(i==null?void 0:i.username)||"no_username"," ‚Ä¢ ",s]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:`text-xs px-2 py-1 rounded-full border ${t==="dark"?"bg-gray-800 border-gray-600 text-gray-300":"bg-gray-200 border-gray-400 text-gray-700"}`,children:[t==="dark"?"üåô":"‚òÄÔ∏è"," ",t]})})]})}):e.jsx("div",{className:"text-xs text-gray-500 text-center p-2",children:"üíª –í–µ–±-–≤–µ—Ä—Å–∏—è (–Ω–µ –≤ Telegram)"})};function Q(){const[i,a]=u.useState({data:null,loading:!1,error:null}),[s,t]=u.useState({data:null,loading:!1,error:null}),[r,l]=u.useState({data:null,loading:!1,error:null}),n=u.useCallback(async f=>{a({data:null,loading:!0,error:null});try{const b=await R.submitScore(f);return b.error?(a({data:null,loading:!1,error:b.error}),{success:!1,error:b.error}):(a({data:b.data,loading:!1,error:null}),{success:!0,data:b.data})}catch(b){const m=b instanceof Error?b.message:"Unknown error";return a({data:null,loading:!1,error:m}),{success:!1,error:m}}},[]),o=u.useCallback(async()=>{t({data:null,loading:!0,error:null});try{const f=await R.getUserStats();return f.error?(t({data:null,loading:!1,error:f.error}),{success:!1,error:f.error}):(t({data:f.data,loading:!1,error:null}),{success:!0,data:f.data})}catch(f){const b=f instanceof Error?f.message:"Unknown error";return t({data:null,loading:!1,error:b}),{success:!1,error:b}}},[]),c=u.useCallback(async(f="level",b=10)=>{l({data:null,loading:!0,error:null});try{const m=await R.getLeaderboard(f,b);return m.error?(l({data:null,loading:!1,error:m.error}),{success:!1,error:m.error}):(l({data:m.data,loading:!1,error:null}),{success:!0,data:m.data})}catch(m){const v=m instanceof Error?m.message:"Unknown error";return l({data:null,loading:!1,error:v}),{success:!1,error:v}}},[]),g=u.useCallback(async()=>{try{const f=await R.refillEnergy();return f.error?{success:!1,error:f.error}:{success:!0,data:f.data}}catch(f){return{success:!1,error:f instanceof Error?f.message:"Unknown error"}}},[]);return{submitScore:n,getUserStats:o,getLeaderboard:c,refillEnergy:g,submitState:i,statsState:s,leaderboardState:r,isAuthenticated:R.isAuthenticated()}}function it(){const[i,a]=u.useState(navigator.onLine);return u.useState(()=>{const s=()=>a(!0),t=()=>a(!1);return window.addEventListener("online",s),window.addEventListener("offline",t),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",t)}}),{isOnline:i}}const rt=()=>{const{player:i,gameState:a,startSingleMode:s,startMultiplayerMode:t,addExperience:r,compensateExperience:l,loadStatsFromServer:n}=D(),{isAuthenticated:o}=Q(),[c,g]=u.useState(!1),[f,b]=u.useState(!1),[m,v]=u.useState(!1);u.useEffect(()=>{(async()=>{if(o&&!m){v(!0);try{const p=await n();p.success?console.log("‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞"):console.warn("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å —Å–µ—Ä–≤–µ—Ä–∞:",p.error)}catch(p){console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:",p)}finally{v(!1)}}})()},[o,n,m]);const x=()=>{r(100)},y=()=>{const j=l();j>0?console.log(`Compensated ${j} experience points`):console.log("No experience compensation needed")},h=j=>{k.medium(),s(j)};return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-background-dark to-background-darker",children:[e.jsxs(d.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},transition:{duration:.8},className:"text-center mb-8",children:[e.jsx("h1",{className:"text-6xl font-bold text-primary-orange tiger-stripes bg-clip-text text-transparent mb-4",children:"–¢–ò–ì–†"}),e.jsx("h2",{className:"text-4xl font-bold text-accent-blue mb-2",children:"–†–û–ó–ï–¢–ö–ê"}),e.jsx("p",{className:"text-lg text-gray-300",children:"Telegram Mini App Game"})]}),e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"mb-6",children:e.jsx(et,{})}),o&&m&&e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},className:"mb-4 text-center text-blue-400 text-sm",children:[e.jsx("span",{className:"inline-block animate-spin mr-2",children:"‚è≥"}),"–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º..."]}),!o&&e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},className:"mb-4 text-center text-yellow-400 text-sm",children:"‚ö†Ô∏è –ò–≥—Ä–∞ –≤ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–º —Ä–µ–∂–∏–º–µ"}),e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.25},className:"mb-4 w-full max-w-md",children:e.jsx(at,{})}),e.jsxs(d.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.3},className:"glass-effect p-6 mb-8 text-center",children:[e.jsxs("div",{className:"text-sm text-gray-300 mb-2",children:["–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ",i.name,"!"]}),e.jsxs("div",{className:"flex justify-center space-x-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"–í–û–õ–¨–¢–´"}),e.jsxs("div",{className:"text-xl font-bold text-primary-orange",children:[i.volts,"‚ö°"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"–£–†–û–í–ï–ù–¨"}),e.jsx("div",{className:"text-xl font-bold text-accent-blue",children:i.level})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"–í–°–ï–ì–û –ù–ê–ñ–ê–¢–ò–ô"}),e.jsx("div",{className:"text-xl font-bold text-accent-lime",children:i.totalClicks})]})]})]}),e.jsxs(d.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},className:"w-full max-w-md space-y-4",children:[e.jsx("h3",{className:"text-2xl font-bold text-center text-white mb-6",children:"‚ö° –û–¥–∏–Ω–æ—á–Ω—ã–π —Ä–µ–∂–∏–º"}),e.jsx("p",{className:"text-center text-gray-300 text-sm mb-4",children:"–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏–≥—Ä—ã –ø—Ä–æ—Ç–∏–≤ –ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫–∞"}),e.jsx(d.button,{onClick:()=>h("easy"),className:"w-full glass-effect p-4 rounded-xl hover:bg-green-500/20 transition-colors",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-green-400",children:"–õ–Å–ì–ö–ò–ô"}),e.jsx("div",{className:"text-sm text-gray-300",children:"15% —à–∞–Ω—Å —Ä–∞–∑—Ä—è–¥–∞ ‚Ä¢ 2 —Å–µ–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"})]}),e.jsx("div",{className:"text-2xl",children:"üü¢"})]})}),e.jsx(d.button,{onClick:()=>h("medium"),className:"w-full glass-effect p-4 rounded-xl hover:bg-yellow-500/20 transition-colors",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-400",children:"–°–†–ï–î–ù–ò–ô"}),e.jsx("div",{className:"text-sm text-gray-300",children:"25% —à–∞–Ω—Å —Ä–∞–∑—Ä—è–¥–∞ ‚Ä¢ 1.5 —Å–µ–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"})]}),e.jsx("div",{className:"text-2xl",children:"üü°"})]})}),e.jsx(d.button,{onClick:()=>h("hard"),className:"w-full glass-effect p-4 rounded-xl hover:bg-orange-500/20 transition-colors",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-orange-400",children:"–°–õ–û–ñ–ù–´–ô"}),e.jsx("div",{className:"text-sm text-gray-300",children:"35% —à–∞–Ω—Å —Ä–∞–∑—Ä—è–¥–∞ ‚Ä¢ 1 —Å–µ–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"})]}),e.jsx("div",{className:"text-2xl",children:"üü†"})]})}),e.jsx(d.button,{onClick:()=>h("extreme"),className:"w-full glass-effect p-4 rounded-xl hover:bg-red-500/20 transition-colors",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-red-400",children:"–≠–ö–°–¢–†–ò–ú"}),e.jsx("div",{className:"text-sm text-gray-300",children:"50% —à–∞–Ω—Å —Ä–∞–∑—Ä—è–¥–∞ ‚Ä¢ 0.5 —Å–µ–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"})]}),e.jsx("div",{className:"text-2xl",children:"üî¥"})]})}),e.jsxs(d.div,{className:"w-full border-t border-white/10 pt-6 mt-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.7},children:[e.jsx("h4",{className:"text-xl font-bold text-center text-white mb-4",children:"üéÆ –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º"}),e.jsx(d.button,{onClick:()=>{k.medium(),t("duel")},className:"w-full glass-effect p-4 rounded-xl hover:bg-purple-500/20 transition-colors border border-purple-400/30",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-purple-400",children:"–î–£–≠–õ–¨"}),e.jsx("div",{className:"text-sm text-gray-300",children:"–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ 1v1 ‚Ä¢ Real-time –±–æ–π"})]}),e.jsx("div",{className:"text-2xl",children:"‚öîÔ∏è"})]})}),e.jsx(d.button,{onClick:()=>{k.medium(),t("tournament")},className:"w-full glass-effect p-4 rounded-xl hover:bg-blue-500/20 transition-colors border border-blue-400/30 mt-3",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-blue-400",children:"–¢–£–†–ù–ò–†"}),e.jsx("div",{className:"text-sm text-gray-300",children:"–î–æ 8 –∏–≥—Ä–æ–∫–æ–≤ ‚Ä¢ –ë—Ä–∞–∫–∫–µ—Ç —Å–∏—Å—Ç–µ–º–∞"})]}),e.jsx("div",{className:"text-2xl",children:"üèÜ"})]})}),e.jsx(d.button,{onClick:()=>{k.medium(),t("coop")},className:"w-full glass-effect p-4 rounded-xl hover:bg-green-500/20 transition-colors border border-green-400/30 mt-3",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-green-400",children:"–ö–û–û–ü"}),e.jsx("div",{className:"text-sm text-gray-300",children:"–ö–æ–º–∞–Ω–¥–Ω–∞—è –∏–≥—Ä–∞ ‚Ä¢ –ü—Ä–æ—Ç–∏–≤ –ò–ò"})]}),e.jsx("div",{className:"text-2xl",children:"ü§ù"})]})})]}),e.jsx(d.button,{onClick:()=>{k.light(),g(!0)},className:"w-full glass-effect p-3 rounded-xl hover:bg-blue-500/20 transition-colors border border-blue-400/30",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:"üìä"}),e.jsx("span",{className:"text-lg font-semibold text-blue-400",children:"–û—á–∫–∏ –∏ —É—Ä–æ–≤–Ω–∏"})]})}),e.jsx(d.button,{onClick:()=>{k.light(),b(!0)},className:"w-full glass-effect p-3 rounded-xl hover:bg-purple-500/20 transition-colors border border-purple-400/30",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:"üì≥"}),e.jsx("span",{className:"text-lg font-semibold text-purple-400",children:"–í–∏–±—Ä–∞—Ü–∏—è"})]})})]}),c&&e.jsx(Ze,{onClose:()=>g(!1)}),f&&e.jsx(tt,{isVisible:f,onClose:()=>b(!1)}),e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:1},className:"mt-8 text-center text-gray-400 text-sm space-y-2",children:[e.jsx("p",{children:"‚ö° –ò–≥—Ä–∞–π –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ! ‚ö°"}),e.jsx("p",{className:"mt-2",children:"v1.1.0 | Single Mode + Multiplayer Preview"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>{k.light(),x()},className:"px-3 py-1 text-xs bg-purple-600/30 hover:bg-purple-600/50 text-purple-300 rounded transition-colors",children:"üîß +100 –æ–ø—ã—Ç–∞ (—Ç–µ—Å—Ç)"}),e.jsxs("button",{onClick:()=>{k.light(),y()},className:"px-3 py-1 text-xs bg-green-600/30 hover:bg-green-600/50 text-green-300 rounded transition-colors",children:["‚ö° –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø—ã—Ç (",a.score," –æ—á–∫–æ–≤)"]})]})]})]})};class lt{constructor(){_(this,"audioContext",null);_(this,"sounds",new Map);_(this,"volume",.7);_(this,"enabled",!0);this.init()}async init(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(a){console.warn("Web Audio API not supported:",a)}}async loadSound(a,s){if(this.audioContext)try{const r=await(await fetch(s)).arrayBuffer(),l=await this.audioContext.decodeAudioData(r);this.sounds.set(a,l)}catch(t){console.warn(`Failed to load sound ${a}:`,t)}}playSound(a,s=1){if(!this.enabled||!this.audioContext)return;const t=this.sounds.get(a);if(!t)return;const r=this.audioContext.createBufferSource(),l=this.audioContext.createGain();r.buffer=t,l.gain.value=this.volume*s,r.connect(l),l.connect(this.audioContext.destination),r.start()}generateSparkSound(a){if(!this.enabled||!this.audioContext)return;const s={low:.1,medium:.2,high:.3,extreme:.5}[a],t={low:2e3,medium:3e3,high:4e3,extreme:5e3}[a],r=this.audioContext.sampleRate*s,l=this.audioContext.createBuffer(1,r,this.audioContext.sampleRate),n=l.getChannelData(0);for(let g=0;g<r;g++){const f=g/this.audioContext.sampleRate,b=Math.exp(-f*10),m=(Math.random()*2-1)*b,v=Math.sin(2*Math.PI*t*f*(1+Math.random()*.5));n[g]=m*v*.3}const o=this.audioContext.createBufferSource(),c=this.audioContext.createGain();o.buffer=l,c.gain.value=this.volume*(a==="extreme"?.8:.5),o.connect(c),c.connect(this.audioContext.destination),o.start()}generateShockSound(){if(!this.enabled||!this.audioContext)return;const s=this.audioContext.sampleRate*.8,t=this.audioContext.createBuffer(1,s,this.audioContext.sampleRate),r=t.getChannelData(0);for(let o=0;o<s;o++){const c=o/this.audioContext.sampleRate,g=Math.exp(-c*3),f=Math.sin(2*Math.PI*100*c),b=Math.sin(2*Math.PI*800*c)*.5,m=(Math.random()*2-1)*.3;r[o]=(f+b+m)*g*.6}const l=this.audioContext.createBufferSource(),n=this.audioContext.createGain();l.buffer=t,n.gain.value=this.volume,l.connect(n),n.connect(this.audioContext.destination),l.start()}generateWarningSound(){if(!this.enabled||!this.audioContext)return;const a=.3,s=this.audioContext.sampleRate*a,t=this.audioContext.createBuffer(1,s,this.audioContext.sampleRate),r=t.getChannelData(0);for(let o=0;o<s;o++){const c=o/this.audioContext.sampleRate,g=1e3+Math.sin(c*20)*200,f=Math.sin(Math.PI*c/a);r[o]=Math.sin(2*Math.PI*g*c)*f*.4}const l=this.audioContext.createBufferSource(),n=this.audioContext.createGain();l.buffer=t,n.gain.value=this.volume*.6,l.connect(n),n.connect(this.audioContext.destination),l.start()}async playTigerSound(){if(this.enabled)try{const a=new Audio("/tigerrosette/Media/sound/re_-tigra.mp3");a.volume=this.volume*.8,a.preload="auto",await a.play(),console.log("SoundManager: Tiger sound played successfully")}catch(a){console.warn("Failed to play tiger sound:",a)}}setVolume(a){this.volume=Math.max(0,Math.min(1,a))}setEnabled(a){this.enabled=a}getVolume(){return this.volume}isEnabled(){return this.enabled}}const G=new lt,nt=({score:i,reason:a,isVisible:s,position:t,type:r,experience:l=0})=>{const n=()=>{switch(r){case"success":return i>=30?"text-yellow-300":i>=20?"text-green-300":"text-blue-300";case"shock":return"text-red-300";case"bonus":return"text-purple-300";default:return"text-white"}},o=()=>{switch(r){case"success":return i>=30?"üî•":i>=20?"‚ö°":"‚ú®";case"shock":return"üí•";case"bonus":return"üéâ";default:return"‚ö°"}};return e.jsx($,{children:s&&e.jsx(d.div,{className:`absolute pointer-events-none z-50 ${n()}`,initial:{opacity:0,scale:.5,x:t.x,y:t.y},animate:{opacity:[0,1,1,0],scale:[.5,1.2,1,.8],y:t.y-80,x:t.x+(Math.random()-.5)*40},transition:{duration:2,ease:"easeOut"},children:e.jsx("div",{className:"bg-black/80 backdrop-blur-sm rounded-lg px-3 py-2 border border-current",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:o()}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-lg",children:["+",i,"‚ö°"]}),l>0&&e.jsxs("div",{className:"text-xs text-blue-300",children:["+",l," –æ–ø—ã—Ç–∞"]}),e.jsx("div",{className:"text-xs opacity-80",children:a})]})]})})})})},ot=({isActive:i,intensity:a="medium",onComplete:s})=>{const[t,r]=u.useState([]);u.useEffect(()=>{i?l():r([])},[i,a]);const l=()=>{const n={low:6,medium:12,high:18,extreme:25}[a],o=["#3B82F6","#EF4444","#FFFFFF","#FBBF24","#8B5CF6"],c=[];for(let g=0;g<n;g++)c.push({id:g,x:Math.random()*100,y:Math.random()*100,angle:Math.random()*360,length:20+Math.random()*60,delay:Math.random()*.3,color:o[Math.floor(Math.random()*o.length)]});r(c),setTimeout(()=>{r([]),s==null||s()},1e3)};return e.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[e.jsx($,{children:t.map(n=>e.jsxs(d.div,{className:"absolute",style:{left:`${n.x}%`,top:`${n.y}%`,transform:`rotate(${n.angle}deg)`},initial:{opacity:0,scale:0},animate:{opacity:[0,1,.7,0],scale:[0,1,.8,0],x:[0,Math.cos(n.angle*Math.PI/180)*n.length],y:[0,Math.sin(n.angle*Math.PI/180)*n.length]},transition:{duration:.6,delay:n.delay,ease:"easeOut"},children:[e.jsx("div",{className:"w-1 bg-gradient-to-r opacity-90 rounded-full shadow-lg",style:{height:`${n.length}px`,backgroundColor:n.color,boxShadow:`0 0 8px ${n.color}, 0 0 16px ${n.color}40`}}),e.jsx("div",{className:"absolute top-0 left-0 w-1 blur-sm opacity-60 rounded-full",style:{height:`${n.length}px`,backgroundColor:n.color}})]},n.id))}),e.jsx($,{children:i&&e.jsx(d.svg,{className:"absolute inset-0 w-full h-full",initial:{opacity:0},animate:{opacity:[0,1,.8,.2,.9,0]},transition:{duration:.8,times:[0,.1,.3,.5,.7,1]},children:Array.from({length:3},(n,o)=>{const c=20+Math.random()*60,g=20+Math.random()*60,f=5+Math.floor(Math.random()*5);let b=`M ${c} ${g}`,m=c,v=g;for(let x=0;x<f;x++)m+=(Math.random()-.5)*40,v+=(Math.random()-.5)*40,b+=` L ${m} ${v}`;return e.jsx(d.path,{d:b,stroke:"#FFFFFF",strokeWidth:Math.random()*2+1,fill:"none",opacity:.8,filter:"drop-shadow(0 0 4px #3B82F6)",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.3,delay:o*.1,ease:"easeOut"}},o)})})}),e.jsx($,{children:i&&e.jsx(d.div,{className:"absolute inset-0 bg-white mix-blend-screen",initial:{opacity:0},animate:{opacity:[0,.4,.1,.3,0]},transition:{duration:.5,times:[0,.1,.3,.6,1]}})})]})},ct="/tigerrosette/assets/electric_shock-mF2Yhpau.mp4",dt=({isActive:i,onComplete:a})=>{const s=u.useRef(null);return u.useEffect(()=>{const t=s.current;if(!t)return;console.log("SimpleVideoPlayer: Effect triggered",{isActive:i});const r=()=>{console.log("SimpleVideoPlayer: Video state",{src:t.src,readyState:t.readyState,networkState:t.networkState,error:t.error,canPlay:t.readyState>=3})},l=()=>console.log("SimpleVideoPlayer: loadstart"),n=()=>console.log("SimpleVideoPlayer: canplay"),o=c=>{console.error("SimpleVideoPlayer: Video error",c.target.error)};if(t.addEventListener("loadstart",l),t.addEventListener("canplay",n),t.addEventListener("error",o),r(),i){console.log("SimpleVideoPlayer: Starting video"),t.currentTime=0,t.style.display="block",G.playTigerSound().catch(g=>{console.warn("SimpleVideoPlayer: Failed to play tiger sound:",g)}),setTimeout(()=>{r(),t.play().then(()=>{console.log("SimpleVideoPlayer: Video started successfully"),window.__shockVideoStarted=!0}).catch(g=>{console.error("SimpleVideoPlayer: Play error:",g)})},100);const c=()=>{console.log("SimpleVideoPlayer: Video ended"),t.style.display="none",a==null||a()};return t.addEventListener("ended",c),()=>{t.removeEventListener("ended",c),t.removeEventListener("loadstart",l),t.removeEventListener("canplay",n),t.removeEventListener("error",o)}}else t.style.display="none"},[i,a]),e.jsx("video",{ref:s,src:ct,className:"absolute inset-0 w-full h-full object-cover rounded-2xl",style:{display:"none"},muted:!0,playsInline:!0,autoPlay:!1,preload:"auto"})},mt=({isActive:i,onComplete:a,intensity:s="high"})=>{const t=u.useRef(null),[r,l]=u.useState(!1),[n,o]=u.useState(""),[c,g]=u.useState(!1),f=u.useRef(null);console.log("ElectricShockVideo render:",{isActive:i,intensity:s,isVideoLoaded:r,isPlaying:c}),u.useEffect(()=>{const h="/tigerrosette/Media/video/electric_shock.mp4";o(h),console.log("ElectricShockVideo: Using video URL:",h)},[]),u.useEffect(()=>{const h=t.current;if(!h)return;const j=()=>{console.log("ElectricShockVideo: Video loaded successfully"),l(!0)},p=()=>{console.log("ElectricShockVideo: Video can start playing")},E=()=>{console.log("ElectricShockVideo: Video loading started")},I=()=>{console.log("ElectricShockVideo: Video ended"),g(!1),a==null||a()},w=S=>{const M=S.target;console.error("ElectricShockVideo: Video error",{error:M.error,networkState:M.networkState,readyState:M.readyState,src:M.src}),g(!1)};return h.addEventListener("loadeddata",j),h.addEventListener("canplay",p),h.addEventListener("loadstart",E),h.addEventListener("ended",I),h.addEventListener("error",w),()=>{h.removeEventListener("loadeddata",j),h.removeEventListener("canplay",p),h.removeEventListener("loadstart",E),h.removeEventListener("ended",I),h.removeEventListener("error",w)}},[a]),u.useEffect(()=>{const h=t.current;if(console.log("ElectricShockVideo: useEffect triggered",{isActive:i,isVideoLoaded:r,video:!!h,videoSrc:n,videoReadyState:h==null?void 0:h.readyState,videoNetworkState:h==null?void 0:h.networkState}),!(!h||!n)){if(i&&!c){console.log("ElectricShockVideo: Attempting to play video"),h.currentTime=0,g(!0);const j=h.play();f.current=j,j!==void 0&&j.then(()=>{console.log("ElectricShockVideo: Video started playing successfully")}).catch(p=>{console.error("ElectricShockVideo: Failed to play video",p),g(!1)})}return()=>{f.current&&f.current.catch(()=>{})}}},[i,n,c]);const b=()=>{switch(s){case"extreme":return{scale:1.2,opacity:.9,blur:2,brightness:1.3};case"high":return{scale:1.1,opacity:.8,blur:1,brightness:1.2};case"medium":return{scale:1.05,opacity:.7,blur:.5,brightness:1.1};case"low":default:return{scale:1,opacity:.6,blur:0,brightness:1}}},{scale:m,opacity:v,blur:x,brightness:y}=b();return e.jsx($,{children:i&&e.jsxs(d.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},className:"absolute inset-0 rounded-2xl overflow-hidden",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("video",{ref:t,src:n,className:"absolute inset-0 w-full h-full object-cover rounded-2xl",style:{transform:`scale(${m})`,filter:`blur(${x}px) brightness(${y})`,opacity:v},muted:!0,playsInline:!0,preload:"auto",onLoadStart:()=>console.log("Video load start inline, src:",n),onCanPlay:()=>console.log("Video can play inline, src:",n),onError:h=>{console.error("Video error inline, src:",n),console.error("Error event:",h)}}),!r&&e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 bg-gradient-radial from-blue-500/30 via-purple-500/20 to-transparent"}),e.jsx(d.div,{initial:{opacity:0},animate:{opacity:.3},exit:{opacity:0},className:"absolute inset-0 bg-black"}),e.jsx(d.div,{animate:{scale:[1,m,1],rotate:[0,Math.random()*4-2,0]},transition:{duration:.3,repeat:2,ease:"easeInOut"},className:"relative z-10",children:e.jsx("video",{ref:t,className:"w-full h-full object-cover",style:{filter:`blur(${x}px) brightness(${y})`,opacity:v,maxWidth:"100vw",maxHeight:"100vh",width:"auto",height:"auto"},muted:!0,playsInline:!0,preload:"auto",children:e.jsx("source",{src:"/Media/video/electric_shock.mp4",type:"video/mp4"})})}),e.jsx(d.div,{initial:{opacity:0},animate:{opacity:[0,.8,0],scale:[.8,1.2,.8]},transition:{duration:.6,repeat:1,ease:"easeInOut"},className:"absolute inset-0 bg-gradient-radial from-blue-400/20 via-purple-500/10 to-transparent"}),e.jsx(d.div,{initial:{opacity:0},animate:{opacity:[0,1,0]},transition:{duration:.1,repeat:3,repeatDelay:.1},className:"absolute inset-0 bg-white/20"}),e.jsx(d.div,{animate:{background:["radial-gradient(circle at 20% 30%, rgba(0, 255, 255, 0.3) 0%, transparent 50%)","radial-gradient(circle at 80% 70%, rgba(255, 255, 0, 0.3) 0%, transparent 50%)","radial-gradient(circle at 60% 20%, rgba(255, 0, 255, 0.3) 0%, transparent 50%)","radial-gradient(circle at 20% 30%, rgba(0, 255, 255, 0.3) 0%, transparent 50%)"]},transition:{duration:.3,repeat:1/0,ease:"linear"},className:"absolute inset-0 pointer-events-none"})]})})},xt=()=>{const{player:i}=D(),[a,s]=u.useState(H(i.level)),[t,r]=u.useState(!1);return u.useEffect(()=>{const l=H(i.level);console.log(`Player level: ${i.level}, Image path: ${l}`),l!==a&&(r(!0),setTimeout(()=>{s(l),r(!1)},300))},[i.level,a]),{currentImage:a,isAnimating:t}},ut=({className:i="",onShock:a})=>{const{clickOutlet:s,singleMode:t,gameState:r,player:l,updateScore:n,triggerShock:o}=D(),{currentImage:c,isAnimating:g}=xt(),[f,b]=u.useState([]),[m,v]=u.useState(!1),[x,y]=u.useState(1),[h,j]=u.useState(!1),[p,E]=u.useState(!1),[I,w]=u.useState({visible:!1,score:0,reason:"",type:"success"}),S=u.useCallback((A,N,C)=>{w({visible:!0,score:A,reason:N,type:C}),setTimeout(()=>{w(T=>({...T,visible:!1}))},2e3)},[]),M=u.useCallback(()=>{console.log("TigerOutlet: Shock video completed"),E(!1)},[]);u.useEffect(()=>{if(p){console.log("TigerOutlet: Video started, setting failsafe timeout");const A=setTimeout(()=>{console.log("TigerOutlet: Failsafe timeout - forcing video off"),E(!1)},1e4);return()=>clearTimeout(A)}},[p]);const L=u.useCallback(A=>{const N={low:3,medium:6,high:12,extreme:20}[A],C=Array.from({length:N},(T,P)=>({id:`spark-${Date.now()}-${P}`,x:Math.random()*200-100,y:Math.random()*200-100,intensity:A,timestamp:Date.now(),duration:300+Math.random()*200,color:A==="extreme"?"#E8FF00":A==="high"?"#00D4FF":A==="medium"?"#8A2BE2":"#FF6B35"}));b(T=>[...T,...C]),C.forEach(T=>{setTimeout(()=>{b(P=>P.filter(W=>W.id!==T.id))},T.duration)})},[]),F=u.useCallback(()=>{if(!r.isPlaying)return;if(p){console.log("TigerOutlet: Click during shock video - applying additional penalty!"),k.electricShock(),G.generateShockSound();const N={basePoints:-20,riskMultiplier:1,streakBonus:0,timeBonus:0,totalPoints:-20,reason:"–ö–ª–∏–∫ –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä—è–¥–∞!"};n(N),S(N.totalPoints,N.reason,"shock"),L("extreme"),y(4);return}t.warningSignsActive&&(t.dangerLevel>80?k.extremeDangerWarning():t.dangerLevel>60&&k.dangerWarning()),k.outletPress(),v(!0),s();const A=t.isDischarging;if(console.log("TigerOutlet: Click handled",{isShocked:A,dangerLevel:t.dangerLevel,isDischarging:t.isDischarging,currentRisk:t.currentRisk,gameState:r.isPlaying,aiElectricianActive:t.aiElectricianActive,nextDischargeTime:t.nextDischargeTime,now:Date.now(),timeUntilDischarge:t.nextDischargeTime-Date.now(),showShockVideo:p,singleModeState:t}),A)console.log("TigerOutlet: Electric shock triggered!",{currentVideoState:p,electricShockActive:h}),j(!0),E(!0),y(3),a==null||a(),k.electricShock(),G.generateShockSound(),o(),setTimeout(()=>{console.log("TigerOutlet: Disabling electric shock effect"),j(!1)},1e3),setTimeout(()=>{const N=window.lastPenaltyMessage;if(N)S(0,N,"shock"),window.lastPenaltyMessage=null;else{const C=B(l.experience).level,T=C>=3?-15:5,P={low:1,medium:1.5,high:2,extreme:2.5}[t.currentRisk],W=C>=3?Math.floor(T*P):T+Math.floor(Math.random()*10),U={basePoints:T,riskMultiplier:P,streakBonus:0,timeBonus:0,totalPoints:W,reason:"–ü–æ—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–∫–æ–º"};n(U),S(U.totalPoints,U.reason,"shock")}},100);else{const N=t.currentRisk==="extreme"?"extreme":t.currentRisk==="high"?"high":t.currentRisk==="medium"?"medium":"low";L(N),y(2),k.survivalSuccess(),G.generateSparkSound(N);const C=5,T={low:1,medium:2,high:3.5,extreme:6}[t.currentRisk],P=t.streakCount>=50?4:t.streakCount>=25?3:t.streakCount>=10?2:t.streakCount>=5?1.5:1,W=Math.floor(C*T*P),U={basePoints:C,riskMultiplier:T,streakBonus:P,timeBonus:0,totalPoints:W,reason:`–í—ã–∂–∏–≤–∞–Ω–∏–µ (${t.currentRisk} —Ä–∏—Å–∫)`};n(U),S(U.totalPoints,U.reason,"success"),t.streakCount>0&&t.streakCount%5===0&&k.streakAchievement(t.streakCount)}setTimeout(()=>{v(!1),y(1)},200)},[r.isPlaying,t,s,L,n]);return e.jsxs("div",{className:`relative z-30 ${i}`,children:[p&&e.jsx(d.div,{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-20",initial:{opacity:0},animate:{opacity:[0,1,0]},transition:{duration:.5,repeat:1/0},children:e.jsx("div",{className:"bg-red-600/80 text-white px-4 py-2 rounded-lg border-2 border-red-300 font-bold text-sm",children:"‚ö° DANGER! -20 points per click ‚ö°"})}),e.jsxs(d.button,{onClick:F,disabled:!r.isPlaying,className:`relative w-64 h-64 rounded-2xl overflow-hidden bg-gray-800 ${p?"cursor-pointer animate-pulse":"cursor-pointer"}`,style:{opacity:r.isPlaying?1:.5,boxShadow:p?`0 0 ${40*x}px rgba(255, 0, 0, 0.8)`:`0 0 ${20*x}px rgba(255, 107, 53, ${.5*x})`},whileTap:{scale:.95},whileHover:{scale:1.05},animate:{scale:m?.9:p?[1,1.05,1]:1,filter:`brightness(${x}) saturate(${x})`,rotateY:g?[0,180,360]:0},transition:{rotateY:{duration:.6,ease:"easeInOut"},scale:p?{duration:.3,repeat:1/0}:{duration:.1}},children:[p?e.jsx(ht,{active:p,onEnd:M}):e.jsx("img",{src:c,alt:"Tiger Outlet",className:"absolute inset-0 w-full h-full object-cover rounded-2xl",onError:A=>{console.error("Image failed to load:",c),console.error("Error event:",A),console.error("Current window location:",window.location.href),console.error("Trying full path:",`${window.location.origin}${c}`),A.currentTarget.style.display="none"},onLoad:()=>{console.log("Image loaded successfully:",c)}}),p&&e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 bg-red-500/20 rounded-2xl flex items-center justify-center z-10",children:e.jsx("div",{className:"bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold",children:"‚ö° –†–ê–ó–†–Ø–î ‚ö°"})}),e.jsx("div",{className:"absolute inset-0 tiger-stripes opacity-20 mix-blend-overlay"}),e.jsx(d.div,{className:"absolute inset-0 rounded-2xl",animate:{boxShadow:t.warningSignsActive?`0 0 ${30*x}px #FF0000, inset 0 0 ${30*x}px #FF0000`:`0 0 ${15*x}px #FF6B35, inset 0 0 ${15*x}px #FF6B35`},transition:{duration:t.warningSignsActive?.1:.2}}),t.dangerLevel>50&&e.jsx(d.div,{className:"absolute -top-12 left-1/2 transform -translate-x-1/2",initial:{opacity:0,scale:0},animate:{opacity:[.7,1,.7,1],scale:[.8,1.2,.8,1.2]},transition:{duration:1,repeat:1/0,ease:"easeInOut"},children:e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-bold ${t.dangerLevel>80?"bg-red-500 text-white":t.dangerLevel>70?"bg-orange-500 text-white":"bg-yellow-500 text-black"}`,children:t.dangerLevel>80?"üî¥ –ö–†–ò–¢–ò–ß–ù–û":t.dangerLevel>70?"üü† –û–ü–ê–°–ù–û":"üü° –†–ò–°–ö"})}),e.jsx(ot,{isActive:h,intensity:"extreme",onComplete:()=>j(!1)})]}),e.jsx($,{children:f.map(A=>e.jsx(d.div,{className:"absolute w-2 h-2 rounded-full pointer-events-none",style:{backgroundColor:A.color,boxShadow:`0 0 10px ${A.color}`,left:"50%",top:"50%"},initial:{x:0,y:0,scale:0,opacity:1},animate:{x:A.x,y:A.y,scale:[0,1.5,.8,0],opacity:[1,1,.5,0],rotate:[0,180,360]},transition:{duration:A.duration/1e3,ease:"easeOut"}},A.id))}),e.jsx("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2",children:e.jsxs("div",{className:`px-3 py-1 rounded-full text-xs font-bold ${t.currentRisk==="extreme"?"bg-red-500 text-white":t.currentRisk==="high"?"bg-orange-500 text-white":t.currentRisk==="medium"?"bg-yellow-500 text-black":"bg-green-500 text-white"}`,children:[t.currentRisk==="extreme"?"–≠–ö–°–¢–†–ò–ú":t.currentRisk==="high"?"–í–´–°–û–ö–ò–ô":t.currentRisk==="medium"?"–°–†–ï–î–ù–ò–ô":"–ù–ò–ó–ö–ò–ô"," –†–ò–°–ö"]})}),e.jsx(nt,{score:I.score,reason:I.reason,isVisible:I.visible,position:{x:0,y:-32},type:I.type})]})},ht=({active:i,onEnd:a})=>{const[s,t]=z.useState(!1),r=z.useRef(null);z.useEffect(()=>(i?r.current=window.setTimeout(()=>{window.__shockVideoStarted||(console.warn("VideoShockWrapper: fallback to ElectricShockVideo"),t(!0))},400):t(!1),()=>{r.current&&window.clearTimeout(r.current)}),[i]);const l=()=>{window.__shockVideoStarted=!0};return s?e.jsx(mt,{isActive:i,onComplete:()=>{a()},intensity:"high"}):e.jsx(dt,{isActive:i,onComplete:()=>{l(),a()}})},gt=({className:i="",disabled:a=!1})=>{const{player:s,singleMode:t,aiElectrician:r,damageAIElectrician:l,gameState:n}=D(),[o,c]=u.useState(!1),[g,f]=u.useState(0),[b,m]=u.useState(!1),v=10,x=n.isPlaying&&t.aiElectricianActive&&r.isActive&&!a&&g===0&&s.volts>=v,y=async()=>{if(!x||o)return;c(!0),m(!0),k.electricShock(),G.generateShockSound();const h=s.volts,j=10,p=Math.floor(h/10),E=j+p;console.log("Counter attack!",{playerVoltage:h,baseDamage:j,voltageDamage:p,totalDamage:E}),l("energy",E,!0),h>=200?l("equipment",Math.random()*15+10,!0):h>=100&&Math.random()<.5&&l("equipment",Math.random()*10+5,!0);const I=D.getState();D.setState({player:{...I.player,volts:0}});const w=Math.max(3,Math.min(15,Math.floor(h/50)));f(w);const S=setInterval(()=>{f(M=>M<=1?(clearInterval(S),0):M-1)},1e3);setTimeout(()=>{m(!1),c(!1)},1e3)};return e.jsxs("div",{className:`relative ${i}`,children:[e.jsx($,{children:b&&e.jsx(d.div,{className:"absolute inset-0 pointer-events-none z-10",initial:{scale:0,rotate:0},animate:{scale:[0,1.5,1],rotate:[0,180,360],opacity:[0,1,0]},exit:{opacity:0},transition:{duration:1},children:e.jsx("div",{className:"w-full h-full bg-yellow-400 rounded-full shadow-lg flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"‚ö°"})})})}),e.jsxs(d.button,{onClick:y,disabled:!x||o,className:`
          relative w-16 h-16 rounded-full border-2 transition-all duration-200
          ${x?"bg-gradient-to-br from-yellow-400 to-orange-500 border-yellow-300 shadow-lg hover:shadow-xl cursor-pointer":"bg-gray-600 border-gray-500 cursor-not-allowed opacity-50"}
          ${g>0?"animate-pulse":""}
        `,whileTap:x?{scale:.9}:{},whileHover:x?{scale:1.1,rotate:5}:{},style:{boxShadow:x?"0 0 20px rgba(255, 193, 7, 0.6)":"none"},children:[e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:g>0?e.jsx("span",{className:"text-white font-bold text-sm",children:g}):e.jsx("span",{className:"text-2xl",children:o?"üí•":s.level>=5?"‚ö°":"ü¶∑"})}),x&&e.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2",children:e.jsxs("div",{className:"bg-black/80 text-white text-xs px-1 py-0.5 rounded",children:[s.volts,"‚ö° ‚Üí 0‚ö°"]})})]}),!x&&!o&&e.jsx("div",{className:"absolute -top-12 left-1/2 transform -translate-x-1/2 pointer-events-none",children:e.jsx("div",{className:"bg-black/80 text-white text-xs px-2 py-1 rounded whitespace-nowrap",children:s.volts<v?`–ù—É–∂–Ω–æ ${v-s.volts} –≤–æ–ª—å—Ç`:n.isPlaying?t.aiElectricianActive?"–ö–æ–Ω—Ç—Ä–∞—Ç–∞–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞":"–ò–ò —ç–ª–µ–∫—Ç—Ä–∏–∫ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω":"–ò–≥—Ä–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞"})})]})},ft=({className:i=""})=>{const{isAuthenticated:a}=Q(),{isOnline:s}=it(),r=s?a?{text:"–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É",color:"text-green-400",icon:"‚úÖ",bgColor:"bg-green-500/10"}:{text:"–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ä–µ–∂–∏–º",color:"text-yellow-400",icon:"‚ö†Ô∏è",bgColor:"bg-yellow-500/10"}:{text:"–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è",color:"text-red-400",icon:"‚ùå",bgColor:"bg-red-500/10"};return e.jsx(d.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:`glass-effect p-2 rounded-lg ${r.bgColor} ${i}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:r.icon}),e.jsx("span",{className:`text-xs font-medium ${r.color}`,children:r.text})]})})},pt=({isOpen:i,onClose:a})=>{var j;const{player:s,getShopItems:t,buyProtectionItem:r,getTotalProtection:l}=D(),[n,o]=u.useState("gloves"),[c,g]=u.useState(null);u.useEffect(()=>{if(!i)return;const p=E=>{E.key==="Escape"&&a()};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[i,a]);const f=t(),b=l(),m=[{key:"gloves",name:"–ü–µ—Ä—á–∞—Ç–∫–∏",icon:"üß§"},{key:"boots",name:"–°–∞–ø–æ–≥–∏",icon:"üë¢"},{key:"suit",name:"–ö–æ—Å—Ç—é–º",icon:"ü•Ω"},{key:"helmet",name:"–ö–∞—Å–∫–∞",icon:"‚õëÔ∏è"}],v=f.filter(p=>p.type===n),x=p=>{r(p.type,p.level)&&(g(p.id),setTimeout(()=>g(null),1e3))},y=p=>s.volts>=p,h=p=>s.protection[p.type].level>=p.level;return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:a,role:"button","aria-label":"–ó–∞–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω",children:e.jsxs(d.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"bg-gray-900 border-2 border-yellow-400 rounded-lg p-6 max-w-4xl w-full max-h-[80vh] overflow-y-auto",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400",children:"–ú–∞–≥–∞–∑–∏–Ω –∑–∞—â–∏—Ç—ã"}),e.jsxs("p",{className:"text-gray-300",children:["–í–æ–ª—å—Ç—ã: ",e.jsxs("span",{className:"text-yellow-400 font-bold",children:[s.volts,"V"]})," | –û–±—â–∞—è –∑–∞—â–∏—Ç–∞: ",e.jsxs("span",{className:"text-green-400 font-bold",children:[b.toFixed(1),"%"]})]})]}),e.jsx("button",{onClick:a,className:"text-red-400 hover:text-red-300 text-2xl font-bold",children:"‚úï"})]}),e.jsx("div",{className:"flex mb-6 bg-gray-800 rounded-lg p-1",children:m.map(p=>e.jsxs("button",{onClick:()=>o(p.key),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all ${n===p.key?"bg-yellow-400 text-black":"text-gray-300 hover:text-white hover:bg-gray-700"}`,children:[e.jsx("span",{className:"mr-2",children:p.icon}),p.name]},p.key))}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-800 rounded-lg",children:[e.jsxs("h3",{className:"text-lg font-bold text-yellow-400 mb-2",children:["–¢–µ–∫—É—â–∞—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞: ",(j=m.find(p=>p.key===n))==null?void 0:j.name]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-sm",children:[e.jsx("div",{className:"text-gray-400",children:"–£—Ä–æ–≤–µ–Ω—å:"}),e.jsx("div",{className:"text-white",children:s.protection[n].level||"–ù–µ—Ç"}),e.jsx("div",{className:"text-gray-400",children:"–ó–∞—â–∏—Ç–∞:"}),e.jsxs("div",{className:"text-green-400",children:[s.protection[n].protection,"%"]}),e.jsx("div",{className:"text-gray-400",children:"–ü—Ä–æ—á–Ω–æ—Å—Ç—å:"}),e.jsxs("div",{className:"text-blue-400",children:[s.protection[n].durability,"/",s.protection[n].maxDurability]})]})]}),e.jsx("div",{className:"grid gap-4",children:v.map(p=>{const E=h(p),I=y(p.price),w=c===p.id;return e.jsx(d.div,{className:`p-4 rounded-lg border-2 transition-all ${E?"border-green-500 bg-green-900 bg-opacity-30":I?"border-yellow-400 bg-gray-800":"border-gray-600 bg-gray-800 opacity-60"}`,whileHover:!E&&I?{scale:1.02}:{},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-2xl",children:p.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-white",children:p.name}),e.jsx("p",{className:"text-gray-300 text-sm",children:p.description})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"–£—Ä–æ–≤–µ–Ω—å: "}),e.jsx("span",{className:"text-yellow-400 font-bold",children:p.level})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"–ó–∞—â–∏—Ç–∞: "}),e.jsxs("span",{className:"text-green-400 font-bold",children:[p.protection,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"–ü—Ä–æ—á–Ω–æ—Å—Ç—å: "}),e.jsx("span",{className:"text-blue-400 font-bold",children:p.durability})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"–¶–µ–Ω–∞: "}),e.jsxs("span",{className:"text-yellow-400 font-bold",children:[p.price,"V"]})]})]})]}),e.jsx("div",{className:"ml-4",children:e.jsx($,{children:E?e.jsx("div",{className:"px-4 py-2 bg-green-500 text-white rounded-lg font-bold",children:"–ö—É–ø–ª–µ–Ω–æ"}):e.jsx(d.button,{onClick:()=>x(p),disabled:!I,className:`px-4 py-2 rounded-lg font-bold transition-all ${I?"bg-yellow-400 text-black hover:bg-yellow-300":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,whileTap:I?{scale:.95}:{},animate:w?{scale:[1,1.2,1],backgroundColor:["#fbbf24","#10b981","#fbbf24"]}:{},children:I?"–ö—É–ø–∏—Ç—å":"–ù–µ—Ç –≤–æ–ª—å—Ç"})})})]})},p.id)})}),e.jsx("div",{className:"mt-6 p-4 bg-blue-900 bg-opacity-30 border border-blue-400 rounded-lg",children:e.jsxs("p",{className:"text-blue-300 text-sm",children:["üí° ",e.jsx("strong",{children:"–°–æ–≤–µ—Ç:"})," –ó–∞—â–∏—Ç–Ω–∞—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞ –∏–∑–Ω–∞—à–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —É–¥–∞—Ä–∞—Ö —Ç–æ–∫–æ–º. –ë–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞ —Å–ª—É–∂–∏—Ç –¥–æ–ª—å—à–µ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ª—É—á—à—É—é –∑–∞—â–∏—Ç—É."]})}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:a,className:"px-5 py-2 rounded-md font-bold bg-gray-700 text-white hover:bg-gray-600 border border-gray-500",children:"–ó–∞–∫—Ä—ã—Ç—å"})})]})}):null},vt=()=>{const{player:i,gameState:a,singleMode:s,aiElectrician:t,repairAIElectrician:r,getTotalProtection:l}=D(),[n,o]=u.useState(!1);return e.jsxs("div",{className:"fixed top-0 left-0 right-0 z-10 bg-black/20 backdrop-blur-sm border-b border-white/10 pointer-events-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(d.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–°–ß–Å–¢"}),e.jsx("div",{className:"text-xl font-bold text-accent-lime",children:a.score.toLocaleString()})]}),e.jsxs(d.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–í–û–õ–¨–¢–´"}),e.jsxs("div",{className:"text-xl font-bold text-primary-orange",children:[i.volts.toLocaleString(),"‚ö°"]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs(d.div,{className:"glass-effect px-4 py-2",animate:{scale:s.streakCount>0?[1,1.1,1]:1,boxShadow:s.streakCount>=5?"0 0 20px #E8FF00":"0 0 10px rgba(255,255,255,0.2)"},transition:{duration:.3},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–°–ï–†–ò–Ø"}),e.jsx("div",{className:`text-xl font-bold ${s.streakCount>=25?"text-red-400":s.streakCount>=10?"text-orange-400":s.streakCount>=5?"text-yellow-400":"text-white"}`,children:s.streakCount})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(d.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},animate:{opacity:i.luckIndicatorHidden&&Date.now()<i.luckHiddenUntil?.3:1},transition:{duration:.3},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–£–î–ê–ß–ê"}),e.jsx("div",{className:`text-sm font-bold ${i.luckIndicatorHidden&&Date.now()<i.luckHiddenUntil?"text-gray-500":i.luckCoefficient>=70?"text-green-400":i.luckCoefficient>=50?"text-yellow-400":i.luckCoefficient>=30?"text-orange-400":"text-red-400"}`,children:i.luckIndicatorHidden&&Date.now()<i.luckHiddenUntil?"???":`${i.luckCoefficient}%`})]}),e.jsxs(d.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–°–õ–û–ñ–ù–û–°–¢–¨"}),e.jsx("div",{className:`text-sm font-bold ${s.difficulty==="extreme"?"text-red-400":s.difficulty==="hard"?"text-orange-400":s.difficulty==="medium"?"text-yellow-400":"text-green-400"}`,children:s.difficulty==="extreme"?"–≠–ö–°–¢–†–ò–ú":s.difficulty==="hard"?"–°–õ–û–ñ–ù–´–ô":s.difficulty==="medium"?"–°–†–ï–î–ù–ò–ô":"–õ–Å–ì–ö–ò–ô"})]}),e.jsxs(d.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},animate:{boxShadow:s.dangerLevel>80?"0 0 20px #ff4444":s.dangerLevel>60?"0 0 15px #ff8800":s.dangerLevel>40?"0 0 10px #ffaa00":"0 0 5px rgba(255,255,255,0.2)"},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–û–ü–ê–°–ù–û–°–¢–¨"}),e.jsxs("div",{className:`text-sm font-bold ${s.dangerLevel>80?"text-red-400":s.dangerLevel>60?"text-orange-400":s.dangerLevel>40?"text-yellow-400":"text-green-400"}`,children:[s.dangerLevel,"%"]})]}),e.jsxs(d.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},animate:{boxShadow:s.isDischarging?"0 0 20px #ff0000":s.warningSignsActive?"0 0 15px #ff8800":s.aiElectricianActive?"0 0 10px #00ffff":"0 0 5px rgba(255,255,255,0.2)",scale:s.isDischarging?[1,1.05,1]:1},transition:{duration:.3,repeat:s.isDischarging?1/0:0},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–ò–ò –≠–õ–ï–ö–¢–†–ò–ö"}),e.jsx("div",{className:`text-sm font-bold ${s.isDischarging?"text-red-400":s.warningSignsActive?"text-orange-400":s.aiElectricianActive?"text-cyan-400":"text-gray-500"}`,children:s.isDischarging?"‚ö° –†–ê–ó–†–Ø–î!":s.warningSignsActive?"‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!":s.aiElectricianActive?"ü§ñ –ê–ö–¢–ò–í–ï–ù":"üò¥ –°–ü–ò–¢"})]}),s.aiElectricianActive&&e.jsxs(d.div,{className:"glass-effect px-4 py-2 min-w-[120px]",whileHover:{scale:1.05},animate:{boxShadow:t.energy<20?"0 0 15px #ff4444":t.energy<50?"0 0 10px #ff8800":"0 0 5px rgba(255,255,255,0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–≠–¢–ê–ü"}),e.jsx("div",{className:"text-sm font-bold text-cyan-300",children:s.stage||1})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–û–ß–ö–ò –ò–ò"}),e.jsxs("div",{className:"text-sm font-bold text-cyan-200",children:[Math.max(0,Math.floor(t.points??0))," / ",Math.max(1,Math.floor(t.maxPoints??0))]})]})]}),e.jsx("div",{className:"text-xs text-gray-300",children:"–≠–ù–ï–†–ì–ò–Ø"}),e.jsxs("div",{className:`text-sm font-bold ${t.energy<20?"text-red-400":t.energy<50?"text-orange-400":"text-green-400"}`,children:[Math.round(t.energy),"%"]}),e.jsx("div",{className:"text-xs text-gray-300 mt-1",children:"–£–°–¢–ê–õ–û–°–¢–¨"}),e.jsxs("div",{className:`text-xs font-bold ${t.fatigueLevel>=8?"text-red-400":t.fatigueLevel>=5?"text-orange-400":t.fatigueLevel>=2?"text-yellow-400":"text-green-400"}`,children:[Math.floor(t.fatigueLevel),"/10",t.fatigueLevel>=8&&" üíé",t.fatigueLevel>=5&&t.fatigueLevel<8&&" ü•á",t.fatigueLevel>=2&&t.fatigueLevel<5&&" ü•à"]})]}),e.jsxs(d.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–ù–ê–ñ–ê–¢–ò–ô"}),e.jsx("div",{className:"text-lg font-bold text-accent-blue",children:i.totalClicks})]}),e.jsx(ft,{})]})]}),s.warningSignsActive&&e.jsx(d.div,{className:"bg-yellow-500/80 text-black px-4 py-2 text-center font-bold",initial:{opacity:0,y:-20},animate:{opacity:[0,1,.7,1,.7,1],y:0},transition:{duration:.5},children:"‚ö†Ô∏è –û–ü–ê–°–ù–û–°–¢–¨! –í–´–°–û–ö–ò–ô –†–ò–°–ö –†–ê–ó–†–Ø–î–ê! ‚ö†Ô∏è"}),s.dangerLevel>30&&e.jsxs(d.div,{className:`px-4 py-1 text-center text-xs font-semibold ${s.dangerLevel>70?"bg-red-500/60 text-white":s.dangerLevel>50?"bg-orange-500/60 text-white":"bg-yellow-500/60 text-black"}`,initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:["üî• –£–†–û–í–ï–ù–¨ –û–ü–ê–°–ù–û–°–¢–ò: ",s.dangerLevel,"% üî•"]}),s.aiElectricianActive&&e.jsx(d.div,{className:"bg-black/40 border-t border-white/10 px-4 py-3",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-cyan-400 font-bold",children:["‚ö° ",t.name]}),e.jsx("div",{className:`text-xs ${t.mood==="confident"?"text-green-400":t.mood==="frustrated"?"text-orange-400":t.mood==="tired"?"text-yellow-400":t.mood==="broken"?"text-red-400":"text-red-600"}`,children:t.lastMessage})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-1",children:"–≠–ù–ï–†–ì–ò–Ø"}),e.jsx("div",{className:"w-20 h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx(d.div,{className:`h-full rounded-full ${t.energy>60?"bg-green-500":t.energy>30?"bg-yellow-500":"bg-red-500"}`,initial:{width:0},animate:{width:`${t.energy}%`},transition:{duration:.5}})}),e.jsxs("div",{className:"text-xs text-white",children:[Math.round(t.energy),"%"]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-1",children:"–ù–ê–ü–†–Ø–ñ–ï–ù–ò–ï"}),e.jsx("div",{className:"w-20 h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx(d.div,{className:`h-full rounded-full ${t.voltage>300?"bg-red-500":t.voltage>200?"bg-orange-500":t.voltage>100?"bg-yellow-500":"bg-blue-500"}`,initial:{width:0},animate:{width:`${t.voltage/t.maxVoltage*100}%`,boxShadow:t.voltage>=100?"0 0 10px rgba(255, 0, 0, 0.8)":"none"},transition:{duration:.5}})}),e.jsxs("div",{className:`text-xs font-bold ${t.voltage>=100?"text-red-400":"text-white"}`,children:[Math.round(t.voltage),"‚ö°"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–ë–ê–¢"}),e.jsxs("div",{className:`text-xs font-bold ${t.equipment.battery>70?"text-green-400":t.equipment.battery>30?"text-yellow-400":"text-red-400"}`,children:[Math.round(t.equipment.battery),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–ö–û–ù"}),e.jsxs("div",{className:`text-xs font-bold ${t.equipment.capacitor>70?"text-green-400":t.equipment.capacitor>30?"text-yellow-400":"text-red-400"}`,children:[Math.round(t.equipment.capacitor),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–ü–†–í"}),e.jsxs("div",{className:`text-xs font-bold ${t.equipment.wires>70?"text-green-400":t.equipment.wires>30?"text-yellow-400":"text-red-400"}`,children:[Math.round(t.equipment.wires),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–ì–ï–ù"}),e.jsxs("div",{className:`text-xs font-bold ${t.equipment.generator>70?"text-green-400":t.equipment.generator>30?"text-yellow-400":"text-red-400"}`,children:[Math.round(t.equipment.generator),"%"]})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–≠–§–§–ï–ö–¢"}),e.jsxs("div",{className:`text-sm font-bold ${t.workingEfficiency>80?"text-green-400":t.workingEfficiency>50?"text-yellow-400":"text-red-400"}`,children:[Math.round(t.workingEfficiency),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–£–°–ü–ï–•/–ù–ï–£–î–ê–ß"}),e.jsx("div",{className:"text-xs text-green-400",children:t.successfulDischarges}),e.jsx("div",{className:"text-xs text-red-400",children:t.failuresCount})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:`text-sm font-bold ${t.canWork?"text-green-400":"text-red-400"}`,children:t.canWork?"‚úÖ –†–ê–ë–û–¢–ê–ï–¢":"‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢"})})]}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsx(d.button,{className:"glass-effect px-3 py-1 text-xs text-green-400 hover:text-green-300 disabled:text-gray-500 disabled:cursor-not-allowed",onClick:()=>{i.volts>=50&&(r("energy"),D.getState().updatePlayerStats({volts:i.volts-50}))},disabled:i.volts<50||t.energy>=90,whileHover:{scale:1.05},whileTap:{scale:.95},children:"‚ö° –ó–∞—Ä—è–¥–∏—Ç—å (50‚ö°)"}),e.jsx(d.button,{className:"glass-effect px-3 py-1 text-xs text-blue-400 hover:text-blue-300 disabled:text-gray-500 disabled:cursor-not-allowed",onClick:()=>{i.volts>=100&&(r("equipment"),D.getState().updatePlayerStats({volts:i.volts-100}))},disabled:i.volts<100||Object.values(t.equipment).every(c=>c>=95),whileHover:{scale:1.05},whileTap:{scale:.95},children:"üîß –ü–æ—á–∏–Ω–∏—Ç—å (100‚ö°)"})]})]})}),e.jsx(d.button,{onClick:()=>o(!0),className:"fixed bottom-20 left-4 glass-effect px-4 py-2 text-yellow-400 hover:text-yellow-300 z-40",whileHover:{scale:1.1},whileTap:{scale:.95},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"üõ°Ô∏è"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold",children:"–ó–ê–©–ò–¢–ê"}),e.jsxs("div",{className:"text-xs",children:[l().toFixed(1),"%"]})]})]})}),e.jsx(pt,{isOpen:n,onClose:()=>o(!1)})]})},yt=({isActive:i,intensity:a="medium",duration:s=500,onComplete:t})=>{const r={low:5,medium:10,high:15,extreme:20}[a];return u.useEffect(()=>{if(i&&t){const l=setTimeout(t,s);return()=>clearTimeout(l)}},[i,s,t]),i?e.jsx(d.div,{className:"fixed inset-0 pointer-events-none z-50",initial:{x:0,y:0},animate:{x:[0,-r,r,-r,r,0],y:[0,r,-r,r,-r,0]},transition:{duration:s/1e3,times:[0,.1,.2,.3,.4,1],ease:"easeInOut"},children:e.jsx(d.div,{className:"absolute inset-0 bg-red-500 mix-blend-multiply",initial:{opacity:0},animate:{opacity:[0,.3,0,.2,0]},transition:{duration:s/1e3}})}):null},bt=()=>{const{gameState:i,singleMode:a,endGame:s,player:t,submitGameToServer:r}=D(),{isAuthenticated:l}=Q(),[n,o]=u.useState(0),[c,g]=u.useState(!1),[f,b]=u.useState(!1),[m,v]=u.useState(!1),x=u.useCallback(()=>{v(!0),setTimeout(()=>{v(!1)},600)},[]);u.useEffect(()=>{if(!i.isPlaying)return;const j=setInterval(()=>{o(p=>p+1)},1e3);return()=>clearInterval(j)},[i.isPlaying]),u.useEffect(()=>{n>=600&&g(!0)},[n]);const y=async()=>{if(g(!1),o(0),l&&i.score>0){b(!0);try{const j=D.getState();j.gameState.gameTime=n*1e3;const p=await r();p.success?console.log("‚úÖ –ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä"):console.warn("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä:",p.error)}catch(j){console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–≥—Ä—ã:",j)}finally{b(!1)}}s()},h=j=>{const p=Math.floor(j/60),E=j%60;return`${p.toString().padStart(2,"0")}:${E.toString().padStart(2,"0")}`};return c?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background-dark to-background-darker",children:e.jsxs(d.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"glass-effect p-8 text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold text-primary-orange mb-4",children:"–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!"}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"–í—Ä–µ–º—è –∏–≥—Ä—ã:"}),e.jsx("span",{className:"font-bold",children:h(n)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç:"}),e.jsx("span",{className:"font-bold text-accent-lime",children:i.score.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"–ü–æ–ª—É—á–µ–Ω–æ –≤–æ–ª—å—Ç:"}),e.jsxs("span",{className:"font-bold text-primary-orange",children:[i.score,"‚ö°"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"–í—Å–µ–≥–æ –Ω–∞–∂–∞—Ç–∏–π:"}),e.jsx("span",{className:"font-bold text-accent-blue",children:t.totalClicks})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"–õ—É—á—à–∞—è —Å–µ—Ä–∏—è:"}),e.jsx("span",{className:"font-bold text-yellow-400",children:t.streak})]})]}),l&&i.score>0&&e.jsx("div",{className:"mb-4 text-center",children:f?e.jsxs("div",{className:"text-blue-400 text-sm",children:[e.jsx("span",{className:"inline-block animate-spin mr-2",children:"‚è≥"}),"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤..."]}):e.jsx("div",{className:"text-green-400 text-sm",children:"‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä"})}),!l&&i.score>0&&e.jsx("div",{className:"mb-4 text-center text-yellow-400 text-sm",children:"‚ö†Ô∏è –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ"}),e.jsx(d.button,{onClick:y,disabled:f,className:"w-full glass-effect p-3 rounded-xl hover:bg-primary-orange/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",whileHover:{scale:f?1:1.05},whileTap:{scale:f?1:.95},children:e.jsx("span",{className:"font-bold",children:f?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...":"–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx(yt,{isActive:m}),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background-dark to-background-darker relative",children:[e.jsx(vt,{}),e.jsxs("div",{className:`flex flex-col items-center justify-center min-h-screen pb-8 ${a.aiElectricianActive?"pt-44 md:pt-48":"pt-24"}`,children:[e.jsx(d.div,{className:"glass-effect px-6 py-3 mb-8",animate:{scale:n%10===0&&n>0?[1,1.1,1]:1},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–í–†–ï–ú–Ø –ò–ì–†–´"}),e.jsx("div",{className:"text-2xl font-bold text-white font-mono",children:h(n)})]})}),e.jsxs("div",{className:"relative flex items-center justify-center space-x-8 mb-8 z-20",children:[e.jsx(gt,{className:"order-1"}),e.jsx(ut,{className:"order-2",onShock:x}),e.jsx("div",{className:"w-16 h-16 order-3 opacity-0"})]}),e.jsx("div",{className:"flex space-x-4 text-center",children:e.jsxs(d.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"–ü–û–°–õ–ï–î–ù–ò–ô –†–ò–°–ö"}),e.jsx("div",{className:`text-sm font-bold ${a.currentRisk==="extreme"?"text-red-400":a.currentRisk==="high"?"text-orange-400":a.currentRisk==="medium"?"text-yellow-400":"text-green-400"}`,children:a.currentRisk==="extreme"?"–≠–ö–°–¢–†–ò–ú":a.currentRisk==="high"?"–í–´–°–û–ö–ò–ô":a.currentRisk==="medium"?"–°–†–ï–î–ù–ò–ô":"–ù–ò–ó–ö–ò–ô"})]})}),e.jsx(d.button,{onClick:y,className:"mt-8 glass-effect px-6 py-3 rounded-xl hover:bg-red-500/20 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx("span",{className:"text-red-300 font-bold",children:"–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É"})})]}),e.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden",children:e.jsx(d.div,{className:"absolute inset-0 opacity-10",animate:{backgroundPosition:["0% 0%","100% 100%"]},transition:{duration:20,repeat:1/0,ease:"linear"},style:{backgroundImage:`
              linear-gradient(0deg, transparent 24%, rgba(255, 107, 53, 0.05) 25%, rgba(255, 107, 53, 0.05) 26%, transparent 27%, transparent 74%, rgba(255, 107, 53, 0.05) 75%, rgba(255, 107, 53, 0.05) 76%, transparent 77%, transparent),
              linear-gradient(90deg, transparent 24%, rgba(255, 107, 53, 0.05) 25%, rgba(255, 107, 53, 0.05) 26%, transparent 27%, transparent 74%, rgba(255, 107, 53, 0.05) 75%, rgba(255, 107, 53, 0.05) 76%, transparent 77%, transparent)
            `,backgroundSize:"50px 50px"}})})]})]})},jt=()=>{const i=()=>{k.light(),D.getState().endGame()};return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-background-dark to-background-darker",children:[e.jsxs(d.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-primary-orange mb-4",children:"üéÆ –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º"}),e.jsx("p",{className:"text-xl text-gray-300 mb-8",children:"–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –±—É–¥—É—Ç —ç–ø–∏—á–µ—Å–∫–∏–µ –¥—É—ç–ª–∏!"})]}),e.jsxs(d.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.2},className:"glass-effect p-8 rounded-xl text-center max-w-md",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üöß"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–º–∏ –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Ä–µ–∂–∏–º–∞–º–∏:"}),e.jsxs("div",{className:"space-y-3 text-left mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-purple-400",children:"‚öîÔ∏è"}),e.jsx("span",{className:"text-gray-300",children:"–î—É—ç–ª–∏ 1v1 –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-blue-400",children:"üèÜ"}),e.jsx("span",{className:"text-gray-300",children:"–¢—É—Ä–Ω–∏—Ä—ã –¥–æ 8 –∏–≥—Ä–æ–∫–æ–≤"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-green-400",children:"ü§ù"}),e.jsx("span",{className:"text-gray-300",children:"–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ–∂–∏–º—ã"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-yellow-400",children:"üìä"}),e.jsx("span",{className:"text-gray-300",children:"–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤"})]})]}),e.jsx(d.button,{onClick:i,className:"w-full glass-effect p-3 rounded-xl hover:bg-orange-500/20 transition-colors border border-orange-400/30",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsx("span",{className:"text-lg font-semibold text-orange-400",children:"‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"})})]}),e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4},className:"mt-8 text-center text-gray-400 text-sm",children:e.jsx("p",{children:"üîî –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –æ –∑–∞–ø—É—Å–∫–µ –ø–µ—Ä–≤—ã–º–∏!"})})]})},wt=()=>{const{player:i}=D(),[a,s]=u.useState(!1),[t,r]=u.useState(null),[l,n]=u.useState(null),[o,c]=u.useState([]),g=u.useRef(null),f=u.useRef([]),b=u.useRef(null),m=u.useRef(0),v=u.useCallback(()=>{console.log("üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –¥—É—ç–ª–µ–π..."),setTimeout(()=>{s(!0),console.log("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É –¥—É—ç–ª–µ–π"),g.current=setInterval(()=>{if(f.current.length>0){const w=f.current.shift();w&&c(S=>[...S,w])}},100)},1e3)},[]),x=u.useCallback(()=>{g.current&&(clearInterval(g.current),g.current=null),b.current&&(clearInterval(b.current),b.current=null),s(!1),r(null),n(null),c([]),console.log("üîå –û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –¥—É—ç–ª–µ–π")},[]),y=u.useCallback(async()=>{if(!a)throw new Error("–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É");return console.log("üîç –ü–æ–∏—Å–∫ –¥—É—ç–ª–∏..."),new Promise(w=>{setTimeout(()=>{const S={id:`duel_${Date.now()}`,players:[i.id,"bot_opponent"],status:"waiting",createdAt:Date.now()},M={id:"bot_opponent",name:`–°–æ–ø–µ—Ä–Ω–∏–∫ ${Math.floor(Math.random()*1e3)}`,level:Math.max(1,i.level-2+Math.floor(Math.random()*5)),volts:Math.floor(Math.random()*500)+100,isReady:!1,score:0,streak:0};r(S),n(M),console.log("‚úÖ –î—É—ç–ª—å –Ω–∞–π–¥–µ–Ω–∞!",S),w(S)},2e3+Math.random()*3e3)})},[a,i.id,i.level]),h=u.useCallback(w=>{if(!a||!t){console.warn("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: –Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–ª–∏ –∫–æ–º–Ω–∞—Ç—ã");return}const S={...w,timestamp:Date.now()};if(console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:",S),w.type==="player_ready"&&setTimeout(()=>{f.current.push({type:"player_ready",playerId:"bot_opponent",timestamp:Date.now()})},1e3+Math.random()*2e3),w.type==="player_action"){const M=Date.now();M-m.current>2e3&&Math.random()<.3&&(m.current=M,setTimeout(()=>{Math.random()<.25?f.current.push({type:"player_shocked",playerId:"bot_opponent",data:{damage:20+Math.random()*30},timestamp:Date.now()}):f.current.push({type:"player_action",playerId:"bot_opponent",data:{points:Math.floor(Math.random()*50)+15,volts:Math.floor(Math.random()*30)+10},timestamp:Date.now()})},800+Math.random()*1500))}},[a,t]),j=u.useCallback(()=>{h({type:"player_ready",playerId:i.id}),setTimeout(()=>{b.current=setInterval(()=>{const w=Date.now();Math.random()<.4&&(Math.random()<.25?f.current.push({type:"player_shocked",playerId:"bot_opponent",data:{damage:20+Math.random()*30},timestamp:w}):f.current.push({type:"player_action",playerId:"bot_opponent",data:{points:Math.floor(Math.random()*50)+15,volts:Math.floor(Math.random()*30)+10},timestamp:w}))},2e3+Math.random()*1500)},3e3)},[h,i.id]),p=u.useCallback((w,S)=>{h({type:"player_action",playerId:i.id,data:{points:w,volts:S}})},[h,i.id]),E=u.useCallback(w=>{h({type:"player_shocked",playerId:i.id,data:{damage:w}})},[h,i.id]),I=u.useCallback(()=>{t&&h({type:"game_end",playerId:i.id,data:{reason:"left"}}),b.current&&(clearInterval(b.current),b.current=null),r(null),n(null),c([])},[t,h,i.id]);return u.useEffect(()=>()=>{x()},[x]),{isConnected:a,currentRoom:t,opponent:l,messages:o,connect:v,disconnect:x,findDuel:y,setReady:j,sendPlayerAction:p,sendPlayerShocked:E,leaveDuel:I,setOpponent:n}},Nt=()=>{const{player:i,endGame:a}=D(),{isConnected:s,currentRoom:t,opponent:r,messages:l,connect:n,disconnect:o,findDuel:c,setReady:g,sendPlayerAction:f,sendPlayerShocked:b,leaveDuel:m,setOpponent:v}=wt(),[x,y]=u.useState({status:"connecting",timeLeft:60,winner:null,roundNumber:1,maxRounds:3}),[h,j]=u.useState({id:i.id,name:i.name,volts:i.volts,level:i.level,isReady:!1,isAlive:!0,score:0,streak:0}),[p,E]=u.useState(0),[I,w]=u.useState(0);u.useEffect(()=>(n(),()=>{o()}),[n,o]),u.useEffect(()=>{s&&x.status==="connecting"&&(y(N=>({...N,status:"searching"})),c().then(()=>{y(N=>({...N,status:"found"})),k.medium()}))},[s,x.status,c]),u.useEffect(()=>{const N=l[l.length-1];if(N)switch(N.type){case"player_ready":N.playerId!==i.id&&v(C=>C?{...C,isReady:!0}:null);break;case"player_action":if(N.playerId!==i.id&&r){const{points:C,volts:T}=N.data;v(P=>P?{...P,score:P.score+C,volts:P.volts+T,streak:P.streak+1}:null)}break;case"player_shocked":if(N.playerId!==i.id&&r){const{damage:C}=N.data;v(T=>T?{...T,volts:Math.max(0,T.volts-C),streak:0}:null)}break;case"game_start":y(C=>({...C,status:"countdown"})),E(3);break;case"game_end":y(C=>({...C,status:"finished"}));break}},[l,i.id,r,v]),u.useEffect(()=>{x.status==="found"&&h.isReady&&(r!=null&&r.isReady)&&(y(N=>({...N,status:"countdown"})),E(3))},[x.status,h.isReady,r==null?void 0:r.isReady]),u.useEffect(()=>{if(x.status==="countdown"&&p>0){const N=setTimeout(()=>{E(C=>C-1),k.light()},1e3);return()=>clearTimeout(N)}else x.status==="countdown"&&p===0&&(y(N=>({...N,status:"playing"})),w(x.timeLeft),k.heavy())},[x.status,p,x.timeLeft]),u.useEffect(()=>{if(x.status==="playing"&&I>0){const N=setTimeout(()=>{w(C=>C-1)},1e3);return()=>clearTimeout(N)}else if(x.status==="playing"&&I===0){const N=h.score>((r==null?void 0:r.score)||0)?h.id:((r==null?void 0:r.score)||0)>h.score?r==null?void 0:r.id:null;y(C=>({...C,status:"finished",winner:N}))}},[x.status,I,h.score,r==null?void 0:r.score]);const S=()=>{j(N=>({...N,isReady:!0})),g(),k.medium()},M=u.useCallback(()=>{if(x.status!=="playing")return;const N=Math.floor(Math.random()*80)+20;Math.random()<.25?(j(P=>({...P,volts:Math.max(0,P.volts-30),streak:0})),b(30),k.heavy()):(j(T=>({...T,score:T.score+N,volts:T.volts+N,streak:T.streak+1})),f(N,N),k.light())},[x.status,f,b]),L=()=>{k.light(),m(),a()},F=()=>{switch(x.status){case"connecting":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...";case"searching":return"–ü–æ–∏—Å–∫ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...";case"found":return"–°–æ–ø–µ—Ä–Ω–∏–∫ –Ω–∞–π–¥–µ–Ω!";case"ready":return"–ü—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å!";case"countdown":return`–ù–∞—á–∏–Ω–∞–µ–º —á–µ—Ä–µ–∑ ${p}`;case"playing":return`–û—Å—Ç–∞–ª–æ—Å—å: ${I}—Å`;case"finished":return x.winner?x.winner===h.id?"–ü–æ–±–µ–¥–∞!":"–ü–æ—Ä–∞–∂–µ–Ω–∏–µ":"–ù–∏—á—å—è!";default:return""}},A=()=>s?t?"üü¢ –í –¥—É—ç–ª–∏":"üü° –ü–æ–¥–∫–ª—é—á–µ–Ω":"üî¥ –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background-dark to-background-darker",children:[e.jsx("div",{className:"bg-black/40 border-b border-white/10 p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:L,className:"text-gray-400 hover:text-white transition-colors",children:"‚Üê –ù–∞–∑–∞–¥"}),e.jsx("h1",{className:"text-xl font-bold text-primary-orange",children:"‚öîÔ∏è –î–£–≠–õ–¨ REAL-TIME"}),e.jsx("div",{className:"text-sm text-gray-400",children:A()})]})}),e.jsxs("div",{className:"bg-black/30 p-4 text-center",children:[e.jsx(d.div,{className:"text-2xl font-bold text-white",animate:{scale:x.status==="countdown"?[1,1.2,1]:1},transition:{duration:.5,repeat:x.status==="countdown"?1/0:0},children:F()}),t&&e.jsxs("div",{className:"text-sm text-gray-400 mt-2",children:["–ö–æ–º–Ω–∞—Ç–∞: ",t.id.slice(-8)]})]}),(x.status==="found"||x.status==="ready"||x.status==="countdown"||x.status==="playing"||x.status==="finished")&&r&&e.jsxs("div",{className:"flex justify-between items-center p-4 bg-black/20",children:[e.jsx(d.div,{className:"glass-effect p-4 rounded-xl flex-1 mr-2",animate:{borderColor:h.isReady?"#10B981":"#6B7280",boxShadow:h.streak>0?"0 0 20px #10B981":"none"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-400",children:h.name}),e.jsxs("div",{className:"text-sm text-gray-300",children:["–£—Ä–æ–≤–µ–Ω—å ",h.level]}),e.jsx("div",{className:"text-2xl font-bold text-white mt-2",children:h.score}),e.jsx("div",{className:"text-xs text-gray-400",children:"–û—á–∫–∏"}),e.jsxs("div",{className:"text-sm text-yellow-400 mt-1",children:["–°–µ—Ä–∏—è: ",h.streak]}),e.jsxs("div",{className:"text-sm text-blue-400",children:[h.volts,"‚ö°"]}),h.isReady&&e.jsx("div",{className:"text-xs text-green-400 mt-1",children:"‚úì –ì–æ—Ç–æ–≤"})]})}),e.jsx("div",{className:"px-4",children:e.jsx("div",{className:"text-3xl font-bold text-red-400",children:"VS"})}),e.jsx(d.div,{className:"glass-effect p-4 rounded-xl flex-1 ml-2",animate:{borderColor:r.isReady?"#10B981":"#6B7280",boxShadow:r.streak>0?"0 0 20px #EF4444":"none"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-400",children:r.name}),e.jsxs("div",{className:"text-sm text-gray-300",children:["–£—Ä–æ–≤–µ–Ω—å ",r.level]}),e.jsx("div",{className:"text-2xl font-bold text-white mt-2",children:r.score}),e.jsx("div",{className:"text-xs text-gray-400",children:"–û—á–∫–∏"}),e.jsxs("div",{className:"text-sm text-yellow-400 mt-1",children:["–°–µ—Ä–∏—è: ",r.streak]}),e.jsxs("div",{className:"text-sm text-blue-400",children:[r.volts,"‚ö°"]}),r.isReady&&e.jsx("div",{className:"text-xs text-green-400 mt-1",children:"‚úì –ì–æ—Ç–æ–≤"})]})})]}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center p-4",children:e.jsxs($,{mode:"wait",children:[(x.status==="connecting"||x.status==="searching")&&e.jsxs(d.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:x.status==="connecting"?"ÔøΩ":"ÔøΩüîç"}),e.jsx("div",{className:"text-xl text-gray-300 mb-4",children:x.status==="connecting"?"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...":"–ò—â–µ–º –¥–æ—Å—Ç–æ–π–Ω–æ–≥–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞..."}),e.jsx("div",{className:"animate-spin text-4xl",children:"‚ö°"})]},"searching"),x.status==="found"&&e.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"‚öîÔ∏è"}),e.jsx("div",{className:"text-xl text-white mb-6",children:"–°–æ–ø–µ—Ä–Ω–∏–∫ –Ω–∞–π–¥–µ–Ω!"}),e.jsxs("div",{className:"text-lg text-gray-300 mb-4",children:[r==null?void 0:r.name," (–£—Ä–æ–≤–µ–Ω—å ",r==null?void 0:r.level,")"]}),e.jsx(d.button,{onClick:S,disabled:h.isReady,className:`px-8 py-4 rounded-xl font-bold text-lg transition-colors ${h.isReady?"bg-green-600 text-white cursor-default":"bg-orange-600 hover:bg-orange-500 text-white"}`,whileHover:{scale:h.isReady?1:1.05},whileTap:{scale:h.isReady?1:.95},children:h.isReady?"‚úì –ì–æ—Ç–æ–≤! –ñ–¥–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...":"–ì–æ—Ç–æ–≤ –∫ –±–æ—é!"})]},"found"),x.status==="countdown"&&e.jsx(d.div,{initial:{opacity:0,scale:2},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},className:"text-center",children:e.jsx(d.div,{className:"text-9xl font-bold text-red-400",animate:{scale:[1,1.2,1]},transition:{duration:.5},children:p||"‚ö°"})},"countdown"),x.status==="playing"&&e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"w-full max-w-md",children:[e.jsx("div",{className:"w-full h-48 bg-orange-500 rounded-lg cursor-pointer flex items-center justify-center hover:bg-orange-600 transition-colors",onClick:M,children:e.jsx("span",{className:"text-white text-2xl font-bold",children:"‚ö° –ö–õ–ò–ö ‚ö°"})}),e.jsx("div",{className:"text-center mt-4 text-white",children:"üî• Real-time –¥—É—ç–ª—å! –ö–ª–∏–∫–∞–π—Ç–µ –±—ã—Å—Ç—Ä–æ! üî•"}),e.jsxs("div",{className:"text-center mt-2 text-gray-400 text-sm",children:["–í—Ä–µ–º—è: ",I,"—Å | –í–∞—à —Å—á–µ—Ç: ",h.score," | –°–æ–ø–µ—Ä–Ω–∏–∫: ",(r==null?void 0:r.score)||0]})]},"playing"),x.status==="finished"&&e.jsxs(d.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:x.winner===h.id?"üèÜ":x.winner===(r==null?void 0:r.id)?"üíÄ":"ü§ù"}),e.jsx("div",{className:"text-3xl font-bold text-white mb-4",children:F()}),e.jsxs("div",{className:"text-lg text-gray-300 mb-6",children:["–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á–µ—Ç: ",h.score," - ",(r==null?void 0:r.score)||0]}),x.winner===h.id&&e.jsxs("div",{className:"text-green-400 text-lg mb-4",children:["+",Math.floor(h.score*.1)," –æ–ø—ã—Ç–∞ –∑–∞ –ø–æ–±–µ–¥—É!"]}),e.jsx(d.button,{onClick:L,className:"px-8 py-4 bg-orange-600 hover:bg-orange-500 text-white rounded-xl font-bold text-lg transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:"–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"})]},"finished")]})})]})},kt=()=>{const{player:i,goToMenu:a}=D(),{webApp:s,user:t,isInTelegram:r}=X(),[l,n]=u.useState([]),[o,c]=u.useState([]),[g,f]=u.useState(null),[b,m]=u.useState("idle"),[v,x]=u.useState(!1);u.useEffect(()=>{r&&s&&t?y(t.id):n([])},[r,s,t]);const y=async w=>{x(!0);try{const M=await(await fetch(`http://localhost:3001/api/duels/players/${w}`)).json();M.success?(n(M.players),console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${M.players.length} —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤`)):(console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤:",M.error),n([]))}catch(S){console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏–≥—Ä–æ–∫–æ–≤:",S),n([])}finally{x(!1)}},h=async w=>{if(!r||!s||!t){alert("–î—É—ç–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤ Telegram!");return}m("sending"),k.medium();try{const M=await(await fetch("http://localhost:3001/api/duels/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUserId:t.id,toUserId:w.id,message:`${t.first_name} (–£—Ä–æ–≤–µ–Ω—å ${i.level}) –≤—ã–∑—ã–≤–∞–µ—Ç –≤–∞—Å –Ω–∞ –¥—É—ç–ª—å!`})})).json();if(M.success){const L={id:M.duelId,fromUserId:t.id,toUserId:w.id,status:"pending",createdAt:Date.now(),expiresAt:Date.now()+3e5};c(F=>[...F,L]),m("sent"),s.showAlert&&s.showAlert(`–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${w.firstName}! –û–∂–∏–¥–∞–µ–º –æ—Ç–≤–µ—Ç–∞...`),setTimeout(()=>{m("waiting")},2e3)}else throw new Error(M.error||"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è")}catch(S){console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è:",S),m("idle"),s!=null&&s.showAlert&&s.showAlert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.")}},j=w=>{f(w),k.light()},p=()=>{g&&h(g)},E=()=>{k.light(),a()},I=w=>{const S=w.lastName?`${w.firstName} ${w.lastName}`:w.firstName;return w.username?`${S} (@${w.username})`:S};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background-dark to-background-darker",children:[e.jsxs("div",{className:"bg-black/40 border-b border-white/10 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:E,className:"text-gray-400 hover:text-white transition-colors",children:"‚Üê –ù–∞–∑–∞–¥"}),e.jsx("h1",{className:"text-white text-xl font-bold",children:"‚öîÔ∏è –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –Ω–∞ –¥—É—ç–ª—å"}),e.jsx("div",{})]}),!r&&e.jsx("div",{className:"text-sm text-yellow-400 mt-2 text-center",children:"‚ö†Ô∏è –î–ª—è –¥—É—ç–ª–µ–π –æ—Ç–∫—Ä–æ–π—Ç–µ –∏–≥—Ä—É –≤ Telegram"})]}),e.jsx("div",{className:"p-4",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-white text-lg mb-4 font-bold",children:"üë• –ò–≥—Ä–æ–∫–∏ –æ–Ω–ª–∞–π–Ω:"}),v?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin text-orange-400 text-4xl mb-4",children:"‚ö°"}),e.jsx("div",{className:"text-gray-400",children:"–ó–∞–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤..."})]}):l.length>0?e.jsx("div",{className:"space-y-3",children:l.map(w=>e.jsx(d.div,{className:`glass-effect p-4 rounded-xl cursor-pointer transition-all ${(g==null?void 0:g.id)===w.id?"border-2 border-green-400 bg-green-400/10":"border border-white/20 hover:border-orange-400"}`,onClick:()=>j(w),whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center text-white font-bold text-lg",children:w.firstName.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:I(w)}),e.jsxs("div",{className:"text-gray-400 text-sm",children:["–£—Ä–æ–≤–µ–Ω—å ",w.level||1," ‚Ä¢ –ü–æ–±–µ–¥: ",w.wins||0,"/",w.totalGames||0]})]})]}),(g==null?void 0:g.id)===w.id&&e.jsx("div",{className:"text-green-400 text-2xl",children:"‚úì"})]})},w.id))}):e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üòî"}),e.jsx("div",{className:"text-lg mb-2",children:"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤"}),e.jsx("div",{className:"text-sm",children:"–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –±–æ—Ç–∞ –¥–ª—è –¥—É—ç–ª–µ–π!"})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üì±"}),e.jsx("div",{className:"text-xl text-white mb-4",children:"–û—Ç–∫—Ä–æ–π—Ç–µ –∏–≥—Ä—É –≤ Telegram"}),e.jsx("div",{className:"text-gray-400 mb-6",children:"–î—É—ç–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º –±–æ—Ç–∞ –≤ Telegram"}),e.jsx("a",{href:"https://orspiritus.github.io/tigerrosette/",target:"_blank",rel:"noopener noreferrer",className:"bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors",children:"üöÄ –û—Ç–∫—Ä—ã—Ç—å –≤ Telegram"})]})}),g&&b==="idle"&&e.jsx("div",{className:"fixed bottom-6 left-4 right-4",children:e.jsxs(d.button,{onClick:p,className:"w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-4 rounded-xl font-bold text-lg",whileHover:{scale:1.02},whileTap:{scale:.98},initial:{opacity:0,y:50},animate:{opacity:1,y:0},children:["‚öîÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ –Ω–∞ –¥—É—ç–ª—å ",g.firstName]})}),b==="waiting"&&e.jsx("div",{className:"fixed bottom-6 left-4 right-4",children:e.jsxs("div",{className:"bg-black/60 backdrop-blur-sm rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-white text-lg mb-2",children:"‚è≥ –û–∂–∏–¥–∞–µ–º –æ—Ç–≤–µ—Ç–∞..."}),e.jsx("div",{className:"text-gray-400 text-sm",children:"–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ 5 –º–∏–Ω—É—Ç"}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"animate-pulse text-orange-400",children:"‚ö°‚öîÔ∏è‚ö°"})})]})}),o.length>0&&e.jsxs("div",{className:"p-4 mt-4",children:[e.jsx("div",{className:"text-white text-lg mb-3 font-bold",children:"üìã –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è:"}),o.map(w=>{const S=l.find(F=>F.id===w.toUserId),M=Math.max(0,w.expiresAt-Date.now()),L=Math.floor(M/6e4);return e.jsxs("div",{className:"glass-effect p-3 rounded-lg mb-2",children:[e.jsx("div",{className:"text-white",children:S?I(S):"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"}),e.jsxs("div",{className:"text-sm text-gray-400",children:["–°—Ç–∞—Ç—É—Å: ",w.status," ‚Ä¢ –û—Å—Ç–∞–ª–æ—Å—å: ",L,"–º"]})]},w.id)})]})]})},St=()=>{const{player:i,startMultiplayerMode:a}=D(),{webApp:s,user:t,isInTelegram:r}=X(),[l,n]=u.useState([]),[o,c]=u.useState(null);u.useEffect(()=>{if(r&&s){const m=new URLSearchParams(window.location.search),v=m.get("duel")||m.get("duel_invite");console.log("üîç URL parameters:",window.location.search),console.log("üéØ Duel ID found:",v),v&&(console.log("üéØ Found duel ID in URL, fetching duel info..."),g(v)),console.log("–°–ª—É—à–∞–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –Ω–∞ –¥—É—ç–ª–∏...")}},[r,s]);const g=async m=>{var v,x,y;try{console.log("üîç Fetching duel info for ID:",m);const j=await(await fetch(`http://localhost:3001/api/duels/info/${m}`)).json();if(j.success&&j.duel){console.log("‚úÖ Duel info received:",j.duel);const p=j.duel,E={id:m,fromUserId:p.player1_id,fromUserName:((v=p.fromUser)==null?void 0:v.firstName)||"–ò–≥—Ä–æ–∫",fromUserLevel:((x=p.fromUser)==null?void 0:x.level)||1,message:`–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –¥—É—ç–ª—å –æ—Ç ${((y=p.fromUser)==null?void 0:y.firstName)||"–∏–≥—Ä–æ–∫–∞"}!`,receivedAt:Date.now(),expiresAt:new Date(p.expires_at).getTime()};f(E)}else{console.error("‚ùå Failed to fetch duel info:",j.error);const p={id:m,fromUserId:12345,fromUserName:"–ò–≥—Ä–æ–∫",fromUserLevel:1,message:"–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –¥—É—ç–ª—å!",receivedAt:Date.now(),expiresAt:Date.now()+5*60*1e3};f(p)}}catch(h){console.error("‚ùå Error fetching duel info:",h),f({id:m,fromUserId:12345,fromUserName:"–ò–≥—Ä–æ–∫",fromUserLevel:1,message:"–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –¥—É—ç–ª—å!"})}},f=m=>{var x,y,h;const v={id:m.inviteId||m.id,fromUserId:((x=m.fromUser)==null?void 0:x.id)||m.fromUserId,fromUserName:((y=m.fromUser)==null?void 0:y.name)||m.fromUserName,fromUserLevel:((h=m.fromUser)==null?void 0:h.level)||m.fromUserLevel,message:m.message,receivedAt:Date.now(),expiresAt:Date.now()+3e5};n(j=>[...j,v]),s!=null&&s.showAlert&&s.showAlert(`üéÆ –ù–æ–≤–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –¥—É—ç–ª—å –æ—Ç ${v.fromUserName}!`),k.heavy()},b=async(m,v)=>{c(m.id),k.medium();try{if(v){if(s!=null&&s.sendData){const x={type:"duel_response",inviteId:m.id,accepted:!0,fromUserId:t==null?void 0:t.id,fromUserName:t==null?void 0:t.first_name,fromUserLevel:i.level};s.sendData(JSON.stringify(x))}s!=null&&s.showAlert&&s.showAlert(`–î—É—ç–ª—å –ø—Ä–∏–Ω—è—Ç–∞! –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –±–æ—é —Å ${m.fromUserName}...`),n(x=>x.filter(y=>y.id!==m.id)),setTimeout(()=>{a("duel")},2e3)}else{if(s!=null&&s.sendData){const x={type:"duel_response",inviteId:m.id,accepted:!1,fromUserId:t==null?void 0:t.id};s.sendData(JSON.stringify(x))}s!=null&&s.showAlert&&s.showAlert(`–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç ${m.fromUserName} –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ.`),n(x=>x.filter(y=>y.id!==m.id))}}catch(x){console.error("–û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ:",x)}finally{c(null)}};return u.useEffect(()=>{const m=setInterval(()=>{const v=Date.now();n(x=>x.filter(y=>y.expiresAt>v))},3e4);return()=>clearInterval(m)},[]),l.length===0?null:e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(d.div,{className:"bg-gradient-to-br from-gray-900 to-black rounded-2xl p-6 max-w-md w-full border border-orange-400/30",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-4xl mb-2",children:"‚öîÔ∏è"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –¥—É—ç–ª—å!"}),e.jsxs("div",{className:"text-orange-400 text-sm",children:[l.length," –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π"]})]}),l.map(m=>{const v=Math.max(0,m.expiresAt-Date.now()),x=Math.floor(v/6e4),y=Math.floor(v%6e4/1e3);return e.jsxs(d.div,{className:"bg-black/40 rounded-xl p-4 mb-4 border border-white/10",initial:{x:-20,opacity:0},animate:{x:0,opacity:1},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold text-lg",children:m.fromUserName}),e.jsxs("div",{className:"text-gray-400 text-sm",children:["–£—Ä–æ–≤–µ–Ω—å ",m.fromUserLevel]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-orange-400 text-sm font-medium",children:["‚è∞ ",x,":",y.toString().padStart(2,"0")]}),e.jsx("div",{className:"text-gray-500 text-xs",children:"–¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è"})]})]}),e.jsxs("div",{className:"text-gray-300 text-sm mb-4 bg-black/20 rounded-lg p-3",children:["üéÆ –î—É—ç–ª—å –Ω–∞ 60 —Å–µ–∫—É–Ω–¥",e.jsx("br",{}),"üèÜ –ü–æ–±–µ–∂–¥–∞–µ—Ç —Ç–æ—Ç, –∫—Ç–æ –Ω–∞–±–µ—Ä–µ—Ç –±–æ–ª—å—à–µ –æ—á–∫–æ–≤",e.jsx("br",{}),"‚ö° –£–¥–∞—á–∏ –∏ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏!"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(d.button,{onClick:()=>b(m,!1),disabled:o===m.id,className:"flex-1 bg-gray-600 hover:bg-gray-500 text-white py-3 px-4 rounded-xl font-medium transition-colors disabled:opacity-50",whileHover:{scale:1.02},whileTap:{scale:.98},children:o===m.id?"...":"‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å"}),e.jsx(d.button,{onClick:()=>b(m,!0),disabled:o===m.id,className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-400 hover:to-emerald-400 text-white py-3 px-4 rounded-xl font-medium transition-all disabled:opacity-50",whileHover:{scale:1.02},whileTap:{scale:.98},children:o===m.id?"‚è≥ –ü—Ä–∏–Ω–∏–º–∞–µ–º...":"‚úÖ –ü—Ä–∏–Ω—è—Ç—å"})]})]},m.id)}),e.jsx("div",{className:"text-center text-gray-400 text-xs mt-4",children:"üí° –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç"})]})})},Et=({isVisible:i,newLevel:a,voltsReward:s,onClose:t})=>{if(u.useEffect(()=>{i&&k.levelUp()},[i]),!a||!a.level)return i&&console.warn("LevelUpNotification: newLevel is invalid",a),null;const r=H(a.level),l=H(a.level-1),n=r!==l;return e.jsx($,{children:i&&e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",onClick:t,children:e.jsxs(d.div,{initial:{scale:.5,opacity:0,rotateY:-90},animate:{scale:1,opacity:1,rotateY:0},exit:{scale:.5,opacity:0,rotateY:90},transition:{type:"spring",stiffness:300,damping:20,duration:.6},className:"glass-effect p-8 max-w-md mx-4 text-center relative overflow-hidden",onClick:o=>o.stopPropagation(),children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(20)].map((o,c)=>e.jsx(d.div,{className:"absolute w-1 h-1 bg-yellow-300 rounded-full",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`},animate:{opacity:[0,1,0],scale:[0,1,0]},transition:{duration:2,repeat:1/0,delay:Math.random()*2}},c))}),e.jsxs(d.div,{animate:{scale:[1,1.1,1]},transition:{duration:.6,delay:.3},children:[e.jsx("div",{className:"text-6xl mb-4",children:"üéâ"}),e.jsx(d.h2,{className:"text-3xl font-bold text-primary-orange mb-2",animate:{textShadow:["0 0 10px rgba(255, 107, 53, 0.5)","0 0 20px rgba(255, 107, 53, 0.8)","0 0 10px rgba(255, 107, 53, 0.5)"]},transition:{duration:1.5,repeat:1/0},children:"–ù–û–í–´–ô –£–†–û–í–ï–ù–¨!"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-5xl font-bold text-accent-blue mb-2",children:a.level}),e.jsx("div",{className:"text-xl text-yellow-300 font-semibold mb-1",children:a.title}),e.jsx("div",{className:"text-sm text-gray-300 italic",children:a.description})]}),e.jsxs(d.div,{className:"glass-effect p-4 rounded-lg bg-gradient-to-r from-yellow-500/20 to-orange-500/20",animate:{boxShadow:["0 0 20px rgba(255, 193, 7, 0.3)","0 0 30px rgba(255, 193, 7, 0.6)","0 0 20px rgba(255, 193, 7, 0.3)"]},transition:{duration:2,repeat:1/0},children:[e.jsx("div",{className:"text-lg font-bold text-yellow-300 mb-1",children:"–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ —É—Ä–æ–≤–µ–Ω—å:"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:["+",s,"‚ö° –í–æ–ª—å—Ç"]}),n&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-yellow-400/30",children:[e.jsx("div",{className:"text-sm font-bold text-blue-300 mb-2",children:"üé® –ù–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–æ–∑–µ—Ç–∫–∏!"}),e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"–ë—ã–ª–æ:"}),e.jsx("img",{src:l,alt:"–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Ä–æ–∑–µ—Ç–∫–∞",className:"w-8 h-8 rounded border border-gray-600"})]}),e.jsx("div",{className:"text-yellow-400",children:"‚Üí"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"–°—Ç–∞–ª–æ:"}),e.jsx("img",{src:r,alt:"–ù–æ–≤–∞—è —Ä–æ–∑–µ—Ç–∫–∞",className:"w-8 h-8 rounded border border-blue-400"})]})]})]})]})]}),e.jsx(d.button,{onClick:t,className:"mt-6 px-6 py-3 bg-primary-orange hover:bg-primary-orange/80 text-white font-bold rounded-lg transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:"–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[...Array(15)].map((o,c)=>e.jsx(d.div,{className:"absolute w-2 h-2 rounded-full",style:{backgroundColor:["#FFD700","#FF6B35","#00D4FF","#E8FF00","#8A2BE2"][c%5],left:`${50+(Math.random()-.5)*60}%`,top:"20%"},animate:{y:["0vh","80vh"],x:[(Math.random()-.5)*200,(Math.random()-.5)*400],rotate:[0,360],opacity:[1,0]},transition:{duration:3,delay:Math.random()*.5,ease:"easeOut"}},`confetti-${c}`))})]})})})},Mt=()=>{const{aiElectrician:i}=D(),[a,s]=u.useState([]);return u.useEffect(()=>{if(i.lastMessage&&i.messageTime&&(i.lastMessage.includes("üß§")||i.lastMessage.includes("üë¢")||i.lastMessage.includes("‚õëÔ∏è")||i.lastMessage.includes("ü•Ω")||i.lastMessage.includes("üí∞"))){const r={id:`${i.messageTime}-${Math.random()}`,message:i.lastMessage,timestamp:i.messageTime};s(l=>[...l,r]),setTimeout(()=>{s(l=>l.filter(n=>n.id!==r.id))},5e3)}},[i.lastMessage,i.messageTime]),e.jsx("div",{className:"fixed top-20 right-4 z-50 space-y-2 pointer-events-none",children:e.jsx($,{children:a.map(t=>e.jsxs(d.div,{initial:{opacity:0,x:300,scale:.8},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:300,scale:.8},transition:{type:"spring",stiffness:400,damping:25,duration:.5},className:"glass-effect bg-gradient-to-r from-yellow-900/30 to-orange-900/30 border border-yellow-500/50 rounded-lg p-4 max-w-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d.div,{animate:{rotate:[0,10,-10,0],scale:[1,1.1,1]},transition:{duration:.6,repeat:2,ease:"easeInOut"},className:"text-2xl",children:"üéÅ"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-yellow-300 font-semibold mb-1",children:"–ù–ê–•–û–î–ö–ê!"}),e.jsx("div",{className:"text-sm text-white font-medium",children:t.message})]})]}),e.jsx(d.div,{className:"h-1 bg-yellow-500/30 rounded-full mt-3 overflow-hidden",initial:{width:"100%"},children:e.jsx(d.div,{className:"h-full bg-gradient-to-r from-yellow-400 to-orange-400",initial:{width:"100%"},animate:{width:"0%"},transition:{duration:5,ease:"linear"}})})]},t.id))})})};function Ct(){const{gameState:i,levelUpNotification:a,hideLevelUpNotification:s}=D();return u.useEffect(()=>{var t,r;if(typeof window<"u"&&((t=window.Telegram)!=null&&t.WebApp)){const l=window.Telegram.WebApp;l.ready(),l.expand(),l.setHeaderColor("#FF6B35"),l.setBackgroundColor("#1A1A1A"),l.enableClosingConfirmation(),l.MainButton&&(l.MainButton.setText("üéÆ –ò–≥—Ä–∞—Ç—å"),l.MainButton.color="#FF6B35",l.MainButton.textColor="#FFFFFF"),console.log("Telegram WebApp initialized:",{platform:l.platform,version:l.version,colorScheme:l.colorScheme,user:(r=l.initDataUnsafe)==null?void 0:r.user})}else console.log("Running outside Telegram environment")},[]),console.log("App rendering, mode:",i.mode),e.jsx(st,{children:e.jsxs("div",{className:"App",children:[i.mode==="menu"&&e.jsx(rt,{}),i.mode==="single"&&e.jsx(bt,{}),i.mode==="multiplayer"&&e.jsx(jt,{}),i.mode==="duel-invite"&&e.jsx(kt,{}),i.mode==="duel"&&e.jsx(Nt,{}),e.jsx(St,{}),e.jsx(Mt,{}),a.level&&e.jsx(Et,{isVisible:a.isVisible,newLevel:a.level,voltsReward:a.voltsReward||0,onClose:s})]})})}var le,ne;if(typeof window<"u"&&((le=window.Telegram)!=null&&le.WebApp)){const i=window.Telegram.WebApp;i.ready(),i.expand(),i.setHeaderColor("#000000"),i.setBackgroundColor("#000000"),i.BackButton.hide(),i.HapticFeedback&&i.HapticFeedback.selectionChanged(),console.log("Telegram WebApp initialized:",{version:i.version,platform:i.platform,colorScheme:i.colorScheme,user:(ne=i.initDataUnsafe)==null?void 0:ne.user})}J.createRoot(document.getElementById("root")).render(e.jsx(z.StrictMode,{children:e.jsx(Ct,{})}));
//# sourceMappingURL=index-CnReC_KI.js.map
