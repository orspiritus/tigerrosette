{"version":3,"mappings":"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","names":["m","require$$0","client","createStoreImpl","createState","state","listeners","setState","partial","replace","nextState","previousState","listener","getState","api","initialState","__vite_import_meta_env__","createStore","React","is","x","y","objectIs","useState","useEffect","useLayoutEffect","useDebugValue","useSyncExternalStore$2","subscribe","getSnapshot","value","_useState","inst","forceUpdate","checkIfSnapshotChanged","latestGetSnapshot","nextValue","useSyncExternalStore$1","shim","useSyncExternalStoreShim_production","shimModule","require$$1","useSyncExternalStore","useRef","useMemo","withSelector_production","getServerSnapshot","selector","isEqual","instRef","memoizedSelector","nextSnapshot","hasMemo","memoizedSnapshot","currentSelection","memoizedSelection","nextSelection","maybeGetServerSnapshot","withSelectorModule","ReactExports","useSyncExternalStoreWithSelector","useSyncExternalStoreExports","didWarnAboutEqualityFn","identity","arg","useStore","equalityFn","slice","createImpl","useBoundStore","create","LEVEL_CONFIGS","calculateLevel","totalExperience","currentLevel","i","getExperienceToNextLevel","nextLevelIndex","config","nextLevel","getLevelProgress","current","required","EXPERIENCE_REWARDS","getOutletImageByLevel","level","basePath","API_BASE_URL","ApiClient","__publicField","_a","webApp","_b","initData","data","error","endpoint","options","headers","response","scoreData","type","limit","token","apiClient","EffectsBus","event","payload","l","effectsBus","defaultGameState","defaultPlayer","defaultSingleMode","defaultSounds","defaultAchievements","useGameStore","set","get","difficulty","compensated","mode","gameMode","now","timeSinceLastClick","currentRisk","dangerLevel","warningSignsActive","newScore","newVolts","isSuccess","newStreak","newStreakCount","experienceGained","scoreBonus","newSuccessfulClicks","newShockedClicks","totalAttempts","newLuckCoefficient","ai","decrease","addExperience","unlockAchievement","volts","damage","severity","duration","luckHideDuration","voltsDrained","baseShockImpact","protectionMultiplier","finalDamage","s","achievementId","achievement","stats","amount","newExperience","oldLevel","newLevel","showLevelUpNotification","correctLevel","currentScore","currentExperience","expectedExperience","missingExperience","voltsReward","stage","diff","base","successfulClicks","shouldRestoreLuckIndicator","aiUpdateInterval","currentState","nextStage","nextMax","reduced","fatigueLevel","dropTable","fatigue","random","cumulativeChance","selectedItem","item","message","typedType","voltBonus","itemStats","expBonus","interval","baseInterval","modifier","luckCoeff","min","max","nextDischargeTime","dischargeWarningTime","energyDrain","newEnergy","newFatigueLevel","wasEnergyLow","isEnergyLow","voltageGain","newVoltage","equipmentWear","newEquipment","avgEquipment","newEfficiency","newMood","canWork","damageType","isPlayerAttack","playerAttackMessages","equipmentTypes","randomEquipment","equipmentDamageMessages","repairType","repairMessages","baseDamage","voltageDamage","totalDamage","attackMessages","newPlayerVolts","messages","moodMessages","gameData","getDifficultyLevel","serverData","errorMessage","protection","total","durabilityRatio","newProtection","key","HapticManager","enabled","streakCount","isWinner","indicator","style","pattern","delay","vibrateDuration","pauseDuration","hapticManager","ScoreBreakdown","onClose","player","singleMode","gameState","jsx","motion","jsxs","e","LevelDisplay","getCurrentLevelInfo","progressInfo","progressPercent","currentOutletImage","nextOutletImage","outletWillChange","HapticSettings","isVisible","isEnabled","setIsEnabled","testingType","setTestingType","savedEnabled","handleToggleEnabled","newValue","testHaptic","action","TelegramContext","createContext","useTelegram","useContext","TelegramProvider","children","setWebApp","user","setUser","isInTelegram","setIsInTelegram","platform","setPlatform","colorScheme","setColorScheme","setToken","isAuthenticating","setIsAuthenticating","authError","setAuthError","syncPlayerToStore","useCallback","tgUser","prev","performAuth","tgWebApp","backend","body","res","json","logout","authenticate","_c","mockUser","contextValue","TelegramUserInfo","useGameApi","submitState","setSubmitState","statsState","setStatsState","leaderboardState","setLeaderboardState","submitScore","getUserStats","getLeaderboard","refillEnergy","useOfflineMode","isOnline","setIsOnline","handleOnline","handleOffline","MainMenu","startSingleMode","startMultiplayerMode","compensateExperience","loadStatsFromServer","isAuthenticated","showScoreBreakdown","setShowScoreBreakdown","showHapticSettings","setShowHapticSettings","isLoadingStats","setIsLoadingStats","result","handleQuickLevelUp","handleCompensateExperience","handleStartGame","SoundManager","name","url","arrayBuffer","audioBuffer","volume","buffer","source","gainNode","intensity","frequency","bufferSize","output","t","envelope","noise","oscillation","lowFreq","highFreq","audio","soundManager","ScorePopup","score","reason","position","experience","getColorClass","getIcon","AnimatePresence","ElectricSparks","isActive","onComplete","sparks","setSparks","generateSparks","sparkCount","colors","newSparks","spark","_","startX","startY","segments","path","currentX","currentY","j","electricShockVideo","SimpleVideoPlayer","videoRef","debugInfo","setDebugInfo","needsManualPlay","setNeedsManualPlay","attemptedAutoPlay","setAttemptedAutoPlay","video","logVideoState","handleLoadStart","handleCanPlay","handleError","handlePlay","handleEnded","Fragment","v","err","useOutletImageAnimation","currentImage","setCurrentImage","isAnimating","setIsAnimating","newImage","TigerOutlet","className","onShock","clickOutlet","updateScore","triggerShock","isPressed","setIsPressed","glowIntensity","setGlowIntensity","isElectricShockActive","setIsElectricShockActive","showShockVideo","setShowShockVideo","scorePopup","setScorePopup","showScorePopup","handleShockVideoComplete","timeout","createSparks","handleClick","penaltyData","isShocked","penaltyMessage","basePenalty","riskPenalty","finalPenalty","basePoints","riskMultiplier","streakBonus","totalPoints","CounterAttackButton","disabled","aiElectrician","damageAIElectrician","isAttacking","setIsAttacking","cooldown","setCooldown","showEffect","setShowEffect","minVoltageForAttack","canAttack","handleCounterAttack","currentVoltage","cooldownTime","cooldownInterval","ConnectionStatus","status","ProtectionShop","isOpen","getShopItems","buyProtectionItem","getTotalProtection","selectedCategory","setSelectedCategory","purchaseAnimation","setPurchaseAnimation","handleKey","shopItems","totalProtection","categories","filteredItems","handlePurchase","canAfford","price","isOwned","category","c","owned","affordable","animating","GameHUD","repairAIElectrician","showShop","setShowShop","val","ScreenShake","shakeAmount","timer","GameScreen","endGame","submitGameToServer","gameTime","setGameTime","showGameOver","setShowGameOver","isSavingToServer","setIsSavingToServer","isScreenShaking","setIsScreenShaking","handleShockEffect","handleEndGame","gameStore","formatTime","seconds","mins","secs","MultiplayerScreen","handleBackToMenu","PACKET_TYPES","PACKET_TYPES_REVERSE","ERROR_PACKET","withNativeBlob","withNativeArrayBuffer","isView","obj","encodePacket","supportsBinary","callback","encodeBlobAsBase64","fileReader","content","toArray","TEXT_ENCODER","encodePacketToBinary","packet","encoded","chars","lookup","decode","base64","bufferLength","len","p","encoded1","encoded2","encoded3","encoded4","arraybuffer","bytes","decodePacket","encodedPacket","binaryType","mapBinary","decodeBase64Packet","decoded","SEPARATOR","encodePayload","packets","length","encodedPackets","count","decodePayload","encodedPayload","decodedPacket","createPacketEncoderStream","controller","payloadLength","header","view","TEXT_DECODER","totalLength","chunks","acc","chunk","concatChunks","size","createPacketDecoderStream","maxPayload","expectedLength","isBinary","headerArray","n","protocol","Emitter","mixin","fn","on","callbacks","cb","args","nextTick","setTimeoutFn","globalThisShim","defaultBinaryType","pick","attr","k","NATIVE_SET_TIMEOUT","globalThis","NATIVE_CLEAR_TIMEOUT","installTimerFunctions","opts","BASE64_OVERHEAD","byteLength","utf8Length","str","randomString","encode","qs","qry","pairs","pair","TransportError","description","context","Transport","details","onPause","schema","query","hostname","encodedQuery","Polling","pause","close","hasCORS","empty","BaseXHR","isSSL","port","req","xhrStatus","Request","createRequest","uri","xhr","fromError","unloadHandler","terminationEvent","hasXHR2","newRequest","XHR","forceBase64","xdomain","isReactNative","BaseWS","protocols","closeEvent","ev","lastPacket","WebSocketCtor","WS","_packet","WT","stream","decoderStream","reader","encoderStream","read","done","transports","re","parts","parse","src","b","pathNames","queryKey","regx","names","$0","$1","$2","withEventListeners","OFFLINE_EVENT_LISTENERS","SocketWithoutUpgrade","parsedUri","transportName","transport","payloadSize","hasExpired","msg","cleanupAndClose","waitForUpgrade","SocketWithUpgrade","failed","onTransportOpen","cleanup","freezeTransport","onerror","onTransportClose","onclose","onupgrade","to","upgrades","filteredUpgrades","o","DEFAULT_TRANSPORTS","loc","host","toString","withNativeFile","hasBinary","toJSON","deconstructPacket","buffers","packetData","pack","_deconstructPacket","placeholder","newData","reconstructPacket","_reconstructPacket","RESERVED_EVENTS","PacketType","Encoder","replacer","deconstruction","isObject","Decoder","reviver","isBinaryEvent","BinaryReconstructor","start","buf","next","binData","Socket","io","nsp","id","ack","isTransportWritable","isConnected","resolve","reject","arg1","arg2","responseArgs","force","self","sent","pid","subDestroy","compress","Backoff","ms","rand","deviation","jitter","Manager","_parser","parser","Engine","socket","openSubDestroy","onError","errorSub","nsps","attempt","cache","parsed","sameNamespace","newConnection","useDuelConnection","setIsConnected","currentRoom","setCurrentRoom","opponent","setOpponent","setMessages","socketRef","simulationIntervalRef","connectionRef","messageQueueRef","aiIntervalRef","lastAiActionRef","connect","createSocket","startSimulation","players","disconnect","findDuel","room","botOpponent","sendMessage","fullMessage","setReady","sendPlayerAction","points","sendPlayerShocked","leaveDuel","DuelScreen","connectedOpponent","duelState","setDuelState","playerState","setPlayerState","countdownTimer","setCountdownTimer","gameTimer","setGameTimer","lastMessage","winner","handlePlayerReady","handlePlayerClick","getStatusText","getConnectionStatus","DuelInviteScreen","goToMenu","contacts","setContacts","pendingInvites","setPendingInvites","selectedContact","setSelectedContact","inviteStatus","setInviteStatus","isLoading","setIsLoading","loadRealPlayers","userId","sendDuelInvite","contact","invite","handleContactSelect","handleSendInvite","getContactDisplayName","fullName","timeLeft","minutesLeft","DuelInviteReceiver","incomingInvites","setIncomingInvites","respondingTo","setRespondingTo","urlParams","inviteId","fetchDuelInfo","duelId","duelInfo","realInvite","handleIncomingInvite","fallbackInvite","newInvite","respondToInvite","accept","inv","secondsLeft","LevelUpNotification","newOutletImage","previousOutletImage","outletImageChanged","ItemDropNotification","notifications","setNotifications","newNotification","notification","_WebGPUManager","canvas","adapter","device","format","WebGPUManager","ParticleSystem","angle","speed","dt","ctx","alpha","grad","generateLightning","x1","y1","x2","y2","displace","recurse","ax","ay","bx","by","disp","mx","my","offset","nx","ny","drawLightning","segs","WebGPUCanvas","canvasRef","setStatus","fps","setFps","framesRef","lastFpsUpdateRef","lastTimeRef","particleRef","lightningRef","isTelegramMiniApp","targetParticleMaxRef","adaptAccumulatorRef","wgpuReadyRef","deviceRef","contextRef","pipelineRef","formatRef","ensurePipeline","shader","raf","loop","delta","recentFps","encoder","pass","lx","mounted","mgr","tri","pipe","draw","enc","handleResize","parent","width","height","unsubLevel","unsubShock","mult","unsubStage","unsubDrop","unsubAi","voltage","BabylonStage","__vitePreload","BabylonStageAdvanced","App","levelUpNotification","hideLevelUpNotification","renderMode","setRenderMode","Suspense","tg","ReactDOM"],"ignoreList":[0,1,2,3,4,5,6,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],"sources":["../../node_modules/react-dom/client.js","../../node_modules/zustand/esm/vanilla.mjs","../../node_modules/use-sync-external-store/cjs/use-sync-external-store-shim.production.js","../../node_modules/use-sync-external-store/shim/index.js","../../node_modules/use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.js","../../node_modules/use-sync-external-store/shim/with-selector.js","../../node_modules/zustand/esm/index.mjs","../../src/utils/levelSystem.ts","../../src/utils/apiClient.ts","../../src/effects/effectsBus.ts","../../src/store/gameStore.ts","../../src/utils/hapticManager.ts","../../src/components/ScoreBreakdown.tsx","../../src/components/LevelDisplay.tsx","../../src/components/HapticSettings.tsx","../../src/components/TelegramProvider.tsx","../../src/components/TelegramUserInfo.tsx","../../src/hooks/useGameApi.ts","../../src/components/MainMenu.tsx","../../src/utils/soundManager.ts","../../src/components/ScorePopup.tsx","../../src/components/ElectricSparks.tsx","../../src/assets/video/electric_shock.mp4","../../src/components/SimpleVideoPlayer.tsx","../../src/hooks/useOutletImageAnimation.ts","../../src/components/TigerOutlet.tsx","../../src/components/CounterAttackButton.tsx","../../src/components/ConnectionStatus.tsx","../../src/components/ProtectionShop.tsx","../../src/components/GameHUD.tsx","../../src/components/ScreenShake.tsx","../../src/components/GameScreen.tsx","../../src/components/MultiplayerScreen.tsx","../../node_modules/engine.io-parser/build/esm/commons.js","../../node_modules/engine.io-parser/build/esm/encodePacket.browser.js","../../node_modules/engine.io-parser/build/esm/contrib/base64-arraybuffer.js","../../node_modules/engine.io-parser/build/esm/decodePacket.browser.js","../../node_modules/engine.io-parser/build/esm/index.js","../../node_modules/@socket.io/component-emitter/lib/esm/index.js","../../node_modules/engine.io-client/build/esm/globals.js","../../node_modules/engine.io-client/build/esm/util.js","../../node_modules/engine.io-client/build/esm/contrib/parseqs.js","../../node_modules/engine.io-client/build/esm/transport.js","../../node_modules/engine.io-client/build/esm/transports/polling.js","../../node_modules/engine.io-client/build/esm/contrib/has-cors.js","../../node_modules/engine.io-client/build/esm/transports/polling-xhr.js","../../node_modules/engine.io-client/build/esm/transports/websocket.js","../../node_modules/engine.io-client/build/esm/transports/webtransport.js","../../node_modules/engine.io-client/build/esm/transports/index.js","../../node_modules/engine.io-client/build/esm/contrib/parseuri.js","../../node_modules/engine.io-client/build/esm/socket.js","../../node_modules/socket.io-client/build/esm/url.js","../../node_modules/socket.io-parser/build/esm/is-binary.js","../../node_modules/socket.io-parser/build/esm/binary.js","../../node_modules/socket.io-parser/build/esm/index.js","../../node_modules/socket.io-client/build/esm/on.js","../../node_modules/socket.io-client/build/esm/socket.js","../../node_modules/socket.io-client/build/esm/contrib/backo2.js","../../node_modules/socket.io-client/build/esm/manager.js","../../node_modules/socket.io-client/build/esm/index.js","../../src/hooks/useDuelConnection.ts","../../src/components/DuelScreen.tsx","../../src/components/DuelInviteScreen.tsx","../../src/components/DuelInviteReceiver.tsx","../../src/components/LevelUpNotification.tsx","../../src/components/ItemDropNotification.tsx","../../src/webgpu/WebGPUManager.ts","../../src/webgpu/ParticleSystem.ts","../../src/webgpu/LightningEffect.ts","../../src/components/WebGPUCanvas.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","const createStoreImpl = (createState) => {\n  let state;\n  const listeners = /* @__PURE__ */ new Set();\n  const setState = (partial, replace) => {\n    const nextState = typeof partial === \"function\" ? partial(state) : partial;\n    if (!Object.is(nextState, state)) {\n      const previousState = state;\n      state = (replace != null ? replace : typeof nextState !== \"object\" || nextState === null) ? nextState : Object.assign({}, state, nextState);\n      listeners.forEach((listener) => listener(state, previousState));\n    }\n  };\n  const getState = () => state;\n  const getInitialState = () => initialState;\n  const subscribe = (listener) => {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  };\n  const destroy = () => {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      console.warn(\n        \"[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected.\"\n      );\n    }\n    listeners.clear();\n  };\n  const api = { setState, getState, getInitialState, subscribe, destroy };\n  const initialState = state = createState(setState, getState, api);\n  return api;\n};\nconst createStore = (createState) => createState ? createStoreImpl(createState) : createStoreImpl;\nvar vanilla = (createState) => {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    console.warn(\n      \"[DEPRECATED] Default export is deprecated. Instead use import { createStore } from 'zustand/vanilla'.\"\n    );\n  }\n  return createStore(createState);\n};\n\nexport { createStore, vanilla as default };\n","/**\n * @license React\n * use-sync-external-store-shim.production.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\nvar React = require(\"react\");\nfunction is(x, y) {\n  return (x === y && (0 !== x || 1 / x === 1 / y)) || (x !== x && y !== y);\n}\nvar objectIs = \"function\" === typeof Object.is ? Object.is : is,\n  useState = React.useState,\n  useEffect = React.useEffect,\n  useLayoutEffect = React.useLayoutEffect,\n  useDebugValue = React.useDebugValue;\nfunction useSyncExternalStore$2(subscribe, getSnapshot) {\n  var value = getSnapshot(),\n    _useState = useState({ inst: { value: value, getSnapshot: getSnapshot } }),\n    inst = _useState[0].inst,\n    forceUpdate = _useState[1];\n  useLayoutEffect(\n    function () {\n      inst.value = value;\n      inst.getSnapshot = getSnapshot;\n      checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n    },\n    [subscribe, value, getSnapshot]\n  );\n  useEffect(\n    function () {\n      checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n      return subscribe(function () {\n        checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n      });\n    },\n    [subscribe]\n  );\n  useDebugValue(value);\n  return value;\n}\nfunction checkIfSnapshotChanged(inst) {\n  var latestGetSnapshot = inst.getSnapshot;\n  inst = inst.value;\n  try {\n    var nextValue = latestGetSnapshot();\n    return !objectIs(inst, nextValue);\n  } catch (error) {\n    return !0;\n  }\n}\nfunction useSyncExternalStore$1(subscribe, getSnapshot) {\n  return getSnapshot();\n}\nvar shim =\n  \"undefined\" === typeof window ||\n  \"undefined\" === typeof window.document ||\n  \"undefined\" === typeof window.document.createElement\n    ? useSyncExternalStore$1\n    : useSyncExternalStore$2;\nexports.useSyncExternalStore =\n  void 0 !== React.useSyncExternalStore ? React.useSyncExternalStore : shim;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('../cjs/use-sync-external-store-shim.production.js');\n} else {\n  module.exports = require('../cjs/use-sync-external-store-shim.development.js');\n}\n","/**\n * @license React\n * use-sync-external-store-shim/with-selector.production.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\nvar React = require(\"react\"),\n  shim = require(\"use-sync-external-store/shim\");\nfunction is(x, y) {\n  return (x === y && (0 !== x || 1 / x === 1 / y)) || (x !== x && y !== y);\n}\nvar objectIs = \"function\" === typeof Object.is ? Object.is : is,\n  useSyncExternalStore = shim.useSyncExternalStore,\n  useRef = React.useRef,\n  useEffect = React.useEffect,\n  useMemo = React.useMemo,\n  useDebugValue = React.useDebugValue;\nexports.useSyncExternalStoreWithSelector = function (\n  subscribe,\n  getSnapshot,\n  getServerSnapshot,\n  selector,\n  isEqual\n) {\n  var instRef = useRef(null);\n  if (null === instRef.current) {\n    var inst = { hasValue: !1, value: null };\n    instRef.current = inst;\n  } else inst = instRef.current;\n  instRef = useMemo(\n    function () {\n      function memoizedSelector(nextSnapshot) {\n        if (!hasMemo) {\n          hasMemo = !0;\n          memoizedSnapshot = nextSnapshot;\n          nextSnapshot = selector(nextSnapshot);\n          if (void 0 !== isEqual && inst.hasValue) {\n            var currentSelection = inst.value;\n            if (isEqual(currentSelection, nextSnapshot))\n              return (memoizedSelection = currentSelection);\n          }\n          return (memoizedSelection = nextSnapshot);\n        }\n        currentSelection = memoizedSelection;\n        if (objectIs(memoizedSnapshot, nextSnapshot)) return currentSelection;\n        var nextSelection = selector(nextSnapshot);\n        if (void 0 !== isEqual && isEqual(currentSelection, nextSelection))\n          return (memoizedSnapshot = nextSnapshot), currentSelection;\n        memoizedSnapshot = nextSnapshot;\n        return (memoizedSelection = nextSelection);\n      }\n      var hasMemo = !1,\n        memoizedSnapshot,\n        memoizedSelection,\n        maybeGetServerSnapshot =\n          void 0 === getServerSnapshot ? null : getServerSnapshot;\n      return [\n        function () {\n          return memoizedSelector(getSnapshot());\n        },\n        null === maybeGetServerSnapshot\n          ? void 0\n          : function () {\n              return memoizedSelector(maybeGetServerSnapshot());\n            }\n      ];\n    },\n    [getSnapshot, getServerSnapshot, selector, isEqual]\n  );\n  var value = useSyncExternalStore(subscribe, instRef[0], instRef[1]);\n  useEffect(\n    function () {\n      inst.hasValue = !0;\n      inst.value = value;\n    },\n    [value]\n  );\n  useDebugValue(value);\n  return value;\n};\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('../cjs/use-sync-external-store-shim/with-selector.production.js');\n} else {\n  module.exports = require('../cjs/use-sync-external-store-shim/with-selector.development.js');\n}\n","import { createStore } from 'zustand/vanilla';\nexport * from 'zustand/vanilla';\nimport ReactExports from 'react';\nimport useSyncExternalStoreExports from 'use-sync-external-store/shim/with-selector.js';\n\nconst { useDebugValue } = ReactExports;\nconst { useSyncExternalStoreWithSelector } = useSyncExternalStoreExports;\nlet didWarnAboutEqualityFn = false;\nconst identity = (arg) => arg;\nfunction useStore(api, selector = identity, equalityFn) {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && equalityFn && !didWarnAboutEqualityFn) {\n    console.warn(\n      \"[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937\"\n    );\n    didWarnAboutEqualityFn = true;\n  }\n  const slice = useSyncExternalStoreWithSelector(\n    api.subscribe,\n    api.getState,\n    api.getServerState || api.getInitialState,\n    selector,\n    equalityFn\n  );\n  useDebugValue(slice);\n  return slice;\n}\nconst createImpl = (createState) => {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && typeof createState !== \"function\") {\n    console.warn(\n      \"[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.\"\n    );\n  }\n  const api = typeof createState === \"function\" ? createStore(createState) : createState;\n  const useBoundStore = (selector, equalityFn) => useStore(api, selector, equalityFn);\n  Object.assign(useBoundStore, api);\n  return useBoundStore;\n};\nconst create = (createState) => createState ? createImpl(createState) : createImpl;\nvar react = (createState) => {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    console.warn(\n      \"[DEPRECATED] Default export is deprecated. Instead use `import { create } from 'zustand'`.\"\n    );\n  }\n  return create(createState);\n};\n\nexport { create, react as default, useStore };\n","// Level System Configuration\r\nexport interface LevelConfig {\r\n  level: number;\r\n  requiredExperience: number;\r\n  voltsReward: number;\r\n  title: string;\r\n  description: string;\r\n}\r\n\r\n// Experience required for each level (cumulative) - Extremely balanced progression\r\nexport const LEVEL_CONFIGS: LevelConfig[] = [\r\n  { level: 1, requiredExperience: 0, voltsReward: 0, title: \"\", description: \"   \" },\r\n  { level: 2, requiredExperience: 5000, voltsReward: 50, title: \"\", description: \" \" },\r\n  { level: 3, requiredExperience: 15000, voltsReward: 75, title: \"\", description: \" !     \" },\r\n  { level: 4, requiredExperience: 35000, voltsReward: 100, title: \"\", description: \" !    \" },\r\n  { level: 5, requiredExperience: 70000, voltsReward: 150, title: \"\", description: \"    \" },\r\n  { level: 6, requiredExperience: 125000, voltsReward: 200, title: \"\", description: \"  \" },\r\n  { level: 7, requiredExperience: 200000, voltsReward: 250, title: \"\", description: \"   \" },\r\n  { level: 8, requiredExperience: 300000, voltsReward: 300, title: \"\", description: \" \" },\r\n  { level: 9, requiredExperience: 450000, voltsReward: 400, title: \"\", description: \"  \" },\r\n  { level: 10, requiredExperience: 650000, voltsReward: 500, title: \"\", description: \"  \" },\r\n  { level: 11, requiredExperience: 900000, voltsReward: 600, title: \"\", description: \"  \" },\r\n  { level: 12, requiredExperience: 1200000, voltsReward: 750, title: \"\", description: \" \" },\r\n  { level: 13, requiredExperience: 1600000, voltsReward: 900, title: \"\", description: \"  \" },\r\n  { level: 14, requiredExperience: 2100000, voltsReward: 1100, title: \"\", description: \" \" },\r\n  { level: 15, requiredExperience: 2700000, voltsReward: 1300, title: \"\", description: \" \" },\r\n  { level: 16, requiredExperience: 3500000, voltsReward: 1500, title: \"\", description: \"   \" },\r\n  { level: 17, requiredExperience: 4500000, voltsReward: 1750, title: \"\", description: \" \" },\r\n  { level: 18, requiredExperience: 5800000, voltsReward: 2000, title: \"\", description: \" \" },\r\n  { level: 19, requiredExperience: 7500000, voltsReward: 2300, title: \" \", description: \" \" },\r\n  { level: 20, requiredExperience: 10000000, voltsReward: 2500, title: \"\", description: \"   \" },\r\n];\r\n\r\n// Calculate level from total experience\r\nexport function calculateLevel(totalExperience: number): LevelConfig {\r\n  let currentLevel = LEVEL_CONFIGS[0];\r\n  \r\n  for (let i = LEVEL_CONFIGS.length - 1; i >= 0; i--) {\r\n    if (totalExperience >= LEVEL_CONFIGS[i].requiredExperience) {\r\n      currentLevel = LEVEL_CONFIGS[i];\r\n      break;\r\n    }\r\n  }\r\n  \r\n  return currentLevel;\r\n}\r\n\r\n// Calculate experience needed for next level\r\nexport function getExperienceToNextLevel(totalExperience: number): {\r\n  current: number;\r\n  required: number;\r\n  remaining: number;\r\n  nextLevel: LevelConfig | null;\r\n} {\r\n  const currentLevel = calculateLevel(totalExperience);\r\n  const nextLevelIndex = LEVEL_CONFIGS.findIndex(config => config.level === currentLevel.level) + 1;\r\n  \r\n  if (nextLevelIndex >= LEVEL_CONFIGS.length) {\r\n    return {\r\n      current: totalExperience,\r\n      required: totalExperience,\r\n      remaining: 0,\r\n      nextLevel: null\r\n    };\r\n  }\r\n  \r\n  const nextLevel = LEVEL_CONFIGS[nextLevelIndex];\r\n  \r\n  return {\r\n    current: totalExperience - currentLevel.requiredExperience,\r\n    required: nextLevel.requiredExperience - currentLevel.requiredExperience,\r\n    remaining: nextLevel.requiredExperience - totalExperience,\r\n    nextLevel\r\n  };\r\n}\r\n\r\n// Get level progress percentage\r\nexport function getLevelProgress(totalExperience: number): number {\r\n  const { current, required } = getExperienceToNextLevel(totalExperience);\r\n  if (required === 0) return 100;\r\n  return Math.min(100, (current / required) * 100);\r\n}\r\n\r\n// Experience rewards for different actions - Rebalanced for better progression\r\nexport const EXPERIENCE_REWARDS = {\r\n  SAFE_CLICK: 3,        //   1  3\r\n  RISKY_CLICK: 8,       //   2  8\r\n  EXTREME_CLICK: 15,    //   3  15\r\n  STREAK_5: 25,         //   5  25\r\n  STREAK_10: 60,        //   12  60\r\n  STREAK_25: 150,       //   30  150\r\n  STREAK_50: 300,       //   60  300\r\n  SURVIVAL_MINUTE: 10,  //   2  10\r\n  SHOCK_SURVIVAL: 5,    //   1  5\r\n  ACHIEVEMENT: 50,      //   10  50\r\n  DAILY_BONUS: 100      //   20  100\r\n} as const;\r\n\r\n// Get outlet image based on player level - Adjusted for new level system\r\nexport function getOutletImageByLevel(level: number): string {\r\n  // We have 4 different outlet images (tigrrozetka_1.png to tigrrozetka_4.png)\r\n  // Cycle through them based on level ranges\r\n  \r\n  const basePath = '/tigerrosette/';\r\n  \r\n  if (level <= 3) {\r\n    return `${basePath}Media/Pictures/tigrrozetka_1.png`;\r\n  } else if (level <= 7) {\r\n    return `${basePath}Media/Pictures/tigrrozetka_2.png`;\r\n  } else if (level <= 12) {\r\n    return `${basePath}Media/Pictures/tigrrozetka_3.png`;\r\n  } else {\r\n    return `${basePath}Media/Pictures/tigrrozetka_4.png`;\r\n  }\r\n}\r\n","/**\r\n * API     backend\r\n */\r\n\r\nconst API_BASE_URL = (import.meta as any).env?.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\ninterface ApiResponse<T = any> {\r\n  success?: boolean;\r\n  data?: T;\r\n  error?: string;\r\n}\r\n\r\ninterface GameScoreData {\r\n  score: number;\r\n  level: number;\r\n  timePlayed: number;\r\n}\r\n\r\ninterface GameScoreResponse {\r\n  success: boolean;\r\n  experienceGained: number;\r\n  voltsGained: number;\r\n  levelUpReward: number;\r\n  leveledUp: boolean;\r\n  newLevel: number;\r\n  levelProgress: {\r\n    currentLevel: number;\r\n    experienceInLevel: number;\r\n    experienceToNextLevel: number;\r\n    progressPercentage: number;\r\n  };\r\n  newEnergy: number;\r\n  totalExperience: number;\r\n  totalVolts: number;\r\n}\r\n\r\ninterface UserStats {\r\n  level: number;\r\n  totalExperience: number;\r\n  levelProgress: {\r\n    currentLevel: number;\r\n    experienceInLevel: number;\r\n    experienceToNextLevel: number;\r\n    progressPercentage: number;\r\n  };\r\n  totalVolts: number;\r\n  premiumVolts: number;\r\n  energy: number;\r\n  maxEnergy: number;\r\n  energyLastRefilled: string;\r\n  totalSessions: number;\r\n  bestScore: number;\r\n  totalTimePlayed: number;\r\n  recentSessions: Array<{\r\n    id: string;\r\n    score: number;\r\n    level: number;\r\n    experienceGained: number;\r\n    voltsGained: number;\r\n    timePlayed: number;\r\n    playedAt: string;\r\n  }>;\r\n}\r\n\r\ninterface LeaderboardEntry {\r\n  rank: number;\r\n  id: string;\r\n  username: string;\r\n  level: number;\r\n  totalExperience: number;\r\n  totalVolts: number;\r\n}\r\n\r\nclass ApiClient {\r\n  private token: string | null = null;\r\n\r\n  constructor() {\r\n    //    localStorage  Telegram WebApp\r\n    this.token = localStorage.getItem('auth_token');\r\n    this.initializeTelegramAuth();\r\n  }\r\n\r\n  private initializeTelegramAuth() {\r\n    //    Telegram WebApp\r\n    if (typeof window !== 'undefined' && window.Telegram?.WebApp) {\r\n      const webApp = window.Telegram.WebApp;\r\n      if (webApp.initDataUnsafe?.user) {\r\n        //    Telegram\r\n        this.authenticateWithTelegram(webApp.initData);\r\n      }\r\n    }\r\n  }\r\n\r\n  private async authenticateWithTelegram(initData: string): Promise<void> {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}/auth/telegram`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ initData }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      \r\n      if (data.token) {\r\n        this.token = data.token;\r\n        localStorage.setItem('auth_token', data.token);\r\n      }\r\n    } catch (error) {\r\n      console.error('Telegram authentication failed:', error);\r\n    }\r\n  }\r\n\r\n  private async makeRequest<T>(\r\n    endpoint: string,\r\n    options: RequestInit = {}\r\n  ): Promise<ApiResponse<T>> {\r\n    try {\r\n      const headers: Record<string, string> = {\r\n        'Content-Type': 'application/json',\r\n        ...(options.headers as Record<string, string>),\r\n      };\r\n\r\n      if (this.token) {\r\n        headers.Authorization = `Bearer ${this.token}`;\r\n      }\r\n\r\n      const response = await fetch(`${API_BASE_URL}${endpoint}`, {\r\n        ...options,\r\n        headers,\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!response.ok) {\r\n        return {\r\n          error: data.error || `HTTP ${response.status}`,\r\n        };\r\n      }\r\n\r\n      return {\r\n        success: true,\r\n        data,\r\n      };\r\n    } catch (error) {\r\n      console.error('API request failed:', error);\r\n      return {\r\n        error: error instanceof Error ? error.message : 'Network error',\r\n      };\r\n    }\r\n  }\r\n\r\n  // ===   ===\r\n\r\n  /**\r\n   *     \r\n   */\r\n  async submitScore(scoreData: GameScoreData): Promise<ApiResponse<GameScoreResponse>> {\r\n    return this.makeRequest<GameScoreResponse>('/game/score', {\r\n      method: 'POST',\r\n      body: JSON.stringify(scoreData),\r\n    });\r\n  }\r\n\r\n  /**\r\n   *   \r\n   */\r\n  async getUserStats(): Promise<ApiResponse<UserStats>> {\r\n    return this.makeRequest<UserStats>('/game/stats');\r\n  }\r\n\r\n  /**\r\n   *   \r\n   */\r\n  async getLeaderboard(type: 'level' | 'volts' | 'experience' = 'level', limit = 10): Promise<ApiResponse<{ leaderboard: LeaderboardEntry[] }>> {\r\n    return this.makeRequest<{ leaderboard: LeaderboardEntry[] }>(`/game/leaderboard?type=${type}&limit=${limit}`);\r\n  }\r\n\r\n  /**\r\n   *  \r\n   */\r\n  async refillEnergy(): Promise<ApiResponse<{\r\n    success: boolean;\r\n    energyRefilled: number;\r\n    newEnergy: number;\r\n    maxEnergy: number;\r\n  }>> {\r\n    return this.makeRequest('/game/refill-energy', {\r\n      method: 'POST',\r\n    });\r\n  }\r\n\r\n  // ===   ===\r\n\r\n  /**\r\n   * ,   \r\n   */\r\n  isAuthenticated(): boolean {\r\n    return !!this.token;\r\n  }\r\n\r\n  /**\r\n   *   \r\n   */\r\n  setToken(token: string): void {\r\n    this.token = token;\r\n    localStorage.setItem('auth_token', token);\r\n  }\r\n\r\n  /**\r\n   *   \r\n   */\r\n  clearToken(): void {\r\n    this.token = null;\r\n    localStorage.removeItem('auth_token');\r\n  }\r\n}\r\n\r\n//   \r\nexport const apiClient = new ApiClient();\r\nexport default apiClient;\r\n","// Simple global effects event bus for decoupling game logic from rendering layer\r\n// Provides typed events (ADD ONLY LIGHTWEIGHT PAYLOADS) consumed by visual layers like WebGPUCanvas or BabylonStage\r\n\r\nexport type EffectEventMap = {\r\n  levelUp: { level: number; voltsReward: number };\r\n  shock: { severity: 'mild' | 'moderate' | 'severe' | 'critical' };\r\n  stageAdvance: { stage: number };\r\n  itemDrop: { type: string; level: number };\r\n  aiAttack: { voltage: number };\r\n  outletClick: { time: number };\r\n  duelState: { roomId: string; players: Record<string, { id: string; score: number; volts: number; streak: number }> };\r\n};\r\n\r\nexport type EffectEventName = keyof EffectEventMap;\r\n\r\nexport type EffectEventListener<E extends EffectEventName> = (payload: EffectEventMap[E]) => void;\r\n\r\nclass EffectsBus {\r\n  // Simpler runtime structure with loose typing internally; external API remains typed\r\n  private listeners: Record<string, Set<(...args: any[]) => void>> = {};\r\n\r\n  on<K extends EffectEventName>(event: K, listener: EffectEventListener<K>) {\r\n    (this.listeners[event] ||= new Set()).add(listener as any);\r\n    return () => this.off(event, listener);\r\n  }\r\n\r\n  off<K extends EffectEventName>(event: K, listener: EffectEventListener<K>) {\r\n    this.listeners[event]?.delete(listener as any);\r\n  }\r\n\r\n  emit<K extends EffectEventName>(event: K, payload: EffectEventMap[K]) {\r\n    this.listeners[event]?.forEach(l => {\r\n      try { l(payload); } catch { /* ignore */ }\r\n    });\r\n  }\r\n}\r\n\r\nexport const effectsBus = new EffectsBus();\r\n","import { create } from 'zustand';\r\nimport { GameStore, GameState, Player, SingleModeState, Achievement, ScoreData, SoundConfig, ShockImpact, PlayerProtection, ShopItem } from '../types/game';\r\nimport { calculateLevel, getExperienceToNextLevel, EXPERIENCE_REWARDS } from '../utils/levelSystem';\r\nimport { apiClient } from '../utils/apiClient';\r\nimport { effectsBus } from '../effects/effectsBus';\r\n\r\n// Default states\r\nconst defaultGameState: GameState = {\r\n  mode: 'menu',\r\n  isPlaying: false,\r\n  isPaused: false,\r\n  gameTime: 0,\r\n  score: 0\r\n};\r\n\r\nconst defaultPlayer: Player = {\r\n  id: 'player1',\r\n  name: '',\r\n  volts: 0,\r\n  level: 1,\r\n  experience: 0,\r\n  streak: 0,\r\n  totalClicks: 0,\r\n  successfulClicks: 0,\r\n  shockedClicks: 0,\r\n  luckCoefficient: 50, //   50%\r\n  luckIndicatorHidden: false,\r\n  luckHiddenUntil: 0,\r\n  survivalTime: 0,\r\n  protection: {\r\n    gloves: { level: 0, protection: 0, durability: 0, maxDurability: 0 },\r\n    boots: { level: 0, protection: 0, durability: 0, maxDurability: 0 },\r\n    suit: { level: 0, protection: 0, durability: 0, maxDurability: 0 },\r\n    helmet: { level: 0, protection: 0, durability: 0, maxDurability: 0 }\r\n  }\r\n};\r\n\r\nconst defaultSingleMode: SingleModeState = {\r\n  difficulty: 'easy',\r\n  aiPattern: 'regular',\r\n  currentRisk: 'low',\r\n  streakCount: 0,\r\n  timeInSafeZone: 0,\r\n  lastClickTime: 0,\r\n  dangerLevel: 0,\r\n  warningSignsActive: false,\r\n  stage: 1,\r\n  \r\n  // AI Electrician System\r\n  aiElectricianActive: false,\r\n  nextDischargeTime: 0,\r\n  dischargeWarningTime: 0,\r\n  isDischarging: false,\r\n  dischargeDuration: 5000 // 5  -     \r\n};\r\n\r\nconst defaultSounds: SoundConfig = {\r\n  volume: 0.7,\r\n  enabled: true,\r\n  backgroundMusicEnabled: true\r\n};\r\n\r\n// Default achievements\r\nconst defaultAchievements: Achievement[] = [\r\n  {\r\n    id: 'first_click',\r\n    title: ' ',\r\n    description: '   ',\r\n    icon: '',\r\n    requirement: 1,\r\n    progress: 0,\r\n    completed: false,\r\n    reward: 50,\r\n    category: 'special'\r\n  },\r\n  {\r\n    id: 'survivor_5',\r\n    title: '',\r\n    description: '  5  ',\r\n    icon: '',\r\n    requirement: 5,\r\n    progress: 0,\r\n    completed: false,\r\n    reward: 100,\r\n    category: 'streak'\r\n  },\r\n  {\r\n    id: 'survivor_25',\r\n    title: '',\r\n    description: '  25  ',\r\n    icon: '',\r\n    requirement: 25,\r\n    progress: 0,\r\n    completed: false,\r\n    reward: 500,\r\n    category: 'streak'\r\n  },\r\n  {\r\n    id: 'risk_taker',\r\n    title: '',\r\n    description: '50    High Risk',\r\n    icon: '',\r\n    requirement: 50,\r\n    progress: 0,\r\n    completed: false,\r\n    reward: 500,\r\n    category: 'risk'\r\n  },\r\n  {\r\n    id: 'time_survivor',\r\n    title: '',\r\n    description: ' 5   ',\r\n    icon: '',\r\n    requirement: 300,\r\n    progress: 0,\r\n    completed: false,\r\n    reward: 1000,\r\n    category: 'survival'\r\n  }\r\n];\r\n\r\nexport const useGameStore = create<GameStore>((set, get) => ({\r\n  // Initial state\r\n  gameState: defaultGameState,\r\n  player: defaultPlayer,\r\n  singleMode: defaultSingleMode,\r\n  achievements: defaultAchievements,\r\n  sounds: defaultSounds,\r\n  showElectricSparks: false,\r\n  sparksIntensity: 'medium',\r\n  showScreenShake: false,\r\n  aiElectrician: {\r\n    name: ' ',\r\n    energy: 100,\r\n    maxEnergy: 100,\r\n    voltage: 0,\r\n    maxVoltage: 500,\r\n    voltageChargeRate: 2, //   \r\n    lastAttackTime: 0,\r\n    equipment: {\r\n      battery: 100,\r\n      capacitor: 100,\r\n      wires: 100,\r\n      generator: 100\r\n    },\r\n    mood: 'confident',\r\n    experience: 50,\r\n    isActive: false,\r\n    lastMessage: '  !',\r\n    messageTime: 0,\r\n    failuresCount: 0,\r\n    successfulDischarges: 0,\r\n    playerAttacksReceived: 0,\r\n    workingEfficiency: 100,\r\n    canWork: true,\r\n    fatigueLevel: 0, //      \r\n    points: 0,\r\n    maxPoints: 0\r\n  },\r\n  levelUpNotification: {\r\n    isVisible: false,\r\n    level: null,\r\n    voltsReward: 0\r\n  },\r\n\r\n  // Actions\r\n  startSingleMode: (difficulty) => {\r\n    console.log('startSingleMode: Starting with difficulty:', difficulty);\r\n    \r\n    //         \r\n    get().fixPlayerLevel();\r\n    \r\n    //       ()\r\n    const compensated = get().compensateExperience();\r\n    if (compensated > 0) {\r\n      console.log(`Compensated ${compensated} experience points based on current score`);\r\n    }\r\n    \r\n    set({\r\n      gameState: {\r\n        ...get().gameState,\r\n        mode: 'single',\r\n        isPlaying: true,\r\n        gameTime: 0,\r\n        score: 0\r\n      },\r\n      singleMode: {\r\n        ...defaultSingleMode,\r\n        difficulty\r\n      }\r\n    });\r\n\r\n    //      \r\n    set(state => ({\r\n      aiElectrician: {\r\n        ...state.aiElectrician,\r\n        points: get().getAIMaxPointsForStage((get().singleMode.stage) || 1),\r\n        maxPoints: get().getAIMaxPointsForStage((get().singleMode.stage) || 1)\r\n      }\r\n    }));\r\n\r\n    //   \r\n    setTimeout(() => {\r\n      console.log('startSingleMode: Starting AI Electrician after 3s delay');\r\n      get().startAIElectrician();\r\n    }, 3000); //   3    \r\n  },\r\n\r\n  startMultiplayerMode: (mode: 'duel' | 'tournament' | 'coop') => {\r\n    let gameMode: 'multiplayer' | 'duel' | 'duel-invite' = 'multiplayer';\r\n    \r\n    //   ,    \r\n    if (mode === 'duel') {\r\n      gameMode = 'duel-invite';\r\n    }\r\n    \r\n    set({\r\n      gameState: {\r\n        ...get().gameState,\r\n        mode: gameMode,\r\n        isPlaying: false,\r\n        gameTime: 0,\r\n        score: 0\r\n      }\r\n    });\r\n    \r\n    console.log(`Starting multiplayer mode: ${mode}`);\r\n  },\r\n\r\n  //      \r\n  startRealDuel: () => {\r\n    set({\r\n      gameState: {\r\n        ...get().gameState,\r\n        mode: 'duel',\r\n        isPlaying: true,\r\n        gameTime: 0,\r\n        score: 0\r\n      }\r\n    });\r\n    \r\n    console.log('Starting real duel with another player');\r\n  },\r\n\r\n  //      \r\n  goToMenu: () => {\r\n    set({\r\n      gameState: {\r\n        ...defaultGameState,\r\n        mode: 'menu'\r\n      }\r\n    });\r\n  },\r\n\r\n  clickOutlet: () => {\r\n    const state = get();\r\n    const now = Date.now();\r\n    const timeSinceLastClick = now - state.singleMode.lastClickTime;\r\n    \r\n    // Calculate risk level based on timing\r\n    let currentRisk: SingleModeState['currentRisk'] = 'low';\r\n    if (timeSinceLastClick < 1000) currentRisk = 'extreme';\r\n    else if (timeSinceLastClick < 2000) currentRisk = 'high';\r\n    else if (timeSinceLastClick < 3000) currentRisk = 'medium';\r\n\r\n    // Calculate danger level (affects warning signs)\r\n    const dangerLevel = Math.min(100, \r\n      (state.singleMode.streakCount * 2) + //   =  \r\n      (currentRisk === 'extreme' ? 40 : \r\n       currentRisk === 'high' ? 25 : \r\n       currentRisk === 'medium' ? 15 : 5) + //    \r\n      (state.player.luckCoefficient < 30 ? 20 : 0) //   =  \r\n    );\r\n\r\n    // Activate warning signs if danger is high\r\n    const warningSignsActive = dangerLevel > 60;\r\n\r\n    // Update click stats\r\n    set({\r\n      player: {\r\n        ...state.player,\r\n        totalClicks: state.player.totalClicks + 1\r\n      },\r\n      singleMode: {\r\n        ...state.singleMode,\r\n        lastClickTime: now,\r\n        currentRisk,\r\n        dangerLevel,\r\n        warningSignsActive\r\n      }\r\n    });\r\n\r\n    // Update luck coefficient and restore indicator if needed\r\n    get().updateLuckCoefficient();\r\n  // Emit outlet click event for Babylon features\r\n  effectsBus.emit('outletClick', { time: now });\r\n  },\r\n\r\n  updateScore: (scoreData: ScoreData) => {\r\n    const state = get();\r\n    const newScore = state.gameState.score + scoreData.totalPoints;\r\n    const newVolts = state.player.volts + scoreData.totalPoints;\r\n    \r\n    // Update streak if it was a success\r\n    const isSuccess = scoreData.reason !== ' ' && \r\n                     scoreData.reason !== '   !' &&\r\n                     scoreData.totalPoints > 0; //     \r\n    const newStreak = isSuccess ? state.player.streak + 1 : 0;\r\n    const newStreakCount = isSuccess ? state.singleMode.streakCount + 1 : 0;\r\n    \r\n    // Calculate experience based on action\r\n    let experienceGained = 0;\r\n    if (isSuccess) {\r\n      // Base experience for successful click\r\n      experienceGained = EXPERIENCE_REWARDS.SAFE_CLICK;\r\n      \r\n      // Bonus experience for risky clicks\r\n      if (scoreData.riskMultiplier >= 2.0) {\r\n        experienceGained = EXPERIENCE_REWARDS.RISKY_CLICK;\r\n      }\r\n      if (scoreData.riskMultiplier >= 3.0) {\r\n        experienceGained = EXPERIENCE_REWARDS.EXTREME_CLICK;\r\n      }\r\n      \r\n      // Bonus experience for streaks\r\n      if (newStreak === 5) experienceGained += EXPERIENCE_REWARDS.STREAK_5;\r\n      if (newStreak === 10) experienceGained += EXPERIENCE_REWARDS.STREAK_10;\r\n      if (newStreak === 25) experienceGained += EXPERIENCE_REWARDS.STREAK_25;\r\n      if (newStreak === 50) experienceGained += EXPERIENCE_REWARDS.STREAK_50;\r\n      \r\n      //       (1    10 )\r\n      const scoreBonus = Math.floor(Math.max(0, scoreData.totalPoints) / 10);\r\n      experienceGained += scoreBonus;\r\n    } else {\r\n      // Small experience even for getting shocked\r\n      experienceGained = EXPERIENCE_REWARDS.SHOCK_SURVIVAL;\r\n    }\r\n    \r\n    // Update success/shock statistics and calculate luck coefficient\r\n    const newSuccessfulClicks = isSuccess ? state.player.successfulClicks + 1 : state.player.successfulClicks;\r\n    const newShockedClicks = !isSuccess ? state.player.shockedClicks + 1 : state.player.shockedClicks;\r\n    const totalAttempts = newSuccessfulClicks + newShockedClicks;\r\n    const newLuckCoefficient = totalAttempts > 0 ? Math.round((newSuccessfulClicks / totalAttempts) * 100) : 50;\r\n    \r\n    set({\r\n      gameState: {\r\n        ...state.gameState,\r\n        score: newScore\r\n      },\r\n      player: {\r\n        ...state.player,\r\n        volts: newVolts,\r\n        streak: newStreak,\r\n        successfulClicks: newSuccessfulClicks,\r\n        shockedClicks: newShockedClicks,\r\n        luckCoefficient: newLuckCoefficient\r\n      },\r\n      singleMode: {\r\n        ...state.singleMode,\r\n        streakCount: newStreakCount\r\n      }\r\n    });\r\n\r\n    //   :     \r\n    if (isSuccess && scoreData.totalPoints > 0) {\r\n      const ai = get().aiElectrician;\r\n      const decrease = Math.max(1, Math.floor(scoreData.totalPoints / 2));\r\n      set({\r\n        aiElectrician: {\r\n          ...ai,\r\n          points: Math.max(0, ai.points - decrease)\r\n        }\r\n      });\r\n      get().onAIPointsChanged();\r\n    }\r\n\r\n    // Add experience\r\n    const { addExperience } = get();\r\n    addExperience(experienceGained);\r\n\r\n    // Check for achievements\r\n    const { unlockAchievement } = get();\r\n    if (state.player.totalClicks === 0) {\r\n      unlockAchievement('first_click');\r\n    }\r\n    if (newStreak === 5) unlockAchievement('survivor_5');\r\n    if (newStreak === 10) unlockAchievement('survivor_10');\r\n    if (newStreak === 25) unlockAchievement('survivor_25');\r\n  },\r\n\r\n  //         \r\n  calculateShockImpact: (volts: number): ShockImpact => {\r\n    let damage: number;\r\n    let severity: 'mild' | 'moderate' | 'severe' | 'critical';\r\n    let duration: number;\r\n    let luckHideDuration: number;\r\n\r\n    if (volts < 50) {\r\n      damage = Math.floor(volts * 0.1) + 1; // 1-5 \r\n      severity = 'mild';\r\n      duration = 1000;\r\n      luckHideDuration = 2000;\r\n    } else if (volts < 150) {\r\n      damage = Math.floor(volts * 0.15) + 5; // 5-27 \r\n      severity = 'moderate';\r\n      duration = 1500;\r\n      luckHideDuration = 3000;\r\n    } else if (volts < 300) {\r\n      damage = Math.floor(volts * 0.2) + 10; // 10-70 \r\n      severity = 'severe';\r\n      duration = 2000;\r\n      luckHideDuration = 5000;\r\n    } else {\r\n      damage = Math.floor(volts * 0.25) + 20; // 20+ \r\n      severity = 'critical';\r\n      duration = 3000;\r\n      luckHideDuration = 8000;\r\n    }\r\n\r\n    const voltsDrained = Math.floor(volts * 0.7); //  70% \r\n\r\n    return {\r\n      damage,\r\n      voltsDrained,\r\n      duration,\r\n      severity,\r\n      luckHideDuration\r\n    };\r\n  },\r\n\r\n  triggerShock: () => {\r\n    const state = get();\r\n    if (!state.gameState.isPlaying) return;\r\n\r\n    //      \r\n    const baseShockImpact = state.calculateShockImpact(state.player.volts);\r\n    \r\n    //  \r\n    const totalProtection = state.getTotalProtection();\r\n    const protectionMultiplier = (100 - totalProtection) / 100;\r\n    const finalDamage = Math.floor(baseShockImpact.damage * protectionMultiplier);\r\n    \r\n    //   \r\n    state.damageProtection(baseShockImpact.damage);\r\n    \r\n  set({\r\n      player: {\r\n        ...state.player,\r\n        volts: Math.max(0, state.player.volts - baseShockImpact.voltsDrained),\r\n        shockedClicks: state.player.shockedClicks + 1,\r\n        totalClicks: state.player.totalClicks + 1,\r\n        streak: 0,\r\n        luckIndicatorHidden: true,\r\n        luckHiddenUntil: Date.now() + baseShockImpact.luckHideDuration\r\n      },\r\n      showElectricSparks: true,\r\n      sparksIntensity: baseShockImpact.severity === 'critical' ? 'extreme' : \r\n                      baseShockImpact.severity === 'severe' ? 'high' :\r\n                      baseShockImpact.severity === 'moderate' ? 'medium' : 'low',\r\n      showScreenShake: true,\r\n      gameState: {\r\n        ...state.gameState,\r\n        score: Math.max(0, state.gameState.score - finalDamage)\r\n      },\r\n      singleMode: {\r\n        ...state.singleMode,\r\n        streakCount: 0\r\n      }\r\n    });\r\n\r\n    //          :   \r\n    set(s => ({\r\n      aiElectrician: {\r\n        ...s.aiElectrician,\r\n        points: Math.min(s.aiElectrician.maxPoints, s.aiElectrician.points + Math.max(1, Math.floor(finalDamage / 2)))\r\n      }\r\n    }));\r\n    get().onAIPointsChanged();\r\n\r\n    //    \r\n    setTimeout(() => {\r\n      set({\r\n        showElectricSparks: false,\r\n        showScreenShake: false\r\n      });\r\n    }, baseShockImpact.duration);\r\n    // Emit shock event\r\n    effectsBus.emit('shock', { severity: baseShockImpact.severity });\r\n    //   \r\n    get().updateLuckCoefficient();\r\n  },\r\n\r\n  endGame: () => {\r\n    //   \r\n    get().stopAIElectrician();\r\n    \r\n    set({\r\n      gameState: {\r\n        ...get().gameState,\r\n        mode: 'menu',\r\n        isPlaying: false\r\n      }\r\n    });\r\n  },\r\n\r\n  unlockAchievement: (achievementId: string) => {\r\n    const state = get();\r\n    const achievement = state.achievements.find(a => a.id === achievementId);\r\n    \r\n    if (achievement && !achievement.completed) {\r\n      set({\r\n        achievements: state.achievements.map(a =>\r\n          a.id === achievementId \r\n            ? { ...a, completed: true, progress: a.requirement }\r\n            : a\r\n        ),\r\n        player: {\r\n          ...state.player,\r\n          volts: state.player.volts + achievement.reward\r\n        }\r\n      });\r\n    }\r\n  },\r\n\r\n  updatePlayerStats: (stats: Partial<Player>) => {\r\n    const state = get();\r\n    set({\r\n      player: {\r\n        ...state.player,\r\n        ...stats\r\n      }\r\n    });\r\n  },\r\n\r\n  addExperience: (amount: number) => {\r\n    const state = get();\r\n    const newExperience = state.player.experience + amount;\r\n    const oldLevel = calculateLevel(state.player.experience);\r\n    const newLevel = calculateLevel(newExperience);\r\n    \r\n    console.log('addExperience:', {\r\n      amount,\r\n      oldExperience: state.player.experience,\r\n      newExperience,\r\n      oldLevel: oldLevel.level,\r\n      newLevel: newLevel.level,\r\n      playerLevel: state.player.level\r\n    });\r\n    \r\n    // Check if player leveled up\r\n    if (newLevel.level > oldLevel.level) {\r\n      console.log('LEVEL UP!', {\r\n        from: oldLevel.level,\r\n        to: newLevel.level,\r\n        voltsReward: newLevel.voltsReward\r\n      });\r\n      \r\n      // Player leveled up! Give rewards\r\n      const newVolts = state.player.volts + newLevel.voltsReward;\r\n      \r\n      set({\r\n        player: {\r\n          ...state.player,\r\n          experience: newExperience,\r\n          level: newLevel.level,\r\n          volts: newVolts\r\n        }\r\n      });\r\n      \r\n      // Show level up notification\r\n      const { showLevelUpNotification } = get();\r\n      showLevelUpNotification(newLevel, newLevel.voltsReward);\r\n      // Emit levelUp effect event\r\n      effectsBus.emit('levelUp', { level: newLevel.level, voltsReward: newLevel.voltsReward });\r\n    } else {\r\n      // Just add experience and ensure level is correct\r\n      set({\r\n        player: {\r\n          ...state.player,\r\n          experience: newExperience,\r\n          level: newLevel.level //      \r\n        }\r\n      });\r\n    }\r\n  },\r\n\r\n  getCurrentLevelInfo: () => {\r\n    const state = get();\r\n    return {\r\n      currentLevel: calculateLevel(state.player.experience),\r\n      progressInfo: getExperienceToNextLevel(state.player.experience)\r\n    };\r\n  },\r\n\r\n  //       \r\n  fixPlayerLevel: () => {\r\n    const state = get();\r\n    const correctLevel = calculateLevel(state.player.experience);\r\n    \r\n    console.log('fixPlayerLevel:', {\r\n      currentStoredLevel: state.player.level,\r\n      correctLevel: correctLevel.level,\r\n      experience: state.player.experience\r\n    });\r\n    \r\n    if (state.player.level !== correctLevel.level) {\r\n      console.log('Fixing player level from', state.player.level, 'to', correctLevel.level);\r\n      set({\r\n        player: {\r\n          ...state.player,\r\n          level: correctLevel.level\r\n        }\r\n      });\r\n    }\r\n  },\r\n\r\n  //         ()\r\n  compensateExperience: () => {\r\n    const state = get();\r\n    const currentScore = state.gameState.score;\r\n    const currentExperience = state.player.experience;\r\n    \r\n    //          \r\n    const expectedExperience = Math.floor(currentScore / 5); // 1    5 \r\n    const missingExperience = Math.max(0, expectedExperience - currentExperience);\r\n    \r\n    console.log('compensateExperience:', {\r\n      currentScore,\r\n      currentExperience,\r\n      expectedExperience,\r\n      missingExperience\r\n    });\r\n    \r\n    if (missingExperience > 0) {\r\n      console.log(`Compensating ${missingExperience} experience points`);\r\n      get().addExperience(missingExperience);\r\n      return missingExperience;\r\n    }\r\n    \r\n    return 0;\r\n  },\r\n\r\n  showLevelUpNotification: (level, voltsReward) => {\r\n    set({\r\n      levelUpNotification: {\r\n        isVisible: true,\r\n        level,\r\n        voltsReward\r\n      }\r\n    });\r\n  },\r\n\r\n  //  :     \r\n  getAIMaxPointsForStage(stage: number) {\r\n    const diff = get().singleMode.difficulty;\r\n    const base = diff === 'extreme' ? 250 : diff === 'hard' ? 200 : diff === 'medium' ? 150 : 120;\r\n    //   ,    \r\n    return base + Math.floor((stage - 1) * base * 0.25);\r\n  },\r\n\r\n  hideLevelUpNotification: () => {\r\n    set({\r\n      levelUpNotification: {\r\n        isVisible: false,\r\n        level: null,\r\n        voltsReward: 0\r\n      }\r\n    });\r\n  },\r\n\r\n  updateLuckCoefficient: () => {\r\n    const state = get();\r\n    const totalAttempts = state.player.totalClicks;\r\n    const successfulClicks = state.player.successfulClicks;\r\n    \r\n    const newLuckCoefficient = totalAttempts > 0 ? \r\n      Math.round((successfulClicks / totalAttempts) * 100) : 50;\r\n    \r\n    // ,     \r\n    const shouldRestoreLuckIndicator = state.player.luckIndicatorHidden && \r\n                                      Date.now() >= state.player.luckHiddenUntil;\r\n    \r\n    set({\r\n      player: {\r\n        ...state.player,\r\n        luckCoefficient: newLuckCoefficient,\r\n        luckIndicatorHidden: shouldRestoreLuckIndicator ? false : state.player.luckIndicatorHidden\r\n      }\r\n    });\r\n  },\r\n\r\n  // AI Electrician System\r\n  startAIElectrician: () => {\r\n    const state = get();\r\n    if (!state.gameState.isPlaying) {\r\n      console.log('startAIElectrician: Game not playing, aborting');\r\n      return;\r\n    }\r\n\r\n    console.log('startAIElectrician: Starting AI Electrician');\r\n    set({\r\n      singleMode: {\r\n        ...state.singleMode,\r\n        aiElectricianActive: true\r\n      },\r\n      aiElectrician: {\r\n        ...state.aiElectrician,\r\n        isActive: true,\r\n        lastMessage: get().getAIElectricianMessage(),\r\n        messageTime: Date.now()\r\n      }\r\n    });\r\n\r\n    //      ( 2 )\r\n    const aiUpdateInterval = setInterval(() => {\r\n      const currentState = get();\r\n      if (!currentState.singleMode.aiElectricianActive || !currentState.gameState.isPlaying) {\r\n        console.log('startAIElectrician: Clearing AI update interval');\r\n        clearInterval(aiUpdateInterval);\r\n        return;\r\n      }\r\n      \r\n      get().updateAIElectrician();\r\n      \r\n      //    5-10 \r\n      if (Math.random() < 0.3) {\r\n        set({\r\n          aiElectrician: {\r\n            ...get().aiElectrician,\r\n            lastMessage: get().getAIElectricianMessage(),\r\n            messageTime: Date.now()\r\n          }\r\n        });\r\n      }\r\n    }, 2000);\r\n\r\n    //   \r\n    console.log('startAIElectrician: Scheduling first discharge');\r\n    get().scheduleNextDischarge();\r\n  },\r\n\r\n\r\n        //     ,      \r\n        onAIPointsChanged: () => {\r\n          const state = get();\r\n          const ai = state.aiElectrician;\r\n          if (!state.gameState.isPlaying) return;\r\n\r\n          //    :   \r\n          if (ai.points <= 0) {\r\n            const nextStage = state.singleMode.stage + 1;\r\n            const nextMax = get().getAIMaxPointsForStage(nextStage);\r\n            const voltsReward = 50 + nextStage * 10;\r\n            set({\r\n              player: { ...state.player, volts: state.player.volts + voltsReward },\r\n              singleMode: { ...state.singleMode, stage: nextStage },\r\n              aiElectrician: { ...ai, points: nextMax, maxPoints: nextMax, lastMessage: ' !  ...', messageTime: Date.now() }\r\n            });\r\n            effectsBus.emit('stageAdvance', { stage: nextStage });\r\n            //      \r\n            if (Math.random() < 0.5) {\r\n              setTimeout(() => get().dropElectricianItem(), 400);\r\n            }\r\n            return;\r\n          }\r\n\r\n          //         \r\n          if (ai.points >= ai.maxPoints) {\r\n            //  \r\n            get().aiElectricianAttackPlayer();\r\n            //    60%   \r\n            const reduced = Math.floor(ai.maxPoints * 0.6);\r\n            set({ aiElectrician: { ...ai, points: reduced } });\r\n          }\r\n        },\r\n\r\n        //     \r\n        advanceStage: () => {\r\n          const state = get();\r\n          const nextStage = state.singleMode.stage + 1;\r\n          const nextMax = get().getAIMaxPointsForStage(nextStage);\r\n          set({\r\n            singleMode: { ...state.singleMode, stage: nextStage },\r\n            aiElectrician: { ...state.aiElectrician, points: nextMax, maxPoints: nextMax }\r\n          });\r\n        },\r\n  //      \r\n  dropElectricianItem: () => {\r\n    const state = get();\r\n    const fatigueLevel = Math.floor(state.aiElectrician.fatigueLevel);\r\n    \r\n    //       \r\n    const getDropTable = (fatigue: number) => {\r\n      if (fatigue >= 8) {\r\n        return [\r\n          { type: 'suit', level: 3, chance: 0.2, message: '       !' },\r\n          { type: 'gloves', level: 3, chance: 0.3, message: '     !' },\r\n          { type: 'boots', level: 2, chance: 0.3, message: '     !' },\r\n          { type: 'helmet', level: 2, chance: 0.2, message: '     !' }\r\n        ];\r\n      } else if (fatigue >= 5) {\r\n        return [\r\n          { type: 'gloves', level: 2, chance: 0.4, message: '     !' },\r\n          { type: 'boots', level: 2, chance: 0.3, message: '     !' },\r\n          { type: 'suit', level: 1, chance: 0.2, message: '     !' },\r\n          { type: 'helmet', level: 1, chance: 0.1, message: '    !' }\r\n        ];\r\n      } else if (fatigue >= 2) {\r\n        return [\r\n          { type: 'gloves', level: 1, chance: 0.5, message: '     !' },\r\n          { type: 'boots', level: 1, chance: 0.3, message: '     !' },\r\n          { type: 'helmet', level: 1, chance: 0.2, message: '     !' }\r\n        ];\r\n      } else {\r\n        return [\r\n          { type: 'gloves', level: 1, chance: 0.7, message: '     !' },\r\n          { type: 'boots', level: 1, chance: 0.3, message: '    !' }\r\n        ];\r\n      }\r\n    };\r\n    \r\n    const dropTable = getDropTable(fatigueLevel);\r\n    \r\n    //      \r\n    const random = Math.random();\r\n    let cumulativeChance = 0;\r\n    let selectedItem = null;\r\n    \r\n    for (const item of dropTable) {\r\n      cumulativeChance += item.chance;\r\n      if (random <= cumulativeChance) {\r\n        selectedItem = item;\r\n        break;\r\n      }\r\n    }\r\n    \r\n    if (!selectedItem) return;\r\n    \r\n    const { type, level, message } = selectedItem;\r\n    const typedType = type as keyof PlayerProtection;\r\n    \r\n    // ,            \r\n    const currentItem = state.player.protection[typedType];\r\n    if (currentItem.level >= level) {\r\n      console.log('Player already has better protection item:', type, level);\r\n      //    \r\n      const voltBonus = level * 25;\r\n      set({\r\n        player: {\r\n          ...state.player,\r\n          volts: state.player.volts + voltBonus\r\n        },\r\n        aiElectrician: {\r\n          ...state.aiElectrician,\r\n          lastMessage: `    ${voltBonus}    !`,\r\n          messageTime: Date.now()\r\n        }\r\n      });\r\n      return;\r\n    }\r\n    \r\n    //     \r\n    const shopItems = state.getShopItems();\r\n    const itemStats = shopItems.find(item => item.type === typedType && item.level === level);\r\n    \r\n    if (!itemStats) {\r\n      console.error('Item stats not found for:', type, level);\r\n      return;\r\n    }\r\n    \r\n    //   \r\n    set({\r\n      player: {\r\n        ...state.player,\r\n        protection: {\r\n          ...state.player.protection,\r\n          [typedType]: {\r\n            level: itemStats.level,\r\n            protection: itemStats.protection,\r\n            durability: itemStats.durability,\r\n            maxDurability: itemStats.durability\r\n          }\r\n        }\r\n      },\r\n      aiElectrician: {\r\n        ...state.aiElectrician,\r\n        lastMessage: message,\r\n        messageTime: Date.now()\r\n      }\r\n    });\r\n    effectsBus.emit('itemDrop', { type: typedType, level });\r\n    \r\n    console.log(`Dropped item: ${itemStats.name} (${itemStats.protection}% protection) at fatigue level ${fatigueLevel}`);\r\n    \r\n    //      (   )\r\n    const expBonus = 25 * level;\r\n    get().addExperience(expBonus);\r\n  },\r\n\r\n  //       \r\n  restartAIElectrician: () => {\r\n    const state = get();\r\n    if (!state.gameState.isPlaying) {\r\n      console.log('restartAIElectrician: Game not playing');\r\n      return;\r\n    }\r\n    \r\n    if (state.aiElectrician.isActive) {\r\n      console.log('restartAIElectrician: AI already active');\r\n      return;\r\n    }\r\n    \r\n    console.log('restartAIElectrician: Restarting AI Electrician');\r\n    \r\n    //      \r\n    set({\r\n      aiElectrician: {\r\n        ...state.aiElectrician,\r\n        energy: Math.max(50, state.aiElectrician.energy), //  50 \r\n        equipment: {\r\n          battery: Math.max(50, state.aiElectrician.equipment.battery),\r\n          capacitor: Math.max(50, state.aiElectrician.equipment.capacitor), \r\n          wires: Math.max(50, state.aiElectrician.equipment.wires),\r\n          generator: Math.max(50, state.aiElectrician.equipment.generator)\r\n        },\r\n        lastMessage: ',    !',\r\n        messageTime: Date.now()\r\n      }\r\n    });\r\n    \r\n    //  \r\n    get().startAIElectrician();\r\n  },\r\n\r\n  stopAIElectrician: () => {\r\n    set(state => ({\r\n      singleMode: {\r\n        ...state.singleMode,\r\n        aiElectricianActive: false,\r\n        nextDischargeTime: 0,\r\n        dischargeWarningTime: 0,\r\n        isDischarging: false\r\n      },\r\n      aiElectrician: {\r\n        ...state.aiElectrician,\r\n        isActive: false,\r\n        lastMessage: ' ,  !',\r\n        messageTime: Date.now()\r\n      }\r\n    }));\r\n  },\r\n\r\n  scheduleNextDischarge: () => {\r\n    const state = get();\r\n    console.log('scheduleNextDischarge: Starting, AI active:', state.singleMode.aiElectricianActive);\r\n    if (!state.singleMode.aiElectricianActive) return;\r\n\r\n    const now = Date.now();\r\n    \r\n    //          AI \r\n    const getDischargeInterval = () => {\r\n      const baseInterval = {\r\n        easy: { min: 3000, max: 8000 },     // 3-8  -    \r\n        medium: { min: 2500, max: 6000 },   // 2.5-6   \r\n        hard: { min: 2000, max: 4000 },     // 2-4 \r\n        extreme: { min: 1500, max: 3000 }   // 1.5-3 \r\n      }[state.singleMode.difficulty];\r\n\r\n      //    AI \r\n      let modifier = 1.0;\r\n      if (state.singleMode.aiPattern === 'burst') modifier = 0.7;      // \r\n      else if (state.singleMode.aiPattern === 'random') modifier = Math.random() * 0.8 + 0.6; // 0.6-1.4\r\n      else if (state.singleMode.aiPattern === 'adaptive') {\r\n        //    \r\n        const luckCoeff = state.player.luckCoefficient;\r\n        modifier = luckCoeff > 70 ? 0.8 : luckCoeff < 30 ? 1.3 : 1.0;\r\n      }\r\n\r\n      const min = baseInterval.min * modifier;\r\n      const max = baseInterval.max * modifier;\r\n      return Math.random() * (max - min) + min;\r\n    };\r\n\r\n    const interval = getDischargeInterval();\r\n    const nextDischargeTime = now + interval;\r\n    const dischargeWarningTime = nextDischargeTime - 3000; //   3 \r\n\r\n    console.log('scheduleNextDischarge: Scheduled discharge', {\r\n      interval: interval / 1000 + 's',\r\n      nextDischargeTime,\r\n      dischargeWarningTime,\r\n      timeFromNow: (nextDischargeTime - now) / 1000 + 's'\r\n    });\r\n\r\n    set({\r\n      singleMode: {\r\n        ...state.singleMode,\r\n        nextDischargeTime,\r\n        dischargeWarningTime\r\n      }\r\n    });\r\n\r\n    //   \r\n    setTimeout(() => {\r\n      console.log('scheduleNextDischarge: Timer triggered, checking discharge');\r\n      get().checkForDischarge();\r\n    }, interval);\r\n  },\r\n\r\n  checkForDischarge: () => {\r\n    const state = get();\r\n    if (!state.singleMode.aiElectricianActive || !state.gameState.isPlaying) {\r\n      console.log('checkForDischarge: AI inactive or game not playing', { \r\n        aiActive: state.singleMode.aiElectricianActive, \r\n        isPlaying: state.gameState.isPlaying \r\n      });\r\n      return;\r\n    }\r\n\r\n    const now = Date.now();\r\n    console.log('checkForDischarge: Checking discharge timing', {\r\n      now,\r\n      nextDischargeTime: state.singleMode.nextDischargeTime,\r\n      timeUntilDischarge: state.singleMode.nextDischargeTime - now,\r\n      isDischarging: state.singleMode.isDischarging,\r\n      warningSignsActive: state.singleMode.warningSignsActive,\r\n      dischargeWarningTime: state.singleMode.dischargeWarningTime\r\n    });\r\n\r\n    // ,     \r\n    if (!state.singleMode.warningSignsActive && now >= state.singleMode.dischargeWarningTime) {\r\n      console.log('checkForDischarge: Activating warning signs');\r\n      set({\r\n        singleMode: {\r\n          ...state.singleMode,\r\n          warningSignsActive: true,\r\n          dangerLevel: 85 //   \r\n        }\r\n      });\r\n    }\r\n\r\n    // ,     \r\n    if (now >= state.singleMode.nextDischargeTime && !state.singleMode.isDischarging) {\r\n      console.log('checkForDischarge: STARTING DISCHARGE!');\r\n      //  \r\n      set({\r\n        singleMode: {\r\n          ...state.singleMode,\r\n          isDischarging: true\r\n        },\r\n        showElectricSparks: true,\r\n        sparksIntensity: 'high'\r\n      });\r\n\r\n      //      \r\n      set({\r\n        aiElectrician: {\r\n          ...state.aiElectrician,\r\n          successfulDischarges: state.aiElectrician.successfulDischarges + 1,\r\n          lastMessage: ' !   !',\r\n          messageTime: now\r\n        }\r\n      });\r\n\r\n      //     \r\n      if (Math.random() < 0.3) { // 30%  \r\n        get().damageAIElectrician('equipment', Math.random() * 5 + 2);\r\n      }\r\n\r\n      //    dischargeDuration\r\n      setTimeout(() => {\r\n        console.log('checkForDischarge: ENDING DISCHARGE after', state.singleMode.dischargeDuration, 'ms');\r\n        const currentState = get();\r\n        set({\r\n          singleMode: {\r\n            ...currentState.singleMode,\r\n            isDischarging: false,\r\n            warningSignsActive: false,\r\n            dangerLevel: 0\r\n          },\r\n          showElectricSparks: false\r\n        });\r\n\r\n        //    \r\n        get().updateAIElectrician();\r\n\r\n        //       \r\n        if (get().aiElectrician.canWork) {\r\n          console.log('checkForDischarge: Scheduling next discharge after ending current one');\r\n          get().scheduleNextDischarge();\r\n        } else {\r\n          //     ,    \r\n          console.log('checkForDischarge: AI electrician is tired/broken, scheduling with delay');\r\n          set({\r\n            aiElectrician: {\r\n              ...get().aiElectrician,\r\n              lastMessage: get().getAIElectricianMessage(),\r\n              messageTime: Date.now()\r\n            }\r\n          });\r\n          \r\n          //       (30 )\r\n          setTimeout(() => {\r\n            if (get().singleMode.aiElectricianActive && get().gameState.isPlaying) {\r\n              console.log('checkForDischarge: Tired AI attempting to work again');\r\n              get().scheduleNextDischarge();\r\n            }\r\n          }, 30000);\r\n        }\r\n      }, state.singleMode.dischargeDuration);\r\n    }\r\n  },\r\n\r\n  // AI Electrician management methods\r\n  updateAIElectrician: () => {\r\n    const state = get();\r\n    if (!state.aiElectrician.isActive) {\r\n      console.log('updateAIElectrician: AI not active, skipping');\r\n      return;\r\n    }\r\n\r\n    const ai = state.aiElectrician;\r\n    const now = Date.now();\r\n\r\n    console.log('updateAIElectrician: Current state', {\r\n      energy: ai.energy.toFixed(1),\r\n      voltage: ai.voltage.toFixed(1),\r\n      efficiency: ai.workingEfficiency.toFixed(1),\r\n      mood: ai.mood,\r\n      canWork: ai.canWork\r\n    });\r\n\r\n    //      \r\n    const energyDrain = ai.workingEfficiency > 80 ? 0.1 : 0.2;\r\n    let newEnergy = Math.max(0, ai.energy - energyDrain);\r\n    \r\n    //   -    \r\n    let newFatigueLevel = ai.fatigueLevel;\r\n    const wasEnergyLow = ai.energy > 10;\r\n    const isEnergyLow = newEnergy <= 10;\r\n    \r\n    //       10\r\n    if (isEnergyLow && wasEnergyLow) {\r\n      newFatigueLevel = Math.min(10, ai.fatigueLevel + 0.1);\r\n    }\r\n    \r\n    //        ( )\r\n    if (isEnergyLow) {\r\n      newEnergy = Math.min(ai.maxEnergy, newEnergy + 0.5); //  \r\n      console.log('updateAIElectrician: AI resting, energy recovery:', newEnergy.toFixed(1));\r\n      \r\n      //         \r\n      if (Math.floor(newFatigueLevel) > Math.floor(ai.fatigueLevel) && Math.random() < 0.5) {\r\n        console.log(`AI fatigue level increased to ${Math.floor(newFatigueLevel)}, dropping item`);\r\n        get().dropElectricianItem();\r\n      }\r\n    } else if (newEnergy > 50) {\r\n      //     \r\n      newFatigueLevel = Math.max(0, ai.fatigueLevel - 0.05);\r\n    }\r\n\r\n    //    \r\n    const voltageGain = ai.voltageChargeRate * (ai.workingEfficiency / 100);\r\n    const newVoltage = Math.min(ai.maxVoltage, ai.voltage + voltageGain);\r\n\r\n    //  \r\n    const equipmentWear = Math.random() * 0.05; // 0-5% \r\n    const newEquipment = {\r\n      battery: Math.max(0, ai.equipment.battery - equipmentWear),\r\n      capacitor: Math.max(0, ai.equipment.capacitor - equipmentWear * 0.5),\r\n      wires: Math.max(0, ai.equipment.wires - equipmentWear * 0.3),\r\n      generator: Math.max(0, ai.equipment.generator - equipmentWear * 0.7)\r\n    };\r\n    \r\n    //    \r\n    const avgEquipment = (newEquipment.battery + newEquipment.capacitor + \r\n                          newEquipment.wires + newEquipment.generator) / 4;\r\n    \r\n    //    ()\r\n    if (avgEquipment < 30) {\r\n      const selfRepair = 0.1; //   \r\n      newEquipment.battery = Math.min(100, newEquipment.battery + selfRepair);\r\n      newEquipment.capacitor = Math.min(100, newEquipment.capacitor + selfRepair);\r\n      newEquipment.wires = Math.min(100, newEquipment.wires + selfRepair);\r\n      newEquipment.generator = Math.min(100, newEquipment.generator + selfRepair);\r\n      console.log('updateAIElectrician: Equipment self-repair activated');\r\n    }\r\n\r\n    //   \r\n    const newEfficiency = Math.min(100, (newEnergy * 0.7) + (avgEquipment * 0.3));\r\n\r\n    //  \r\n    let newMood = ai.mood;\r\n    if (newEfficiency < 20) newMood = 'broken';\r\n    else if (newEfficiency < 40) newMood = 'tired';\r\n    else if (ai.failuresCount > ai.successfulDischarges) newMood = 'frustrated';\r\n    else if (ai.playerAttacksReceived > 3) newMood = 'angry'; //    \r\n    else if (newEfficiency > 80) newMood = 'confident';\r\n\r\n    //   \r\n    const canWork = newEnergy > 10 && avgEquipment > 15;\r\n\r\n    // ,    \r\n    const shouldAttackPlayer = newVoltage >= 100 && //  \r\n                              (ai.playerAttacksReceived > 2 || //    \r\n                               newMood === 'angry' || //  \r\n                               Math.random() < 0.05); // 5%  \r\n\r\n    if (shouldAttackPlayer && now - ai.lastAttackTime > 30000) { //  30   \r\n      setTimeout(() => {\r\n        get().aiElectricianAttackPlayer();\r\n      }, Math.random() * 5000); //   0-5 \r\n    }\r\n\r\n    set({\r\n      aiElectrician: {\r\n        ...ai,\r\n        energy: newEnergy,\r\n        voltage: newVoltage,\r\n        equipment: newEquipment,\r\n        workingEfficiency: newEfficiency,\r\n        mood: newMood,\r\n        canWork,\r\n        fatigueLevel: newFatigueLevel\r\n      }\r\n    });\r\n  },\r\n\r\n  damageAIElectrician: (damageType: 'energy' | 'equipment', amount = 10, isPlayerAttack = false) => {\r\n    const state = get();\r\n    const ai = state.aiElectrician;\r\n\r\n    if (damageType === 'energy') {\r\n      const newEnergy = Math.max(0, ai.energy - amount);\r\n      \r\n      let message: string;\r\n      if (isPlayerAttack) {\r\n        //     \r\n        const playerAttackMessages = [\r\n          '!   , ?! ',\r\n          ',  !   ! ',\r\n          '!     ... ',\r\n          '!   ?! ',\r\n          '     ?! ',\r\n          ' !     ! ',\r\n          ' !   ! ',\r\n          ' ,   ?! ',\r\n          '-,   ... ',\r\n          '--!     ! ',\r\n          '!    ! ',\r\n          ' ?!   ,   ! ',\r\n          '   , ? ',\r\n          '    ?! ',\r\n          ' ,    ... ',\r\n          ',   !   ! ',\r\n          '!  ,    ... '\r\n        ];\r\n        message = playerAttackMessages[Math.floor(Math.random() * playerAttackMessages.length)];\r\n      } else {\r\n        message = newEnergy <= 0 ? ' !  ...' : '!   !';\r\n      }\r\n      \r\n      set({\r\n        aiElectrician: {\r\n          ...ai,\r\n          energy: newEnergy,\r\n          failuresCount: ai.failuresCount + 1,\r\n          playerAttacksReceived: isPlayerAttack ? ai.playerAttacksReceived + 1 : ai.playerAttacksReceived,\r\n          lastMessage: message,\r\n          messageTime: Date.now()\r\n        }\r\n      });\r\n    } else {\r\n      //   \r\n      const equipmentTypes = ['battery', 'capacitor', 'wires', 'generator'] as const;\r\n      const randomEquipment = equipmentTypes[Math.floor(Math.random() * equipmentTypes.length)];\r\n      \r\n      const newEquipment = {\r\n        ...ai.equipment,\r\n        [randomEquipment]: Math.max(0, ai.equipment[randomEquipment] - amount)\r\n      };\r\n\r\n      let message: string;\r\n      if (isPlayerAttack) {\r\n        //       \r\n        const equipmentDamageMessages = [\r\n          `   ${randomEquipment === 'battery' ? '' : \r\n                          randomEquipment === 'capacitor' ? '' :\r\n                          randomEquipment === 'wires' ? '' : ''}!   ?! `,\r\n          `!  ${randomEquipment === 'battery' ? '' : \r\n                          randomEquipment === 'capacitor' ? '' :\r\n                          randomEquipment === 'wires' ? '' : ''} ! `,\r\n          ` !  ${randomEquipment === 'battery' ? '' : \r\n                        randomEquipment === 'capacitor' ? '' :\r\n                        randomEquipment === 'wires' ? '' : ''}    ! `,\r\n          `  ,  ${randomEquipment === 'battery' ? '' : \r\n                                  randomEquipment === 'capacitor' ? '' :\r\n                                  randomEquipment === 'wires' ? '' : ''}  ?! `,\r\n          '    !   ... '\r\n        ];\r\n        message = equipmentDamageMessages[Math.floor(Math.random() * equipmentDamageMessages.length)];\r\n      } else {\r\n        message = ` ${randomEquipment === 'battery' ? '' : \r\n                               randomEquipment === 'capacitor' ? '' :\r\n                               randomEquipment === 'wires' ? '' : ''}!`;\r\n      }\r\n\r\n      set({\r\n        aiElectrician: {\r\n          ...ai,\r\n          equipment: newEquipment,\r\n          failuresCount: ai.failuresCount + 1,\r\n          lastMessage: message,\r\n          messageTime: Date.now()\r\n        }\r\n      });\r\n    }\r\n\r\n    //  \r\n    get().updateAIElectrician();\r\n  },\r\n\r\n  repairAIElectrician: (repairType: 'energy' | 'equipment') => {\r\n    const state = get();\r\n    const ai = state.aiElectrician;\r\n\r\n    if (repairType === 'energy') {\r\n      const newEnergy = Math.min(ai.maxEnergy, ai.energy + 25);\r\n      const repairMessages = [\r\n        '!   !',\r\n        '!     !',\r\n        ' !   !',\r\n        '!    !'\r\n      ];\r\n      set({\r\n        aiElectrician: {\r\n          ...ai,\r\n          energy: newEnergy,\r\n          lastMessage: repairMessages[Math.floor(Math.random() * repairMessages.length)],\r\n          messageTime: Date.now()\r\n        }\r\n      });\r\n    } else {\r\n      //     20%\r\n      const newEquipment = {\r\n        battery: Math.min(100, ai.equipment.battery + 20),\r\n        capacitor: Math.min(100, ai.equipment.capacitor + 20),\r\n        wires: Math.min(100, ai.equipment.wires + 20),\r\n        generator: Math.min(100, ai.equipment.generator + 20)\r\n      };\r\n\r\n      const repairMessages = [\r\n        ' ,   !',\r\n        '  !   !',\r\n        '  ,  !',\r\n        ' !    !'\r\n      ];\r\n\r\n      set({\r\n        aiElectrician: {\r\n          ...ai,\r\n          equipment: newEquipment,\r\n          lastMessage: repairMessages[Math.floor(Math.random() * repairMessages.length)],\r\n          messageTime: Date.now()\r\n        }\r\n      });\r\n    }\r\n\r\n    get().updateAIElectrician();\r\n  },\r\n\r\n  aiElectricianAttackPlayer: () => {\r\n    const state = get();\r\n    const ai = state.aiElectrician;\r\n    \r\n    if (!ai.isActive || ai.voltage < 100) return;\r\n\r\n    console.log('AI Electrician attacking player!', {\r\n      aiVoltage: ai.voltage,\r\n      playerVolts: state.player.volts\r\n    });\r\n\r\n    //     \r\n    const baseDamage = 20;\r\n    const voltageDamage = Math.floor(ai.voltage / 20); // 1    20 \r\n    const totalDamage = baseDamage + voltageDamage;\r\n    \r\n    //   \r\n    const attackMessages = [\r\n      `! ${ai.voltage}    ! `,\r\n      `      ! ${ai.voltage}! `,\r\n      `   ?   ${ai.voltage} ! `,\r\n      ` ! ${ai.voltage}  ! `,\r\n      `   ${ai.voltage}!   ! `,\r\n      `    ,    ! ${ai.voltage}! `,\r\n      ` ! ${ai.voltage}    ! `,\r\n      `  !  ${ai.voltage} ! `,\r\n    ];\r\n\r\n    // :       TigerOutlet\r\n    set({\r\n      singleMode: {\r\n        ...state.singleMode,\r\n        isDischarging: true,\r\n        warningSignsActive: true,\r\n        dangerLevel: 100\r\n      }\r\n    });\r\n\r\n    //   \r\n    set({\r\n      aiElectrician: {\r\n        ...ai,\r\n        voltage: 0, //    \r\n        lastAttackTime: Date.now(),\r\n        lastMessage: attackMessages[Math.floor(Math.random() * attackMessages.length)],\r\n        messageTime: Date.now(),\r\n        playerAttacksReceived: Math.max(0, ai.playerAttacksReceived - 1) //   \r\n      }\r\n    });\r\n\r\n    //    ( )\r\n    const newPlayerVolts = Math.max(0, state.player.volts - totalDamage);\r\n    \r\n    set({\r\n      player: {\r\n        ...state.player,\r\n        volts: newPlayerVolts\r\n      }\r\n    });\r\n\r\n    //  \r\n    set({\r\n      showElectricSparks: true,\r\n      sparksIntensity: 'extreme'\r\n    });\r\n\r\n    //    3 \r\n    setTimeout(() => {\r\n      set({\r\n        showElectricSparks: false,\r\n        singleMode: {\r\n          ...get().singleMode,\r\n          isDischarging: false,\r\n          warningSignsActive: false,\r\n          dangerLevel: 0\r\n        }\r\n      });\r\n      // :       \r\n      if (get().singleMode.aiElectricianActive && get().gameState.isPlaying) {\r\n        console.log('AI attack complete, restarting discharge scheduling');\r\n        get().scheduleNextDischarge();\r\n      }\r\n    }, 3000);\r\n    effectsBus.emit('aiAttack', { voltage: ai.voltage });\r\n  },\r\n\r\n  getAIElectricianMessage: () => {\r\n    const state = get();\r\n    const ai = state.aiElectrician;\r\n\r\n    const messages = {\r\n      confident: [\r\n        '    !',\r\n        '    !',\r\n        '    !',\r\n        '   !',\r\n        ' -  !',\r\n        '      !',\r\n        '    !'\r\n      ],\r\n      frustrated: [\r\n        '-    ...',\r\n        ' ,  ...',\r\n        ' ,   ?',\r\n        ' -   !',\r\n        '     ?',\r\n        '    ?!',\r\n        '   ...'\r\n      ],\r\n      tired: [\r\n        '  ...',\r\n        '   ',\r\n        '   ',\r\n        ' ...',\r\n        '   ',\r\n        '  ',\r\n        ',   ?'\r\n      ],\r\n      broken: [\r\n        ' !   !',\r\n        ' !    !',\r\n        '  ...',\r\n        '  ,    !',\r\n        ' !  !',\r\n        ' ! !',\r\n        '    !'\r\n      ],\r\n      angry: [\r\n        '   ?!  !',\r\n        '   ?!',\r\n        '   !',\r\n        '   !',\r\n        '    ?!',\r\n        '  ?!   !',\r\n        ' ! !',\r\n        '    !'\r\n      ]\r\n    };\r\n\r\n    const moodMessages = messages[ai.mood] || messages.confident;\r\n    return moodMessages[Math.floor(Math.random() * moodMessages.length)];\r\n  },\r\n\r\n  // API integration methods\r\n  submitGameToServer: async () => {\r\n    const state = get();\r\n    \r\n    // ,   \r\n    if (!apiClient.isAuthenticated()) {\r\n      console.warn('User not authenticated, skipping server submission');\r\n      return { success: false, error: 'Not authenticated' };\r\n    }\r\n\r\n    try {\r\n      //    \r\n      const gameData = {\r\n        score: state.gameState.score,\r\n        level: getDifficultyLevel(state.singleMode.difficulty),\r\n        timePlayed: Math.floor(state.gameState.gameTime / 1000), //  \r\n      };\r\n\r\n      console.log('Submitting game data to server:', gameData);\r\n\r\n      const response = await apiClient.submitScore(gameData);\r\n\r\n      if (response.error) {\r\n        console.error('Failed to submit score:', response.error);\r\n        return { success: false, error: response.error };\r\n      }\r\n\r\n      if (response.data) {\r\n        //      \r\n        const serverData = response.data;\r\n        \r\n        set({\r\n          player: {\r\n            ...state.player,\r\n            volts: serverData.totalVolts,\r\n            experience: serverData.totalExperience,\r\n            level: serverData.newLevel\r\n          }\r\n        });\r\n\r\n        //     ,  \r\n        if (serverData.leveledUp) {\r\n          const { showLevelUpNotification } = get();\r\n          showLevelUpNotification(\r\n            { level: serverData.newLevel }, \r\n            serverData.levelUpReward\r\n          );\r\n        }\r\n\r\n        console.log('Successfully submitted score and synced with server');\r\n        return { success: true };\r\n      }\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\r\n      console.error('Error submitting game to server:', errorMessage);\r\n      return { success: false, error: errorMessage };\r\n    }\r\n  },\r\n\r\n  syncWithServer: async () => {\r\n    if (!apiClient.isAuthenticated()) {\r\n      return { success: false, error: 'Not authenticated' };\r\n    }\r\n\r\n    try {\r\n      const response = await apiClient.getUserStats();\r\n\r\n      if (response.error) {\r\n        return { success: false, error: response.error };\r\n      }\r\n\r\n      if (response.data) {\r\n        const serverData = response.data;\r\n        \r\n        //      \r\n        set({\r\n          player: {\r\n            ...get().player,\r\n            volts: serverData.totalVolts,\r\n            experience: serverData.totalExperience,\r\n            level: serverData.level\r\n          }\r\n        });\r\n\r\n        console.log('Successfully synced with server');\r\n        return { success: true };\r\n      }\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\r\n      console.error('Error syncing with server:', errorMessage);\r\n      return { success: false, error: errorMessage };\r\n    }\r\n  },\r\n\r\n  loadStatsFromServer: async () => {\r\n    if (!apiClient.isAuthenticated()) {\r\n      return { success: false, error: 'Not authenticated' };\r\n    }\r\n\r\n    try {\r\n      const response = await apiClient.getUserStats();\r\n\r\n      if (response.error) {\r\n        return { success: false, error: response.error };\r\n      }\r\n\r\n      if (response.data) {\r\n        const serverData = response.data;\r\n        \r\n        //     \r\n        set({\r\n          player: {\r\n            ...get().player,\r\n            volts: serverData.totalVolts,\r\n            experience: serverData.totalExperience,\r\n            level: serverData.level\r\n          }\r\n        });\r\n\r\n        console.log('Successfully loaded stats from server');\r\n        return { success: true };\r\n      }\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\r\n      console.error('Error loading stats from server:', errorMessage);\r\n      return { success: false, error: errorMessage };\r\n    }\r\n  },\r\n\r\n  // Protection shop functions\r\n  buyProtectionItem: (type: keyof PlayerProtection, level: number) => {\r\n    const shopItems = get().getShopItems();\r\n    const item = shopItems.find(item => item.type === type && item.level === level);\r\n    if (!item) return false;\r\n\r\n    const currentPlayer = get().player;\r\n    if (currentPlayer.volts < item.price) return false;\r\n\r\n    set((state) => ({\r\n      player: {\r\n        ...state.player,\r\n        volts: state.player.volts - item.price,\r\n        protection: {\r\n          ...state.player.protection,\r\n          [type]: {\r\n            level: item.level,\r\n            protection: item.protection,\r\n            durability: item.durability,\r\n            maxDurability: item.durability\r\n          }\r\n        }\r\n      }\r\n    }));\r\n\r\n    return true;\r\n  },\r\n\r\n  getShopItems: (): ShopItem[] => {\r\n    return [\r\n      // \r\n      { id: 'gloves-1', type: 'gloves', level: 1, protection: 10, price: 50, durability: 100, name: ' ', description: '    ', icon: '' },\r\n      { id: 'gloves-2', type: 'gloves', level: 2, protection: 20, price: 150, durability: 200, name: ' ', description: '    ', icon: '' },\r\n      { id: 'gloves-3', type: 'gloves', level: 3, protection: 35, price: 400, durability: 300, name: ' ', description: '    ', icon: '' },\r\n      \r\n      // \r\n      { id: 'boots-1', type: 'boots', level: 1, protection: 15, price: 80, durability: 150, name: ' ', description: '   ', icon: '' },\r\n      { id: 'boots-2', type: 'boots', level: 2, protection: 25, price: 200, durability: 250, name: ' ', description: '   ', icon: '' },\r\n      { id: 'boots-3', type: 'boots', level: 3, protection: 40, price: 500, durability: 350, name: ' ', description: '   ', icon: '' },\r\n      \r\n      // \r\n      { id: 'suit-1', type: 'suit', level: 1, protection: 20, price: 200, durability: 120, name: ' ', description: '    ', icon: '' },\r\n      { id: 'suit-2', type: 'suit', level: 2, protection: 35, price: 500, durability: 200, name: ' ', description: '   ', icon: '' },\r\n      { id: 'suit-3', type: 'suit', level: 3, protection: 50, price: 1000, durability: 300, name: ' ', description: '   ', icon: '' },\r\n      \r\n      // \r\n      { id: 'helmet-1', type: 'helmet', level: 1, protection: 10, price: 100, durability: 200, name: ' ', description: '    ', icon: '' },\r\n      { id: 'helmet-2', type: 'helmet', level: 2, protection: 20, price: 300, durability: 300, name: ' ', description: '  ', icon: '' },\r\n      { id: 'helmet-3', type: 'helmet', level: 3, protection: 30, price: 600, durability: 400, name: ' ', description: '  ', icon: '' }\r\n    ];\r\n  },\r\n\r\n  getTotalProtection: (): number => {\r\n    const protection = get().player.protection;\r\n    let total = 0;\r\n    \r\n    Object.values(protection).forEach(item => {\r\n      if (item.durability > 0) {\r\n        //    \r\n        const durabilityRatio = item.durability / item.maxDurability;\r\n        total += item.protection * durabilityRatio;\r\n      }\r\n    });\r\n    \r\n    return Math.min(total, 80); //  80% \r\n  },\r\n\r\n  damageProtection: (damage: number) => {\r\n    set((state) => {\r\n      const newProtection = { ...state.player.protection };\r\n      \r\n      //      \r\n      Object.keys(newProtection).forEach(key => {\r\n        const item = newProtection[key as keyof PlayerProtection];\r\n        if (item.durability > 0 && Math.random() < 0.3) { // 30%  \r\n          item.durability = Math.max(0, item.durability - Math.floor(damage / 4));\r\n        }\r\n      });\r\n      \r\n      return {\r\n        player: {\r\n          ...state.player,\r\n          protection: newProtection\r\n        }\r\n      };\r\n    });\r\n  }\r\n}));\r\n\r\n//        \r\nfunction getDifficultyLevel(difficulty: SingleModeState['difficulty']): number {\r\n  switch (difficulty) {\r\n    case 'easy': return 1;\r\n    case 'medium': return 2;\r\n    case 'hard': return 3;\r\n    case 'extreme': return 4;\r\n    default: return 1;\r\n  }\r\n}\r\n\r\n//  ,     mutate\r\n// :         set  \r\n// : attachStageAndPointsHandlers IIFE;     \r\n","/**\r\n * Haptic Manager -    Telegram Mini App\r\n *       \r\n */\r\n\r\nimport type { TelegramHapticFeedback } from '../types/telegram';\r\n\r\n//   Telegram Web App\r\nexport type HapticType = 'light' | 'medium' | 'heavy' | 'rigid' | 'soft';\r\nexport type NotificationType = 'error' | 'success' | 'warning';\r\n\r\n//  Window   Telegram\r\ndeclare global {\r\n  interface Window {\r\n    Telegram?: {\r\n      WebApp?: {\r\n        HapticFeedback?: TelegramHapticFeedback;\r\n        [key: string]: any;\r\n      };\r\n    };\r\n  }\r\n}\r\n\r\nclass HapticManager {\r\n  private hapticFeedback: TelegramHapticFeedback | null = null;\r\n  private isEnabled: boolean = true;\r\n  private isTelegramEnvironment: boolean = false;\r\n\r\n  constructor() {\r\n    this.initializeTelegramHaptics();\r\n  }\r\n\r\n  /**\r\n   *  Telegram Haptic API\r\n   */\r\n  private initializeTelegramHaptics(): void {\r\n    try {\r\n      // ,     Telegram\r\n      if (typeof window !== 'undefined' && window.Telegram?.WebApp) {\r\n        this.isTelegramEnvironment = true;\r\n        //   HapticFeedback   WebApp\r\n        const webApp = window.Telegram.WebApp as any;\r\n        if (webApp.HapticFeedback) {\r\n          this.hapticFeedback = webApp.HapticFeedback;\r\n          console.log('Telegram Haptic Feedback initialized');\r\n        } else {\r\n          console.log('HapticFeedback not available in this Telegram version');\r\n        }\r\n      } else {\r\n        console.log('Not in Telegram environment, haptics disabled');\r\n      }\r\n    } catch (error) {\r\n      console.warn('Failed to initialize Telegram haptics:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * / \r\n   */\r\n  setEnabled(enabled: boolean): void {\r\n    this.isEnabled = enabled;\r\n  }\r\n\r\n  /**\r\n   *   \r\n   */\r\n  isAvailable(): boolean {\r\n    return (\r\n      (this.isTelegramEnvironment && this.hapticFeedback !== null) || \r\n      (typeof window !== 'undefined' && 'navigator' in window && 'vibrate' in navigator)\r\n    ) && this.isEnabled;\r\n  }\r\n\r\n  /**\r\n   *    \r\n   */\r\n  light(): void {\r\n    if (this.isAvailable()) {\r\n      this.hapticFeedback!.impactOccurred('light');\r\n    } else {\r\n      this.fallbackVibration(50);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *     \r\n   */\r\n  medium(): void {\r\n    if (this.isAvailable()) {\r\n      this.hapticFeedback!.impactOccurred('medium');\r\n    } else {\r\n      this.fallbackVibration(100);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *     \r\n   */\r\n  heavy(): void {\r\n    if (this.isAvailable()) {\r\n      this.hapticFeedback!.impactOccurred('heavy');\r\n    } else {\r\n      this.fallbackVibration(150);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *     \r\n   */\r\n  soft(): void {\r\n    if (this.isAvailable()) {\r\n      this.hapticFeedback!.impactOccurred('soft');\r\n    } else {\r\n      this.fallbackVibration(30);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *     \r\n   */\r\n  rigid(): void {\r\n    if (this.isAvailable()) {\r\n      this.hapticFeedback!.impactOccurred('rigid');\r\n    } else {\r\n      this.fallbackVibration(200);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *   \r\n   */\r\n  success(): void {\r\n    if (this.isAvailable()) {\r\n      this.hapticFeedback!.notificationOccurred('success');\r\n    } else {\r\n      this.customPattern([100, 50, 100]);\r\n    }\r\n  }\r\n\r\n  error(): void {\r\n    if (this.isAvailable()) {\r\n      this.hapticFeedback!.notificationOccurred('error');\r\n    } else {\r\n      this.customPattern([200, 100, 200, 100, 200]);\r\n    }\r\n  }\r\n\r\n  warning(): void {\r\n    if (this.isAvailable()) {\r\n      this.hapticFeedback!.notificationOccurred('warning');\r\n    } else {\r\n      this.customPattern([150, 50, 150]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *    \r\n   */\r\n  selection(): void {\r\n    if (this.isAvailable()) {\r\n      this.hapticFeedback!.selectionChanged();\r\n    } else {\r\n      this.fallbackVibration(25);\r\n    }\r\n  }\r\n\r\n  // ====================   ====================\r\n\r\n  /**\r\n   *     \r\n   */\r\n  outletPress(): void {\r\n    this.medium();\r\n  }\r\n\r\n  /**\r\n   *    \r\n   */\r\n  survivalSuccess(): void {\r\n    this.success();\r\n  }\r\n\r\n  /**\r\n   *     \r\n   *       \r\n   */\r\n  electricShock(): void {\r\n    if (!this.isEnabled) return;\r\n\r\n    //      \r\n    this.rigid();\r\n    \r\n    //       \r\n    setTimeout(() => {\r\n      if (this.isEnabled) this.heavy();\r\n    }, 50);\r\n  }\r\n\r\n  /**\r\n   *     \r\n   */\r\n  electricWarning(): void {\r\n    if (!this.isEnabled) return;\r\n    \r\n    //    \r\n    this.light();\r\n    setTimeout(() => {\r\n      if (this.isEnabled) this.light();\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   *    \r\n   */\r\n  levelUp(): void {\r\n    //   3- \r\n    this.success();\r\n    setTimeout(() => this.medium(), 150);\r\n    setTimeout(() => this.success(), 300);\r\n  }\r\n\r\n  /**\r\n   *     \r\n   */\r\n  dangerWarning(): void {\r\n    if (!this.isEnabled) return;\r\n    \r\n    //      \r\n    this.light();\r\n    setTimeout(() => {\r\n      if (this.isEnabled) this.light();\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   *      \r\n   */\r\n  extremeDangerWarning(): void {\r\n    if (!this.isEnabled) return;\r\n    \r\n    //     \r\n    this.light();\r\n    setTimeout(() => {\r\n      if (this.isEnabled) this.medium();\r\n    }, 150);\r\n    setTimeout(() => {\r\n      if (this.isEnabled) this.heavy();\r\n    }, 300);\r\n  }\r\n\r\n  /**\r\n   *    \r\n   */\r\n  rewardReceived(): void {\r\n    this.light();\r\n    setTimeout(() => this.medium(), 100);\r\n  }\r\n\r\n  /**\r\n   *    \r\n   */\r\n  streakAchievement(streakCount: number): void {\r\n    if (streakCount >= 25) {\r\n      //     \r\n      this.heavy();\r\n      setTimeout(() => this.heavy(), 200);\r\n      setTimeout(() => this.heavy(), 400);\r\n    } else if (streakCount >= 10) {\r\n      //     \r\n      this.medium();\r\n      setTimeout(() => this.medium(), 150);\r\n    } else if (streakCount >= 5) {\r\n      //     \r\n      this.light();\r\n      setTimeout(() => this.light(), 100);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *    \r\n   */\r\n  itemUsed(): void {\r\n    this.soft();\r\n  }\r\n\r\n  /**\r\n   *     \r\n   */\r\n  shopPurchase(): void {\r\n    this.medium();\r\n    setTimeout(() => this.light(), 100);\r\n  }\r\n\r\n  /**\r\n   *      \r\n   */\r\n  gameInvitation(): void {\r\n    this.warning();\r\n    setTimeout(() => this.light(), 500);\r\n    setTimeout(() => this.light(), 1000);\r\n  }\r\n\r\n  /**\r\n   *    \r\n   */\r\n  roundStart(): void {\r\n    this.light();\r\n  }\r\n\r\n  /**\r\n   *    \r\n   */\r\n  gameEnd(isWinner: boolean): void {\r\n    if (isWinner) {\r\n      this.success();\r\n      setTimeout(() => this.medium(), 200);\r\n      setTimeout(() => this.success(), 400);\r\n    } else {\r\n      this.error();\r\n    }\r\n  }\r\n\r\n  // ====================   ====================\r\n\r\n  /**\r\n   *      Telegram API\r\n   */\r\n  private fallbackVibration(duration: number): void {\r\n    if ('navigator' in window && 'vibrate' in navigator) {\r\n      try {\r\n        navigator.vibrate(duration);\r\n        console.log(` Fallback vibration: ${duration}ms`);\r\n      } catch (error) {\r\n        console.warn('Vibration not supported:', error);\r\n      }\r\n    } else {\r\n      //       \r\n      console.log(` Haptic feedback: ${duration}ms (visual only)`);\r\n      this.visualFeedback(duration);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *       \r\n   */\r\n  private visualFeedback(duration: number): void {\r\n    //    \r\n    const indicator = document.createElement('div');\r\n    indicator.style.cssText = `\r\n      position: fixed;\r\n      top: 20px;\r\n      right: 20px;\r\n      background: #FF6B35;\r\n      color: white;\r\n      padding: 8px 12px;\r\n      border-radius: 20px;\r\n      font-size: 12px;\r\n      font-weight: bold;\r\n      z-index: 10000;\r\n      pointer-events: none;\r\n      animation: pulse 0.3s ease-in-out;\r\n    `;\r\n    indicator.textContent = ` ${duration}ms`;\r\n    \r\n    //  CSS \r\n    if (!document.querySelector('#haptic-style')) {\r\n      const style = document.createElement('style');\r\n      style.id = 'haptic-style';\r\n      style.textContent = `\r\n        @keyframes pulse {\r\n          0% { transform: scale(0.8); opacity: 0; }\r\n          50% { transform: scale(1.1); opacity: 1; }\r\n          100% { transform: scale(1); opacity: 0.8; }\r\n        }\r\n      `;\r\n      document.head.appendChild(style);\r\n    }\r\n    \r\n    document.body.appendChild(indicator);\r\n    \r\n    setTimeout(() => {\r\n      if (indicator.parentNode) {\r\n        indicator.parentNode.removeChild(indicator);\r\n      }\r\n    }, Math.max(duration, 500));\r\n  }\r\n\r\n  /**\r\n   *   \r\n   */\r\n  private customPattern(pattern: number[]): void {\r\n    if ('navigator' in window && 'vibrate' in navigator) {\r\n      try {\r\n        navigator.vibrate(pattern);\r\n        console.log(` Vibration pattern: [${pattern.join(', ')}]ms`);\r\n      } catch (error) {\r\n        console.warn('Vibration pattern not supported:', error);\r\n      }\r\n    } else {\r\n      //      \r\n      console.log(` Haptic pattern: [${pattern.join(', ')}]ms (visual only)`);\r\n      this.visualPatternFeedback(pattern);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *    \r\n   */\r\n  private visualPatternFeedback(pattern: number[]): void {\r\n    let delay = 0;\r\n    for (let i = 0; i < pattern.length; i += 2) {\r\n      const vibrateDuration = pattern[i];\r\n      const pauseDuration = pattern[i + 1] || 0;\r\n      \r\n      setTimeout(() => {\r\n        this.visualFeedback(vibrateDuration);\r\n      }, delay);\r\n      \r\n      delay += vibrateDuration + pauseDuration;\r\n    }\r\n  }\r\n\r\n  /**\r\n   *    \r\n   */\r\n  test(): void {\r\n    this.medium();\r\n    setTimeout(() => this.light(), 200);\r\n    setTimeout(() => this.heavy(), 400);\r\n  }\r\n}\r\n\r\n//    \r\nexport const hapticManager = new HapticManager();\r\n\r\nexport default hapticManager;\r\n","import React from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { useGameStore } from '../store/gameStore';\r\n\r\ninterface ScoreBreakdownProps {\r\n  onClose: () => void;\r\n}\r\n\r\nexport const ScoreBreakdown: React.FC<ScoreBreakdownProps> = ({ onClose }) => {\r\n  const { player, singleMode, gameState } = useGameStore();\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: 1 }}\r\n      exit={{ opacity: 0 }}\r\n      className=\"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50\"\r\n      onClick={onClose}\r\n    >\r\n      <motion.div\r\n        initial={{ opacity: 0, y: 20, scale: 0.9 }}\r\n        animate={{ opacity: 1, y: 0, scale: 1 }}\r\n        exit={{ opacity: 0, y: 20, scale: 0.9 }}\r\n        className=\"glass-effect p-6 max-w-2xl mx-auto relative max-h-[90vh] overflow-y-auto\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        {/* Close Button */}\r\n        <button\r\n          onClick={onClose}\r\n          className=\"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors text-2xl\"\r\n        >\r\n          \r\n        </button>\r\n\r\n        <h3 className=\"text-2xl font-bold text-center mb-6 text-primary-orange\">\r\n              \r\n        </h3>\r\n\r\n        {/* Current Stats */}\r\n        <div className=\"grid grid-cols-2 gap-4 mb-6\">\r\n          <div className=\"text-center glass-effect p-3 rounded-lg\">\r\n            <div className=\"text-xs text-gray-400\"> </div>\r\n            <div className=\"text-xl font-bold text-yellow-400\">\r\n              {singleMode.streakCount}\r\n            </div>\r\n          </div>\r\n          <div className=\"text-center glass-effect p-3 rounded-lg\">\r\n            <div className=\"text-xs text-gray-400\"> </div>\r\n            <div className={`text-xl font-bold ${\r\n              player.luckCoefficient >= 70 ? 'text-green-400' :\r\n              player.luckCoefficient >= 50 ? 'text-yellow-400' :\r\n              player.luckCoefficient >= 30 ? 'text-orange-400' :\r\n              'text-red-400'\r\n            }`}>\r\n              {player.luckCoefficient}%\r\n            </div>\r\n          </div>\r\n          <div className=\"text-center glass-effect p-3 rounded-lg\">\r\n            <div className=\"text-xs text-gray-400\"> </div>\r\n            <div className=\"text-xl font-bold text-green-400\">\r\n              {gameState.score}\r\n            </div>\r\n          </div>\r\n          <div className=\"text-center glass-effect p-3 rounded-lg\">\r\n            <div className=\"text-xs text-gray-400\"> </div>\r\n            <div className=\"text-xl font-bold text-blue-400\">\r\n              {player.volts}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Luck Statistics */}\r\n        <div className=\"mb-6\">\r\n          <h4 className=\"text-lg font-bold text-accent-blue mb-3\">  </h4>\r\n          <div className=\"grid grid-cols-3 gap-3\">\r\n            <div className=\"glass-effect p-3 rounded-lg text-center\">\r\n              <div className=\"text-xs text-gray-400\"></div>\r\n              <div className=\"text-lg font-bold text-green-400\">{player.successfulClicks}</div>\r\n            </div>\r\n            <div className=\"glass-effect p-3 rounded-lg text-center\">\r\n              <div className=\"text-xs text-gray-400\"> </div>\r\n              <div className=\"text-lg font-bold text-red-400\">{player.shockedClicks}</div>\r\n            </div>\r\n            <div className=\"glass-effect p-3 rounded-lg text-center\">\r\n              <div className=\"text-xs text-gray-400\"> </div>\r\n              <div className=\"text-lg font-bold text-blue-400\">{player.totalClicks}</div>\r\n            </div>\r\n          </div>\r\n          <div className=\"mt-3 text-center\">\r\n            <div className=\"text-sm text-gray-300\">\r\n                    \r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Scoring Rules */}\r\n        <div className=\"space-y-6\">\r\n          {/* Experience System */}\r\n          <div>\r\n            <h4 className=\"text-lg font-bold text-accent-blue mb-3\">    </h4>\r\n            <div className=\"grid grid-cols-2 gap-3\">\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-green-400 font-bold\">  :</div>\r\n                <div className=\"text-sm text-gray-300\">+10 </div>\r\n              </div>\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-yellow-400 font-bold\">  (2x+):</div>\r\n                <div className=\"text-sm text-gray-300\">+15 </div>\r\n              </div>\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-red-400 font-bold\">  (3x+):</div>\r\n                <div className=\"text-sm text-gray-300\">+25 </div>\r\n              </div>\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-orange-400 font-bold\">  :</div>\r\n                <div className=\"text-sm text-gray-300\">+5 </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"mt-3 text-center\">\r\n              <div className=\"text-sm text-yellow-400 font-semibold\">\r\n                       !\r\n              </div>\r\n              <div className=\"text-xs text-gray-400 mt-1\">\r\n                 2: +50   5: +150   10: +500\r\n              </div>\r\n              <div className=\"text-xs text-blue-300 mt-2\">\r\n                     5 !\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Basic Points Table */}\r\n          <div>\r\n            <h4 className=\"text-lg font-bold text-accent-blue mb-3\">    </h4>\r\n            <div className=\"grid grid-cols-2 gap-3\">\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-green-400 font-bold\">  :</div>\r\n                <div className=\"text-sm text-gray-300\">+10 ( )</div>\r\n              </div>\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-red-400 font-bold\">  :</div>\r\n                <div className=\"text-sm text-gray-300\">-8  -25 ()</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Risk Multipliers */}\r\n          <div>\r\n            <h4 className=\"text-lg font-bold text-accent-blue mb-3\">   </h4>\r\n            <div className=\"grid grid-cols-2 gap-3\">\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-green-400 font-bold\">  (15% ):</div>\r\n                <div className=\"text-sm text-gray-300\">1.0 ( )</div>\r\n              </div>\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-yellow-400 font-bold\">  (25% ):</div>\r\n                <div className=\"text-sm text-gray-300\">1.5 </div>\r\n              </div>\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-orange-400 font-bold\">  (35% ):</div>\r\n                <div className=\"text-sm text-gray-300\">2.0 </div>\r\n              </div>\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-red-400 font-bold\">  (50% ):</div>\r\n                <div className=\"text-sm text-gray-300\">3.0 </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Streak Bonuses */}\r\n          <div>\r\n            <h4 className=\"text-lg font-bold text-accent-blue mb-3\">   </h4>\r\n            <div className=\"grid grid-cols-2 gap-3\">\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-gray-400 font-bold\">0-4 :</div>\r\n                <div className=\"text-sm text-gray-300\">1.0 ( )</div>\r\n              </div>\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-yellow-400 font-bold\">5+ :</div>\r\n                <div className=\"text-sm text-gray-300\">1.2 </div>\r\n              </div>\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-orange-400 font-bold\">10+ :</div>\r\n                <div className=\"text-sm text-gray-300\">1.5 </div>\r\n              </div>\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-red-400 font-bold\">25+ :</div>\r\n                <div className=\"text-sm text-gray-300\">2.0 </div>\r\n              </div>\r\n              <div className=\"glass-effect p-3 rounded-lg\">\r\n                <div className=\"text-purple-400 font-bold\">50+ :</div>\r\n                <div className=\"text-sm text-gray-300\">3.0 </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Formula */}\r\n          <div>\r\n            <h4 className=\"text-lg font-bold text-accent-blue mb-3\">  </h4>\r\n            <div className=\"glass-effect p-4 rounded-lg bg-gradient-to-r from-blue-500/10 to-purple-500/10\">\r\n              <div className=\"text-center text-lg font-mono\">\r\n                <span className=\"text-white\"> </span> = \r\n                <span className=\"text-green-400\"> 10</span>  \r\n                <span className=\"text-orange-400\"> </span>  \r\n                <span className=\"text-yellow-400\"> </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Examples */}\r\n          <div>\r\n            <h4 className=\"text-lg font-bold text-accent-blue mb-3\">  </h4>\r\n            <div className=\"space-y-3\">\r\n              <div className=\"bg-black/30 p-3 rounded-lg\">\r\n                <div className=\"text-green-400 font-bold\">  :</div>\r\n                <div className=\"text-sm text-gray-300\">\r\n                  10  1.0 ( )  1.2 (5+ ) = <span className=\"text-white font-bold\">12</span>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"bg-black/30 p-3 rounded-lg\">\r\n                <div className=\"text-orange-400 font-bold\">  :</div>\r\n                <div className=\"text-sm text-gray-300\">\r\n                  10  2.0 ( )  1.5 (10+ ) = <span className=\"text-white font-bold\">30</span>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"bg-black/30 p-3 rounded-lg\">\r\n                <div className=\"text-red-400 font-bold\">  :</div>\r\n                <div className=\"text-sm text-gray-300\">\r\n                  10  3.0 ( )  2.0 (25+ ) = <span className=\"text-white font-bold\">60</span>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"bg-black/30 p-3 rounded-lg\">\r\n                <div className=\"text-red-400 font-bold\">  :</div>\r\n                <div className=\"text-sm text-gray-300\">\r\n                    8  25 + <span className=\"text-red-400\"> </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mt-6 text-center text-xs text-gray-400\">\r\n           :        !\r\n        </div>\r\n      </motion.div>\r\n    </motion.div>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { useGameStore } from '../store/gameStore';\r\nimport { getLevelProgress, getOutletImageByLevel } from '../utils/levelSystem';\r\n\r\nexport const LevelDisplay: React.FC = () => {\r\n  const { player, getCurrentLevelInfo } = useGameStore();\r\n  const { currentLevel, progressInfo } = getCurrentLevelInfo();\r\n  const progressPercent = getLevelProgress(player.experience);\r\n  \r\n  // Check if outlet image will change at next level\r\n  const currentOutletImage = getOutletImageByLevel(currentLevel.level);\r\n  const nextOutletImage = progressInfo.nextLevel ? getOutletImageByLevel(progressInfo.nextLevel.level) : null;\r\n  const outletWillChange = nextOutletImage && nextOutletImage !== currentOutletImage;\r\n\r\n  return (\r\n    <div className=\"glass-effect p-4 rounded-xl space-y-3\">\r\n      {/* Level Title and Number */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          {/* Current Outlet Image */}\r\n          <img \r\n            src={getOutletImageByLevel(currentLevel.level)} \r\n            alt={`  ${currentLevel.level}`}\r\n            className=\"w-12 h-12 rounded-lg border-2 border-primary-orange shadow-lg\"\r\n          />\r\n          <div>\r\n            <div className=\"text-xs text-gray-400 uppercase tracking-wide\"></div>\r\n            <div className=\"flex items-baseline space-x-2\">\r\n              <span className=\"text-2xl font-bold text-primary-orange\">{currentLevel.level}</span>\r\n              <span className=\"text-sm text-gray-300\">{currentLevel.title}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"text-right\">\r\n          <div className=\"text-xs text-gray-400\"></div>\r\n          <div className=\"text-lg font-bold text-accent-blue\">\r\n            {player.experience.toLocaleString()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Progress Bar */}\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex justify-between text-xs text-gray-400\">\r\n          <span>{progressInfo.current}</span>\r\n          <span>{progressInfo.nextLevel ? `${progressInfo.remaining}  ${progressInfo.nextLevel.level} ` : ''}</span>\r\n          <span>{progressInfo.required}</span>\r\n        </div>\r\n        \r\n        <div className=\"relative w-full bg-gray-700 rounded-full h-2 overflow-hidden\">\r\n          <motion.div\r\n            className=\"h-full bg-gradient-to-r from-accent-blue to-primary-orange rounded-full\"\r\n            initial={{ width: 0 }}\r\n            animate={{ width: `${progressPercent}%` }}\r\n            transition={{ duration: 0.8, ease: \"easeOut\" }}\r\n          />\r\n          \r\n          {/* Spark effect on progress bar */}\r\n          {progressPercent > 0 && (\r\n            <motion.div\r\n              className=\"absolute top-0 right-0 w-1 h-full bg-white opacity-80\"\r\n              style={{ right: `${100 - progressPercent}%` }}\r\n              animate={{ opacity: [0.8, 0.3, 0.8] }}\r\n              transition={{ repeat: Infinity, duration: 1.5 }}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Level Description */}\r\n      <div className=\"text-xs text-gray-400 italic text-center\">\r\n        {currentLevel.description}\r\n      </div>\r\n\r\n      {/* Next Level Preview */}\r\n      {progressInfo.nextLevel && (\r\n        <div className=\"text-center pt-2 border-t border-gray-600\">\r\n          <div className=\"text-xs text-gray-500\"> </div>\r\n          <div className=\"text-sm\">\r\n            <span className=\"text-accent-lime font-semibold\">{progressInfo.nextLevel.title}</span>\r\n            <span className=\"text-gray-400\">  </span>\r\n            <span className=\"text-yellow-400\">+{progressInfo.nextLevel.voltsReward}</span>\r\n          </div>\r\n          \r\n          {/* Show next outlet image if it will change */}\r\n          {outletWillChange && (\r\n            <div className=\"flex items-center justify-center space-x-2 mt-2\">\r\n              <span className=\"text-xs text-blue-300\">  :</span>\r\n              <img \r\n                src={nextOutletImage} \r\n                alt={`  ${progressInfo.nextLevel.level}`}\r\n                className=\"w-6 h-6 rounded border border-blue-400 shadow-sm\"\r\n              />\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { hapticManager } from '../utils/hapticManager';\r\n\r\ninterface HapticSettingsProps {\r\n  isVisible: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport const HapticSettings: React.FC<HapticSettingsProps> = ({\r\n  isVisible,\r\n  onClose\r\n}) => {\r\n  const [isEnabled, setIsEnabled] = useState(true);\r\n  const [testingType, setTestingType] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    // Load settings from localStorage\r\n    const savedEnabled = localStorage.getItem('hapticEnabled');\r\n    if (savedEnabled !== null) {\r\n      const enabled = JSON.parse(savedEnabled);\r\n      setIsEnabled(enabled);\r\n      hapticManager.setEnabled(enabled);\r\n    }\r\n  }, []);\r\n\r\n  const handleToggleEnabled = () => {\r\n    const newValue = !isEnabled;\r\n    setIsEnabled(newValue);\r\n    hapticManager.setEnabled(newValue);\r\n    localStorage.setItem('hapticEnabled', JSON.stringify(newValue));\r\n    \r\n    // Test vibration when enabling\r\n    if (newValue) {\r\n      hapticManager.test();\r\n    }\r\n  };\r\n\r\n  const testHaptic = (type: string, action: () => void) => {\r\n    setTestingType(type);\r\n    action();\r\n    setTimeout(() => setTestingType(null), 500);\r\n  };\r\n\r\n  if (!isVisible) return null;\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: 1 }}\r\n      exit={{ opacity: 0 }}\r\n      className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\"\r\n      onClick={onClose}\r\n    >\r\n      <motion.div\r\n        initial={{ scale: 0.8, opacity: 0 }}\r\n        animate={{ scale: 1, opacity: 1 }}\r\n        exit={{ scale: 0.8, opacity: 0 }}\r\n        className=\"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl p-6 max-w-sm w-full border border-primary-orange/20\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        {/* Header */}\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <h2 className=\"text-2xl font-bold text-primary-orange\"></h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-white text-2xl\"\r\n          >\r\n            \r\n          </button>\r\n        </div>\r\n\r\n        {/* Enable/Disable Toggle */}\r\n        <div className=\"mb-6\">\r\n          <div className=\"flex justify-between items-center p-4 bg-gray-800/50 rounded-xl\">\r\n            <div>\r\n              <h3 className=\"text-lg font-semibold text-white\"> </h3>\r\n              <p className=\"text-sm text-gray-400\">\r\n                {hapticManager.isAvailable() \r\n                  ? '  ' \r\n                  : '   '\r\n                }\r\n              </p>\r\n            </div>\r\n            <motion.button\r\n              onClick={handleToggleEnabled}\r\n              className={`w-12 h-6 rounded-full p-1 transition-colors ${\r\n                isEnabled ? 'bg-primary-orange' : 'bg-gray-600'\r\n              }`}\r\n              whileTap={{ scale: 0.95 }}\r\n            >\r\n              <motion.div\r\n                className=\"w-4 h-4 bg-white rounded-full\"\r\n                animate={{ x: isEnabled ? 24 : 0 }}\r\n                transition={{ type: 'spring', stiffness: 500, damping: 30 }}\r\n              />\r\n            </motion.button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Test Vibrations */}\r\n        {isEnabled && (\r\n          <div className=\"space-y-3\">\r\n            <h3 className=\"text-lg font-semibold text-white mb-3\"> </h3>\r\n            \r\n            {/* Game Events */}\r\n            <div className=\"space-y-2\">\r\n              <h4 className=\"text-sm font-medium text-gray-300\"> </h4>\r\n              \r\n              <motion.button\r\n                onClick={() => testHaptic('press', () => hapticManager.outletPress())}\r\n                className={`w-full p-3 rounded-lg border transition-colors ${\r\n                  testingType === 'press' \r\n                    ? 'bg-blue-500/30 border-blue-400 text-blue-200' \r\n                    : 'bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50'\r\n                }`}\r\n                whileHover={{ scale: 1.02 }}\r\n                whileTap={{ scale: 0.98 }}\r\n              >\r\n                   \r\n              </motion.button>\r\n\r\n              <motion.button\r\n                onClick={() => testHaptic('success', () => hapticManager.survivalSuccess())}\r\n                className={`w-full p-3 rounded-lg border transition-colors ${\r\n                  testingType === 'success' \r\n                    ? 'bg-green-500/30 border-green-400 text-green-200' \r\n                    : 'bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50'\r\n                }`}\r\n                whileHover={{ scale: 1.02 }}\r\n                whileTap={{ scale: 0.98 }}\r\n              >\r\n                  \r\n              </motion.button>\r\n\r\n              <motion.button\r\n                onClick={() => testHaptic('shock', () => hapticManager.electricShock())}\r\n                className={`w-full p-3 rounded-lg border transition-colors ${\r\n                  testingType === 'shock' \r\n                    ? 'bg-red-500/30 border-red-400 text-red-200' \r\n                    : 'bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50'\r\n                }`}\r\n                whileHover={{ scale: 1.02 }}\r\n                whileTap={{ scale: 0.98 }}\r\n              >\r\n                  \r\n              </motion.button>\r\n\r\n              <motion.button\r\n                onClick={() => testHaptic('levelup', () => hapticManager.levelUp())}\r\n                className={`w-full p-3 rounded-lg border transition-colors ${\r\n                  testingType === 'levelup' \r\n                    ? 'bg-yellow-500/30 border-yellow-400 text-yellow-200' \r\n                    : 'bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50'\r\n                }`}\r\n                whileHover={{ scale: 1.02 }}\r\n                whileTap={{ scale: 0.98 }}\r\n              >\r\n                  \r\n              </motion.button>\r\n            </div>\r\n\r\n            {/* Intensity Levels */}\r\n            <div className=\"space-y-2 mt-4\">\r\n              <h4 className=\"text-sm font-medium text-gray-300\"></h4>\r\n              \r\n              <div className=\"grid grid-cols-2 gap-2\">\r\n                <motion.button\r\n                  onClick={() => testHaptic('light', () => hapticManager.light())}\r\n                  className={`p-2 rounded-lg border text-sm transition-colors ${\r\n                    testingType === 'light' \r\n                      ? 'bg-gray-500/30 border-gray-400 text-gray-200' \r\n                      : 'bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50'\r\n                  }`}\r\n                  whileHover={{ scale: 1.02 }}\r\n                  whileTap={{ scale: 0.98 }}\r\n                >\r\n                  \r\n                </motion.button>\r\n\r\n                <motion.button\r\n                  onClick={() => testHaptic('medium', () => hapticManager.medium())}\r\n                  className={`p-2 rounded-lg border text-sm transition-colors ${\r\n                    testingType === 'medium' \r\n                      ? 'bg-gray-500/30 border-gray-400 text-gray-200' \r\n                      : 'bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50'\r\n                  }`}\r\n                  whileHover={{ scale: 1.02 }}\r\n                  whileTap={{ scale: 0.98 }}\r\n                >\r\n                  \r\n                </motion.button>\r\n\r\n                <motion.button\r\n                  onClick={() => testHaptic('heavy', () => hapticManager.heavy())}\r\n                  className={`p-2 rounded-lg border text-sm transition-colors ${\r\n                    testingType === 'heavy' \r\n                      ? 'bg-gray-500/30 border-gray-400 text-gray-200' \r\n                      : 'bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50'\r\n                  }`}\r\n                  whileHover={{ scale: 1.02 }}\r\n                  whileTap={{ scale: 0.98 }}\r\n                >\r\n                  \r\n                </motion.button>\r\n\r\n                <motion.button\r\n                  onClick={() => testHaptic('rigid', () => hapticManager.rigid())}\r\n                  className={`p-2 rounded-lg border text-sm transition-colors ${\r\n                    testingType === 'rigid' \r\n                      ? 'bg-gray-500/30 border-gray-400 text-gray-200' \r\n                      : 'bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50'\r\n                  }`}\r\n                  whileHover={{ scale: 1.02 }}\r\n                  whileTap={{ scale: 0.98 }}\r\n                >\r\n                  \r\n                </motion.button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Info */}\r\n        <div className=\"mt-6 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg\">\r\n          <p className=\"text-xs text-blue-300 text-center\">\r\n                 Telegram Mini App   \r\n          </p>\r\n        </div>\r\n      </motion.div>\r\n    </motion.div>\r\n  );\r\n};\r\n","/**\r\n * TelegramProvider -      Telegram Mini App\r\n */\r\n\r\nimport React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\r\nimport type { TelegramWebApp, TelegramUser } from '../types/telegram';\r\nimport { useGameStore } from '../store/gameStore';\r\n\r\ninterface TelegramContextType {\r\n  webApp: TelegramWebApp | null;\r\n  user: TelegramUser | null;\r\n  isInTelegram: boolean;\r\n  platform: string;\r\n  colorScheme: 'light' | 'dark';\r\n  token: string | null;\r\n  isAuthenticating: boolean;\r\n  isAuthenticated: boolean;\r\n  authError: string | null;\r\n  authenticate: () => Promise<void>;\r\n  logout: () => void;\r\n}\r\n\r\nconst TelegramContext = createContext<TelegramContextType>({\r\n  webApp: null,\r\n  user: null,\r\n  isInTelegram: false,\r\n  platform: 'unknown',\r\n  colorScheme: 'dark',\r\n  token: null,\r\n  isAuthenticating: false,\r\n  isAuthenticated: false,\r\n  authError: null,\r\n  authenticate: async () => {},\r\n  logout: () => {}\r\n});\r\n\r\nexport const useTelegram = () => useContext(TelegramContext);\r\n\r\ninterface TelegramProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport const TelegramProvider: React.FC<TelegramProviderProps> = ({ children }) => {\r\n  const [webApp, setWebApp] = useState<TelegramWebApp | null>(null);\r\n  const [user, setUser] = useState<TelegramUser | null>(null);\r\n  const [isInTelegram, setIsInTelegram] = useState(false);\r\n  const [platform, setPlatform] = useState('unknown');\r\n  const [colorScheme, setColorScheme] = useState<'light' | 'dark'>('dark');\r\n  const [token, setToken] = useState<string | null>(() => (typeof sessionStorage !== 'undefined' ? sessionStorage.getItem('tg_token') : null));\r\n  const [isAuthenticating, setIsAuthenticating] = useState(false);\r\n  const [authError, setAuthError] = useState<string | null>(null);\r\n\r\n  // Helper to push telegram user fields into game store (light touch  avoids creating new action)\r\n  const syncPlayerToStore = useCallback((tgUser: TelegramUser) => {\r\n    try {\r\n      useGameStore.setState(prev => ({\r\n        player: {\r\n          ...prev.player,\r\n          telegramId: tgUser.id.toString(),\r\n          // Preserve other player fields; attach a displayName for UI if structure lacks names\r\n          displayName: tgUser.username || tgUser.first_name || 'Player'\r\n        }\r\n      }));\r\n    } catch (e) {\r\n      console.warn('Failed to sync telegram user to game store', e);\r\n    }\r\n  }, []);\r\n\r\n  const performAuth = useCallback(async (tgWebApp: TelegramWebApp) => {\r\n    if (!tgWebApp?.initDataUnsafe?.user) return;\r\n    if (token) return; // already have\r\n    setIsAuthenticating(true);\r\n    setAuthError(null);\r\n    try {\r\n      const backend = (import.meta as any).env?.VITE_BACKEND_URL || 'http://localhost:3001';\r\n      const body = {\r\n        user: tgWebApp.initDataUnsafe.user,\r\n        auth_date: tgWebApp.initDataUnsafe.auth_date,\r\n        hash: tgWebApp.initDataUnsafe.hash\r\n      };\r\n      const res = await fetch(`${backend}/auth/telegram`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(body)\r\n      });\r\n      if (!res.ok) throw new Error(`Auth failed: ${res.status}`);\r\n      const json = await res.json();\r\n      if (json.token) {\r\n        setToken(json.token);\r\n        if (typeof sessionStorage !== 'undefined') sessionStorage.setItem('tg_token', json.token);\r\n        syncPlayerToStore(tgWebApp.initDataUnsafe.user!);\r\n      }\r\n    } catch (e:any) {\r\n      console.error('Telegram auth error', e);\r\n      setAuthError(e.message || 'Auth error');\r\n    } finally {\r\n      setIsAuthenticating(false);\r\n    }\r\n  }, [token, syncPlayerToStore]);\r\n\r\n  const logout = useCallback(() => {\r\n    setToken(null);\r\n    if (typeof sessionStorage !== 'undefined') sessionStorage.removeItem('tg_token');\r\n  }, []);\r\n\r\n  const authenticate = useCallback(async () => {\r\n    if (webApp) await performAuth(webApp);\r\n  }, [webApp, performAuth]);\r\n\r\n  useEffect(() => {\r\n    // Real Telegram environment\r\n    if (typeof window !== 'undefined' && window.Telegram?.WebApp) {\r\n      const tgWebApp = window.Telegram.WebApp as TelegramWebApp;\r\n      tgWebApp.ready();\r\n      tgWebApp.expand();\r\n      setWebApp(tgWebApp);\r\n      setIsInTelegram(true);\r\n      setPlatform(tgWebApp.platform || 'unknown');\r\n      setColorScheme(tgWebApp.colorScheme || 'dark');\r\n      if (tgWebApp.initDataUnsafe?.user) {\r\n        setUser(tgWebApp.initDataUnsafe.user);\r\n        syncPlayerToStore(tgWebApp.initDataUnsafe.user);\r\n        performAuth(tgWebApp); // fire & forget\r\n      }\r\n      tgWebApp.setHeaderColor('#000000');\r\n      tgWebApp.setBackgroundColor('#000000');\r\n      tgWebApp.disableClosingConfirmation();\r\n      console.log('[Telegram] Initialized', {\r\n        platform: tgWebApp.platform,\r\n        colorScheme: tgWebApp.colorScheme,\r\n        user: tgWebApp.initDataUnsafe?.user,\r\n        version: tgWebApp.version\r\n      });\r\n      return;\r\n    }\r\n    // Debug / local non-Telegram mode with mock user (enable with ?tg_debug=1)\r\n    if (typeof window !== 'undefined') {\r\n      const params = new URLSearchParams(window.location.search);\r\n      if (params.get('tg_debug') === '1') {\r\n        const mockUser: TelegramUser = {\r\n          id: 999999,\r\n            first_name: 'Debug',\r\n            last_name: 'User',\r\n            username: 'debug_player'\r\n          };\r\n        setUser(mockUser);\r\n        syncPlayerToStore(mockUser);\r\n        console.log('[Telegram] Debug mock user active');\r\n      }\r\n    }\r\n  }, [performAuth, syncPlayerToStore]);\r\n\r\n  const contextValue: TelegramContextType = {\r\n    webApp,\r\n    user,\r\n    isInTelegram,\r\n    platform,\r\n    colorScheme,\r\n    token,\r\n    isAuthenticating,\r\n    isAuthenticated: !!token,\r\n    authError,\r\n    authenticate,\r\n    logout\r\n  };\r\n\r\n  return (\r\n    <TelegramContext.Provider value={contextValue}>\r\n      {children}\r\n    </TelegramContext.Provider>\r\n  );\r\n};\r\n\r\nexport default TelegramProvider;\r\n","/**\r\n * TelegramUserInfo -       Telegram\r\n */\r\n\r\nimport React from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { useTelegram } from './TelegramProvider';\r\n\r\nexport const TelegramUserInfo: React.FC = () => {\r\n  const { user, isInTelegram, platform, colorScheme } = useTelegram();\r\n\r\n  if (!isInTelegram) {\r\n    return (\r\n      <div className=\"text-xs text-gray-500 text-center p-2\">\r\n         - (  Telegram)\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, y: -10 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      className=\"bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-500/30 rounded-lg p-3 mb-4\"\r\n    >\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          {user?.photo_url ? (\r\n            <img \r\n              src={user.photo_url} \r\n              alt=\"Avatar\" \r\n              className=\"w-8 h-8 rounded-full border border-blue-400/50\"\r\n            />\r\n          ) : (\r\n            <div className=\"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center\">\r\n              <span className=\"text-white text-sm font-bold\">\r\n                {user?.first_name?.[0] || '?'}\r\n              </span>\r\n            </div>\r\n          )}\r\n          \r\n          <div>\r\n            <div className=\"text-sm font-medium text-white\">\r\n              {user?.first_name} {user?.last_name}\r\n              {user?.is_premium && <span className=\"ml-1 text-yellow-400\"></span>}\r\n            </div>\r\n            <div className=\"text-xs text-gray-400\">\r\n              @{user?.username || 'no_username'}  {platform}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"text-right\">\r\n          <div className={`text-xs px-2 py-1 rounded-full border ${\r\n            colorScheme === 'dark' \r\n              ? 'bg-gray-800 border-gray-600 text-gray-300' \r\n              : 'bg-gray-200 border-gray-400 text-gray-700'\r\n          }`}>\r\n            {colorScheme === 'dark' ? '' : ''} {colorScheme}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </motion.div>\r\n  );\r\n};\r\n","import { useState, useCallback } from 'react';\r\nimport { apiClient } from '../utils/apiClient';\r\n\r\ninterface UseApiState<T = any> {\r\n  data: T | null;\r\n  loading: boolean;\r\n  error: string | null;\r\n}\r\n\r\ninterface GameScoreData {\r\n  score: number;\r\n  level: number;\r\n  timePlayed: number;\r\n}\r\n\r\n/**\r\n *      API\r\n */\r\nexport function useGameApi() {\r\n  const [submitState, setSubmitState] = useState<UseApiState>({\r\n    data: null,\r\n    loading: false,\r\n    error: null,\r\n  });\r\n\r\n  const [statsState, setStatsState] = useState<UseApiState>({\r\n    data: null,\r\n    loading: false,\r\n    error: null,\r\n  });\r\n\r\n  const [leaderboardState, setLeaderboardState] = useState<UseApiState>({\r\n    data: null,\r\n    loading: false,\r\n    error: null,\r\n  });\r\n\r\n  /**\r\n   *    \r\n   */\r\n  const submitScore = useCallback(async (scoreData: GameScoreData) => {\r\n    setSubmitState({ data: null, loading: true, error: null });\r\n\r\n    try {\r\n      const response = await apiClient.submitScore(scoreData);\r\n      \r\n      if (response.error) {\r\n        setSubmitState({ data: null, loading: false, error: response.error });\r\n        return { success: false, error: response.error };\r\n      }\r\n\r\n      setSubmitState({ data: response.data, loading: false, error: null });\r\n      return { success: true, data: response.data };\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\r\n      setSubmitState({ data: null, loading: false, error: errorMessage });\r\n      return { success: false, error: errorMessage };\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   *   \r\n   */\r\n  const getUserStats = useCallback(async () => {\r\n    setStatsState({ data: null, loading: true, error: null });\r\n\r\n    try {\r\n      const response = await apiClient.getUserStats();\r\n      \r\n      if (response.error) {\r\n        setStatsState({ data: null, loading: false, error: response.error });\r\n        return { success: false, error: response.error };\r\n      }\r\n\r\n      setStatsState({ data: response.data, loading: false, error: null });\r\n      return { success: true, data: response.data };\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\r\n      setStatsState({ data: null, loading: false, error: errorMessage });\r\n      return { success: false, error: errorMessage };\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   *   \r\n   */\r\n  const getLeaderboard = useCallback(async (type: 'level' | 'volts' | 'experience' = 'level', limit = 10) => {\r\n    setLeaderboardState({ data: null, loading: true, error: null });\r\n\r\n    try {\r\n      const response = await apiClient.getLeaderboard(type, limit);\r\n      \r\n      if (response.error) {\r\n        setLeaderboardState({ data: null, loading: false, error: response.error });\r\n        return { success: false, error: response.error };\r\n      }\r\n\r\n      setLeaderboardState({ data: response.data, loading: false, error: null });\r\n      return { success: true, data: response.data };\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\r\n      setLeaderboardState({ data: null, loading: false, error: errorMessage });\r\n      return { success: false, error: errorMessage };\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   *  \r\n   */\r\n  const refillEnergy = useCallback(async () => {\r\n    try {\r\n      const response = await apiClient.refillEnergy();\r\n      \r\n      if (response.error) {\r\n        return { success: false, error: response.error };\r\n      }\r\n\r\n      return { success: true, data: response.data };\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\r\n      return { success: false, error: errorMessage };\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    // \r\n    submitScore,\r\n    getUserStats,\r\n    getLeaderboard,\r\n    refillEnergy,\r\n    \r\n    // \r\n    submitState,\r\n    statsState,\r\n    leaderboardState,\r\n    \r\n    //  \r\n    isAuthenticated: apiClient.isAuthenticated(),\r\n  };\r\n}\r\n\r\n/**\r\n *    offline/online \r\n */\r\nexport function useOfflineMode() {\r\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\r\n\r\n  useState(() => {\r\n    const handleOnline = () => setIsOnline(true);\r\n    const handleOffline = () => setIsOnline(false);\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  });\r\n\r\n  return { isOnline };\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { useGameStore } from '../store/gameStore';\r\nimport { hapticManager } from '../utils/hapticManager';\r\nimport { ScoreBreakdown } from './ScoreBreakdown';\r\nimport { LevelDisplay } from './LevelDisplay';\r\nimport { HapticSettings } from './HapticSettings';\r\nimport { TelegramUserInfo } from './TelegramUserInfo';\r\nimport { useGameApi } from '../hooks/useGameApi';\r\n\r\nexport const MainMenu: React.FC = () => {\r\n  const { \r\n    player, \r\n    gameState,\r\n    startSingleMode, \r\n    startMultiplayerMode,\r\n    addExperience,\r\n    compensateExperience,\r\n    loadStatsFromServer \r\n  } = useGameStore();\r\n  const { isAuthenticated } = useGameApi();\r\n  const [showScoreBreakdown, setShowScoreBreakdown] = useState(false);\r\n  const [showHapticSettings, setShowHapticSettings] = useState(false);\r\n  const [isLoadingStats, setIsLoadingStats] = useState(false);\r\n\r\n  //       \r\n  useEffect(() => {\r\n    const loadServerStats = async () => {\r\n      if (isAuthenticated && !isLoadingStats) {\r\n        setIsLoadingStats(true);\r\n        \r\n        try {\r\n          const result = await loadStatsFromServer();\r\n          \r\n          if (result.success) {\r\n            console.log('    ');\r\n          } else {\r\n            console.warn('      :', result.error);\r\n          }\r\n        } catch (error) {\r\n          console.error('    :', error);\r\n        } finally {\r\n          setIsLoadingStats(false);\r\n        }\r\n      }\r\n    };\r\n\r\n    loadServerStats();\r\n  }, [isAuthenticated, loadStatsFromServer, isLoadingStats]);\r\n  \r\n  // Development helper to test level system\r\n  const handleQuickLevelUp = () => {\r\n    addExperience(100); // Add 100 experience for testing\r\n  };\r\n\r\n  // Function to compensate missing experience\r\n  const handleCompensateExperience = () => {\r\n    const compensated = compensateExperience();\r\n    if (compensated > 0) {\r\n      console.log(`Compensated ${compensated} experience points`);\r\n    } else {\r\n      console.log('No experience compensation needed');\r\n    }\r\n  };\r\n\r\n  const handleStartGame = (difficulty: 'easy' | 'medium' | 'hard' | 'extreme') => {\r\n    hapticManager.medium(); //    \r\n    startSingleMode(difficulty);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-background-dark to-background-darker\">\r\n      {/* Logo */}\r\n      <motion.div\r\n        initial={{ opacity: 0, y: -50 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ duration: 0.8 }}\r\n        className=\"text-center mb-8\"\r\n      >\r\n        <h1 className=\"text-6xl font-bold text-primary-orange tiger-stripes bg-clip-text text-transparent mb-4\">\r\n          \r\n        </h1>\r\n        <h2 className=\"text-4xl font-bold text-accent-blue mb-2\">\r\n          \r\n        </h2>\r\n        <p className=\"text-lg text-gray-300\">\r\n          Telegram Mini App Game\r\n        </p>\r\n      </motion.div>\r\n\r\n      {/* Level Display */}\r\n      <motion.div\r\n        initial={{ opacity: 0, y: 20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ duration: 0.6, delay: 0.2 }}\r\n        className=\"mb-6\"\r\n      >\r\n        <LevelDisplay />\r\n      </motion.div>\r\n\r\n      {/*   */}\r\n      {isAuthenticated && isLoadingStats && (\r\n        <motion.div\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: 1 }}\r\n          className=\"mb-4 text-center text-blue-400 text-sm\"\r\n        >\r\n          <span className=\"inline-block animate-spin mr-2\"></span>\r\n            ...\r\n        </motion.div>\r\n      )}\r\n\r\n      {!isAuthenticated && (\r\n        <motion.div\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: 1 }}\r\n          className=\"mb-4 text-center text-yellow-400 text-sm\"\r\n        >\r\n              \r\n        </motion.div>\r\n      )}\r\n\r\n      {/* Telegram User Info */}\r\n      <motion.div\r\n        initial={{ opacity: 0, y: 20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ duration: 0.6, delay: 0.25 }}\r\n        className=\"mb-4 w-full max-w-md\"\r\n      >\r\n        <TelegramUserInfo />\r\n      </motion.div>\r\n\r\n      {/* Player Stats */}\r\n      <motion.div\r\n        initial={{ opacity: 0, scale: 0.9 }}\r\n        animate={{ opacity: 1, scale: 1 }}\r\n        transition={{ duration: 0.5, delay: 0.3 }}\r\n        className=\"glass-effect p-6 mb-8 text-center\"\r\n      >\r\n        <div className=\"text-sm text-gray-300 mb-2\"> , {player.name}!</div>\r\n        <div className=\"flex justify-center space-x-6\">\r\n          <div>\r\n            <div className=\"text-xs text-gray-400\"></div>\r\n            <div className=\"text-xl font-bold text-primary-orange\">{player.volts}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"text-xs text-gray-400\"></div>\r\n            <div className=\"text-xl font-bold text-accent-blue\">{player.level}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"text-xs text-gray-400\"> </div>\r\n            <div className=\"text-xl font-bold text-accent-lime\">{player.totalClicks}</div>\r\n          </div>\r\n        </div>\r\n      </motion.div>\r\n\r\n      {/* Game Mode Selection */}\r\n      <motion.div\r\n        initial={{ opacity: 0, y: 50 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ duration: 0.6, delay: 0.5 }}\r\n        className=\"w-full max-w-md space-y-4\"\r\n      >\r\n        <h3 className=\"text-2xl font-bold text-center text-white mb-6\">\r\n            \r\n        </h3>\r\n        <p className=\"text-center text-gray-300 text-sm mb-4\">\r\n               \r\n        </p>\r\n\r\n        {/* Easy Mode */}\r\n        <motion.button\r\n          onClick={() => handleStartGame('easy')}\r\n          className=\"w-full glass-effect p-4 rounded-xl hover:bg-green-500/20 transition-colors\"\r\n          whileHover={{ scale: 1.02, x: 10 }}\r\n          whileTap={{ scale: 0.98 }}\r\n        >\r\n          <div className=\"flex justify-between items-center\">\r\n            <div className=\"text-left\">\r\n              <div className=\"text-lg font-bold text-green-400\"></div>\r\n              <div className=\"text-sm text-gray-300\">15%    2  </div>\r\n            </div>\r\n            <div className=\"text-2xl\"></div>\r\n          </div>\r\n        </motion.button>\r\n\r\n        {/* Medium Mode */}\r\n        <motion.button\r\n          onClick={() => handleStartGame('medium')}\r\n          className=\"w-full glass-effect p-4 rounded-xl hover:bg-yellow-500/20 transition-colors\"\r\n          whileHover={{ scale: 1.02, x: 10 }}\r\n          whileTap={{ scale: 0.98 }}\r\n        >\r\n          <div className=\"flex justify-between items-center\">\r\n            <div className=\"text-left\">\r\n              <div className=\"text-lg font-bold text-yellow-400\"></div>\r\n              <div className=\"text-sm text-gray-300\">25%    1.5  </div>\r\n            </div>\r\n            <div className=\"text-2xl\"></div>\r\n          </div>\r\n        </motion.button>\r\n\r\n        {/* Hard Mode */}\r\n        <motion.button\r\n          onClick={() => handleStartGame('hard')}\r\n          className=\"w-full glass-effect p-4 rounded-xl hover:bg-orange-500/20 transition-colors\"\r\n          whileHover={{ scale: 1.02, x: 10 }}\r\n          whileTap={{ scale: 0.98 }}\r\n        >\r\n          <div className=\"flex justify-between items-center\">\r\n            <div className=\"text-left\">\r\n              <div className=\"text-lg font-bold text-orange-400\"></div>\r\n              <div className=\"text-sm text-gray-300\">35%    1  </div>\r\n            </div>\r\n            <div className=\"text-2xl\"></div>\r\n          </div>\r\n        </motion.button>\r\n\r\n        {/* Extreme Mode */}\r\n        <motion.button\r\n          onClick={() => handleStartGame('extreme')}\r\n          className=\"w-full glass-effect p-4 rounded-xl hover:bg-red-500/20 transition-colors\"\r\n          whileHover={{ scale: 1.02, x: 10 }}\r\n          whileTap={{ scale: 0.98 }}\r\n        >\r\n          <div className=\"flex justify-between items-center\">\r\n            <div className=\"text-left\">\r\n              <div className=\"text-lg font-bold text-red-400\"></div>\r\n              <div className=\"text-sm text-gray-300\">50%    0.5  </div>\r\n            </div>\r\n            <div className=\"text-2xl\"></div>\r\n          </div>\r\n        </motion.button>\r\n\r\n        {/* Multiplayer Mode Section */}\r\n        <motion.div\r\n          className=\"w-full border-t border-white/10 pt-6 mt-6\"\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ duration: 0.6, delay: 0.7 }}\r\n        >\r\n          <h4 className=\"text-xl font-bold text-center text-white mb-4\">\r\n              \r\n          </h4>\r\n          \r\n          {/* Coming Soon for now */}\r\n          <motion.button\r\n            onClick={() => {\r\n              hapticManager.medium();\r\n              startMultiplayerMode('duel');\r\n            }}\r\n            className=\"w-full glass-effect p-4 rounded-xl hover:bg-purple-500/20 transition-colors border border-purple-400/30\"\r\n            whileHover={{ scale: 1.02, x: 10 }}\r\n            whileTap={{ scale: 0.98 }}\r\n          >\r\n            <div className=\"flex justify-between items-center\">\r\n              <div className=\"text-left\">\r\n                <div className=\"text-lg font-bold text-purple-400\"></div>\r\n                <div className=\"text-sm text-gray-300\"> 1v1  Real-time </div>\r\n              </div>\r\n              <div className=\"text-2xl\"></div>\r\n            </div>\r\n          </motion.button>\r\n\r\n          <motion.button\r\n            onClick={() => {\r\n              hapticManager.medium();\r\n              startMultiplayerMode('tournament');\r\n            }}\r\n            className=\"w-full glass-effect p-4 rounded-xl hover:bg-blue-500/20 transition-colors border border-blue-400/30 mt-3\"\r\n            whileHover={{ scale: 1.02, x: 10 }}\r\n            whileTap={{ scale: 0.98 }}\r\n          >\r\n            <div className=\"flex justify-between items-center\">\r\n              <div className=\"text-left\">\r\n                <div className=\"text-lg font-bold text-blue-400\"></div>\r\n                <div className=\"text-sm text-gray-300\"> 8    </div>\r\n              </div>\r\n              <div className=\"text-2xl\"></div>\r\n            </div>\r\n          </motion.button>\r\n\r\n          <motion.button\r\n            onClick={() => {\r\n              hapticManager.medium();\r\n              startMultiplayerMode('coop');\r\n            }}\r\n            className=\"w-full glass-effect p-4 rounded-xl hover:bg-green-500/20 transition-colors border border-green-400/30 mt-3\"\r\n            whileHover={{ scale: 1.02, x: 10 }}\r\n            whileTap={{ scale: 0.98 }}\r\n          >\r\n            <div className=\"flex justify-between items-center\">\r\n              <div className=\"text-left\">\r\n                <div className=\"text-lg font-bold text-green-400\"></div>\r\n                <div className=\"text-sm text-gray-300\">    </div>\r\n              </div>\r\n              <div className=\"text-2xl\"></div>\r\n            </div>\r\n          </motion.button>\r\n        </motion.div>\r\n\r\n        {/* Score Breakdown Button */}\r\n        <motion.button\r\n          onClick={() => {\r\n            hapticManager.light();\r\n            setShowScoreBreakdown(true);\r\n          }}\r\n          className=\"w-full glass-effect p-3 rounded-xl hover:bg-blue-500/20 transition-colors border border-blue-400/30\"\r\n          whileHover={{ scale: 1.02 }}\r\n          whileTap={{ scale: 0.98 }}\r\n        >\r\n          <div className=\"flex justify-center items-center space-x-2\">\r\n            <span className=\"text-lg\"></span>\r\n            <span className=\"text-lg font-semibold text-blue-400\">  </span>\r\n          </div>\r\n        </motion.button>\r\n\r\n        {/* Haptic Settings Button */}\r\n        <motion.button\r\n          onClick={() => {\r\n            hapticManager.light();\r\n            setShowHapticSettings(true);\r\n          }}\r\n          className=\"w-full glass-effect p-3 rounded-xl hover:bg-purple-500/20 transition-colors border border-purple-400/30\"\r\n          whileHover={{ scale: 1.02 }}\r\n          whileTap={{ scale: 0.98 }}\r\n        >\r\n          <div className=\"flex justify-center items-center space-x-2\">\r\n            <span className=\"text-lg\"></span>\r\n            <span className=\"text-lg font-semibold text-purple-400\"></span>\r\n          </div>\r\n        </motion.button>\r\n      </motion.div>\r\n\r\n      {/* Score Breakdown Modal */}\r\n      {showScoreBreakdown && (\r\n        <ScoreBreakdown onClose={() => setShowScoreBreakdown(false)} />\r\n      )}\r\n\r\n      {/* Haptic Settings Modal */}\r\n      {showHapticSettings && (\r\n        <HapticSettings \r\n          isVisible={showHapticSettings}\r\n          onClose={() => setShowHapticSettings(false)} \r\n        />\r\n      )}\r\n\r\n      {/* Footer */}\r\n      <motion.div\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: 1 }}\r\n        transition={{ duration: 0.5, delay: 1 }}\r\n        className=\"mt-8 text-center text-gray-400 text-sm space-y-2\"\r\n      >\r\n        <p>  ! </p>\r\n        <p className=\"mt-2\">v1.1.0 | Single Mode + Multiplayer Preview</p>\r\n        \r\n        {/* Development button for testing levels */}\r\n        <div className=\"flex gap-2 justify-center\">\r\n          <button \r\n            onClick={() => {\r\n              hapticManager.light();\r\n              handleQuickLevelUp();\r\n            }}\r\n            className=\"px-3 py-1 text-xs bg-purple-600/30 hover:bg-purple-600/50 text-purple-300 rounded transition-colors\"\r\n          >\r\n             +100  ()\r\n          </button>\r\n          \r\n          <button \r\n            onClick={() => {\r\n              hapticManager.light();\r\n              handleCompensateExperience();\r\n            }}\r\n            className=\"px-3 py-1 text-xs bg-green-600/30 hover:bg-green-600/50 text-green-300 rounded transition-colors\"\r\n          >\r\n               ({gameState.score} )\r\n          </button>\r\n        </div>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n};\r\n","// Sound effects manager for TigerRozetka\r\n// Using Web Audio API for better control\r\n\r\nexport class SoundManager {\r\n  private audioContext: AudioContext | null = null;\r\n  private sounds: Map<string, AudioBuffer> = new Map();\r\n  private volume: number = 0.7;\r\n  private enabled: boolean = true;\r\n\r\n  constructor() {\r\n    this.init();\r\n  }\r\n\r\n  private async init() {\r\n    try {\r\n      this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n    } catch (error) {\r\n      console.warn('Web Audio API not supported:', error);\r\n    }\r\n  }\r\n\r\n  async loadSound(name: string, url: string): Promise<void> {\r\n    if (!this.audioContext) return;\r\n\r\n    try {\r\n      const response = await fetch(url);\r\n      const arrayBuffer = await response.arrayBuffer();\r\n      const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\r\n      this.sounds.set(name, audioBuffer);\r\n    } catch (error) {\r\n      console.warn(`Failed to load sound ${name}:`, error);\r\n    }\r\n  }\r\n\r\n  playSound(name: string, volume: number = 1): void {\r\n    if (!this.enabled || !this.audioContext) return;\r\n\r\n    const buffer = this.sounds.get(name);\r\n    if (!buffer) return;\r\n\r\n    const source = this.audioContext.createBufferSource();\r\n    const gainNode = this.audioContext.createGain();\r\n\r\n    source.buffer = buffer;\r\n    gainNode.gain.value = this.volume * volume;\r\n\r\n    source.connect(gainNode);\r\n    gainNode.connect(this.audioContext.destination);\r\n\r\n    source.start();\r\n  }\r\n\r\n  // Generate electric spark sound programmatically\r\n  generateSparkSound(intensity: 'low' | 'medium' | 'high' | 'extreme'): void {\r\n    if (!this.enabled || !this.audioContext) return;\r\n\r\n    const duration = {\r\n      low: 0.1,\r\n      medium: 0.2,\r\n      high: 0.3,\r\n      extreme: 0.5\r\n    }[intensity];\r\n\r\n    const frequency = {\r\n      low: 2000,\r\n      medium: 3000,\r\n      high: 4000,\r\n      extreme: 5000\r\n    }[intensity];\r\n\r\n    // Create white noise for spark effect\r\n    const bufferSize = this.audioContext.sampleRate * duration;\r\n    const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);\r\n    const output = buffer.getChannelData(0);\r\n\r\n    // Generate noise with frequency modulation\r\n    for (let i = 0; i < bufferSize; i++) {\r\n      const t = i / this.audioContext.sampleRate;\r\n      const envelope = Math.exp(-t * 10); // Exponential decay\r\n      const noise = (Math.random() * 2 - 1) * envelope;\r\n      const oscillation = Math.sin(2 * Math.PI * frequency * t * (1 + Math.random() * 0.5));\r\n      output[i] = noise * oscillation * 0.3;\r\n    }\r\n\r\n    const source = this.audioContext.createBufferSource();\r\n    const gainNode = this.audioContext.createGain();\r\n    \r\n    source.buffer = buffer;\r\n    gainNode.gain.value = this.volume * (intensity === 'extreme' ? 0.8 : 0.5);\r\n\r\n    source.connect(gainNode);\r\n    gainNode.connect(this.audioContext.destination);\r\n\r\n    source.start();\r\n  }\r\n\r\n  // Generate shock sound\r\n  generateShockSound(): void {\r\n    if (!this.enabled || !this.audioContext) return;\r\n\r\n    const duration = 0.8;\r\n    const bufferSize = this.audioContext.sampleRate * duration;\r\n    const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);\r\n    const output = buffer.getChannelData(0);\r\n\r\n    for (let i = 0; i < bufferSize; i++) {\r\n      const t = i / this.audioContext.sampleRate;\r\n      const envelope = Math.exp(-t * 3);\r\n      const lowFreq = Math.sin(2 * Math.PI * 100 * t);\r\n      const highFreq = Math.sin(2 * Math.PI * 800 * t) * 0.5;\r\n      const noise = (Math.random() * 2 - 1) * 0.3;\r\n      output[i] = (lowFreq + highFreq + noise) * envelope * 0.6;\r\n    }\r\n\r\n    const source = this.audioContext.createBufferSource();\r\n    const gainNode = this.audioContext.createGain();\r\n    \r\n    source.buffer = buffer;\r\n    gainNode.gain.value = this.volume;\r\n\r\n    source.connect(gainNode);\r\n    gainNode.connect(this.audioContext.destination);\r\n\r\n    source.start();\r\n  }\r\n\r\n  // Generate warning sound\r\n  generateWarningSound(): void {\r\n    if (!this.enabled || !this.audioContext) return;\r\n\r\n    const duration = 0.3;\r\n    const bufferSize = this.audioContext.sampleRate * duration;\r\n    const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);\r\n    const output = buffer.getChannelData(0);\r\n\r\n    for (let i = 0; i < bufferSize; i++) {\r\n      const t = i / this.audioContext.sampleRate;\r\n      const frequency = 1000 + Math.sin(t * 20) * 200; // Frequency modulation\r\n      const envelope = Math.sin(Math.PI * t / duration); // Bell-shaped envelope\r\n      output[i] = Math.sin(2 * Math.PI * frequency * t) * envelope * 0.4;\r\n    }\r\n\r\n    const source = this.audioContext.createBufferSource();\r\n    const gainNode = this.audioContext.createGain();\r\n    \r\n    source.buffer = buffer;\r\n    gainNode.gain.value = this.volume * 0.6;\r\n\r\n    source.connect(gainNode);\r\n    gainNode.connect(this.audioContext.destination);\r\n\r\n    source.start();\r\n  }\r\n\r\n  //        \r\n  async playTigerSound(): Promise<void> {\r\n    if (!this.enabled) return;\r\n\r\n    try {\r\n      //  HTML5 Audio     \r\n      const audio = new Audio('/tigerrosette/Media/sound/re_-tigra.mp3');\r\n      audio.volume = this.volume * 0.8; //    \r\n      audio.preload = 'auto';\r\n      \r\n      //  \r\n      await audio.play();\r\n      console.log('SoundManager: Tiger sound played successfully');\r\n    } catch (error) {\r\n      console.warn('Failed to play tiger sound:', error);\r\n    }\r\n  }\r\n\r\n  setVolume(volume: number): void {\r\n    this.volume = Math.max(0, Math.min(1, volume));\r\n  }\r\n\r\n  setEnabled(enabled: boolean): void {\r\n    this.enabled = enabled;\r\n  }\r\n\r\n  getVolume(): number {\r\n    return this.volume;\r\n  }\r\n\r\n  isEnabled(): boolean {\r\n    return this.enabled;\r\n  }\r\n}\r\n\r\n// Global sound manager instance\r\nexport const soundManager = new SoundManager();\r\n","import React from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\ninterface ScorePopupProps {\r\n  score: number;\r\n  reason: string;\r\n  isVisible: boolean;\r\n  position: { x: number; y: number };\r\n  type: 'success' | 'shock' | 'bonus';\r\n  experience?: number;\r\n}\r\n\r\nexport const ScorePopup: React.FC<ScorePopupProps> = ({ \r\n  score, \r\n  reason, \r\n  isVisible, \r\n  position,\r\n  type,\r\n  experience = 0\r\n}) => {\r\n  const getColorClass = () => {\r\n    switch (type) {\r\n      case 'success':\r\n        return score >= 30 ? 'text-yellow-300' : \r\n               score >= 20 ? 'text-green-300' : 'text-blue-300';\r\n      case 'shock':\r\n        return 'text-red-300';\r\n      case 'bonus':\r\n        return 'text-purple-300';\r\n      default:\r\n        return 'text-white';\r\n    }\r\n  };\r\n\r\n  const getIcon = () => {\r\n    switch (type) {\r\n      case 'success':\r\n        return score >= 30 ? '' : score >= 20 ? '' : '';\r\n      case 'shock':\r\n        return '';\r\n      case 'bonus':\r\n        return '';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isVisible && (\r\n        <motion.div\r\n          className={`absolute pointer-events-none z-50 ${getColorClass()}`}\r\n          initial={{\r\n            opacity: 0,\r\n            scale: 0.5,\r\n            x: position.x,\r\n            y: position.y\r\n          }}\r\n          animate={{\r\n            opacity: [0, 1, 1, 0],\r\n            scale: [0.5, 1.2, 1, 0.8],\r\n            y: position.y - 80,\r\n            x: position.x + (Math.random() - 0.5) * 40\r\n          }}\r\n          transition={{\r\n            duration: 2,\r\n            ease: 'easeOut'\r\n          }}\r\n        >\r\n          <div className=\"bg-black/80 backdrop-blur-sm rounded-lg px-3 py-2 border border-current\">\r\n            <div className=\"flex items-center space-x-2\">\r\n              <span className=\"text-lg\">{getIcon()}</span>\r\n              <div>\r\n                <div className=\"font-bold text-lg\">+{score}</div>\r\n                {experience > 0 && (\r\n                  <div className=\"text-xs text-blue-300\">+{experience} </div>\r\n                )}\r\n                <div className=\"text-xs opacity-80\">{reason}</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n};\r\n","import React, { useEffect, useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\ninterface ElectricSparksProps {\r\n  isActive: boolean;\r\n  intensity?: 'low' | 'medium' | 'high' | 'extreme';\r\n  onComplete?: () => void;\r\n}\r\n\r\ninterface Spark {\r\n  id: number;\r\n  x: number;\r\n  y: number;\r\n  angle: number;\r\n  length: number;\r\n  delay: number;\r\n  color: string;\r\n}\r\n\r\nexport const ElectricSparks: React.FC<ElectricSparksProps> = ({\r\n  isActive,\r\n  intensity = 'medium',\r\n  onComplete\r\n}) => {\r\n  const [sparks, setSparks] = useState<Spark[]>([]);\r\n\r\n  useEffect(() => {\r\n    if (isActive) {\r\n      generateSparks();\r\n    } else {\r\n      setSparks([]);\r\n    }\r\n  }, [isActive, intensity]);\r\n\r\n  const generateSparks = () => {\r\n    const sparkCount = {\r\n      low: 6,\r\n      medium: 12,\r\n      high: 18,\r\n      extreme: 25\r\n    }[intensity];\r\n\r\n    const colors = [\r\n      '#3B82F6', // blue\r\n      '#EF4444', // red\r\n      '#FFFFFF', // white\r\n      '#FBBF24', // yellow\r\n      '#8B5CF6', // purple\r\n    ];\r\n\r\n    const newSparks: Spark[] = [];\r\n\r\n    for (let i = 0; i < sparkCount; i++) {\r\n      newSparks.push({\r\n        id: i,\r\n        x: Math.random() * 100,\r\n        y: Math.random() * 100,\r\n        angle: Math.random() * 360,\r\n        length: 20 + Math.random() * 60,\r\n        delay: Math.random() * 0.3,\r\n        color: colors[Math.floor(Math.random() * colors.length)]\r\n      });\r\n    }\r\n\r\n    setSparks(newSparks);\r\n\r\n    // Auto cleanup after animation\r\n    setTimeout(() => {\r\n      setSparks([]);\r\n      onComplete?.();\r\n    }, 1000);\r\n  };\r\n\r\n  return (\r\n    <div className=\"absolute inset-0 pointer-events-none overflow-hidden\">\r\n      <AnimatePresence>\r\n        {sparks.map((spark) => (\r\n          <motion.div\r\n            key={spark.id}\r\n            className=\"absolute\"\r\n            style={{\r\n              left: `${spark.x}%`,\r\n              top: `${spark.y}%`,\r\n              transform: `rotate(${spark.angle}deg)`,\r\n            }}\r\n            initial={{ opacity: 0, scale: 0 }}\r\n            animate={{ \r\n              opacity: [0, 1, 0.7, 0],\r\n              scale: [0, 1, 0.8, 0],\r\n              x: [0, Math.cos(spark.angle * Math.PI / 180) * spark.length],\r\n              y: [0, Math.sin(spark.angle * Math.PI / 180) * spark.length]\r\n            }}\r\n            transition={{\r\n              duration: 0.6,\r\n              delay: spark.delay,\r\n              ease: \"easeOut\"\r\n            }}\r\n          >\r\n            {/* Main spark line */}\r\n            <div\r\n              className=\"w-1 bg-gradient-to-r opacity-90 rounded-full shadow-lg\"\r\n              style={{\r\n                height: `${spark.length}px`,\r\n                backgroundColor: spark.color,\r\n                boxShadow: `0 0 8px ${spark.color}, 0 0 16px ${spark.color}40`\r\n              }}\r\n            />\r\n            \r\n            {/* Spark glow effect */}\r\n            <div\r\n              className=\"absolute top-0 left-0 w-1 blur-sm opacity-60 rounded-full\"\r\n              style={{\r\n                height: `${spark.length}px`,\r\n                backgroundColor: spark.color,\r\n              }}\r\n            />\r\n          </motion.div>\r\n        ))}\r\n      </AnimatePresence>\r\n\r\n      {/* Electric discharge effect - jagged lines */}\r\n      <AnimatePresence>\r\n        {isActive && (\r\n          <motion.svg\r\n            className=\"absolute inset-0 w-full h-full\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: [0, 1, 0.8, 0.2, 0.9, 0] }}\r\n            transition={{ duration: 0.8, times: [0, 0.1, 0.3, 0.5, 0.7, 1] }}\r\n          >\r\n            {/* Jagged lightning lines */}\r\n            {Array.from({ length: 3 }, (_, i) => {\r\n              const startX = 20 + Math.random() * 60;\r\n              const startY = 20 + Math.random() * 60;\r\n              const segments = 5 + Math.floor(Math.random() * 5);\r\n              \r\n              let path = `M ${startX} ${startY}`;\r\n              let currentX = startX;\r\n              let currentY = startY;\r\n              \r\n              for (let j = 0; j < segments; j++) {\r\n                currentX += (Math.random() - 0.5) * 40;\r\n                currentY += (Math.random() - 0.5) * 40;\r\n                path += ` L ${currentX} ${currentY}`;\r\n              }\r\n\r\n              return (\r\n                <motion.path\r\n                  key={i}\r\n                  d={path}\r\n                  stroke=\"#FFFFFF\"\r\n                  strokeWidth={Math.random() * 2 + 1}\r\n                  fill=\"none\"\r\n                  opacity={0.8}\r\n                  filter=\"drop-shadow(0 0 4px #3B82F6)\"\r\n                  initial={{ pathLength: 0 }}\r\n                  animate={{ pathLength: 1 }}\r\n                  transition={{ \r\n                    duration: 0.3,\r\n                    delay: i * 0.1,\r\n                    ease: \"easeOut\"\r\n                  }}\r\n                />\r\n              );\r\n            })}\r\n          </motion.svg>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Screen flash effect */}\r\n      <AnimatePresence>\r\n        {isActive && (\r\n          <motion.div\r\n            className=\"absolute inset-0 bg-white mix-blend-screen\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: [0, 0.4, 0.1, 0.3, 0] }}\r\n            transition={{ duration: 0.5, times: [0, 0.1, 0.3, 0.6, 1] }}\r\n          />\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n};\r\n","export default \"__VITE_ASSET__Drv2uv67__\"","import React, { useRef, useEffect, useState } from 'react';\r\nimport { soundManager } from '../utils/soundManager';\r\nimport electricShockVideo from '../assets/video/electric_shock.mp4';\r\n\r\ninterface SimpleVideoPlayerProps {\r\n  isActive: boolean;\r\n  onComplete?: () => void;\r\n}\r\n\r\nexport const SimpleVideoPlayer: React.FC<SimpleVideoPlayerProps> = ({ \r\n  isActive, \r\n  onComplete\r\n}) => {\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const [debugInfo, setDebugInfo] = useState({ readyState: 0, networkState: 0, currentTime: 0, error: '' });\r\n  const [needsManualPlay, setNeedsManualPlay] = useState(false);\r\n  const [attemptedAutoPlay, setAttemptedAutoPlay] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n\r\n    console.log('SimpleVideoPlayer: Effect triggered', { isActive });\r\n\r\n    //   \r\n    const logVideoState = () => {\r\n      const payload = {\r\n        src: video.currentSrc || video.src,\r\n        readyState: video.readyState,\r\n        networkState: video.networkState,\r\n        error: video.error,\r\n        canPlay: video.readyState >= 3,\r\n        currentTime: video.currentTime\r\n      };\r\n      console.log('SimpleVideoPlayer: Video state', payload);\r\n      setDebugInfo({\r\n        readyState: video.readyState,\r\n        networkState: video.networkState,\r\n        currentTime: video.currentTime,\r\n        error: video.error ? String(video.error?.code) : ''\r\n      });\r\n    };\r\n\r\n    //   \r\n    const handleLoadStart = () => console.log('SimpleVideoPlayer: loadstart');\r\n    const handleCanPlay = () => { console.log('SimpleVideoPlayer: canplay'); logVideoState(); };\r\n    const handleError = (e: Event) => {\r\n      console.error('SimpleVideoPlayer: Video error', (e.target as HTMLVideoElement).error);\r\n      setNeedsManualPlay(false); // error different than autoplay policy\r\n      logVideoState();\r\n    };\r\n    const handlePlay = () => { console.log('SimpleVideoPlayer: play event'); setNeedsManualPlay(false); };\r\n\r\n    video.addEventListener('loadstart', handleLoadStart);\r\n    video.addEventListener('canplay', handleCanPlay);\r\n  video.addEventListener('error', handleError);\r\n  video.addEventListener('play', handlePlay);\r\n\r\n    logVideoState();\r\n\r\n  if (isActive) {\r\n      console.log('SimpleVideoPlayer: Starting video');\r\n      video.currentTime = 0;\r\n      video.style.display = 'block';\r\n      video.style.opacity = '1';\r\n      video.style.outline = '2px solid rgba(255,0,0,0.6)';\r\n      \r\n      //      \r\n      soundManager.playTigerSound().catch(error => {\r\n        console.warn('SimpleVideoPlayer: Failed to play tiger sound:', error);\r\n      });\r\n      \r\n      //      \r\n      setTimeout(() => {\r\n        logVideoState();\r\n        setAttemptedAutoPlay(true);\r\n        video.play().then(() => {\r\n          console.log('SimpleVideoPlayer: Video started successfully');\r\n          (window as any).__shockVideoStarted = true;\r\n        }).catch(error => {\r\n          console.error('SimpleVideoPlayer: Play error (autoplay likely blocked):', error);\r\n          setNeedsManualPlay(true);\r\n        });\r\n      }, 100);\r\n\r\n      //  \r\n      const handleEnded = () => {\r\n        console.log('SimpleVideoPlayer: Video ended');\r\n        video.style.display = 'none';\r\n        onComplete?.();\r\n      };\r\n\r\n      video.addEventListener('ended', handleEnded);\r\n      \r\n      return () => {\r\n        video.removeEventListener('ended', handleEnded);\r\n        video.removeEventListener('loadstart', handleLoadStart);\r\n        video.removeEventListener('canplay', handleCanPlay);\r\n        video.removeEventListener('error', handleError);\r\n        video.removeEventListener('play', handlePlay);\r\n      };\r\n    } else {\r\n      //    \r\n      video.style.display = 'none';\r\n      video.style.opacity = '0';\r\n      video.style.outline = 'none';\r\n    }\r\n  }, [isActive, onComplete]);\r\n\r\n  return (\r\n    <>\r\n      <video\r\n        ref={videoRef}\r\n        src={electricShockVideo}\r\n        className=\"absolute inset-0 w-full h-full object-cover rounded-2xl\"\r\n        style={{ display: 'none', opacity: 0, transition: 'opacity 120ms linear' }}\r\n        muted\r\n        playsInline\r\n        autoPlay={false}\r\n        preload=\"auto\"\r\n        poster={electricShockVideo}\r\n      />\r\n      {isActive && needsManualPlay && (\r\n        <div className=\"absolute inset-0 flex items-center justify-center z-10 bg-black/40\">\r\n          <button\r\n            className=\"px-4 py-2 bg-red-600/80 hover:bg-red-500 text-white text-xs rounded-md shadow\"\r\n            onClick={() => {\r\n              const v = videoRef.current; if (!v) return;\r\n              v.play().catch(err => console.error('Manual play failed', err));\r\n            }}\r\n          > </button>\r\n        </div>\r\n      )}\r\n      {isActive && import.meta.env.DEV && (\r\n        <div className=\"absolute top-0 left-0 m-1 p-1 rounded bg-black/70 text-[10px] leading-tight text-white z-20 space-y-0.5 pointer-events-none\">\r\n          <div>ready:{debugInfo.readyState} net:{debugInfo.networkState}</div>\r\n          <div>t:{debugInfo.currentTime.toFixed(2)}s</div>\r\n          <div>aPlay:{String(attemptedAutoPlay)} manual:{String(needsManualPlay)}</div>\r\n          {debugInfo.error && <div className=\"text-red-400\">err:{debugInfo.error}</div>}\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n","import { useEffect, useState } from 'react';\r\nimport { useGameStore } from '../store/gameStore';\r\nimport { getOutletImageByLevel } from '../utils/levelSystem';\r\n\r\nexport const useOutletImageAnimation = () => {\r\n  const { player } = useGameStore();\r\n  const [currentImage, setCurrentImage] = useState(getOutletImageByLevel(player.level));\r\n  const [isAnimating, setIsAnimating] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const newImage = getOutletImageByLevel(player.level);\r\n    console.log(`Player level: ${player.level}, Image path: ${newImage}`);\r\n    \r\n    if (newImage !== currentImage) {\r\n      // Start animation\r\n      setIsAnimating(true);\r\n      \r\n      // Change image after a brief delay\r\n      setTimeout(() => {\r\n        setCurrentImage(newImage);\r\n        setIsAnimating(false);\r\n      }, 300);\r\n    }\r\n  }, [player.level, currentImage]);\r\n\r\n  return {\r\n    currentImage,\r\n    isAnimating\r\n  };\r\n};\r\n","import React, { useState, useCallback, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useGameStore } from '../store/gameStore';\r\nimport { SparkEffect } from '../types/game';\r\nimport { soundManager } from '../utils/soundManager';\r\nimport { hapticManager } from '../utils/hapticManager';\r\nimport { calculateLevel } from '../utils/levelSystem';\r\nimport { ScorePopup } from './ScorePopup';\r\nimport { ElectricSparks } from './ElectricSparks';\r\nimport { SimpleVideoPlayer } from './SimpleVideoPlayer';\r\n// import { ElectricShockVideo } from './ElectricShockVideo'; // Fallback    \r\nimport { useOutletImageAnimation } from '../hooks/useOutletImageAnimation';\r\n\r\ninterface TigerOutletProps {\r\n  className?: string;\r\n  onShock?: () => void;\r\n}\r\n\r\nexport const TigerOutlet: React.FC<TigerOutletProps> = ({ className = '', onShock }) => {\r\n  const { \r\n    clickOutlet, \r\n    singleMode, \r\n    gameState,\r\n    player,\r\n    updateScore,\r\n    triggerShock\r\n  } = useGameStore();\r\n  \r\n  const { currentImage, isAnimating } = useOutletImageAnimation();\r\n  \r\n  const [sparks, setSparks] = useState<SparkEffect[]>([]);\r\n  const [isPressed, setIsPressed] = useState(false);\r\n  const [glowIntensity, setGlowIntensity] = useState(1);\r\n  const [isElectricShockActive, setIsElectricShockActive] = useState(false);\r\n  const [showShockVideo, setShowShockVideo] = useState(false);\r\n  const [scorePopup, setScorePopup] = useState<{\r\n    visible: boolean;\r\n    score: number;\r\n    reason: string;\r\n    type: 'success' | 'shock' | 'bonus';\r\n  }>({ visible: false, score: 0, reason: '', type: 'success' });\r\n\r\n  // Show score popup\r\n  const showScorePopup = useCallback((score: number, reason: string, type: 'success' | 'shock' | 'bonus') => {\r\n    setScorePopup({ visible: true, score, reason, type });\r\n    setTimeout(() => {\r\n      setScorePopup(prev => ({ ...prev, visible: false }));\r\n    }, 2000);\r\n  }, []);\r\n\r\n  // Handle video shock effect completion\r\n  const handleShockVideoComplete = useCallback(() => {\r\n    console.log('TigerOutlet: Shock video completed');\r\n    setShowShockVideo(false);\r\n  }, []);\r\n\r\n  // Force video off after timeout (failsafe)\r\n  useEffect(() => {\r\n    if (showShockVideo) {\r\n      console.log('TigerOutlet: Video started, setting failsafe timeout');\r\n      const timeout = setTimeout(() => {\r\n        console.log('TigerOutlet: Failsafe timeout - forcing video off');\r\n        setShowShockVideo(false);\r\n      }, 10000); // 10  \r\n      \r\n      return () => clearTimeout(timeout);\r\n    }\r\n  }, [showShockVideo]);\r\n\r\n  // Create spark effect on click\r\n  const createSparks = useCallback((intensity: 'low' | 'medium' | 'high' | 'extreme') => {\r\n    const sparkCount = {\r\n      low: 3,\r\n      medium: 6,\r\n      high: 12,\r\n      extreme: 20\r\n    }[intensity];\r\n\r\n    const newSparks: SparkEffect[] = Array.from({ length: sparkCount }, (_, i) => ({\r\n      id: `spark-${Date.now()}-${i}`,\r\n      x: Math.random() * 200 - 100, // Random position around center\r\n      y: Math.random() * 200 - 100,\r\n      intensity,\r\n      timestamp: Date.now(),\r\n      duration: 300 + Math.random() * 200,\r\n      color: intensity === 'extreme' ? '#E8FF00' : \r\n             intensity === 'high' ? '#00D4FF' : \r\n             intensity === 'medium' ? '#8A2BE2' : '#FF6B35'\r\n    }));\r\n\r\n    setSparks(prev => [...prev, ...newSparks]);\r\n\r\n    // Remove sparks after animation\r\n    newSparks.forEach(spark => {\r\n      setTimeout(() => {\r\n        setSparks(prev => prev.filter(s => s.id !== spark.id));\r\n      }, spark.duration);\r\n    });\r\n  }, []);\r\n\r\n  // Handle outlet click\r\n  const handleClick = useCallback(() => {\r\n    if (!gameState.isPlaying) return;\r\n    \r\n    //        \r\n    if (showShockVideo) {\r\n      console.log('TigerOutlet: Click during shock video - applying additional penalty!');\r\n      \r\n      //        \r\n      hapticManager.electricShock();\r\n      \r\n      //    \r\n      soundManager.generateShockSound();\r\n      \r\n      //         \r\n      const penaltyData = {\r\n        basePoints: -20, //  \r\n        riskMultiplier: 1,\r\n        streakBonus: 0,\r\n        timeBonus: 0,\r\n        totalPoints: -20,\r\n        reason: '   !'\r\n      };\r\n      \r\n      updateScore(penaltyData);\r\n      showScorePopup(penaltyData.totalPoints, penaltyData.reason, 'shock');\r\n      \r\n      //     \r\n      createSparks('extreme');\r\n      setGlowIntensity(4); //  \r\n      \r\n      return; //   \r\n    }\r\n\r\n    //       \r\n    if (singleMode.warningSignsActive) {\r\n      if (singleMode.dangerLevel > 80) {\r\n        hapticManager.extremeDangerWarning();\r\n      } else if (singleMode.dangerLevel > 60) {\r\n        hapticManager.dangerWarning();\r\n      }\r\n    }\r\n\r\n    //    \r\n    hapticManager.outletPress();\r\n\r\n    setIsPressed(true);\r\n    clickOutlet();\r\n\r\n    // ,       \r\n    const isShocked = singleMode.isDischarging;\r\n    console.log('TigerOutlet: Click handled', { \r\n      isShocked, \r\n      dangerLevel: singleMode.dangerLevel, \r\n      isDischarging: singleMode.isDischarging,\r\n      currentRisk: singleMode.currentRisk,\r\n      gameState: gameState.isPlaying,\r\n      aiElectricianActive: singleMode.aiElectricianActive,\r\n      nextDischargeTime: singleMode.nextDischargeTime,\r\n      now: Date.now(),\r\n      timeUntilDischarge: singleMode.nextDischargeTime - Date.now(),\r\n      showShockVideo: showShockVideo,\r\n      singleModeState: singleMode\r\n    });\r\n    \r\n    if (isShocked) {\r\n      console.log('TigerOutlet: Electric shock triggered!', {\r\n        currentVideoState: showShockVideo,\r\n        electricShockActive: isElectricShockActive\r\n      });\r\n      //    \r\n      setIsElectricShockActive(true);\r\n      setShowShockVideo(true); //   \r\n      setGlowIntensity(3);\r\n      \r\n      // Trigger screen shake effect\r\n      onShock?.();\r\n      \r\n      //      \r\n      hapticManager.electricShock();\r\n      \r\n      // Play shock sound\r\n      soundManager.generateShockSound();\r\n      \r\n      // Trigger shock with penalties (handled in store)\r\n      triggerShock();\r\n      \r\n      //     1 \r\n      setTimeout(() => {\r\n        console.log('TigerOutlet: Disabling electric shock effect');\r\n        setIsElectricShockActive(false);\r\n      }, 1000);\r\n      \r\n      // Check for penalty message and show it\r\n      setTimeout(() => {\r\n        const penaltyMessage = (window as any).lastPenaltyMessage;\r\n        if (penaltyMessage) {\r\n          showScorePopup(0, penaltyMessage, 'shock');\r\n          (window as any).lastPenaltyMessage = null;\r\n        } else {\r\n          // Balanced penalty for electric shock based on level and risk\r\n          const currentLevel = calculateLevel(player.experience).level;\r\n          const basePenalty = currentLevel >= 3 ? -15 : 5; //    ,   \r\n          \r\n          const riskPenalty = {\r\n            low: 1.0,\r\n            medium: 1.5,\r\n            high: 2.0,\r\n            extreme: 2.5\r\n          }[singleMode.currentRisk];\r\n          \r\n          const finalPenalty = currentLevel >= 3 ? \r\n            Math.floor(basePenalty * riskPenalty) : \r\n            basePenalty + Math.floor(Math.random() * 10); // 5-15   \r\n          \r\n          const scoreData = {\r\n            basePoints: basePenalty,\r\n            riskMultiplier: riskPenalty,\r\n            streakBonus: 0,\r\n            timeBonus: 0,\r\n            totalPoints: finalPenalty,\r\n            reason: ' '\r\n          };\r\n          \r\n          updateScore(scoreData);\r\n          showScorePopup(scoreData.totalPoints, scoreData.reason, 'shock');\r\n        }\r\n      }, 100);\r\n    } else {\r\n      // Success effect with haptic feedback\r\n      const intensity = singleMode.currentRisk === 'extreme' ? 'extreme' :\r\n                       singleMode.currentRisk === 'high' ? 'high' :\r\n                       singleMode.currentRisk === 'medium' ? 'medium' : 'low';\r\n      \r\n      createSparks(intensity);\r\n      setGlowIntensity(2);\r\n\r\n      //   \r\n      hapticManager.survivalSuccess();\r\n\r\n      // Play spark sound based on intensity\r\n      soundManager.generateSparkSound(intensity);\r\n\r\n      // Calculate success score - More balanced scoring\r\n      const basePoints = 5; //   10  5\r\n      const riskMultiplier = {\r\n        low: 1.0,\r\n        medium: 2.0,    //   1.5  2.0\r\n        high: 3.5,      //   2.0  3.5\r\n        extreme: 6.0    //   3.0  6.0\r\n      }[singleMode.currentRisk];\r\n\r\n      const streakBonus = singleMode.streakCount >= 50 ? 4.0 :  //  \r\n                         singleMode.streakCount >= 25 ? 3.0 :\r\n                         singleMode.streakCount >= 10 ? 2.0 :\r\n                         singleMode.streakCount >= 5 ? 1.5 : 1.0;\r\n\r\n      const totalPoints = Math.floor(basePoints * riskMultiplier * streakBonus);\r\n\r\n      const scoreData = {\r\n        basePoints,\r\n        riskMultiplier,\r\n        streakBonus,\r\n        timeBonus: 0,\r\n        totalPoints,\r\n        reason: ` (${singleMode.currentRisk} )`\r\n      };\r\n\r\n      updateScore(scoreData);\r\n      showScorePopup(scoreData.totalPoints, scoreData.reason, 'success');\r\n      \r\n      //     \r\n      if (singleMode.streakCount > 0 && singleMode.streakCount % 5 === 0) {\r\n        hapticManager.streakAchievement(singleMode.streakCount);\r\n      }\r\n    }\r\n\r\n    // Reset visual effects\r\n    setTimeout(() => {\r\n      setIsPressed(false);\r\n      setGlowIntensity(1);\r\n    }, 200);\r\n  }, [gameState.isPlaying, singleMode, clickOutlet, createSparks, updateScore]);\r\n\r\n  return (\r\n    <div className={`relative z-30 ${className}`}>\r\n      {/* Danger Warning during shock */}\r\n      {/*      (     ) */}\r\n      {showShockVideo && (\r\n        <motion.div\r\n          className=\"absolute inset-0 flex items-center justify-center pointer-events-none z-10\"\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: [0, 1, 0] }}\r\n          transition={{ duration: 0.5, repeat: Infinity }}\r\n        >\r\n          <div className=\"bg-red-600/70 text-white px-4 py-2 rounded-lg border border-red-300 font-bold text-xs md:text-sm\">\r\n             !    \r\n          </div>\r\n        </motion.div>\r\n      )}\r\n\r\n      {/* Main Outlet Button */}\r\n      <motion.button\r\n        onClick={handleClick}\r\n        disabled={!gameState.isPlaying} //     \r\n        className={`relative w-64 h-64 rounded-2xl overflow-hidden bg-gray-800 ${\r\n          showShockVideo ? 'cursor-pointer animate-pulse' : 'cursor-pointer'\r\n        }`}\r\n        style={{\r\n          opacity: !gameState.isPlaying ? 0.5 : 1,\r\n          boxShadow: showShockVideo \r\n            ? `0 0 ${40 * glowIntensity}px rgba(255, 0, 0, 0.8)` //     \r\n            : `0 0 ${20 * glowIntensity}px rgba(255, 107, 53, ${0.5 * glowIntensity})`\r\n        }}\r\n        whileTap={{ scale: 0.95 }} //  \r\n        whileHover={{ scale: 1.05 }}\r\n        animate={{\r\n          scale: isPressed ? 0.9 : showShockVideo ? [1, 1.05, 1] : 1, //    \r\n          filter: `brightness(${glowIntensity}) saturate(${glowIntensity})`,\r\n          rotateY: isAnimating ? [0, 180, 360] : 0\r\n        }}\r\n        transition={{\r\n          rotateY: { duration: 0.6, ease: \"easeInOut\" },\r\n          scale: showShockVideo ? { duration: 0.3, repeat: Infinity } : { duration: 0.1 }\r\n        }}\r\n      >\r\n        {/* Main Content - Image or Video */}\r\n        {showShockVideo ? (\r\n          /* :    ,  .   */\r\n          <div className=\"absolute inset-0 z-50 pointer-events-none\">\r\n            <SimpleVideoPlayer isActive={showShockVideo} onComplete={handleShockVideoComplete} />\r\n          </div>\r\n        ) : (\r\n          /* Main Outlet Image */\r\n          <img \r\n            src={currentImage} \r\n            alt=\"Tiger Outlet\" \r\n            className=\"absolute inset-0 w-full h-full object-cover rounded-2xl\"\r\n            onError={(e) => {\r\n              console.error('Image failed to load:', currentImage);\r\n              console.error('Error event:', e);\r\n              console.error('Current window location:', window.location.href);\r\n              console.error('Trying full path:', `${window.location.origin}${currentImage}`);\r\n              // Fallback to a solid background\r\n              e.currentTarget.style.display = 'none';\r\n            }}\r\n            onLoad={() => {\r\n              console.log('Image loaded successfully:', currentImage);\r\n            }}\r\n          />\r\n        )}\r\n        \r\n        {/*      */}\r\n  {/*   ,     */}\r\n        \r\n        {/* Tiger Stripes Overlay */}\r\n        {!showShockVideo && (\r\n          <div className=\"absolute inset-0 tiger-stripes opacity-20 mix-blend-overlay\" />\r\n        )}\r\n        \r\n        {/* Electric Glow Effect */}\r\n        {!showShockVideo && (\r\n          <motion.div\r\n            className=\"absolute inset-0 rounded-2xl\"\r\n            animate={{\r\n              boxShadow: singleMode.warningSignsActive \r\n                ? `0 0 ${30 * glowIntensity}px #FF0000, inset 0 0 ${30 * glowIntensity}px #FF0000`\r\n                : `0 0 ${15 * glowIntensity}px #FF6B35, inset 0 0 ${15 * glowIntensity}px #FF6B35`\r\n            }}\r\n            transition={{ duration: singleMode.warningSignsActive ? 0.1 : 0.2 }}\r\n          />\r\n        )}\r\n\r\n    {/* Danger Level Indicator (retained minimal, could be removed if clutter) */}\r\n  {singleMode.dangerLevel > 50 && !showShockVideo && (\r\n          <motion.div\r\n            className=\"absolute -top-12 left-1/2 transform -translate-x-1/2\"\r\n            initial={{ opacity: 0, scale: 0 }}\r\n            animate={{ \r\n              opacity: [0.7, 1, 0.7, 1],\r\n              scale: [0.8, 1.2, 0.8, 1.2]\r\n            }}\r\n            transition={{ \r\n              duration: 1,\r\n              repeat: Infinity,\r\n              ease: \"easeInOut\"\r\n            }}\r\n          >\r\n            <div className={`px-2 py-1 rounded-full text-xs font-bold ${\r\n              singleMode.dangerLevel > 80 ? 'bg-red-500 text-white' :\r\n              singleMode.dangerLevel > 70 ? 'bg-orange-500 text-white' :\r\n              'bg-yellow-500 text-black'\r\n            }`}>\r\n              {singleMode.dangerLevel > 80 ? ' ' :\r\n               singleMode.dangerLevel > 70 ? ' ' :\r\n               ' '}\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n\r\n        {/* Electric Shock Effects */}\r\n        {!showShockVideo && (\r\n          <ElectricSparks \r\n            isActive={isElectricShockActive}\r\n            intensity=\"extreme\"\r\n            onComplete={() => setIsElectricShockActive(false)}\r\n          />\r\n        )}\r\n      </motion.button>\r\n\r\n      {/* Spark Effects */}\r\n      <AnimatePresence>\r\n        {sparks.map((spark) => (\r\n          <motion.div\r\n            key={spark.id}\r\n            className=\"absolute w-2 h-2 rounded-full pointer-events-none\"\r\n            style={{\r\n              backgroundColor: spark.color,\r\n              boxShadow: `0 0 10px ${spark.color}`,\r\n              left: '50%',\r\n              top: '50%'\r\n            }}\r\n            initial={{\r\n              x: 0,\r\n              y: 0,\r\n              scale: 0,\r\n              opacity: 1\r\n            }}\r\n            animate={{\r\n              x: spark.x,\r\n              y: spark.y,\r\n              scale: [0, 1.5, 0.8, 0],\r\n              opacity: [1, 1, 0.5, 0],\r\n              rotate: [0, 180, 360]\r\n            }}\r\n            transition={{\r\n              duration: spark.duration / 1000,\r\n              ease: 'easeOut'\r\n            }}\r\n          />\r\n        ))}\r\n      </AnimatePresence>\r\n\r\n      {/* Risk Level Indicator */}\r\n      <div className=\"absolute -bottom-8 left-1/2 transform -translate-x-1/2\">\r\n        <div className={`px-3 py-1 rounded-full text-xs font-bold ${\r\n          singleMode.currentRisk === 'extreme' ? 'bg-red-500 text-white' :\r\n          singleMode.currentRisk === 'high' ? 'bg-orange-500 text-white' :\r\n          singleMode.currentRisk === 'medium' ? 'bg-yellow-500 text-black' :\r\n          'bg-green-500 text-white'\r\n        }`}>\r\n          {singleMode.currentRisk === 'extreme' ? '' :\r\n           singleMode.currentRisk === 'high' ? '' :\r\n           singleMode.currentRisk === 'medium' ? '' : ''} \r\n        </div>\r\n      </div>\r\n\r\n      {/* Score Popup */}\r\n      <ScorePopup\r\n        score={scorePopup.score}\r\n        reason={scorePopup.reason}\r\n        isVisible={scorePopup.visible}\r\n        position={{ x: 0, y: -32 }}\r\n        type={scorePopup.type}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\n//  fallback-   \r\n","import React, { useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useGameStore } from '../store/gameStore';\r\nimport { soundManager } from '../utils/soundManager';\r\nimport { hapticManager } from '../utils/hapticManager';\r\n\r\ninterface CounterAttackButtonProps {\r\n  className?: string;\r\n  disabled?: boolean;\r\n}\r\n\r\nexport const CounterAttackButton: React.FC<CounterAttackButtonProps> = ({ \r\n  className = '', \r\n  disabled = false \r\n}) => {\r\n  const { \r\n    player, \r\n    singleMode, \r\n    aiElectrician,\r\n    damageAIElectrician,\r\n    gameState \r\n  } = useGameStore();\r\n  \r\n  const [isAttacking, setIsAttacking] = useState(false);\r\n  const [cooldown, setCooldown] = useState(0);\r\n  const [showEffect, setShowEffect] = useState(false);\r\n\r\n  //    \r\n  const minVoltageForAttack = 10; //   50  10\r\n\r\n  // ,   \r\n  const canAttack = gameState.isPlaying && \r\n                   singleMode.aiElectricianActive && \r\n                   aiElectrician.isActive &&\r\n                   !disabled && \r\n                   cooldown === 0 &&\r\n                   player.volts >= minVoltageForAttack;\r\n\r\n  const handleCounterAttack = async () => {\r\n    if (!canAttack || isAttacking) return;\r\n\r\n    setIsAttacking(true);\r\n    setShowEffect(true);\r\n\r\n    //    \r\n    hapticManager.electricShock();\r\n    soundManager.generateShockSound();\r\n    \r\n    //        \r\n    const currentVoltage = player.volts;\r\n    const baseDamage = 10;\r\n    const voltageDamage = Math.floor(currentVoltage / 10); // 1    10 \r\n    const totalDamage = baseDamage + voltageDamage;\r\n    \r\n    console.log('Counter attack!', {\r\n      playerVoltage: currentVoltage,\r\n      baseDamage,\r\n      voltageDamage,\r\n      totalDamage\r\n    });\r\n    \r\n    damageAIElectrician('energy', totalDamage, true);\r\n    \r\n    //      \r\n    if (currentVoltage >= 200) {\r\n      damageAIElectrician('equipment', Math.random() * 15 + 10, true);\r\n    } else if (currentVoltage >= 100) {\r\n      if (Math.random() < 0.5) {\r\n        damageAIElectrician('equipment', Math.random() * 10 + 5, true);\r\n      }\r\n    }\r\n\r\n    //     \r\n    const state = useGameStore.getState();\r\n    useGameStore.setState({\r\n      player: {\r\n        ...state.player,\r\n        volts: 0 //   \r\n      }\r\n    });\r\n\r\n    //      \r\n    const cooldownTime = Math.max(3, Math.min(15, Math.floor(currentVoltage / 50))); //  3  15 \r\n    setCooldown(cooldownTime);\r\n    const cooldownInterval = setInterval(() => {\r\n      setCooldown(prev => {\r\n        if (prev <= 1) {\r\n          clearInterval(cooldownInterval);\r\n          return 0;\r\n        }\r\n        return prev - 1;\r\n      });\r\n    }, 1000);\r\n\r\n    //    1 \r\n    setTimeout(() => {\r\n      setShowEffect(false);\r\n      setIsAttacking(false);\r\n    }, 1000);\r\n  };\r\n\r\n  return (\r\n    <div className={`relative ${className}`}>\r\n      {/*   */}\r\n      <AnimatePresence>\r\n        {showEffect && (\r\n          <motion.div\r\n            className=\"absolute inset-0 pointer-events-none z-10\"\r\n            initial={{ scale: 0, rotate: 0 }}\r\n            animate={{ \r\n              scale: [0, 1.5, 1], \r\n              rotate: [0, 180, 360],\r\n              opacity: [0, 1, 0]\r\n            }}\r\n            exit={{ opacity: 0 }}\r\n            transition={{ duration: 1 }}\r\n          >\r\n            <div className=\"w-full h-full bg-yellow-400 rounded-full shadow-lg flex items-center justify-center\">\r\n              <span className=\"text-2xl\"></span>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/*   */}\r\n      <motion.button\r\n        onClick={handleCounterAttack}\r\n        disabled={!canAttack || isAttacking}\r\n        className={`\r\n          relative w-16 h-16 rounded-full border-2 transition-all duration-200\r\n          ${canAttack \r\n            ? 'bg-gradient-to-br from-yellow-400 to-orange-500 border-yellow-300 shadow-lg hover:shadow-xl cursor-pointer' \r\n            : 'bg-gray-600 border-gray-500 cursor-not-allowed opacity-50'\r\n          }\r\n          ${cooldown > 0 ? 'animate-pulse' : ''}\r\n        `}\r\n        whileTap={canAttack ? { scale: 0.9 } : {}}\r\n        whileHover={canAttack ? { scale: 1.1, rotate: 5 } : {}}\r\n        style={{\r\n          boxShadow: canAttack \r\n            ? `0 0 20px rgba(255, 193, 7, 0.6)` \r\n            : 'none'\r\n        }}\r\n      >\r\n        {/*  */}\r\n        <div className=\"flex items-center justify-center w-full h-full\">\r\n          {cooldown > 0 ? (\r\n            <span className=\"text-white font-bold text-sm\">{cooldown}</span>\r\n          ) : (\r\n            <span className=\"text-2xl\">\r\n              {isAttacking ? '' : player.level >= 5 ? '' : ''}\r\n            </span>\r\n          )}\r\n        </div>\r\n\r\n        {/*   */}\r\n        {canAttack && (\r\n          <div className=\"absolute -bottom-2 left-1/2 transform -translate-x-1/2\">\r\n            <div className=\"bg-black/80 text-white text-xs px-1 py-0.5 rounded\">\r\n              {player.volts}  0\r\n            </div>\r\n          </div>\r\n        )}\r\n      </motion.button>\r\n\r\n      {/*  */}\r\n      {!canAttack && !isAttacking && (\r\n        <div className=\"absolute -top-12 left-1/2 transform -translate-x-1/2 pointer-events-none\">\r\n          <div className=\"bg-black/80 text-white text-xs px-2 py-1 rounded whitespace-nowrap\">\r\n            {player.volts < minVoltageForAttack \r\n              ? ` ${minVoltageForAttack - player.volts} ` \r\n              : !gameState.isPlaying \r\n              ? '  '\r\n              : !singleMode.aiElectricianActive\r\n              ? '  '\r\n              : ' '\r\n            }\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { useGameApi, useOfflineMode } from '../hooks/useGameApi';\r\n\r\ninterface ConnectionStatusProps {\r\n  className?: string;\r\n}\r\n\r\nexport const ConnectionStatus: React.FC<ConnectionStatusProps> = ({ className = '' }) => {\r\n  const { isAuthenticated } = useGameApi();\r\n  const { isOnline } = useOfflineMode();\r\n\r\n  const getStatusInfo = () => {\r\n    if (!isOnline) {\r\n      return {\r\n        text: ' ',\r\n        color: 'text-red-400',\r\n        icon: '',\r\n        bgColor: 'bg-red-500/10'\r\n      };\r\n    }\r\n\r\n    if (!isAuthenticated) {\r\n      return {\r\n        text: ' ',\r\n        color: 'text-yellow-400',\r\n        icon: '',\r\n        bgColor: 'bg-yellow-500/10'\r\n      };\r\n    }\r\n\r\n    return {\r\n      text: '  ',\r\n      color: 'text-green-400',\r\n      icon: '',\r\n      bgColor: 'bg-green-500/10'\r\n    };\r\n  };\r\n\r\n  const status = getStatusInfo();\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, scale: 0.9 }}\r\n      animate={{ opacity: 1, scale: 1 }}\r\n      className={`glass-effect p-2 rounded-lg ${status.bgColor} ${className}`}\r\n    >\r\n      <div className=\"flex items-center space-x-2\">\r\n        <span className=\"text-sm\">{status.icon}</span>\r\n        <span className={`text-xs font-medium ${status.color}`}>\r\n          {status.text}\r\n        </span>\r\n      </div>\r\n    </motion.div>\r\n  );\r\n};\r\n","import React, { useEffect, useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useGameStore } from '../store/gameStore';\r\nimport { ShopItem, PlayerProtection } from '../types/game';\r\n\r\ninterface ProtectionShopProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport const ProtectionShop: React.FC<ProtectionShopProps> = ({ isOpen, onClose }) => {\r\n  const { \r\n    player, \r\n    getShopItems, \r\n    buyProtectionItem,\r\n    getTotalProtection \r\n  } = useGameStore();\r\n  \r\n  const [selectedCategory, setSelectedCategory] = useState<keyof PlayerProtection>('gloves');\r\n  const [purchaseAnimation, setPurchaseAnimation] = useState<string | null>(null);\r\n\r\n  //    Escape\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    const handleKey = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') onClose();\r\n    };\r\n    window.addEventListener('keydown', handleKey);\r\n    return () => window.removeEventListener('keydown', handleKey);\r\n  }, [isOpen, onClose]);\r\n\r\n  const shopItems = getShopItems();\r\n  const totalProtection = getTotalProtection();\r\n\r\n  const categories = [\r\n    { key: 'gloves' as keyof PlayerProtection, name: '', icon: '' },\r\n    { key: 'boots' as keyof PlayerProtection, name: '', icon: '' },\r\n    { key: 'suit' as keyof PlayerProtection, name: '', icon: '' },\r\n    { key: 'helmet' as keyof PlayerProtection, name: '', icon: '' }\r\n  ];\r\n\r\n  const filteredItems = shopItems.filter(item => item.type === selectedCategory);\r\n\r\n  const handlePurchase = (item: ShopItem) => {\r\n    const success = buyProtectionItem(item.type, item.level);\r\n    if (success) {\r\n      setPurchaseAnimation(item.id);\r\n      setTimeout(() => setPurchaseAnimation(null), 1000);\r\n    }\r\n  };\r\n\r\n  const canAfford = (price: number) => player.volts >= price;\r\n  const isOwned = (item: ShopItem) => {\r\n    const currentItem = player.protection[item.type];\r\n    return currentItem.level >= item.level;\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div\r\n      className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[999]\"\r\n      onClick={onClose}\r\n      role=\"button\"\r\n      aria-label=\" \"\r\n    >\r\n      <motion.div\r\n        initial={{ scale: 0.8, opacity: 0 }}\r\n        animate={{ scale: 1, opacity: 1 }}\r\n        exit={{ scale: 0.8, opacity: 0 }}\r\n        className=\"bg-gray-900 border-2 border-yellow-400 rounded-lg p-6 max-w-4xl w-full max-h-[80vh] overflow-y-auto\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        {/*  */}\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <div>\r\n            <h2 className=\"text-2xl font-bold text-yellow-400\"> </h2>\r\n            <p className=\"text-gray-300\">\r\n              : <span className=\"text-yellow-400 font-bold\">{player.volts}V</span> | \r\n               : <span className=\"text-green-400 font-bold\">{totalProtection.toFixed(1)}%</span>\r\n            </p>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-red-400 hover:text-red-300 text-2xl font-bold\"\r\n          >\r\n            \r\n          </button>\r\n        </div>\r\n\r\n        {/*  */}\r\n        <div className=\"flex mb-6 bg-gray-800 rounded-lg p-1\">\r\n          {categories.map(category => (\r\n            <button\r\n              key={category.key}\r\n              onClick={() => setSelectedCategory(category.key)}\r\n              className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all ${\r\n                selectedCategory === category.key\r\n                  ? 'bg-yellow-400 text-black'\r\n                  : 'text-gray-300 hover:text-white hover:bg-gray-700'\r\n              }`}\r\n            >\r\n              <span className=\"mr-2\">{category.icon}</span>\r\n              {category.name}\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/*   */}\r\n        <div className=\"mb-6 p-4 bg-gray-800 rounded-lg\">\r\n          <h3 className=\"text-lg font-bold text-yellow-400 mb-2\">\r\n             : {categories.find(c => c.key === selectedCategory)?.name}\r\n          </h3>\r\n          <div className=\"grid grid-cols-4 gap-2 text-sm\">\r\n            <div className=\"text-gray-400\">:</div>\r\n            <div className=\"text-white\">{player.protection[selectedCategory].level || ''}</div>\r\n            <div className=\"text-gray-400\">:</div>\r\n            <div className=\"text-green-400\">{player.protection[selectedCategory].protection}%</div>\r\n            <div className=\"text-gray-400\">:</div>\r\n            <div className=\"text-blue-400\">\r\n              {player.protection[selectedCategory].durability}/{player.protection[selectedCategory].maxDurability}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/*  */}\r\n        <div className=\"grid gap-4\">\r\n          {filteredItems.map(item => {\r\n            const owned = isOwned(item);\r\n            const affordable = canAfford(item.price);\r\n            const animating = purchaseAnimation === item.id;\r\n\r\n            return (\r\n              <motion.div\r\n                key={item.id}\r\n                className={`p-4 rounded-lg border-2 transition-all ${\r\n                  owned \r\n                    ? 'border-green-500 bg-green-900 bg-opacity-30' \r\n                    : affordable \r\n                      ? 'border-yellow-400 bg-gray-800' \r\n                      : 'border-gray-600 bg-gray-800 opacity-60'\r\n                }`}\r\n                whileHover={!owned && affordable ? { scale: 1.02 } : {}}\r\n              >\r\n                <div className=\"flex justify-between items-start\">\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"flex items-center gap-3 mb-2\">\r\n                      <span className=\"text-2xl\">{item.icon}</span>\r\n                      <div>\r\n                        <h4 className=\"text-lg font-bold text-white\">{item.name}</h4>\r\n                        <p className=\"text-gray-300 text-sm\">{item.description}</p>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                      <div>\r\n                        <span className=\"text-gray-400\">: </span>\r\n                        <span className=\"text-yellow-400 font-bold\">{item.level}</span>\r\n                      </div>\r\n                      <div>\r\n                        <span className=\"text-gray-400\">: </span>\r\n                        <span className=\"text-green-400 font-bold\">{item.protection}%</span>\r\n                      </div>\r\n                      <div>\r\n                        <span className=\"text-gray-400\">: </span>\r\n                        <span className=\"text-blue-400 font-bold\">{item.durability}</span>\r\n                      </div>\r\n                      <div>\r\n                        <span className=\"text-gray-400\">: </span>\r\n                        <span className=\"text-yellow-400 font-bold\">{item.price}V</span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"ml-4\">\r\n                    <AnimatePresence>\r\n                      {owned ? (\r\n                        <div className=\"px-4 py-2 bg-green-500 text-white rounded-lg font-bold\">\r\n                          \r\n                        </div>\r\n                      ) : (\r\n                        <motion.button\r\n                          onClick={() => handlePurchase(item)}\r\n                          disabled={!affordable}\r\n                          className={`px-4 py-2 rounded-lg font-bold transition-all ${\r\n                            affordable\r\n                              ? 'bg-yellow-400 text-black hover:bg-yellow-300'\r\n                              : 'bg-gray-600 text-gray-400 cursor-not-allowed'\r\n                          }`}\r\n                          whileTap={affordable ? { scale: 0.95 } : {}}\r\n                          animate={animating ? {\r\n                            scale: [1, 1.2, 1],\r\n                            backgroundColor: ['#fbbf24', '#10b981', '#fbbf24']\r\n                          } : {}}\r\n                        >\r\n                          {affordable ? '' : ' '}\r\n                        </motion.button>\r\n                      )}\r\n                    </AnimatePresence>\r\n                  </div>\r\n                </div>\r\n              </motion.div>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {/*  */}\r\n        <div className=\"mt-6 p-4 bg-blue-900 bg-opacity-30 border border-blue-400 rounded-lg\">\r\n          <p className=\"text-blue-300 text-sm\">\r\n             <strong>:</strong>      . \r\n                    .\r\n          </p>\r\n        </div>\r\n\r\n        {/*      */}\r\n        <div className=\"mt-6 flex justify-end\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"px-5 py-2 rounded-md font-bold bg-gray-700 text-white hover:bg-gray-600 border border-gray-500\"\r\n          >\r\n            \r\n          </button>\r\n        </div>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { useState } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { useGameStore } from '../store/gameStore';\r\nimport { ConnectionStatus } from './ConnectionStatus';\r\nimport { ProtectionShop } from './ProtectionShop';\r\n\r\nexport const GameHUD: React.FC = () => {\r\n  const { player, gameState, singleMode, aiElectrician, repairAIElectrician, getTotalProtection } = useGameStore();\r\n  const [showShop, setShowShop] = useState(false);\r\n\r\n  return (\r\n    <div className=\"fixed top-0 left-0 right-0 z-10 bg-black/20 backdrop-blur-sm border-b border-white/10 pointer-events-auto\">\r\n      <div className=\"flex justify-between items-center p-4\">\r\n        {/* Score Display */}\r\n        <div className=\"flex items-center space-x-4\">\r\n          <motion.div \r\n            className=\"glass-effect px-4 py-2\"\r\n            whileHover={{ scale: 1.05 }}\r\n          >\r\n            <div className=\"text-xs text-gray-300\"></div>\r\n            <div className=\"text-xl font-bold text-accent-lime\">\r\n              {gameState.score.toLocaleString()}\r\n            </div>\r\n          </motion.div>\r\n          \r\n          <motion.div \r\n            className=\"glass-effect px-4 py-2\"\r\n            whileHover={{ scale: 1.05 }}\r\n          >\r\n            <div className=\"text-xs text-gray-300\"></div>\r\n            <div className=\"text-xl font-bold text-primary-orange\">\r\n              {player.volts.toLocaleString()}\r\n            </div>\r\n          </motion.div>\r\n        </div>\r\n\r\n        {/* Streak Counter */}\r\n        <div className=\"text-center\">\r\n          <motion.div \r\n            className=\"glass-effect px-4 py-2\"\r\n            animate={{ \r\n              scale: singleMode.streakCount > 0 ? [1, 1.1, 1] : 1,\r\n              boxShadow: singleMode.streakCount >= 5 \r\n                ? '0 0 20px #E8FF00' \r\n                : '0 0 10px rgba(255,255,255,0.2)'\r\n            }}\r\n            transition={{ duration: 0.3 }}\r\n          >\r\n            <div className=\"text-xs text-gray-300\"></div>\r\n            <div className={`text-xl font-bold ${\r\n              singleMode.streakCount >= 25 ? 'text-red-400' :\r\n              singleMode.streakCount >= 10 ? 'text-orange-400' :\r\n              singleMode.streakCount >= 5 ? 'text-yellow-400' :\r\n              'text-white'\r\n            }`}>\r\n              {singleMode.streakCount}\r\n            </div>\r\n          </motion.div>\r\n        </div>\r\n\r\n        {/* Difficulty & Stats */}\r\n        <div className=\"flex items-center space-x-4\">\r\n          <motion.div \r\n            className=\"glass-effect px-4 py-2\"\r\n            whileHover={{ scale: 1.05 }}\r\n            animate={{\r\n              opacity: player.luckIndicatorHidden && Date.now() < player.luckHiddenUntil ? 0.3 : 1\r\n            }}\r\n            transition={{ duration: 0.3 }}\r\n          >\r\n            <div className=\"text-xs text-gray-300\"></div>\r\n            <div className={`text-sm font-bold ${\r\n              player.luckIndicatorHidden && Date.now() < player.luckHiddenUntil ? \r\n                'text-gray-500' :\r\n                player.luckCoefficient >= 70 ? 'text-green-400' :\r\n                player.luckCoefficient >= 50 ? 'text-yellow-400' :\r\n                player.luckCoefficient >= 30 ? 'text-orange-400' :\r\n                'text-red-400'\r\n            }`}>\r\n              {player.luckIndicatorHidden && Date.now() < player.luckHiddenUntil ? \r\n                '???' : \r\n                `${player.luckCoefficient}%`\r\n              }\r\n            </div>\r\n          </motion.div>\r\n\r\n          <motion.div \r\n            className=\"glass-effect px-4 py-2\"\r\n            whileHover={{ scale: 1.05 }}\r\n          >\r\n            <div className=\"text-xs text-gray-300\"></div>\r\n            <div className={`text-sm font-bold ${\r\n              singleMode.difficulty === 'extreme' ? 'text-red-400' :\r\n              singleMode.difficulty === 'hard' ? 'text-orange-400' :\r\n              singleMode.difficulty === 'medium' ? 'text-yellow-400' :\r\n              'text-green-400'\r\n            }`}>\r\n              {singleMode.difficulty === 'extreme' ? '' :\r\n               singleMode.difficulty === 'hard' ? '' :\r\n               singleMode.difficulty === 'medium' ? '' : ''}\r\n            </div>\r\n          </motion.div>\r\n\r\n          <motion.div \r\n            className=\"glass-effect px-4 py-2\"\r\n            whileHover={{ scale: 1.05 }}\r\n            animate={{\r\n              boxShadow: singleMode.dangerLevel > 80 ? '0 0 20px #ff4444' :\r\n                        singleMode.dangerLevel > 60 ? '0 0 15px #ff8800' :\r\n                        singleMode.dangerLevel > 40 ? '0 0 10px #ffaa00' :\r\n                        '0 0 5px rgba(255,255,255,0.2)'\r\n            }}\r\n          >\r\n            <div className=\"text-xs text-gray-300\"></div>\r\n            <div className={`text-sm font-bold ${\r\n              singleMode.dangerLevel > 80 ? 'text-red-400' :\r\n              singleMode.dangerLevel > 60 ? 'text-orange-400' :\r\n              singleMode.dangerLevel > 40 ? 'text-yellow-400' :\r\n              'text-green-400'\r\n            }`}>\r\n              {singleMode.dangerLevel}%\r\n            </div>\r\n          </motion.div>\r\n\r\n          {/* AI Electrician Status */}\r\n          <motion.div \r\n            className=\"glass-effect px-4 py-2\"\r\n            whileHover={{ scale: 1.05 }}\r\n            animate={{\r\n              boxShadow: singleMode.isDischarging ? '0 0 20px #ff0000' :\r\n                        singleMode.warningSignsActive ? '0 0 15px #ff8800' :\r\n                        singleMode.aiElectricianActive ? '0 0 10px #00ffff' :\r\n                        '0 0 5px rgba(255,255,255,0.2)',\r\n              scale: singleMode.isDischarging ? [1, 1.05, 1] : 1\r\n            }}\r\n            transition={{ duration: 0.3, repeat: singleMode.isDischarging ? Infinity : 0 }}\r\n          >\r\n            <div className=\"text-xs text-gray-300\"> </div>\r\n            <div className={`text-sm font-bold ${\r\n              singleMode.isDischarging ? 'text-red-400' :\r\n              singleMode.warningSignsActive ? 'text-orange-400' :\r\n              singleMode.aiElectricianActive ? 'text-cyan-400' :\r\n              'text-gray-500'\r\n            }`}>\r\n              {singleMode.isDischarging ? ' !' :\r\n               singleMode.warningSignsActive ? ' !' :\r\n               singleMode.aiElectricianActive ? ' ' :\r\n               ' '}\r\n            </div>\r\n          </motion.div>\r\n\r\n          {/* AI Electrician Energy & Fatigue */}\r\n          {singleMode.aiElectricianActive && (\r\n            <motion.div \r\n              className=\"glass-effect px-4 py-2 min-w-[120px]\"\r\n              whileHover={{ scale: 1.05 }}\r\n              animate={{\r\n                boxShadow: aiElectrician.energy < 20 ? '0 0 15px #ff4444' :\r\n                          aiElectrician.energy < 50 ? '0 0 10px #ff8800' :\r\n                          '0 0 5px rgba(255,255,255,0.2)'\r\n              }}\r\n            >\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <div className=\"text-xs text-gray-300\"></div>\r\n                  <div className=\"text-sm font-bold text-cyan-300\">{singleMode.stage || 1}</div>\r\n                </div>\r\n                <div className=\"text-right\">\r\n                  <div className=\"text-xs text-gray-300\"> </div>\r\n                  <div className=\"text-sm font-bold text-cyan-200\">\r\n                    {Math.max(0, Math.floor((aiElectrician.points ?? 0)))} / {Math.max(1, Math.floor((aiElectrician.maxPoints ?? 0)))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"text-xs text-gray-300\"></div>\r\n              <div className={`text-sm font-bold ${\r\n                aiElectrician.energy < 20 ? 'text-red-400' :\r\n                aiElectrician.energy < 50 ? 'text-orange-400' :\r\n                'text-green-400'\r\n              }`}>\r\n                {Math.round(aiElectrician.energy)}%\r\n              </div>\r\n              \r\n              {/* Fatigue Level */}\r\n              <div className=\"text-xs text-gray-300 mt-1\"></div>\r\n              <div className={`text-xs font-bold ${\r\n                aiElectrician.fatigueLevel >= 8 ? 'text-red-400' :\r\n                aiElectrician.fatigueLevel >= 5 ? 'text-orange-400' :\r\n                aiElectrician.fatigueLevel >= 2 ? 'text-yellow-400' :\r\n                'text-green-400'\r\n              }`}>\r\n                {Math.floor(aiElectrician.fatigueLevel)}/10\r\n                {aiElectrician.fatigueLevel >= 8 && ' '}\r\n                {aiElectrician.fatigueLevel >= 5 && aiElectrician.fatigueLevel < 8 && ' '}\r\n                {aiElectrician.fatigueLevel >= 2 && aiElectrician.fatigueLevel < 5 && ' '}\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n\r\n          <motion.div \r\n            className=\"glass-effect px-4 py-2\"\r\n            whileHover={{ scale: 1.05 }}\r\n          >\r\n            <div className=\"text-xs text-gray-300\"></div>\r\n            <div className=\"text-lg font-bold text-accent-blue\">\r\n              {player.totalClicks}\r\n            </div>\r\n          </motion.div>\r\n\r\n          {/* Connection Status */}\r\n          <ConnectionStatus />\r\n        </div>\r\n      </div>\r\n      \r\n  {/* Warning and danger banners removed as per request */}\r\n      \r\n      {/* AI Electrician Detailed Status */}\r\n      {singleMode.aiElectricianActive && (\r\n        <motion.div\r\n          className=\"bg-black/40 border-t border-white/10 px-4 py-3\"\r\n          initial={{ opacity: 0, y: -10 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ duration: 0.3 }}\r\n        >\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              {/* AI Electrician Name and Message */}\r\n              <div className=\"text-sm\">\r\n                <div className=\"text-cyan-400 font-bold\"> {aiElectrician.name}</div>\r\n                <div className={`text-xs ${\r\n                  aiElectrician.mood === 'confident' ? 'text-green-400' :\r\n                  aiElectrician.mood === 'frustrated' ? 'text-orange-400' :\r\n                  aiElectrician.mood === 'tired' ? 'text-yellow-400' :\r\n                  aiElectrician.mood === 'broken' ? 'text-red-400' :\r\n                  'text-red-600'\r\n                }`}>\r\n                  {aiElectrician.lastMessage}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Energy Bar */}\r\n              <div className=\"flex flex-col items-center\">\r\n                <div className=\"text-xs text-gray-300 mb-1\"></div>\r\n                <div className=\"w-20 h-2 bg-gray-700 rounded-full overflow-hidden\">\r\n                  <motion.div\r\n                    className={`h-full rounded-full ${\r\n                      aiElectrician.energy > 60 ? 'bg-green-500' :\r\n                      aiElectrician.energy > 30 ? 'bg-yellow-500' :\r\n                      'bg-red-500'\r\n                    }`}\r\n                    initial={{ width: 0 }}\r\n                    animate={{ width: `${aiElectrician.energy}%` }}\r\n                    transition={{ duration: 0.5 }}\r\n                  />\r\n                </div>\r\n                <div className=\"text-xs text-white\">{Math.round(aiElectrician.energy)}%</div>\r\n              </div>\r\n\r\n              {/* Voltage Bar */}\r\n              <div className=\"flex flex-col items-center\">\r\n                <div className=\"text-xs text-gray-300 mb-1\"></div>\r\n                <div className=\"w-20 h-2 bg-gray-700 rounded-full overflow-hidden\">\r\n                  <motion.div\r\n                    className={`h-full rounded-full ${\r\n                      aiElectrician.voltage > 300 ? 'bg-red-500' :\r\n                      aiElectrician.voltage > 200 ? 'bg-orange-500' :\r\n                      aiElectrician.voltage > 100 ? 'bg-yellow-500' :\r\n                      'bg-blue-500'\r\n                    }`}\r\n                    initial={{ width: 0 }}\r\n                    animate={{ \r\n                      width: `${(aiElectrician.voltage / aiElectrician.maxVoltage) * 100}%`,\r\n                      boxShadow: aiElectrician.voltage >= 100 ? '0 0 10px rgba(255, 0, 0, 0.8)' : 'none'\r\n                    }}\r\n                    transition={{ duration: 0.5 }}\r\n                  />\r\n                </div>\r\n                <div className={`text-xs font-bold ${\r\n                  aiElectrician.voltage >= 100 ? 'text-red-400' : 'text-white'\r\n                }`}>\r\n                  {Math.round(aiElectrician.voltage)}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Equipment Status */}\r\n              <div className=\"flex space-x-2\">\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-xs text-gray-300\"></div>\r\n                  <div className={`text-xs font-bold ${\r\n                    aiElectrician.equipment.battery > 70 ? 'text-green-400' :\r\n                    aiElectrician.equipment.battery > 30 ? 'text-yellow-400' :\r\n                    'text-red-400'\r\n                  }`}>\r\n                    {Math.round(aiElectrician.equipment.battery)}%\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-xs text-gray-300\"></div>\r\n                  <div className={`text-xs font-bold ${\r\n                    aiElectrician.equipment.capacitor > 70 ? 'text-green-400' :\r\n                    aiElectrician.equipment.capacitor > 30 ? 'text-yellow-400' :\r\n                    'text-red-400'\r\n                  }`}>\r\n                    {Math.round(aiElectrician.equipment.capacitor)}%\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-xs text-gray-300\"></div>\r\n                  <div className={`text-xs font-bold ${\r\n                    aiElectrician.equipment.wires > 70 ? 'text-green-400' :\r\n                    aiElectrician.equipment.wires > 30 ? 'text-yellow-400' :\r\n                    'text-red-400'\r\n                  }`}>\r\n                    {Math.round(aiElectrician.equipment.wires)}%\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-xs text-gray-300\"></div>\r\n                  <div className={`text-xs font-bold ${\r\n                    aiElectrician.equipment.generator > 70 ? 'text-green-400' :\r\n                    aiElectrician.equipment.generator > 30 ? 'text-yellow-400' :\r\n                    'text-red-400'\r\n                  }`}>\r\n                    {Math.round(aiElectrician.equipment.generator)}%\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Working Efficiency */}\r\n              <div className=\"text-center\">\r\n                <div className=\"text-xs text-gray-300\"></div>\r\n                <div className={`text-sm font-bold ${\r\n                  aiElectrician.workingEfficiency > 80 ? 'text-green-400' :\r\n                  aiElectrician.workingEfficiency > 50 ? 'text-yellow-400' :\r\n                  'text-red-400'\r\n                }`}>\r\n                  {Math.round(aiElectrician.workingEfficiency)}%\r\n                </div>\r\n              </div>\r\n\r\n              {/* Success/Failure Stats */}\r\n              <div className=\"text-center\">\r\n                <div className=\"text-xs text-gray-300\">/</div>\r\n                <div className=\"text-xs text-green-400\">{aiElectrician.successfulDischarges}</div>\r\n                <div className=\"text-xs text-red-400\">{aiElectrician.failuresCount}</div>\r\n              </div>\r\n\r\n              {/* Working Status */}\r\n              <div className=\"text-center\">\r\n                <div className={`text-sm font-bold ${\r\n                  aiElectrician.canWork ? 'text-green-400' : 'text-red-400'\r\n                }`}>\r\n                  {aiElectrician.canWork ? ' ' : '  '}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Repair Controls */}\r\n            <div className=\"flex space-x-2 mt-2\">\r\n              <motion.button\r\n                className=\"glass-effect px-3 py-1 text-xs text-green-400 hover:text-green-300 disabled:text-gray-500 disabled:cursor-not-allowed\"\r\n                onClick={() => {\r\n                  if (player.volts >= 50) {\r\n                    repairAIElectrician('energy');\r\n                    useGameStore.getState().updatePlayerStats({ volts: player.volts - 50 });\r\n                  }\r\n                }}\r\n                disabled={player.volts < 50 || aiElectrician.energy >= 90}\r\n                whileHover={{ scale: 1.05 }}\r\n                whileTap={{ scale: 0.95 }}\r\n              >\r\n                  (50)\r\n              </motion.button>\r\n              \r\n              <motion.button\r\n                className=\"glass-effect px-3 py-1 text-xs text-blue-400 hover:text-blue-300 disabled:text-gray-500 disabled:cursor-not-allowed\"\r\n                onClick={() => {\r\n                  if (player.volts >= 100) {\r\n                    repairAIElectrician('equipment');\r\n                    useGameStore.getState().updatePlayerStats({ volts: player.volts - 100 });\r\n                  }\r\n                }}\r\n                disabled={player.volts < 100 || Object.values(aiElectrician.equipment).every(val => val >= 95)}\r\n                whileHover={{ scale: 1.05 }}\r\n                whileTap={{ scale: 0.95 }}\r\n              >\r\n                  (100)\r\n              </motion.button>\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n      )}\r\n\r\n      {/* Protection Shop Button */}\r\n      <motion.button\r\n        onClick={() => setShowShop(true)}\r\n        className=\"fixed bottom-20 left-4 glass-effect px-4 py-2 text-yellow-400 hover:text-yellow-300 z-40\"\r\n        whileHover={{ scale: 1.1 }}\r\n        whileTap={{ scale: 0.95 }}\r\n      >\r\n        <div className=\"flex items-center gap-2\">\r\n          <span></span>\r\n          <div>\r\n            <div className=\"text-sm font-bold\"></div>\r\n            <div className=\"text-xs\">{getTotalProtection().toFixed(1)}%</div>\r\n          </div>\r\n        </div>\r\n      </motion.button>\r\n\r\n      {/* Protection Shop Modal */}\r\n      <ProtectionShop \r\n        isOpen={showShop}\r\n        onClose={() => setShowShop(false)}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n","import React, { useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\n\r\ninterface ScreenShakeProps {\r\n  isActive: boolean;\r\n  intensity?: 'low' | 'medium' | 'high' | 'extreme';\r\n  duration?: number;\r\n  onComplete?: () => void;\r\n}\r\n\r\nexport const ScreenShake: React.FC<ScreenShakeProps> = ({\r\n  isActive,\r\n  intensity = 'medium',\r\n  duration = 500,\r\n  onComplete\r\n}) => {\r\n  const shakeAmount = {\r\n    low: 5,\r\n    medium: 10,\r\n    high: 15,\r\n    extreme: 20\r\n  }[intensity];\r\n\r\n  useEffect(() => {\r\n    if (isActive && onComplete) {\r\n      const timer = setTimeout(onComplete, duration);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [isActive, duration, onComplete]);\r\n\r\n  if (!isActive) return null;\r\n\r\n  return (\r\n    <motion.div\r\n      className=\"fixed inset-0 pointer-events-none z-50\"\r\n      initial={{ x: 0, y: 0 }}\r\n      animate={{\r\n        x: [0, -shakeAmount, shakeAmount, -shakeAmount, shakeAmount, 0],\r\n        y: [0, shakeAmount, -shakeAmount, shakeAmount, -shakeAmount, 0],\r\n      }}\r\n      transition={{\r\n        duration: duration / 1000,\r\n        times: [0, 0.1, 0.2, 0.3, 0.4, 1],\r\n        ease: \"easeInOut\"\r\n      }}\r\n    >\r\n      {/* Red flash overlay */}\r\n      <motion.div\r\n        className=\"absolute inset-0 bg-red-500 mix-blend-multiply\"\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: [0, 0.3, 0, 0.2, 0] }}\r\n        transition={{ duration: duration / 1000 }}\r\n      />\r\n    </motion.div>\r\n  );\r\n};\r\n","import React, { useEffect, useState, useCallback } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { useGameStore } from '../store/gameStore';\r\nimport { TigerOutlet } from './TigerOutlet';\r\nimport { CounterAttackButton } from './CounterAttackButton';\r\nimport { GameHUD } from './GameHUD';\r\nimport { useGameApi } from '../hooks/useGameApi';\r\nimport { ScreenShake } from './ScreenShake';\r\n\r\nexport const GameScreen: React.FC = () => {\r\n  const { \r\n    gameState, \r\n    singleMode, \r\n    endGame, \r\n    player,\r\n    submitGameToServer\r\n  } = useGameStore();\r\n  \r\n  const { isAuthenticated } = useGameApi();\r\n  const [gameTime, setGameTime] = useState(0);\r\n  const [showGameOver, setShowGameOver] = useState(false);\r\n  const [isSavingToServer, setIsSavingToServer] = useState(false);\r\n  const [isScreenShaking, setIsScreenShaking] = useState(false);\r\n\r\n  // Handle screen shake from electric shock\r\n  const handleShockEffect = useCallback(() => {\r\n    setIsScreenShaking(true);\r\n    setTimeout(() => {\r\n      setIsScreenShaking(false);\r\n    }, 600); // Match ScreenShake duration\r\n  }, []);\r\n\r\n  // Game timer\r\n  useEffect(() => {\r\n    if (!gameState.isPlaying) return;\r\n\r\n    const interval = setInterval(() => {\r\n      setGameTime(prev => prev + 1);\r\n    }, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [gameState.isPlaying]);\r\n\r\n  // Handle game over conditions\r\n  useEffect(() => {\r\n    // Game over after 10 minutes or specific achievements\r\n    if (gameTime >= 600) { // 10 minutes\r\n      setShowGameOver(true);\r\n    }\r\n  }, [gameTime]);\r\n\r\n  const handleEndGame = async () => {\r\n    setShowGameOver(false);\r\n    setGameTime(0);\r\n    \r\n    //    ,   \r\n    if (isAuthenticated && gameState.score > 0) {\r\n      setIsSavingToServer(true);\r\n      \r\n      try {\r\n        //     store  \r\n        const gameStore = useGameStore.getState();\r\n        gameStore.gameState.gameTime = gameTime * 1000; //   \r\n        \r\n        const result = await submitGameToServer();\r\n        \r\n        if (result.success) {\r\n          console.log('     ');\r\n        } else {\r\n          console.warn('      :', result.error);\r\n        }\r\n      } catch (error) {\r\n        console.error('    :', error);\r\n      } finally {\r\n        setIsSavingToServer(false);\r\n      }\r\n    }\r\n    \r\n    endGame();\r\n  };\r\n\r\n  const formatTime = (seconds: number) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  if (showGameOver) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background-dark to-background-darker\">\r\n        <motion.div\r\n          initial={{ opacity: 0, scale: 0.8 }}\r\n          animate={{ opacity: 1, scale: 1 }}\r\n          className=\"glass-effect p-8 text-center max-w-md\"\r\n        >\r\n          <h2 className=\"text-3xl font-bold text-primary-orange mb-4\">\r\n             !\r\n          </h2>\r\n          \r\n          <div className=\"space-y-3 mb-6\">\r\n            <div className=\"flex justify-between\">\r\n              <span> :</span>\r\n              <span className=\"font-bold\">{formatTime(gameTime)}</span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span> :</span>\r\n              <span className=\"font-bold text-accent-lime\">{gameState.score.toLocaleString()}</span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span> :</span>\r\n              <span className=\"font-bold text-primary-orange\">{gameState.score}</span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span> :</span>\r\n              <span className=\"font-bold text-accent-blue\">{player.totalClicks}</span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span> :</span>\r\n              <span className=\"font-bold text-yellow-400\">{player.streak}</span>\r\n            </div>\r\n          </div>\r\n\r\n          {/*    */}\r\n          {isAuthenticated && gameState.score > 0 && (\r\n            <div className=\"mb-4 text-center\">\r\n              {isSavingToServer ? (\r\n                <div className=\"text-blue-400 text-sm\">\r\n                  <span className=\"inline-block animate-spin mr-2\"></span>\r\n                   ...\r\n                </div>\r\n              ) : (\r\n                <div className=\"text-green-400 text-sm\">\r\n                       \r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {!isAuthenticated && gameState.score > 0 && (\r\n            <div className=\"mb-4 text-center text-yellow-400 text-sm\">\r\n                  \r\n            </div>\r\n          )}\r\n\r\n          <motion.button\r\n            onClick={handleEndGame}\r\n            disabled={isSavingToServer}\r\n            className=\"w-full glass-effect p-3 rounded-xl hover:bg-primary-orange/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            whileHover={{ scale: isSavingToServer ? 1 : 1.05 }}\r\n            whileTap={{ scale: isSavingToServer ? 1 : 0.95 }}\r\n          >\r\n            <span className=\"font-bold\">\r\n              {isSavingToServer ? '...' : '  '}\r\n            </span>\r\n          </motion.button>\r\n        </motion.div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <ScreenShake isActive={isScreenShaking} />\r\n      <div className=\"min-h-screen bg-gradient-to-br from-background-dark to-background-darker relative\">\r\n      {/* Game HUD */}\r\n      <GameHUD />\r\n      \r\n      {/* Main Game Area */}\r\n      {/* Main playable area; extra top padding when    ,      */}\r\n      <div\r\n        className={`flex flex-col items-center justify-center min-h-screen pb-8 ${\r\n          singleMode.aiElectricianActive ? 'pt-44 md:pt-48' : 'pt-24'\r\n        }`}\r\n      >\r\n        {/* Game Timer */}\r\n        <motion.div\r\n          className=\"glass-effect px-6 py-3 mb-8\"\r\n          animate={{ \r\n            scale: gameTime % 10 === 0 && gameTime > 0 ? [1, 1.1, 1] : 1 \r\n          }}\r\n        >\r\n          <div className=\"text-center\">\r\n            <div className=\"text-xs text-gray-300\"> </div>\r\n            <div className=\"text-2xl font-bold text-white font-mono\">\r\n              {formatTime(gameTime)}\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n\r\n        {/* Tiger Outlet and Counter Attack - Main Game Elements */}\r\n  <div className=\"relative flex items-center justify-center space-x-8 mb-8 z-20\">\r\n          {/* Counter Attack Button */}\r\n          <CounterAttackButton className=\"order-1\" />\r\n          \r\n          {/* Tiger Outlet - Main Game Element */}\r\n          <TigerOutlet className=\"order-2\" onShock={handleShockEffect} />\r\n          \r\n          {/* Placeholder for symmetry */}\r\n          <div className=\"w-16 h-16 order-3 opacity-0\" />\r\n        </div>\r\n\r\n        {/* Quick Stats */}\r\n        <div className=\"flex space-x-4 text-center\">\r\n          <motion.div \r\n            className=\"glass-effect px-4 py-2\"\r\n            whileHover={{ scale: 1.05 }}\r\n          >\r\n            <div className=\"text-xs text-gray-300\"> </div>\r\n            <div className={`text-sm font-bold ${\r\n              singleMode.currentRisk === 'extreme' ? 'text-red-400' :\r\n              singleMode.currentRisk === 'high' ? 'text-orange-400' :\r\n              singleMode.currentRisk === 'medium' ? 'text-yellow-400' :\r\n              'text-green-400'\r\n            }`}>\r\n              {singleMode.currentRisk === 'extreme' ? '' :\r\n               singleMode.currentRisk === 'high' ? '' :\r\n               singleMode.currentRisk === 'medium' ? '' : ''}\r\n            </div>\r\n          </motion.div>\r\n        </div>\r\n\r\n        {/* Pause/Exit Button */}\r\n        <motion.button\r\n          onClick={handleEndGame}\r\n          className=\"mt-8 glass-effect px-6 py-3 rounded-xl hover:bg-red-500/20 transition-colors\"\r\n          whileHover={{ scale: 1.05 }}\r\n          whileTap={{ scale: 0.95 }}\r\n        >\r\n          <span className=\"text-red-300 font-bold\"> </span>\r\n        </motion.button>\r\n      </div>\r\n\r\n      {/* Background Effects */}\r\n      <div className=\"fixed inset-0 pointer-events-none overflow-hidden\">\r\n        {/* Electric grid animation */}\r\n        <motion.div\r\n          className=\"absolute inset-0 opacity-10\"\r\n          animate={{\r\n            backgroundPosition: ['0% 0%', '100% 100%'],\r\n          }}\r\n          transition={{\r\n            duration: 20,\r\n            repeat: Infinity,\r\n            ease: 'linear'\r\n          }}\r\n          style={{\r\n            backgroundImage: `\r\n              linear-gradient(0deg, transparent 24%, rgba(255, 107, 53, 0.05) 25%, rgba(255, 107, 53, 0.05) 26%, transparent 27%, transparent 74%, rgba(255, 107, 53, 0.05) 75%, rgba(255, 107, 53, 0.05) 76%, transparent 77%, transparent),\r\n              linear-gradient(90deg, transparent 24%, rgba(255, 107, 53, 0.05) 25%, rgba(255, 107, 53, 0.05) 26%, transparent 27%, transparent 74%, rgba(255, 107, 53, 0.05) 75%, rgba(255, 107, 53, 0.05) 76%, transparent 77%, transparent)\r\n            `,\r\n            backgroundSize: '50px 50px'\r\n          }}\r\n        />\r\n      </div>\r\n    </div>\r\n    </>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { useGameStore } from '../store/gameStore';\r\nimport { hapticManager } from '../utils/hapticManager';\r\n\r\nexport const MultiplayerScreen: React.FC = () => {\r\n  const handleBackToMenu = () => {\r\n    hapticManager.light();\r\n    useGameStore.getState().endGame();\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-background-dark to-background-darker\">\r\n      <motion.div\r\n        initial={{ opacity: 0, y: -20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ duration: 0.6 }}\r\n        className=\"text-center\"\r\n      >\r\n        <h1 className=\"text-4xl font-bold text-primary-orange mb-4\">\r\n            \r\n        </h1>\r\n        <p className=\"text-xl text-gray-300 mb-8\">\r\n              !\r\n        </p>\r\n      </motion.div>\r\n\r\n      <motion.div\r\n        initial={{ opacity: 0, scale: 0.9 }}\r\n        animate={{ opacity: 1, scale: 1 }}\r\n        transition={{ duration: 0.5, delay: 0.2 }}\r\n        className=\"glass-effect p-8 rounded-xl text-center max-w-md\"\r\n      >\r\n        <div className=\"text-6xl mb-4\"></div>\r\n        <h2 className=\"text-2xl font-bold text-white mb-4\"> </h2>\r\n        <p className=\"text-gray-300 mb-6\">\r\n               :\r\n        </p>\r\n        \r\n        <div className=\"space-y-3 text-left mb-6\">\r\n          <div className=\"flex items-center space-x-3\">\r\n            <span className=\"text-purple-400\"></span>\r\n            <span className=\"text-gray-300\"> 1v1   </span>\r\n          </div>\r\n          <div className=\"flex items-center space-x-3\">\r\n            <span className=\"text-blue-400\"></span>\r\n            <span className=\"text-gray-300\">  8 </span>\r\n          </div>\r\n          <div className=\"flex items-center space-x-3\">\r\n            <span className=\"text-green-400\"></span>\r\n            <span className=\"text-gray-300\"> </span>\r\n          </div>\r\n          <div className=\"flex items-center space-x-3\">\r\n            <span className=\"text-yellow-400\"></span>\r\n            <span className=\"text-gray-300\">  </span>\r\n          </div>\r\n        </div>\r\n\r\n        <motion.button\r\n          onClick={handleBackToMenu}\r\n          className=\"w-full glass-effect p-3 rounded-xl hover:bg-orange-500/20 transition-colors border border-orange-400/30\"\r\n          whileHover={{ scale: 1.02 }}\r\n          whileTap={{ scale: 0.98 }}\r\n        >\r\n          <span className=\"text-lg font-semibold text-orange-400\">\r\n               \r\n          </span>\r\n        </motion.button>\r\n      </motion.div>\r\n\r\n      <motion.div\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: 1 }}\r\n        transition={{ duration: 0.5, delay: 0.4 }}\r\n        className=\"mt-8 text-center text-gray-400 text-sm\"\r\n      >\r\n        <p>   ,     !</p>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n};\r\n","const PACKET_TYPES = Object.create(null); // no Map = no polyfill\nPACKET_TYPES[\"open\"] = \"0\";\nPACKET_TYPES[\"close\"] = \"1\";\nPACKET_TYPES[\"ping\"] = \"2\";\nPACKET_TYPES[\"pong\"] = \"3\";\nPACKET_TYPES[\"message\"] = \"4\";\nPACKET_TYPES[\"upgrade\"] = \"5\";\nPACKET_TYPES[\"noop\"] = \"6\";\nconst PACKET_TYPES_REVERSE = Object.create(null);\nObject.keys(PACKET_TYPES).forEach((key) => {\n    PACKET_TYPES_REVERSE[PACKET_TYPES[key]] = key;\n});\nconst ERROR_PACKET = { type: \"error\", data: \"parser error\" };\nexport { PACKET_TYPES, PACKET_TYPES_REVERSE, ERROR_PACKET };\n","import { PACKET_TYPES } from \"./commons.js\";\nconst withNativeBlob = typeof Blob === \"function\" ||\n    (typeof Blob !== \"undefined\" &&\n        Object.prototype.toString.call(Blob) === \"[object BlobConstructor]\");\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\n// ArrayBuffer.isView method is not defined in IE10\nconst isView = (obj) => {\n    return typeof ArrayBuffer.isView === \"function\"\n        ? ArrayBuffer.isView(obj)\n        : obj && obj.buffer instanceof ArrayBuffer;\n};\nconst encodePacket = ({ type, data }, supportsBinary, callback) => {\n    if (withNativeBlob && data instanceof Blob) {\n        if (supportsBinary) {\n            return callback(data);\n        }\n        else {\n            return encodeBlobAsBase64(data, callback);\n        }\n    }\n    else if (withNativeArrayBuffer &&\n        (data instanceof ArrayBuffer || isView(data))) {\n        if (supportsBinary) {\n            return callback(data);\n        }\n        else {\n            return encodeBlobAsBase64(new Blob([data]), callback);\n        }\n    }\n    // plain string\n    return callback(PACKET_TYPES[type] + (data || \"\"));\n};\nconst encodeBlobAsBase64 = (data, callback) => {\n    const fileReader = new FileReader();\n    fileReader.onload = function () {\n        const content = fileReader.result.split(\",\")[1];\n        callback(\"b\" + (content || \"\"));\n    };\n    return fileReader.readAsDataURL(data);\n};\nfunction toArray(data) {\n    if (data instanceof Uint8Array) {\n        return data;\n    }\n    else if (data instanceof ArrayBuffer) {\n        return new Uint8Array(data);\n    }\n    else {\n        return new Uint8Array(data.buffer, data.byteOffset, data.byteLength);\n    }\n}\nlet TEXT_ENCODER;\nexport function encodePacketToBinary(packet, callback) {\n    if (withNativeBlob && packet.data instanceof Blob) {\n        return packet.data.arrayBuffer().then(toArray).then(callback);\n    }\n    else if (withNativeArrayBuffer &&\n        (packet.data instanceof ArrayBuffer || isView(packet.data))) {\n        return callback(toArray(packet.data));\n    }\n    encodePacket(packet, false, (encoded) => {\n        if (!TEXT_ENCODER) {\n            TEXT_ENCODER = new TextEncoder();\n        }\n        callback(TEXT_ENCODER.encode(encoded));\n    });\n}\nexport { encodePacket };\n","// imported from https://github.com/socketio/base64-arraybuffer\nconst chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n// Use a lookup table to find the index.\nconst lookup = typeof Uint8Array === 'undefined' ? [] : new Uint8Array(256);\nfor (let i = 0; i < chars.length; i++) {\n    lookup[chars.charCodeAt(i)] = i;\n}\nexport const encode = (arraybuffer) => {\n    let bytes = new Uint8Array(arraybuffer), i, len = bytes.length, base64 = '';\n    for (i = 0; i < len; i += 3) {\n        base64 += chars[bytes[i] >> 2];\n        base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n        base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n        base64 += chars[bytes[i + 2] & 63];\n    }\n    if (len % 3 === 2) {\n        base64 = base64.substring(0, base64.length - 1) + '=';\n    }\n    else if (len % 3 === 1) {\n        base64 = base64.substring(0, base64.length - 2) + '==';\n    }\n    return base64;\n};\nexport const decode = (base64) => {\n    let bufferLength = base64.length * 0.75, len = base64.length, i, p = 0, encoded1, encoded2, encoded3, encoded4;\n    if (base64[base64.length - 1] === '=') {\n        bufferLength--;\n        if (base64[base64.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n    const arraybuffer = new ArrayBuffer(bufferLength), bytes = new Uint8Array(arraybuffer);\n    for (i = 0; i < len; i += 4) {\n        encoded1 = lookup[base64.charCodeAt(i)];\n        encoded2 = lookup[base64.charCodeAt(i + 1)];\n        encoded3 = lookup[base64.charCodeAt(i + 2)];\n        encoded4 = lookup[base64.charCodeAt(i + 3)];\n        bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\n        bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n        bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\n    }\n    return arraybuffer;\n};\n","import { ERROR_PACKET, PACKET_TYPES_REVERSE, } from \"./commons.js\";\nimport { decode } from \"./contrib/base64-arraybuffer.js\";\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\nexport const decodePacket = (encodedPacket, binaryType) => {\n    if (typeof encodedPacket !== \"string\") {\n        return {\n            type: \"message\",\n            data: mapBinary(encodedPacket, binaryType),\n        };\n    }\n    const type = encodedPacket.charAt(0);\n    if (type === \"b\") {\n        return {\n            type: \"message\",\n            data: decodeBase64Packet(encodedPacket.substring(1), binaryType),\n        };\n    }\n    const packetType = PACKET_TYPES_REVERSE[type];\n    if (!packetType) {\n        return ERROR_PACKET;\n    }\n    return encodedPacket.length > 1\n        ? {\n            type: PACKET_TYPES_REVERSE[type],\n            data: encodedPacket.substring(1),\n        }\n        : {\n            type: PACKET_TYPES_REVERSE[type],\n        };\n};\nconst decodeBase64Packet = (data, binaryType) => {\n    if (withNativeArrayBuffer) {\n        const decoded = decode(data);\n        return mapBinary(decoded, binaryType);\n    }\n    else {\n        return { base64: true, data }; // fallback for old browsers\n    }\n};\nconst mapBinary = (data, binaryType) => {\n    switch (binaryType) {\n        case \"blob\":\n            if (data instanceof Blob) {\n                // from WebSocket + binaryType \"blob\"\n                return data;\n            }\n            else {\n                // from HTTP long-polling or WebTransport\n                return new Blob([data]);\n            }\n        case \"arraybuffer\":\n        default:\n            if (data instanceof ArrayBuffer) {\n                // from HTTP long-polling (base64) or WebSocket + binaryType \"arraybuffer\"\n                return data;\n            }\n            else {\n                // from WebTransport (Uint8Array)\n                return data.buffer;\n            }\n    }\n};\n","import { encodePacket, encodePacketToBinary } from \"./encodePacket.js\";\nimport { decodePacket } from \"./decodePacket.js\";\nimport { ERROR_PACKET, } from \"./commons.js\";\nconst SEPARATOR = String.fromCharCode(30); // see https://en.wikipedia.org/wiki/Delimiter#ASCII_delimited_text\nconst encodePayload = (packets, callback) => {\n    // some packets may be added to the array while encoding, so the initial length must be saved\n    const length = packets.length;\n    const encodedPackets = new Array(length);\n    let count = 0;\n    packets.forEach((packet, i) => {\n        // force base64 encoding for binary packets\n        encodePacket(packet, false, (encodedPacket) => {\n            encodedPackets[i] = encodedPacket;\n            if (++count === length) {\n                callback(encodedPackets.join(SEPARATOR));\n            }\n        });\n    });\n};\nconst decodePayload = (encodedPayload, binaryType) => {\n    const encodedPackets = encodedPayload.split(SEPARATOR);\n    const packets = [];\n    for (let i = 0; i < encodedPackets.length; i++) {\n        const decodedPacket = decodePacket(encodedPackets[i], binaryType);\n        packets.push(decodedPacket);\n        if (decodedPacket.type === \"error\") {\n            break;\n        }\n    }\n    return packets;\n};\nexport function createPacketEncoderStream() {\n    return new TransformStream({\n        transform(packet, controller) {\n            encodePacketToBinary(packet, (encodedPacket) => {\n                const payloadLength = encodedPacket.length;\n                let header;\n                // inspired by the WebSocket format: https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers#decoding_payload_length\n                if (payloadLength < 126) {\n                    header = new Uint8Array(1);\n                    new DataView(header.buffer).setUint8(0, payloadLength);\n                }\n                else if (payloadLength < 65536) {\n                    header = new Uint8Array(3);\n                    const view = new DataView(header.buffer);\n                    view.setUint8(0, 126);\n                    view.setUint16(1, payloadLength);\n                }\n                else {\n                    header = new Uint8Array(9);\n                    const view = new DataView(header.buffer);\n                    view.setUint8(0, 127);\n                    view.setBigUint64(1, BigInt(payloadLength));\n                }\n                // first bit indicates whether the payload is plain text (0) or binary (1)\n                if (packet.data && typeof packet.data !== \"string\") {\n                    header[0] |= 0x80;\n                }\n                controller.enqueue(header);\n                controller.enqueue(encodedPacket);\n            });\n        },\n    });\n}\nlet TEXT_DECODER;\nfunction totalLength(chunks) {\n    return chunks.reduce((acc, chunk) => acc + chunk.length, 0);\n}\nfunction concatChunks(chunks, size) {\n    if (chunks[0].length === size) {\n        return chunks.shift();\n    }\n    const buffer = new Uint8Array(size);\n    let j = 0;\n    for (let i = 0; i < size; i++) {\n        buffer[i] = chunks[0][j++];\n        if (j === chunks[0].length) {\n            chunks.shift();\n            j = 0;\n        }\n    }\n    if (chunks.length && j < chunks[0].length) {\n        chunks[0] = chunks[0].slice(j);\n    }\n    return buffer;\n}\nexport function createPacketDecoderStream(maxPayload, binaryType) {\n    if (!TEXT_DECODER) {\n        TEXT_DECODER = new TextDecoder();\n    }\n    const chunks = [];\n    let state = 0 /* State.READ_HEADER */;\n    let expectedLength = -1;\n    let isBinary = false;\n    return new TransformStream({\n        transform(chunk, controller) {\n            chunks.push(chunk);\n            while (true) {\n                if (state === 0 /* State.READ_HEADER */) {\n                    if (totalLength(chunks) < 1) {\n                        break;\n                    }\n                    const header = concatChunks(chunks, 1);\n                    isBinary = (header[0] & 0x80) === 0x80;\n                    expectedLength = header[0] & 0x7f;\n                    if (expectedLength < 126) {\n                        state = 3 /* State.READ_PAYLOAD */;\n                    }\n                    else if (expectedLength === 126) {\n                        state = 1 /* State.READ_EXTENDED_LENGTH_16 */;\n                    }\n                    else {\n                        state = 2 /* State.READ_EXTENDED_LENGTH_64 */;\n                    }\n                }\n                else if (state === 1 /* State.READ_EXTENDED_LENGTH_16 */) {\n                    if (totalLength(chunks) < 2) {\n                        break;\n                    }\n                    const headerArray = concatChunks(chunks, 2);\n                    expectedLength = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length).getUint16(0);\n                    state = 3 /* State.READ_PAYLOAD */;\n                }\n                else if (state === 2 /* State.READ_EXTENDED_LENGTH_64 */) {\n                    if (totalLength(chunks) < 8) {\n                        break;\n                    }\n                    const headerArray = concatChunks(chunks, 8);\n                    const view = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length);\n                    const n = view.getUint32(0);\n                    if (n > Math.pow(2, 53 - 32) - 1) {\n                        // the maximum safe integer in JavaScript is 2^53 - 1\n                        controller.enqueue(ERROR_PACKET);\n                        break;\n                    }\n                    expectedLength = n * Math.pow(2, 32) + view.getUint32(4);\n                    state = 3 /* State.READ_PAYLOAD */;\n                }\n                else {\n                    if (totalLength(chunks) < expectedLength) {\n                        break;\n                    }\n                    const data = concatChunks(chunks, expectedLength);\n                    controller.enqueue(decodePacket(isBinary ? data : TEXT_DECODER.decode(data), binaryType));\n                    state = 0 /* State.READ_HEADER */;\n                }\n                if (expectedLength === 0 || expectedLength > maxPayload) {\n                    controller.enqueue(ERROR_PACKET);\n                    break;\n                }\n            }\n        },\n    });\n}\nexport const protocol = 4;\nexport { encodePacket, encodePayload, decodePacket, decodePayload, };\n","/**\n * Initialize a new `Emitter`.\n *\n * @api public\n */\n\nexport function Emitter(obj) {\n  if (obj) return mixin(obj);\n}\n\n/**\n * Mixin the emitter properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\nfunction mixin(obj) {\n  for (var key in Emitter.prototype) {\n    obj[key] = Emitter.prototype[key];\n  }\n  return obj;\n}\n\n/**\n * Listen on the given `event` with `fn`.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.on =\nEmitter.prototype.addEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])\n    .push(fn);\n  return this;\n};\n\n/**\n * Adds an `event` listener that will be invoked a single\n * time then automatically removed.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.once = function(event, fn){\n  function on() {\n    this.off(event, on);\n    fn.apply(this, arguments);\n  }\n\n  on.fn = fn;\n  this.on(event, on);\n  return this;\n};\n\n/**\n * Remove the given callback for `event` or all\n * registered callbacks.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.off =\nEmitter.prototype.removeListener =\nEmitter.prototype.removeAllListeners =\nEmitter.prototype.removeEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n\n  // all\n  if (0 == arguments.length) {\n    this._callbacks = {};\n    return this;\n  }\n\n  // specific event\n  var callbacks = this._callbacks['$' + event];\n  if (!callbacks) return this;\n\n  // remove all handlers\n  if (1 == arguments.length) {\n    delete this._callbacks['$' + event];\n    return this;\n  }\n\n  // remove specific handler\n  var cb;\n  for (var i = 0; i < callbacks.length; i++) {\n    cb = callbacks[i];\n    if (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, 1);\n      break;\n    }\n  }\n\n  // Remove event specific arrays for event types that no\n  // one is subscribed for to avoid memory leak.\n  if (callbacks.length === 0) {\n    delete this._callbacks['$' + event];\n  }\n\n  return this;\n};\n\n/**\n * Emit `event` with the given args.\n *\n * @param {String} event\n * @param {Mixed} ...\n * @return {Emitter}\n */\n\nEmitter.prototype.emit = function(event){\n  this._callbacks = this._callbacks || {};\n\n  var args = new Array(arguments.length - 1)\n    , callbacks = this._callbacks['$' + event];\n\n  for (var i = 1; i < arguments.length; i++) {\n    args[i - 1] = arguments[i];\n  }\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0);\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\n      callbacks[i].apply(this, args);\n    }\n  }\n\n  return this;\n};\n\n// alias used for reserved events (protected method)\nEmitter.prototype.emitReserved = Emitter.prototype.emit;\n\n/**\n * Return array of callbacks for `event`.\n *\n * @param {String} event\n * @return {Array}\n * @api public\n */\n\nEmitter.prototype.listeners = function(event){\n  this._callbacks = this._callbacks || {};\n  return this._callbacks['$' + event] || [];\n};\n\n/**\n * Check if this emitter has `event` handlers.\n *\n * @param {String} event\n * @return {Boolean}\n * @api public\n */\n\nEmitter.prototype.hasListeners = function(event){\n  return !! this.listeners(event).length;\n};\n","export const nextTick = (() => {\n    const isPromiseAvailable = typeof Promise === \"function\" && typeof Promise.resolve === \"function\";\n    if (isPromiseAvailable) {\n        return (cb) => Promise.resolve().then(cb);\n    }\n    else {\n        return (cb, setTimeoutFn) => setTimeoutFn(cb, 0);\n    }\n})();\nexport const globalThisShim = (() => {\n    if (typeof self !== \"undefined\") {\n        return self;\n    }\n    else if (typeof window !== \"undefined\") {\n        return window;\n    }\n    else {\n        return Function(\"return this\")();\n    }\n})();\nexport const defaultBinaryType = \"arraybuffer\";\nexport function createCookieJar() { }\n","import { globalThisShim as globalThis } from \"./globals.node.js\";\nexport function pick(obj, ...attr) {\n    return attr.reduce((acc, k) => {\n        if (obj.hasOwnProperty(k)) {\n            acc[k] = obj[k];\n        }\n        return acc;\n    }, {});\n}\n// Keep a reference to the real timeout functions so they can be used when overridden\nconst NATIVE_SET_TIMEOUT = globalThis.setTimeout;\nconst NATIVE_CLEAR_TIMEOUT = globalThis.clearTimeout;\nexport function installTimerFunctions(obj, opts) {\n    if (opts.useNativeTimers) {\n        obj.setTimeoutFn = NATIVE_SET_TIMEOUT.bind(globalThis);\n        obj.clearTimeoutFn = NATIVE_CLEAR_TIMEOUT.bind(globalThis);\n    }\n    else {\n        obj.setTimeoutFn = globalThis.setTimeout.bind(globalThis);\n        obj.clearTimeoutFn = globalThis.clearTimeout.bind(globalThis);\n    }\n}\n// base64 encoded buffers are about 33% bigger (https://en.wikipedia.org/wiki/Base64)\nconst BASE64_OVERHEAD = 1.33;\n// we could also have used `new Blob([obj]).size`, but it isn't supported in IE9\nexport function byteLength(obj) {\n    if (typeof obj === \"string\") {\n        return utf8Length(obj);\n    }\n    // arraybuffer or blob\n    return Math.ceil((obj.byteLength || obj.size) * BASE64_OVERHEAD);\n}\nfunction utf8Length(str) {\n    let c = 0, length = 0;\n    for (let i = 0, l = str.length; i < l; i++) {\n        c = str.charCodeAt(i);\n        if (c < 0x80) {\n            length += 1;\n        }\n        else if (c < 0x800) {\n            length += 2;\n        }\n        else if (c < 0xd800 || c >= 0xe000) {\n            length += 3;\n        }\n        else {\n            i++;\n            length += 4;\n        }\n    }\n    return length;\n}\n/**\n * Generates a random 8-characters string.\n */\nexport function randomString() {\n    return (Date.now().toString(36).substring(3) +\n        Math.random().toString(36).substring(2, 5));\n}\n","// imported from https://github.com/galkn/querystring\n/**\n * Compiles a querystring\n * Returns string representation of the object\n *\n * @param {Object}\n * @api private\n */\nexport function encode(obj) {\n    let str = '';\n    for (let i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            if (str.length)\n                str += '&';\n            str += encodeURIComponent(i) + '=' + encodeURIComponent(obj[i]);\n        }\n    }\n    return str;\n}\n/**\n * Parses a simple querystring into an object\n *\n * @param {String} qs\n * @api private\n */\nexport function decode(qs) {\n    let qry = {};\n    let pairs = qs.split('&');\n    for (let i = 0, l = pairs.length; i < l; i++) {\n        let pair = pairs[i].split('=');\n        qry[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n    }\n    return qry;\n}\n","import { decodePacket } from \"engine.io-parser\";\nimport { Emitter } from \"@socket.io/component-emitter\";\nimport { installTimerFunctions } from \"./util.js\";\nimport { encode } from \"./contrib/parseqs.js\";\nexport class TransportError extends Error {\n    constructor(reason, description, context) {\n        super(reason);\n        this.description = description;\n        this.context = context;\n        this.type = \"TransportError\";\n    }\n}\nexport class Transport extends Emitter {\n    /**\n     * Transport abstract constructor.\n     *\n     * @param {Object} opts - options\n     * @protected\n     */\n    constructor(opts) {\n        super();\n        this.writable = false;\n        installTimerFunctions(this, opts);\n        this.opts = opts;\n        this.query = opts.query;\n        this.socket = opts.socket;\n        this.supportsBinary = !opts.forceBase64;\n    }\n    /**\n     * Emits an error.\n     *\n     * @param {String} reason\n     * @param description\n     * @param context - the error context\n     * @return {Transport} for chaining\n     * @protected\n     */\n    onError(reason, description, context) {\n        super.emitReserved(\"error\", new TransportError(reason, description, context));\n        return this;\n    }\n    /**\n     * Opens the transport.\n     */\n    open() {\n        this.readyState = \"opening\";\n        this.doOpen();\n        return this;\n    }\n    /**\n     * Closes the transport.\n     */\n    close() {\n        if (this.readyState === \"opening\" || this.readyState === \"open\") {\n            this.doClose();\n            this.onClose();\n        }\n        return this;\n    }\n    /**\n     * Sends multiple packets.\n     *\n     * @param {Array} packets\n     */\n    send(packets) {\n        if (this.readyState === \"open\") {\n            this.write(packets);\n        }\n        else {\n            // this might happen if the transport was silently closed in the beforeunload event handler\n        }\n    }\n    /**\n     * Called upon open\n     *\n     * @protected\n     */\n    onOpen() {\n        this.readyState = \"open\";\n        this.writable = true;\n        super.emitReserved(\"open\");\n    }\n    /**\n     * Called with data.\n     *\n     * @param {String} data\n     * @protected\n     */\n    onData(data) {\n        const packet = decodePacket(data, this.socket.binaryType);\n        this.onPacket(packet);\n    }\n    /**\n     * Called with a decoded packet.\n     *\n     * @protected\n     */\n    onPacket(packet) {\n        super.emitReserved(\"packet\", packet);\n    }\n    /**\n     * Called upon close.\n     *\n     * @protected\n     */\n    onClose(details) {\n        this.readyState = \"closed\";\n        super.emitReserved(\"close\", details);\n    }\n    /**\n     * Pauses the transport, in order not to lose packets during an upgrade.\n     *\n     * @param onPause\n     */\n    pause(onPause) { }\n    createUri(schema, query = {}) {\n        return (schema +\n            \"://\" +\n            this._hostname() +\n            this._port() +\n            this.opts.path +\n            this._query(query));\n    }\n    _hostname() {\n        const hostname = this.opts.hostname;\n        return hostname.indexOf(\":\") === -1 ? hostname : \"[\" + hostname + \"]\";\n    }\n    _port() {\n        if (this.opts.port &&\n            ((this.opts.secure && Number(this.opts.port !== 443)) ||\n                (!this.opts.secure && Number(this.opts.port) !== 80))) {\n            return \":\" + this.opts.port;\n        }\n        else {\n            return \"\";\n        }\n    }\n    _query(query) {\n        const encodedQuery = encode(query);\n        return encodedQuery.length ? \"?\" + encodedQuery : \"\";\n    }\n}\n","import { Transport } from \"../transport.js\";\nimport { randomString } from \"../util.js\";\nimport { encodePayload, decodePayload } from \"engine.io-parser\";\nexport class Polling extends Transport {\n    constructor() {\n        super(...arguments);\n        this._polling = false;\n    }\n    get name() {\n        return \"polling\";\n    }\n    /**\n     * Opens the socket (triggers polling). We write a PING message to determine\n     * when the transport is open.\n     *\n     * @protected\n     */\n    doOpen() {\n        this._poll();\n    }\n    /**\n     * Pauses polling.\n     *\n     * @param {Function} onPause - callback upon buffers are flushed and transport is paused\n     * @package\n     */\n    pause(onPause) {\n        this.readyState = \"pausing\";\n        const pause = () => {\n            this.readyState = \"paused\";\n            onPause();\n        };\n        if (this._polling || !this.writable) {\n            let total = 0;\n            if (this._polling) {\n                total++;\n                this.once(\"pollComplete\", function () {\n                    --total || pause();\n                });\n            }\n            if (!this.writable) {\n                total++;\n                this.once(\"drain\", function () {\n                    --total || pause();\n                });\n            }\n        }\n        else {\n            pause();\n        }\n    }\n    /**\n     * Starts polling cycle.\n     *\n     * @private\n     */\n    _poll() {\n        this._polling = true;\n        this.doPoll();\n        this.emitReserved(\"poll\");\n    }\n    /**\n     * Overloads onData to detect payloads.\n     *\n     * @protected\n     */\n    onData(data) {\n        const callback = (packet) => {\n            // if its the first message we consider the transport open\n            if (\"opening\" === this.readyState && packet.type === \"open\") {\n                this.onOpen();\n            }\n            // if its a close packet, we close the ongoing requests\n            if (\"close\" === packet.type) {\n                this.onClose({ description: \"transport closed by the server\" });\n                return false;\n            }\n            // otherwise bypass onData and handle the message\n            this.onPacket(packet);\n        };\n        // decode payload\n        decodePayload(data, this.socket.binaryType).forEach(callback);\n        // if an event did not trigger closing\n        if (\"closed\" !== this.readyState) {\n            // if we got data we're not polling\n            this._polling = false;\n            this.emitReserved(\"pollComplete\");\n            if (\"open\" === this.readyState) {\n                this._poll();\n            }\n            else {\n            }\n        }\n    }\n    /**\n     * For polling, send a close packet.\n     *\n     * @protected\n     */\n    doClose() {\n        const close = () => {\n            this.write([{ type: \"close\" }]);\n        };\n        if (\"open\" === this.readyState) {\n            close();\n        }\n        else {\n            // in case we're trying to close while\n            // handshaking is in progress (GH-164)\n            this.once(\"open\", close);\n        }\n    }\n    /**\n     * Writes a packets payload.\n     *\n     * @param {Array} packets - data packets\n     * @protected\n     */\n    write(packets) {\n        this.writable = false;\n        encodePayload(packets, (data) => {\n            this.doWrite(data, () => {\n                this.writable = true;\n                this.emitReserved(\"drain\");\n            });\n        });\n    }\n    /**\n     * Generates uri for connection.\n     *\n     * @private\n     */\n    uri() {\n        const schema = this.opts.secure ? \"https\" : \"http\";\n        const query = this.query || {};\n        // cache busting is forced\n        if (false !== this.opts.timestampRequests) {\n            query[this.opts.timestampParam] = randomString();\n        }\n        if (!this.supportsBinary && !query.sid) {\n            query.b64 = 1;\n        }\n        return this.createUri(schema, query);\n    }\n}\n","// imported from https://github.com/component/has-cors\nlet value = false;\ntry {\n    value = typeof XMLHttpRequest !== 'undefined' &&\n        'withCredentials' in new XMLHttpRequest();\n}\ncatch (err) {\n    // if XMLHttp support is disabled in IE then it will throw\n    // when trying to create\n}\nexport const hasCORS = value;\n","import { Polling } from \"./polling.js\";\nimport { Emitter } from \"@socket.io/component-emitter\";\nimport { installTimerFunctions, pick } from \"../util.js\";\nimport { globalThisShim as globalThis } from \"../globals.node.js\";\nimport { hasCORS } from \"../contrib/has-cors.js\";\nfunction empty() { }\nexport class BaseXHR extends Polling {\n    /**\n     * XHR Polling constructor.\n     *\n     * @param {Object} opts\n     * @package\n     */\n    constructor(opts) {\n        super(opts);\n        if (typeof location !== \"undefined\") {\n            const isSSL = \"https:\" === location.protocol;\n            let port = location.port;\n            // some user agents have empty `location.port`\n            if (!port) {\n                port = isSSL ? \"443\" : \"80\";\n            }\n            this.xd =\n                (typeof location !== \"undefined\" &&\n                    opts.hostname !== location.hostname) ||\n                    port !== opts.port;\n        }\n    }\n    /**\n     * Sends data.\n     *\n     * @param {String} data to send.\n     * @param {Function} called upon flush.\n     * @private\n     */\n    doWrite(data, fn) {\n        const req = this.request({\n            method: \"POST\",\n            data: data,\n        });\n        req.on(\"success\", fn);\n        req.on(\"error\", (xhrStatus, context) => {\n            this.onError(\"xhr post error\", xhrStatus, context);\n        });\n    }\n    /**\n     * Starts a poll cycle.\n     *\n     * @private\n     */\n    doPoll() {\n        const req = this.request();\n        req.on(\"data\", this.onData.bind(this));\n        req.on(\"error\", (xhrStatus, context) => {\n            this.onError(\"xhr poll error\", xhrStatus, context);\n        });\n        this.pollXhr = req;\n    }\n}\nexport class Request extends Emitter {\n    /**\n     * Request constructor\n     *\n     * @param {Object} options\n     * @package\n     */\n    constructor(createRequest, uri, opts) {\n        super();\n        this.createRequest = createRequest;\n        installTimerFunctions(this, opts);\n        this._opts = opts;\n        this._method = opts.method || \"GET\";\n        this._uri = uri;\n        this._data = undefined !== opts.data ? opts.data : null;\n        this._create();\n    }\n    /**\n     * Creates the XHR object and sends the request.\n     *\n     * @private\n     */\n    _create() {\n        var _a;\n        const opts = pick(this._opts, \"agent\", \"pfx\", \"key\", \"passphrase\", \"cert\", \"ca\", \"ciphers\", \"rejectUnauthorized\", \"autoUnref\");\n        opts.xdomain = !!this._opts.xd;\n        const xhr = (this._xhr = this.createRequest(opts));\n        try {\n            xhr.open(this._method, this._uri, true);\n            try {\n                if (this._opts.extraHeaders) {\n                    // @ts-ignore\n                    xhr.setDisableHeaderCheck && xhr.setDisableHeaderCheck(true);\n                    for (let i in this._opts.extraHeaders) {\n                        if (this._opts.extraHeaders.hasOwnProperty(i)) {\n                            xhr.setRequestHeader(i, this._opts.extraHeaders[i]);\n                        }\n                    }\n                }\n            }\n            catch (e) { }\n            if (\"POST\" === this._method) {\n                try {\n                    xhr.setRequestHeader(\"Content-type\", \"text/plain;charset=UTF-8\");\n                }\n                catch (e) { }\n            }\n            try {\n                xhr.setRequestHeader(\"Accept\", \"*/*\");\n            }\n            catch (e) { }\n            (_a = this._opts.cookieJar) === null || _a === void 0 ? void 0 : _a.addCookies(xhr);\n            // ie6 check\n            if (\"withCredentials\" in xhr) {\n                xhr.withCredentials = this._opts.withCredentials;\n            }\n            if (this._opts.requestTimeout) {\n                xhr.timeout = this._opts.requestTimeout;\n            }\n            xhr.onreadystatechange = () => {\n                var _a;\n                if (xhr.readyState === 3) {\n                    (_a = this._opts.cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(\n                    // @ts-ignore\n                    xhr.getResponseHeader(\"set-cookie\"));\n                }\n                if (4 !== xhr.readyState)\n                    return;\n                if (200 === xhr.status || 1223 === xhr.status) {\n                    this._onLoad();\n                }\n                else {\n                    // make sure the `error` event handler that's user-set\n                    // does not throw in the same tick and gets caught here\n                    this.setTimeoutFn(() => {\n                        this._onError(typeof xhr.status === \"number\" ? xhr.status : 0);\n                    }, 0);\n                }\n            };\n            xhr.send(this._data);\n        }\n        catch (e) {\n            // Need to defer since .create() is called directly from the constructor\n            // and thus the 'error' event can only be only bound *after* this exception\n            // occurs.  Therefore, also, we cannot throw here at all.\n            this.setTimeoutFn(() => {\n                this._onError(e);\n            }, 0);\n            return;\n        }\n        if (typeof document !== \"undefined\") {\n            this._index = Request.requestsCount++;\n            Request.requests[this._index] = this;\n        }\n    }\n    /**\n     * Called upon error.\n     *\n     * @private\n     */\n    _onError(err) {\n        this.emitReserved(\"error\", err, this._xhr);\n        this._cleanup(true);\n    }\n    /**\n     * Cleans up house.\n     *\n     * @private\n     */\n    _cleanup(fromError) {\n        if (\"undefined\" === typeof this._xhr || null === this._xhr) {\n            return;\n        }\n        this._xhr.onreadystatechange = empty;\n        if (fromError) {\n            try {\n                this._xhr.abort();\n            }\n            catch (e) { }\n        }\n        if (typeof document !== \"undefined\") {\n            delete Request.requests[this._index];\n        }\n        this._xhr = null;\n    }\n    /**\n     * Called upon load.\n     *\n     * @private\n     */\n    _onLoad() {\n        const data = this._xhr.responseText;\n        if (data !== null) {\n            this.emitReserved(\"data\", data);\n            this.emitReserved(\"success\");\n            this._cleanup();\n        }\n    }\n    /**\n     * Aborts the request.\n     *\n     * @package\n     */\n    abort() {\n        this._cleanup();\n    }\n}\nRequest.requestsCount = 0;\nRequest.requests = {};\n/**\n * Aborts pending requests when unloading the window. This is needed to prevent\n * memory leaks (e.g. when using IE) and to ensure that no spurious error is\n * emitted.\n */\nif (typeof document !== \"undefined\") {\n    // @ts-ignore\n    if (typeof attachEvent === \"function\") {\n        // @ts-ignore\n        attachEvent(\"onunload\", unloadHandler);\n    }\n    else if (typeof addEventListener === \"function\") {\n        const terminationEvent = \"onpagehide\" in globalThis ? \"pagehide\" : \"unload\";\n        addEventListener(terminationEvent, unloadHandler, false);\n    }\n}\nfunction unloadHandler() {\n    for (let i in Request.requests) {\n        if (Request.requests.hasOwnProperty(i)) {\n            Request.requests[i].abort();\n        }\n    }\n}\nconst hasXHR2 = (function () {\n    const xhr = newRequest({\n        xdomain: false,\n    });\n    return xhr && xhr.responseType !== null;\n})();\n/**\n * HTTP long-polling based on the built-in `XMLHttpRequest` object.\n *\n * Usage: browser\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n */\nexport class XHR extends BaseXHR {\n    constructor(opts) {\n        super(opts);\n        const forceBase64 = opts && opts.forceBase64;\n        this.supportsBinary = hasXHR2 && !forceBase64;\n    }\n    request(opts = {}) {\n        Object.assign(opts, { xd: this.xd }, this.opts);\n        return new Request(newRequest, this.uri(), opts);\n    }\n}\nfunction newRequest(opts) {\n    const xdomain = opts.xdomain;\n    // XMLHttpRequest can be disabled on IE\n    try {\n        if (\"undefined\" !== typeof XMLHttpRequest && (!xdomain || hasCORS)) {\n            return new XMLHttpRequest();\n        }\n    }\n    catch (e) { }\n    if (!xdomain) {\n        try {\n            return new globalThis[[\"Active\"].concat(\"Object\").join(\"X\")](\"Microsoft.XMLHTTP\");\n        }\n        catch (e) { }\n    }\n}\n","import { Transport } from \"../transport.js\";\nimport { pick, randomString } from \"../util.js\";\nimport { encodePacket } from \"engine.io-parser\";\nimport { globalThisShim as globalThis, nextTick } from \"../globals.node.js\";\n// detect ReactNative environment\nconst isReactNative = typeof navigator !== \"undefined\" &&\n    typeof navigator.product === \"string\" &&\n    navigator.product.toLowerCase() === \"reactnative\";\nexport class BaseWS extends Transport {\n    get name() {\n        return \"websocket\";\n    }\n    doOpen() {\n        const uri = this.uri();\n        const protocols = this.opts.protocols;\n        // React Native only supports the 'headers' option, and will print a warning if anything else is passed\n        const opts = isReactNative\n            ? {}\n            : pick(this.opts, \"agent\", \"perMessageDeflate\", \"pfx\", \"key\", \"passphrase\", \"cert\", \"ca\", \"ciphers\", \"rejectUnauthorized\", \"localAddress\", \"protocolVersion\", \"origin\", \"maxPayload\", \"family\", \"checkServerIdentity\");\n        if (this.opts.extraHeaders) {\n            opts.headers = this.opts.extraHeaders;\n        }\n        try {\n            this.ws = this.createSocket(uri, protocols, opts);\n        }\n        catch (err) {\n            return this.emitReserved(\"error\", err);\n        }\n        this.ws.binaryType = this.socket.binaryType;\n        this.addEventListeners();\n    }\n    /**\n     * Adds event listeners to the socket\n     *\n     * @private\n     */\n    addEventListeners() {\n        this.ws.onopen = () => {\n            if (this.opts.autoUnref) {\n                this.ws._socket.unref();\n            }\n            this.onOpen();\n        };\n        this.ws.onclose = (closeEvent) => this.onClose({\n            description: \"websocket connection closed\",\n            context: closeEvent,\n        });\n        this.ws.onmessage = (ev) => this.onData(ev.data);\n        this.ws.onerror = (e) => this.onError(\"websocket error\", e);\n    }\n    write(packets) {\n        this.writable = false;\n        // encodePacket efficient as it uses WS framing\n        // no need for encodePayload\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            encodePacket(packet, this.supportsBinary, (data) => {\n                // Sometimes the websocket has already been closed but the browser didn't\n                // have a chance of informing us about it yet, in that case send will\n                // throw an error\n                try {\n                    this.doWrite(packet, data);\n                }\n                catch (e) {\n                }\n                if (lastPacket) {\n                    // fake drain\n                    // defer to next tick to allow Socket to clear writeBuffer\n                    nextTick(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        if (typeof this.ws !== \"undefined\") {\n            this.ws.onerror = () => { };\n            this.ws.close();\n            this.ws = null;\n        }\n    }\n    /**\n     * Generates uri for connection.\n     *\n     * @private\n     */\n    uri() {\n        const schema = this.opts.secure ? \"wss\" : \"ws\";\n        const query = this.query || {};\n        // append timestamp to URI\n        if (this.opts.timestampRequests) {\n            query[this.opts.timestampParam] = randomString();\n        }\n        // communicate binary support capabilities\n        if (!this.supportsBinary) {\n            query.b64 = 1;\n        }\n        return this.createUri(schema, query);\n    }\n}\nconst WebSocketCtor = globalThis.WebSocket || globalThis.MozWebSocket;\n/**\n * WebSocket transport based on the built-in `WebSocket` object.\n *\n * Usage: browser, Node.js (since v21), Deno, Bun\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket\n * @see https://caniuse.com/mdn-api_websocket\n * @see https://nodejs.org/api/globals.html#websocket\n */\nexport class WS extends BaseWS {\n    createSocket(uri, protocols, opts) {\n        return !isReactNative\n            ? protocols\n                ? new WebSocketCtor(uri, protocols)\n                : new WebSocketCtor(uri)\n            : new WebSocketCtor(uri, protocols, opts);\n    }\n    doWrite(_packet, data) {\n        this.ws.send(data);\n    }\n}\n","import { Transport } from \"../transport.js\";\nimport { nextTick } from \"../globals.node.js\";\nimport { createPacketDecoderStream, createPacketEncoderStream, } from \"engine.io-parser\";\n/**\n * WebTransport transport based on the built-in `WebTransport` object.\n *\n * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n * @see https://caniuse.com/webtransport\n */\nexport class WT extends Transport {\n    get name() {\n        return \"webtransport\";\n    }\n    doOpen() {\n        try {\n            // @ts-ignore\n            this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n        }\n        catch (err) {\n            return this.emitReserved(\"error\", err);\n        }\n        this._transport.closed\n            .then(() => {\n            this.onClose();\n        })\n            .catch((err) => {\n            this.onError(\"webtransport error\", err);\n        });\n        // note: we could have used async/await, but that would require some additional polyfills\n        this._transport.ready.then(() => {\n            this._transport.createBidirectionalStream().then((stream) => {\n                const decoderStream = createPacketDecoderStream(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n                const reader = stream.readable.pipeThrough(decoderStream).getReader();\n                const encoderStream = createPacketEncoderStream();\n                encoderStream.readable.pipeTo(stream.writable);\n                this._writer = encoderStream.writable.getWriter();\n                const read = () => {\n                    reader\n                        .read()\n                        .then(({ done, value }) => {\n                        if (done) {\n                            return;\n                        }\n                        this.onPacket(value);\n                        read();\n                    })\n                        .catch((err) => {\n                    });\n                };\n                read();\n                const packet = { type: \"open\" };\n                if (this.query.sid) {\n                    packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n                }\n                this._writer.write(packet).then(() => this.onOpen());\n            });\n        });\n    }\n    write(packets) {\n        this.writable = false;\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            this._writer.write(packet).then(() => {\n                if (lastPacket) {\n                    nextTick(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        var _a;\n        (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n    }\n}\n","import { XHR } from \"./polling-xhr.node.js\";\nimport { WS } from \"./websocket.node.js\";\nimport { WT } from \"./webtransport.js\";\nexport const transports = {\n    websocket: WS,\n    webtransport: WT,\n    polling: XHR,\n};\n","// imported from https://github.com/galkn/parseuri\n/**\n * Parses a URI\n *\n * Note: we could also have used the built-in URL object, but it isn't supported on all platforms.\n *\n * See:\n * - https://developer.mozilla.org/en-US/docs/Web/API/URL\n * - https://caniuse.com/url\n * - https://www.rfc-editor.org/rfc/rfc3986#appendix-B\n *\n * History of the parse() method:\n * - first commit: https://github.com/socketio/socket.io-client/commit/4ee1d5d94b3906a9c052b459f1a818b15f38f91c\n * - export into its own module: https://github.com/socketio/engine.io-client/commit/de2c561e4564efeb78f1bdb1ba39ef81b2822cb3\n * - reimport: https://github.com/socketio/engine.io-client/commit/df32277c3f6d622eec5ed09f493cae3f3391d242\n *\n * @author Steven Levithan <stevenlevithan.com> (MIT license)\n * @api private\n */\nconst re = /^(?:(?![^:@\\/?#]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@\\/?#]*)(?::([^:@\\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\nconst parts = [\n    'source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'\n];\nexport function parse(str) {\n    if (str.length > 8000) {\n        throw \"URI too long\";\n    }\n    const src = str, b = str.indexOf('['), e = str.indexOf(']');\n    if (b != -1 && e != -1) {\n        str = str.substring(0, b) + str.substring(b, e).replace(/:/g, ';') + str.substring(e, str.length);\n    }\n    let m = re.exec(str || ''), uri = {}, i = 14;\n    while (i--) {\n        uri[parts[i]] = m[i] || '';\n    }\n    if (b != -1 && e != -1) {\n        uri.source = src;\n        uri.host = uri.host.substring(1, uri.host.length - 1).replace(/;/g, ':');\n        uri.authority = uri.authority.replace('[', '').replace(']', '').replace(/;/g, ':');\n        uri.ipv6uri = true;\n    }\n    uri.pathNames = pathNames(uri, uri['path']);\n    uri.queryKey = queryKey(uri, uri['query']);\n    return uri;\n}\nfunction pathNames(obj, path) {\n    const regx = /\\/{2,9}/g, names = path.replace(regx, \"/\").split(\"/\");\n    if (path.slice(0, 1) == '/' || path.length === 0) {\n        names.splice(0, 1);\n    }\n    if (path.slice(-1) == '/') {\n        names.splice(names.length - 1, 1);\n    }\n    return names;\n}\nfunction queryKey(uri, query) {\n    const data = {};\n    query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g, function ($0, $1, $2) {\n        if ($1) {\n            data[$1] = $2;\n        }\n    });\n    return data;\n}\n","import { transports as DEFAULT_TRANSPORTS } from \"./transports/index.js\";\nimport { installTimerFunctions, byteLength } from \"./util.js\";\nimport { decode } from \"./contrib/parseqs.js\";\nimport { parse } from \"./contrib/parseuri.js\";\nimport { Emitter } from \"@socket.io/component-emitter\";\nimport { protocol } from \"engine.io-parser\";\nimport { createCookieJar, defaultBinaryType, nextTick, } from \"./globals.node.js\";\nconst withEventListeners = typeof addEventListener === \"function\" &&\n    typeof removeEventListener === \"function\";\nconst OFFLINE_EVENT_LISTENERS = [];\nif (withEventListeners) {\n    // within a ServiceWorker, any event handler for the 'offline' event must be added on the initial evaluation of the\n    // script, so we create one single event listener here which will forward the event to the socket instances\n    addEventListener(\"offline\", () => {\n        OFFLINE_EVENT_LISTENERS.forEach((listener) => listener());\n    }, false);\n}\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes without upgrade mechanism, which means that it will keep the first low-level transport that\n * successfully establishes the connection.\n *\n * In order to allow tree-shaking, there are no transports included, that's why the `transports` option is mandatory.\n *\n * @example\n * import { SocketWithoutUpgrade, WebSocket } from \"engine.io-client\";\n *\n * const socket = new SocketWithoutUpgrade({\n *   transports: [WebSocket]\n * });\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithUpgrade\n * @see Socket\n */\nexport class SocketWithoutUpgrade extends Emitter {\n    /**\n     * Socket constructor.\n     *\n     * @param {String|Object} uri - uri or options\n     * @param {Object} opts - options\n     */\n    constructor(uri, opts) {\n        super();\n        this.binaryType = defaultBinaryType;\n        this.writeBuffer = [];\n        this._prevBufferLen = 0;\n        this._pingInterval = -1;\n        this._pingTimeout = -1;\n        this._maxPayload = -1;\n        /**\n         * The expiration timestamp of the {@link _pingTimeoutTimer} object is tracked, in case the timer is throttled and the\n         * callback is not fired on time. This can happen for example when a laptop is suspended or when a phone is locked.\n         */\n        this._pingTimeoutTime = Infinity;\n        if (uri && \"object\" === typeof uri) {\n            opts = uri;\n            uri = null;\n        }\n        if (uri) {\n            const parsedUri = parse(uri);\n            opts.hostname = parsedUri.host;\n            opts.secure =\n                parsedUri.protocol === \"https\" || parsedUri.protocol === \"wss\";\n            opts.port = parsedUri.port;\n            if (parsedUri.query)\n                opts.query = parsedUri.query;\n        }\n        else if (opts.host) {\n            opts.hostname = parse(opts.host).host;\n        }\n        installTimerFunctions(this, opts);\n        this.secure =\n            null != opts.secure\n                ? opts.secure\n                : typeof location !== \"undefined\" && \"https:\" === location.protocol;\n        if (opts.hostname && !opts.port) {\n            // if no port is specified manually, use the protocol default\n            opts.port = this.secure ? \"443\" : \"80\";\n        }\n        this.hostname =\n            opts.hostname ||\n                (typeof location !== \"undefined\" ? location.hostname : \"localhost\");\n        this.port =\n            opts.port ||\n                (typeof location !== \"undefined\" && location.port\n                    ? location.port\n                    : this.secure\n                        ? \"443\"\n                        : \"80\");\n        this.transports = [];\n        this._transportsByName = {};\n        opts.transports.forEach((t) => {\n            const transportName = t.prototype.name;\n            this.transports.push(transportName);\n            this._transportsByName[transportName] = t;\n        });\n        this.opts = Object.assign({\n            path: \"/engine.io\",\n            agent: false,\n            withCredentials: false,\n            upgrade: true,\n            timestampParam: \"t\",\n            rememberUpgrade: false,\n            addTrailingSlash: true,\n            rejectUnauthorized: true,\n            perMessageDeflate: {\n                threshold: 1024,\n            },\n            transportOptions: {},\n            closeOnBeforeunload: false,\n        }, opts);\n        this.opts.path =\n            this.opts.path.replace(/\\/$/, \"\") +\n                (this.opts.addTrailingSlash ? \"/\" : \"\");\n        if (typeof this.opts.query === \"string\") {\n            this.opts.query = decode(this.opts.query);\n        }\n        if (withEventListeners) {\n            if (this.opts.closeOnBeforeunload) {\n                // Firefox closes the connection when the \"beforeunload\" event is emitted but not Chrome. This event listener\n                // ensures every browser behaves the same (no \"disconnect\" event at the Socket.IO level when the page is\n                // closed/reloaded)\n                this._beforeunloadEventListener = () => {\n                    if (this.transport) {\n                        // silently close the transport\n                        this.transport.removeAllListeners();\n                        this.transport.close();\n                    }\n                };\n                addEventListener(\"beforeunload\", this._beforeunloadEventListener, false);\n            }\n            if (this.hostname !== \"localhost\") {\n                this._offlineEventListener = () => {\n                    this._onClose(\"transport close\", {\n                        description: \"network connection lost\",\n                    });\n                };\n                OFFLINE_EVENT_LISTENERS.push(this._offlineEventListener);\n            }\n        }\n        if (this.opts.withCredentials) {\n            this._cookieJar = createCookieJar();\n        }\n        this._open();\n    }\n    /**\n     * Creates transport of the given type.\n     *\n     * @param {String} name - transport name\n     * @return {Transport}\n     * @private\n     */\n    createTransport(name) {\n        const query = Object.assign({}, this.opts.query);\n        // append engine.io protocol identifier\n        query.EIO = protocol;\n        // transport name\n        query.transport = name;\n        // session id if we already have one\n        if (this.id)\n            query.sid = this.id;\n        const opts = Object.assign({}, this.opts, {\n            query,\n            socket: this,\n            hostname: this.hostname,\n            secure: this.secure,\n            port: this.port,\n        }, this.opts.transportOptions[name]);\n        return new this._transportsByName[name](opts);\n    }\n    /**\n     * Initializes transport to use and starts probe.\n     *\n     * @private\n     */\n    _open() {\n        if (this.transports.length === 0) {\n            // Emit error on next tick so it can be listened to\n            this.setTimeoutFn(() => {\n                this.emitReserved(\"error\", \"No transports available\");\n            }, 0);\n            return;\n        }\n        const transportName = this.opts.rememberUpgrade &&\n            SocketWithoutUpgrade.priorWebsocketSuccess &&\n            this.transports.indexOf(\"websocket\") !== -1\n            ? \"websocket\"\n            : this.transports[0];\n        this.readyState = \"opening\";\n        const transport = this.createTransport(transportName);\n        transport.open();\n        this.setTransport(transport);\n    }\n    /**\n     * Sets the current transport. Disables the existing one (if any).\n     *\n     * @private\n     */\n    setTransport(transport) {\n        if (this.transport) {\n            this.transport.removeAllListeners();\n        }\n        // set up transport\n        this.transport = transport;\n        // set up transport listeners\n        transport\n            .on(\"drain\", this._onDrain.bind(this))\n            .on(\"packet\", this._onPacket.bind(this))\n            .on(\"error\", this._onError.bind(this))\n            .on(\"close\", (reason) => this._onClose(\"transport close\", reason));\n    }\n    /**\n     * Called when connection is deemed open.\n     *\n     * @private\n     */\n    onOpen() {\n        this.readyState = \"open\";\n        SocketWithoutUpgrade.priorWebsocketSuccess =\n            \"websocket\" === this.transport.name;\n        this.emitReserved(\"open\");\n        this.flush();\n    }\n    /**\n     * Handles a packet.\n     *\n     * @private\n     */\n    _onPacket(packet) {\n        if (\"opening\" === this.readyState ||\n            \"open\" === this.readyState ||\n            \"closing\" === this.readyState) {\n            this.emitReserved(\"packet\", packet);\n            // Socket is live - any packet counts\n            this.emitReserved(\"heartbeat\");\n            switch (packet.type) {\n                case \"open\":\n                    this.onHandshake(JSON.parse(packet.data));\n                    break;\n                case \"ping\":\n                    this._sendPacket(\"pong\");\n                    this.emitReserved(\"ping\");\n                    this.emitReserved(\"pong\");\n                    this._resetPingTimeout();\n                    break;\n                case \"error\":\n                    const err = new Error(\"server error\");\n                    // @ts-ignore\n                    err.code = packet.data;\n                    this._onError(err);\n                    break;\n                case \"message\":\n                    this.emitReserved(\"data\", packet.data);\n                    this.emitReserved(\"message\", packet.data);\n                    break;\n            }\n        }\n        else {\n        }\n    }\n    /**\n     * Called upon handshake completion.\n     *\n     * @param {Object} data - handshake obj\n     * @private\n     */\n    onHandshake(data) {\n        this.emitReserved(\"handshake\", data);\n        this.id = data.sid;\n        this.transport.query.sid = data.sid;\n        this._pingInterval = data.pingInterval;\n        this._pingTimeout = data.pingTimeout;\n        this._maxPayload = data.maxPayload;\n        this.onOpen();\n        // In case open handler closes socket\n        if (\"closed\" === this.readyState)\n            return;\n        this._resetPingTimeout();\n    }\n    /**\n     * Sets and resets ping timeout timer based on server pings.\n     *\n     * @private\n     */\n    _resetPingTimeout() {\n        this.clearTimeoutFn(this._pingTimeoutTimer);\n        const delay = this._pingInterval + this._pingTimeout;\n        this._pingTimeoutTime = Date.now() + delay;\n        this._pingTimeoutTimer = this.setTimeoutFn(() => {\n            this._onClose(\"ping timeout\");\n        }, delay);\n        if (this.opts.autoUnref) {\n            this._pingTimeoutTimer.unref();\n        }\n    }\n    /**\n     * Called on `drain` event\n     *\n     * @private\n     */\n    _onDrain() {\n        this.writeBuffer.splice(0, this._prevBufferLen);\n        // setting prevBufferLen = 0 is very important\n        // for example, when upgrading, upgrade packet is sent over,\n        // and a nonzero prevBufferLen could cause problems on `drain`\n        this._prevBufferLen = 0;\n        if (0 === this.writeBuffer.length) {\n            this.emitReserved(\"drain\");\n        }\n        else {\n            this.flush();\n        }\n    }\n    /**\n     * Flush write buffers.\n     *\n     * @private\n     */\n    flush() {\n        if (\"closed\" !== this.readyState &&\n            this.transport.writable &&\n            !this.upgrading &&\n            this.writeBuffer.length) {\n            const packets = this._getWritablePackets();\n            this.transport.send(packets);\n            // keep track of current length of writeBuffer\n            // splice writeBuffer and callbackBuffer on `drain`\n            this._prevBufferLen = packets.length;\n            this.emitReserved(\"flush\");\n        }\n    }\n    /**\n     * Ensure the encoded size of the writeBuffer is below the maxPayload value sent by the server (only for HTTP\n     * long-polling)\n     *\n     * @private\n     */\n    _getWritablePackets() {\n        const shouldCheckPayloadSize = this._maxPayload &&\n            this.transport.name === \"polling\" &&\n            this.writeBuffer.length > 1;\n        if (!shouldCheckPayloadSize) {\n            return this.writeBuffer;\n        }\n        let payloadSize = 1; // first packet type\n        for (let i = 0; i < this.writeBuffer.length; i++) {\n            const data = this.writeBuffer[i].data;\n            if (data) {\n                payloadSize += byteLength(data);\n            }\n            if (i > 0 && payloadSize > this._maxPayload) {\n                return this.writeBuffer.slice(0, i);\n            }\n            payloadSize += 2; // separator + packet type\n        }\n        return this.writeBuffer;\n    }\n    /**\n     * Checks whether the heartbeat timer has expired but the socket has not yet been notified.\n     *\n     * Note: this method is private for now because it does not really fit the WebSocket API, but if we put it in the\n     * `write()` method then the message would not be buffered by the Socket.IO client.\n     *\n     * @return {boolean}\n     * @private\n     */\n    /* private */ _hasPingExpired() {\n        if (!this._pingTimeoutTime)\n            return true;\n        const hasExpired = Date.now() > this._pingTimeoutTime;\n        if (hasExpired) {\n            this._pingTimeoutTime = 0;\n            nextTick(() => {\n                this._onClose(\"ping timeout\");\n            }, this.setTimeoutFn);\n        }\n        return hasExpired;\n    }\n    /**\n     * Sends a message.\n     *\n     * @param {String} msg - message.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @return {Socket} for chaining.\n     */\n    write(msg, options, fn) {\n        this._sendPacket(\"message\", msg, options, fn);\n        return this;\n    }\n    /**\n     * Sends a message. Alias of {@link Socket#write}.\n     *\n     * @param {String} msg - message.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @return {Socket} for chaining.\n     */\n    send(msg, options, fn) {\n        this._sendPacket(\"message\", msg, options, fn);\n        return this;\n    }\n    /**\n     * Sends a packet.\n     *\n     * @param {String} type: packet type.\n     * @param {String} data.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @private\n     */\n    _sendPacket(type, data, options, fn) {\n        if (\"function\" === typeof data) {\n            fn = data;\n            data = undefined;\n        }\n        if (\"function\" === typeof options) {\n            fn = options;\n            options = null;\n        }\n        if (\"closing\" === this.readyState || \"closed\" === this.readyState) {\n            return;\n        }\n        options = options || {};\n        options.compress = false !== options.compress;\n        const packet = {\n            type: type,\n            data: data,\n            options: options,\n        };\n        this.emitReserved(\"packetCreate\", packet);\n        this.writeBuffer.push(packet);\n        if (fn)\n            this.once(\"flush\", fn);\n        this.flush();\n    }\n    /**\n     * Closes the connection.\n     */\n    close() {\n        const close = () => {\n            this._onClose(\"forced close\");\n            this.transport.close();\n        };\n        const cleanupAndClose = () => {\n            this.off(\"upgrade\", cleanupAndClose);\n            this.off(\"upgradeError\", cleanupAndClose);\n            close();\n        };\n        const waitForUpgrade = () => {\n            // wait for upgrade to finish since we can't send packets while pausing a transport\n            this.once(\"upgrade\", cleanupAndClose);\n            this.once(\"upgradeError\", cleanupAndClose);\n        };\n        if (\"opening\" === this.readyState || \"open\" === this.readyState) {\n            this.readyState = \"closing\";\n            if (this.writeBuffer.length) {\n                this.once(\"drain\", () => {\n                    if (this.upgrading) {\n                        waitForUpgrade();\n                    }\n                    else {\n                        close();\n                    }\n                });\n            }\n            else if (this.upgrading) {\n                waitForUpgrade();\n            }\n            else {\n                close();\n            }\n        }\n        return this;\n    }\n    /**\n     * Called upon transport error\n     *\n     * @private\n     */\n    _onError(err) {\n        SocketWithoutUpgrade.priorWebsocketSuccess = false;\n        if (this.opts.tryAllTransports &&\n            this.transports.length > 1 &&\n            this.readyState === \"opening\") {\n            this.transports.shift();\n            return this._open();\n        }\n        this.emitReserved(\"error\", err);\n        this._onClose(\"transport error\", err);\n    }\n    /**\n     * Called upon transport close.\n     *\n     * @private\n     */\n    _onClose(reason, description) {\n        if (\"opening\" === this.readyState ||\n            \"open\" === this.readyState ||\n            \"closing\" === this.readyState) {\n            // clear timers\n            this.clearTimeoutFn(this._pingTimeoutTimer);\n            // stop event from firing again for transport\n            this.transport.removeAllListeners(\"close\");\n            // ensure transport won't stay open\n            this.transport.close();\n            // ignore further transport communication\n            this.transport.removeAllListeners();\n            if (withEventListeners) {\n                if (this._beforeunloadEventListener) {\n                    removeEventListener(\"beforeunload\", this._beforeunloadEventListener, false);\n                }\n                if (this._offlineEventListener) {\n                    const i = OFFLINE_EVENT_LISTENERS.indexOf(this._offlineEventListener);\n                    if (i !== -1) {\n                        OFFLINE_EVENT_LISTENERS.splice(i, 1);\n                    }\n                }\n            }\n            // set ready state\n            this.readyState = \"closed\";\n            // clear session id\n            this.id = null;\n            // emit close event\n            this.emitReserved(\"close\", reason, description);\n            // clean buffers after, so users can still\n            // grab the buffers on `close` event\n            this.writeBuffer = [];\n            this._prevBufferLen = 0;\n        }\n    }\n}\nSocketWithoutUpgrade.protocol = protocol;\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes with an upgrade mechanism, which means that once the connection is established with the first\n * low-level transport, it will try to upgrade to a better transport.\n *\n * In order to allow tree-shaking, there are no transports included, that's why the `transports` option is mandatory.\n *\n * @example\n * import { SocketWithUpgrade, WebSocket } from \"engine.io-client\";\n *\n * const socket = new SocketWithUpgrade({\n *   transports: [WebSocket]\n * });\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithoutUpgrade\n * @see Socket\n */\nexport class SocketWithUpgrade extends SocketWithoutUpgrade {\n    constructor() {\n        super(...arguments);\n        this._upgrades = [];\n    }\n    onOpen() {\n        super.onOpen();\n        if (\"open\" === this.readyState && this.opts.upgrade) {\n            for (let i = 0; i < this._upgrades.length; i++) {\n                this._probe(this._upgrades[i]);\n            }\n        }\n    }\n    /**\n     * Probes a transport.\n     *\n     * @param {String} name - transport name\n     * @private\n     */\n    _probe(name) {\n        let transport = this.createTransport(name);\n        let failed = false;\n        SocketWithoutUpgrade.priorWebsocketSuccess = false;\n        const onTransportOpen = () => {\n            if (failed)\n                return;\n            transport.send([{ type: \"ping\", data: \"probe\" }]);\n            transport.once(\"packet\", (msg) => {\n                if (failed)\n                    return;\n                if (\"pong\" === msg.type && \"probe\" === msg.data) {\n                    this.upgrading = true;\n                    this.emitReserved(\"upgrading\", transport);\n                    if (!transport)\n                        return;\n                    SocketWithoutUpgrade.priorWebsocketSuccess =\n                        \"websocket\" === transport.name;\n                    this.transport.pause(() => {\n                        if (failed)\n                            return;\n                        if (\"closed\" === this.readyState)\n                            return;\n                        cleanup();\n                        this.setTransport(transport);\n                        transport.send([{ type: \"upgrade\" }]);\n                        this.emitReserved(\"upgrade\", transport);\n                        transport = null;\n                        this.upgrading = false;\n                        this.flush();\n                    });\n                }\n                else {\n                    const err = new Error(\"probe error\");\n                    // @ts-ignore\n                    err.transport = transport.name;\n                    this.emitReserved(\"upgradeError\", err);\n                }\n            });\n        };\n        function freezeTransport() {\n            if (failed)\n                return;\n            // Any callback called by transport should be ignored since now\n            failed = true;\n            cleanup();\n            transport.close();\n            transport = null;\n        }\n        // Handle any error that happens while probing\n        const onerror = (err) => {\n            const error = new Error(\"probe error: \" + err);\n            // @ts-ignore\n            error.transport = transport.name;\n            freezeTransport();\n            this.emitReserved(\"upgradeError\", error);\n        };\n        function onTransportClose() {\n            onerror(\"transport closed\");\n        }\n        // When the socket is closed while we're probing\n        function onclose() {\n            onerror(\"socket closed\");\n        }\n        // When the socket is upgraded while we're probing\n        function onupgrade(to) {\n            if (transport && to.name !== transport.name) {\n                freezeTransport();\n            }\n        }\n        // Remove all listeners on the transport and on self\n        const cleanup = () => {\n            transport.removeListener(\"open\", onTransportOpen);\n            transport.removeListener(\"error\", onerror);\n            transport.removeListener(\"close\", onTransportClose);\n            this.off(\"close\", onclose);\n            this.off(\"upgrading\", onupgrade);\n        };\n        transport.once(\"open\", onTransportOpen);\n        transport.once(\"error\", onerror);\n        transport.once(\"close\", onTransportClose);\n        this.once(\"close\", onclose);\n        this.once(\"upgrading\", onupgrade);\n        if (this._upgrades.indexOf(\"webtransport\") !== -1 &&\n            name !== \"webtransport\") {\n            // favor WebTransport\n            this.setTimeoutFn(() => {\n                if (!failed) {\n                    transport.open();\n                }\n            }, 200);\n        }\n        else {\n            transport.open();\n        }\n    }\n    onHandshake(data) {\n        this._upgrades = this._filterUpgrades(data.upgrades);\n        super.onHandshake(data);\n    }\n    /**\n     * Filters upgrades, returning only those matching client transports.\n     *\n     * @param {Array} upgrades - server upgrades\n     * @private\n     */\n    _filterUpgrades(upgrades) {\n        const filteredUpgrades = [];\n        for (let i = 0; i < upgrades.length; i++) {\n            if (~this.transports.indexOf(upgrades[i]))\n                filteredUpgrades.push(upgrades[i]);\n        }\n        return filteredUpgrades;\n    }\n}\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes with an upgrade mechanism, which means that once the connection is established with the first\n * low-level transport, it will try to upgrade to a better transport.\n *\n * @example\n * import { Socket } from \"engine.io-client\";\n *\n * const socket = new Socket();\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithoutUpgrade\n * @see SocketWithUpgrade\n */\nexport class Socket extends SocketWithUpgrade {\n    constructor(uri, opts = {}) {\n        const o = typeof uri === \"object\" ? uri : opts;\n        if (!o.transports ||\n            (o.transports && typeof o.transports[0] === \"string\")) {\n            o.transports = (o.transports || [\"polling\", \"websocket\", \"webtransport\"])\n                .map((transportName) => DEFAULT_TRANSPORTS[transportName])\n                .filter((t) => !!t);\n        }\n        super(uri, o);\n    }\n}\n","import { parse } from \"engine.io-client\";\n/**\n * URL parser.\n *\n * @param uri - url\n * @param path - the request path of the connection\n * @param loc - An object meant to mimic window.location.\n *        Defaults to window.location.\n * @public\n */\nexport function url(uri, path = \"\", loc) {\n    let obj = uri;\n    // default to window.location\n    loc = loc || (typeof location !== \"undefined\" && location);\n    if (null == uri)\n        uri = loc.protocol + \"//\" + loc.host;\n    // relative path support\n    if (typeof uri === \"string\") {\n        if (\"/\" === uri.charAt(0)) {\n            if (\"/\" === uri.charAt(1)) {\n                uri = loc.protocol + uri;\n            }\n            else {\n                uri = loc.host + uri;\n            }\n        }\n        if (!/^(https?|wss?):\\/\\//.test(uri)) {\n            if (\"undefined\" !== typeof loc) {\n                uri = loc.protocol + \"//\" + uri;\n            }\n            else {\n                uri = \"https://\" + uri;\n            }\n        }\n        // parse\n        obj = parse(uri);\n    }\n    // make sure we treat `localhost:80` and `localhost` equally\n    if (!obj.port) {\n        if (/^(http|ws)$/.test(obj.protocol)) {\n            obj.port = \"80\";\n        }\n        else if (/^(http|ws)s$/.test(obj.protocol)) {\n            obj.port = \"443\";\n        }\n    }\n    obj.path = obj.path || \"/\";\n    const ipv6 = obj.host.indexOf(\":\") !== -1;\n    const host = ipv6 ? \"[\" + obj.host + \"]\" : obj.host;\n    // define unique id\n    obj.id = obj.protocol + \"://\" + host + \":\" + obj.port + path;\n    // define href\n    obj.href =\n        obj.protocol +\n            \"://\" +\n            host +\n            (loc && loc.port === obj.port ? \"\" : \":\" + obj.port);\n    return obj;\n}\n","const withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\nconst isView = (obj) => {\n    return typeof ArrayBuffer.isView === \"function\"\n        ? ArrayBuffer.isView(obj)\n        : obj.buffer instanceof ArrayBuffer;\n};\nconst toString = Object.prototype.toString;\nconst withNativeBlob = typeof Blob === \"function\" ||\n    (typeof Blob !== \"undefined\" &&\n        toString.call(Blob) === \"[object BlobConstructor]\");\nconst withNativeFile = typeof File === \"function\" ||\n    (typeof File !== \"undefined\" &&\n        toString.call(File) === \"[object FileConstructor]\");\n/**\n * Returns true if obj is a Buffer, an ArrayBuffer, a Blob or a File.\n *\n * @private\n */\nexport function isBinary(obj) {\n    return ((withNativeArrayBuffer && (obj instanceof ArrayBuffer || isView(obj))) ||\n        (withNativeBlob && obj instanceof Blob) ||\n        (withNativeFile && obj instanceof File));\n}\nexport function hasBinary(obj, toJSON) {\n    if (!obj || typeof obj !== \"object\") {\n        return false;\n    }\n    if (Array.isArray(obj)) {\n        for (let i = 0, l = obj.length; i < l; i++) {\n            if (hasBinary(obj[i])) {\n                return true;\n            }\n        }\n        return false;\n    }\n    if (isBinary(obj)) {\n        return true;\n    }\n    if (obj.toJSON &&\n        typeof obj.toJSON === \"function\" &&\n        arguments.length === 1) {\n        return hasBinary(obj.toJSON(), true);\n    }\n    for (const key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key) && hasBinary(obj[key])) {\n            return true;\n        }\n    }\n    return false;\n}\n","import { isBinary } from \"./is-binary.js\";\n/**\n * Replaces every Buffer | ArrayBuffer | Blob | File in packet with a numbered placeholder.\n *\n * @param {Object} packet - socket.io event packet\n * @return {Object} with deconstructed packet and list of buffers\n * @public\n */\nexport function deconstructPacket(packet) {\n    const buffers = [];\n    const packetData = packet.data;\n    const pack = packet;\n    pack.data = _deconstructPacket(packetData, buffers);\n    pack.attachments = buffers.length; // number of binary 'attachments'\n    return { packet: pack, buffers: buffers };\n}\nfunction _deconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (isBinary(data)) {\n        const placeholder = { _placeholder: true, num: buffers.length };\n        buffers.push(data);\n        return placeholder;\n    }\n    else if (Array.isArray(data)) {\n        const newData = new Array(data.length);\n        for (let i = 0; i < data.length; i++) {\n            newData[i] = _deconstructPacket(data[i], buffers);\n        }\n        return newData;\n    }\n    else if (typeof data === \"object\" && !(data instanceof Date)) {\n        const newData = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                newData[key] = _deconstructPacket(data[key], buffers);\n            }\n        }\n        return newData;\n    }\n    return data;\n}\n/**\n * Reconstructs a binary packet from its placeholder packet and buffers\n *\n * @param {Object} packet - event packet with placeholders\n * @param {Array} buffers - binary buffers to put in placeholder positions\n * @return {Object} reconstructed packet\n * @public\n */\nexport function reconstructPacket(packet, buffers) {\n    packet.data = _reconstructPacket(packet.data, buffers);\n    delete packet.attachments; // no longer useful\n    return packet;\n}\nfunction _reconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (data && data._placeholder === true) {\n        const isIndexValid = typeof data.num === \"number\" &&\n            data.num >= 0 &&\n            data.num < buffers.length;\n        if (isIndexValid) {\n            return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n        }\n        else {\n            throw new Error(\"illegal attachments\");\n        }\n    }\n    else if (Array.isArray(data)) {\n        for (let i = 0; i < data.length; i++) {\n            data[i] = _reconstructPacket(data[i], buffers);\n        }\n    }\n    else if (typeof data === \"object\") {\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                data[key] = _reconstructPacket(data[key], buffers);\n            }\n        }\n    }\n    return data;\n}\n","import { Emitter } from \"@socket.io/component-emitter\";\nimport { deconstructPacket, reconstructPacket } from \"./binary.js\";\nimport { isBinary, hasBinary } from \"./is-binary.js\";\n/**\n * These strings must not be used as event names, as they have a special meaning.\n */\nconst RESERVED_EVENTS = [\n    \"connect\",\n    \"connect_error\",\n    \"disconnect\",\n    \"disconnecting\",\n    \"newListener\",\n    \"removeListener\", // used by the Node.js EventEmitter\n];\n/**\n * Protocol version.\n *\n * @public\n */\nexport const protocol = 5;\nexport var PacketType;\n(function (PacketType) {\n    PacketType[PacketType[\"CONNECT\"] = 0] = \"CONNECT\";\n    PacketType[PacketType[\"DISCONNECT\"] = 1] = \"DISCONNECT\";\n    PacketType[PacketType[\"EVENT\"] = 2] = \"EVENT\";\n    PacketType[PacketType[\"ACK\"] = 3] = \"ACK\";\n    PacketType[PacketType[\"CONNECT_ERROR\"] = 4] = \"CONNECT_ERROR\";\n    PacketType[PacketType[\"BINARY_EVENT\"] = 5] = \"BINARY_EVENT\";\n    PacketType[PacketType[\"BINARY_ACK\"] = 6] = \"BINARY_ACK\";\n})(PacketType || (PacketType = {}));\n/**\n * A socket.io Encoder instance\n */\nexport class Encoder {\n    /**\n     * Encoder constructor\n     *\n     * @param {function} replacer - custom replacer to pass down to JSON.parse\n     */\n    constructor(replacer) {\n        this.replacer = replacer;\n    }\n    /**\n     * Encode a packet as a single string if non-binary, or as a\n     * buffer sequence, depending on packet type.\n     *\n     * @param {Object} obj - packet object\n     */\n    encode(obj) {\n        if (obj.type === PacketType.EVENT || obj.type === PacketType.ACK) {\n            if (hasBinary(obj)) {\n                return this.encodeAsBinary({\n                    type: obj.type === PacketType.EVENT\n                        ? PacketType.BINARY_EVENT\n                        : PacketType.BINARY_ACK,\n                    nsp: obj.nsp,\n                    data: obj.data,\n                    id: obj.id,\n                });\n            }\n        }\n        return [this.encodeAsString(obj)];\n    }\n    /**\n     * Encode packet as string.\n     */\n    encodeAsString(obj) {\n        // first is type\n        let str = \"\" + obj.type;\n        // attachments if we have them\n        if (obj.type === PacketType.BINARY_EVENT ||\n            obj.type === PacketType.BINARY_ACK) {\n            str += obj.attachments + \"-\";\n        }\n        // if we have a namespace other than `/`\n        // we append it followed by a comma `,`\n        if (obj.nsp && \"/\" !== obj.nsp) {\n            str += obj.nsp + \",\";\n        }\n        // immediately followed by the id\n        if (null != obj.id) {\n            str += obj.id;\n        }\n        // json data\n        if (null != obj.data) {\n            str += JSON.stringify(obj.data, this.replacer);\n        }\n        return str;\n    }\n    /**\n     * Encode packet as 'buffer sequence' by removing blobs, and\n     * deconstructing packet into object with placeholders and\n     * a list of buffers.\n     */\n    encodeAsBinary(obj) {\n        const deconstruction = deconstructPacket(obj);\n        const pack = this.encodeAsString(deconstruction.packet);\n        const buffers = deconstruction.buffers;\n        buffers.unshift(pack); // add packet info to beginning of data list\n        return buffers; // write all the buffers\n    }\n}\n// see https://stackoverflow.com/questions/8511281/check-if-a-value-is-an-object-in-javascript\nfunction isObject(value) {\n    return Object.prototype.toString.call(value) === \"[object Object]\";\n}\n/**\n * A socket.io Decoder instance\n *\n * @return {Object} decoder\n */\nexport class Decoder extends Emitter {\n    /**\n     * Decoder constructor\n     *\n     * @param {function} reviver - custom reviver to pass down to JSON.stringify\n     */\n    constructor(reviver) {\n        super();\n        this.reviver = reviver;\n    }\n    /**\n     * Decodes an encoded packet string into packet JSON.\n     *\n     * @param {String} obj - encoded packet\n     */\n    add(obj) {\n        let packet;\n        if (typeof obj === \"string\") {\n            if (this.reconstructor) {\n                throw new Error(\"got plaintext data when reconstructing a packet\");\n            }\n            packet = this.decodeString(obj);\n            const isBinaryEvent = packet.type === PacketType.BINARY_EVENT;\n            if (isBinaryEvent || packet.type === PacketType.BINARY_ACK) {\n                packet.type = isBinaryEvent ? PacketType.EVENT : PacketType.ACK;\n                // binary packet's json\n                this.reconstructor = new BinaryReconstructor(packet);\n                // no attachments, labeled binary but no binary data to follow\n                if (packet.attachments === 0) {\n                    super.emitReserved(\"decoded\", packet);\n                }\n            }\n            else {\n                // non-binary full packet\n                super.emitReserved(\"decoded\", packet);\n            }\n        }\n        else if (isBinary(obj) || obj.base64) {\n            // raw binary data\n            if (!this.reconstructor) {\n                throw new Error(\"got binary data when not reconstructing a packet\");\n            }\n            else {\n                packet = this.reconstructor.takeBinaryData(obj);\n                if (packet) {\n                    // received final buffer\n                    this.reconstructor = null;\n                    super.emitReserved(\"decoded\", packet);\n                }\n            }\n        }\n        else {\n            throw new Error(\"Unknown type: \" + obj);\n        }\n    }\n    /**\n     * Decode a packet String (JSON data)\n     *\n     * @param {String} str\n     * @return {Object} packet\n     */\n    decodeString(str) {\n        let i = 0;\n        // look up type\n        const p = {\n            type: Number(str.charAt(0)),\n        };\n        if (PacketType[p.type] === undefined) {\n            throw new Error(\"unknown packet type \" + p.type);\n        }\n        // look up attachments if type binary\n        if (p.type === PacketType.BINARY_EVENT ||\n            p.type === PacketType.BINARY_ACK) {\n            const start = i + 1;\n            while (str.charAt(++i) !== \"-\" && i != str.length) { }\n            const buf = str.substring(start, i);\n            if (buf != Number(buf) || str.charAt(i) !== \"-\") {\n                throw new Error(\"Illegal attachments\");\n            }\n            p.attachments = Number(buf);\n        }\n        // look up namespace (if any)\n        if (\"/\" === str.charAt(i + 1)) {\n            const start = i + 1;\n            while (++i) {\n                const c = str.charAt(i);\n                if (\",\" === c)\n                    break;\n                if (i === str.length)\n                    break;\n            }\n            p.nsp = str.substring(start, i);\n        }\n        else {\n            p.nsp = \"/\";\n        }\n        // look up id\n        const next = str.charAt(i + 1);\n        if (\"\" !== next && Number(next) == next) {\n            const start = i + 1;\n            while (++i) {\n                const c = str.charAt(i);\n                if (null == c || Number(c) != c) {\n                    --i;\n                    break;\n                }\n                if (i === str.length)\n                    break;\n            }\n            p.id = Number(str.substring(start, i + 1));\n        }\n        // look up json data\n        if (str.charAt(++i)) {\n            const payload = this.tryParse(str.substr(i));\n            if (Decoder.isPayloadValid(p.type, payload)) {\n                p.data = payload;\n            }\n            else {\n                throw new Error(\"invalid payload\");\n            }\n        }\n        return p;\n    }\n    tryParse(str) {\n        try {\n            return JSON.parse(str, this.reviver);\n        }\n        catch (e) {\n            return false;\n        }\n    }\n    static isPayloadValid(type, payload) {\n        switch (type) {\n            case PacketType.CONNECT:\n                return isObject(payload);\n            case PacketType.DISCONNECT:\n                return payload === undefined;\n            case PacketType.CONNECT_ERROR:\n                return typeof payload === \"string\" || isObject(payload);\n            case PacketType.EVENT:\n            case PacketType.BINARY_EVENT:\n                return (Array.isArray(payload) &&\n                    (typeof payload[0] === \"number\" ||\n                        (typeof payload[0] === \"string\" &&\n                            RESERVED_EVENTS.indexOf(payload[0]) === -1)));\n            case PacketType.ACK:\n            case PacketType.BINARY_ACK:\n                return Array.isArray(payload);\n        }\n    }\n    /**\n     * Deallocates a parser's resources\n     */\n    destroy() {\n        if (this.reconstructor) {\n            this.reconstructor.finishedReconstruction();\n            this.reconstructor = null;\n        }\n    }\n}\n/**\n * A manager of a binary event's 'buffer sequence'. Should\n * be constructed whenever a packet of type BINARY_EVENT is\n * decoded.\n *\n * @param {Object} packet\n * @return {BinaryReconstructor} initialized reconstructor\n */\nclass BinaryReconstructor {\n    constructor(packet) {\n        this.packet = packet;\n        this.buffers = [];\n        this.reconPack = packet;\n    }\n    /**\n     * Method to be called when binary data received from connection\n     * after a BINARY_EVENT packet.\n     *\n     * @param {Buffer | ArrayBuffer} binData - the raw binary data received\n     * @return {null | Object} returns null if more binary data is expected or\n     *   a reconstructed packet object if all buffers have been received.\n     */\n    takeBinaryData(binData) {\n        this.buffers.push(binData);\n        if (this.buffers.length === this.reconPack.attachments) {\n            // done with buffer list\n            const packet = reconstructPacket(this.reconPack, this.buffers);\n            this.finishedReconstruction();\n            return packet;\n        }\n        return null;\n    }\n    /**\n     * Cleans up binary packet reconstruction variables.\n     */\n    finishedReconstruction() {\n        this.reconPack = null;\n        this.buffers = [];\n    }\n}\n","export function on(obj, ev, fn) {\n    obj.on(ev, fn);\n    return function subDestroy() {\n        obj.off(ev, fn);\n    };\n}\n","import { PacketType } from \"socket.io-parser\";\nimport { on } from \"./on.js\";\nimport { Emitter, } from \"@socket.io/component-emitter\";\n/**\n * Internal events.\n * These events can't be emitted by the user.\n */\nconst RESERVED_EVENTS = Object.freeze({\n    connect: 1,\n    connect_error: 1,\n    disconnect: 1,\n    disconnecting: 1,\n    // EventEmitter reserved events: https://nodejs.org/api/events.html#events_event_newlistener\n    newListener: 1,\n    removeListener: 1,\n});\n/**\n * A Socket is the fundamental class for interacting with the server.\n *\n * A Socket belongs to a certain Namespace (by default /) and uses an underlying {@link Manager} to communicate.\n *\n * @example\n * const socket = io();\n *\n * socket.on(\"connect\", () => {\n *   console.log(\"connected\");\n * });\n *\n * // send an event to the server\n * socket.emit(\"foo\", \"bar\");\n *\n * socket.on(\"foobar\", () => {\n *   // an event was received from the server\n * });\n *\n * // upon disconnection\n * socket.on(\"disconnect\", (reason) => {\n *   console.log(`disconnected due to ${reason}`);\n * });\n */\nexport class Socket extends Emitter {\n    /**\n     * `Socket` constructor.\n     */\n    constructor(io, nsp, opts) {\n        super();\n        /**\n         * Whether the socket is currently connected to the server.\n         *\n         * @example\n         * const socket = io();\n         *\n         * socket.on(\"connect\", () => {\n         *   console.log(socket.connected); // true\n         * });\n         *\n         * socket.on(\"disconnect\", () => {\n         *   console.log(socket.connected); // false\n         * });\n         */\n        this.connected = false;\n        /**\n         * Whether the connection state was recovered after a temporary disconnection. In that case, any missed packets will\n         * be transmitted by the server.\n         */\n        this.recovered = false;\n        /**\n         * Buffer for packets received before the CONNECT packet\n         */\n        this.receiveBuffer = [];\n        /**\n         * Buffer for packets that will be sent once the socket is connected\n         */\n        this.sendBuffer = [];\n        /**\n         * The queue of packets to be sent with retry in case of failure.\n         *\n         * Packets are sent one by one, each waiting for the server acknowledgement, in order to guarantee the delivery order.\n         * @private\n         */\n        this._queue = [];\n        /**\n         * A sequence to generate the ID of the {@link QueuedPacket}.\n         * @private\n         */\n        this._queueSeq = 0;\n        this.ids = 0;\n        /**\n         * A map containing acknowledgement handlers.\n         *\n         * The `withError` attribute is used to differentiate handlers that accept an error as first argument:\n         *\n         * - `socket.emit(\"test\", (err, value) => { ... })` with `ackTimeout` option\n         * - `socket.timeout(5000).emit(\"test\", (err, value) => { ... })`\n         * - `const value = await socket.emitWithAck(\"test\")`\n         *\n         * From those that don't:\n         *\n         * - `socket.emit(\"test\", (value) => { ... });`\n         *\n         * In the first case, the handlers will be called with an error when:\n         *\n         * - the timeout is reached\n         * - the socket gets disconnected\n         *\n         * In the second case, the handlers will be simply discarded upon disconnection, since the client will never receive\n         * an acknowledgement from the server.\n         *\n         * @private\n         */\n        this.acks = {};\n        this.flags = {};\n        this.io = io;\n        this.nsp = nsp;\n        if (opts && opts.auth) {\n            this.auth = opts.auth;\n        }\n        this._opts = Object.assign({}, opts);\n        if (this.io._autoConnect)\n            this.open();\n    }\n    /**\n     * Whether the socket is currently disconnected\n     *\n     * @example\n     * const socket = io();\n     *\n     * socket.on(\"connect\", () => {\n     *   console.log(socket.disconnected); // false\n     * });\n     *\n     * socket.on(\"disconnect\", () => {\n     *   console.log(socket.disconnected); // true\n     * });\n     */\n    get disconnected() {\n        return !this.connected;\n    }\n    /**\n     * Subscribe to open, close and packet events\n     *\n     * @private\n     */\n    subEvents() {\n        if (this.subs)\n            return;\n        const io = this.io;\n        this.subs = [\n            on(io, \"open\", this.onopen.bind(this)),\n            on(io, \"packet\", this.onpacket.bind(this)),\n            on(io, \"error\", this.onerror.bind(this)),\n            on(io, \"close\", this.onclose.bind(this)),\n        ];\n    }\n    /**\n     * Whether the Socket will try to reconnect when its Manager connects or reconnects.\n     *\n     * @example\n     * const socket = io();\n     *\n     * console.log(socket.active); // true\n     *\n     * socket.on(\"disconnect\", (reason) => {\n     *   if (reason === \"io server disconnect\") {\n     *     // the disconnection was initiated by the server, you need to manually reconnect\n     *     console.log(socket.active); // false\n     *   }\n     *   // else the socket will automatically try to reconnect\n     *   console.log(socket.active); // true\n     * });\n     */\n    get active() {\n        return !!this.subs;\n    }\n    /**\n     * \"Opens\" the socket.\n     *\n     * @example\n     * const socket = io({\n     *   autoConnect: false\n     * });\n     *\n     * socket.connect();\n     */\n    connect() {\n        if (this.connected)\n            return this;\n        this.subEvents();\n        if (!this.io[\"_reconnecting\"])\n            this.io.open(); // ensure open\n        if (\"open\" === this.io._readyState)\n            this.onopen();\n        return this;\n    }\n    /**\n     * Alias for {@link connect()}.\n     */\n    open() {\n        return this.connect();\n    }\n    /**\n     * Sends a `message` event.\n     *\n     * This method mimics the WebSocket.send() method.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/send\n     *\n     * @example\n     * socket.send(\"hello\");\n     *\n     * // this is equivalent to\n     * socket.emit(\"message\", \"hello\");\n     *\n     * @return self\n     */\n    send(...args) {\n        args.unshift(\"message\");\n        this.emit.apply(this, args);\n        return this;\n    }\n    /**\n     * Override `emit`.\n     * If the event is in `events`, it's emitted normally.\n     *\n     * @example\n     * socket.emit(\"hello\", \"world\");\n     *\n     * // all serializable datastructures are supported (no need to call JSON.stringify)\n     * socket.emit(\"hello\", 1, \"2\", { 3: [\"4\"], 5: Uint8Array.from([6]) });\n     *\n     * // with an acknowledgement from the server\n     * socket.emit(\"hello\", \"world\", (val) => {\n     *   // ...\n     * });\n     *\n     * @return self\n     */\n    emit(ev, ...args) {\n        var _a, _b, _c;\n        if (RESERVED_EVENTS.hasOwnProperty(ev)) {\n            throw new Error('\"' + ev.toString() + '\" is a reserved event name');\n        }\n        args.unshift(ev);\n        if (this._opts.retries && !this.flags.fromQueue && !this.flags.volatile) {\n            this._addToQueue(args);\n            return this;\n        }\n        const packet = {\n            type: PacketType.EVENT,\n            data: args,\n        };\n        packet.options = {};\n        packet.options.compress = this.flags.compress !== false;\n        // event ack callback\n        if (\"function\" === typeof args[args.length - 1]) {\n            const id = this.ids++;\n            const ack = args.pop();\n            this._registerAckCallback(id, ack);\n            packet.id = id;\n        }\n        const isTransportWritable = (_b = (_a = this.io.engine) === null || _a === void 0 ? void 0 : _a.transport) === null || _b === void 0 ? void 0 : _b.writable;\n        const isConnected = this.connected && !((_c = this.io.engine) === null || _c === void 0 ? void 0 : _c._hasPingExpired());\n        const discardPacket = this.flags.volatile && !isTransportWritable;\n        if (discardPacket) {\n        }\n        else if (isConnected) {\n            this.notifyOutgoingListeners(packet);\n            this.packet(packet);\n        }\n        else {\n            this.sendBuffer.push(packet);\n        }\n        this.flags = {};\n        return this;\n    }\n    /**\n     * @private\n     */\n    _registerAckCallback(id, ack) {\n        var _a;\n        const timeout = (_a = this.flags.timeout) !== null && _a !== void 0 ? _a : this._opts.ackTimeout;\n        if (timeout === undefined) {\n            this.acks[id] = ack;\n            return;\n        }\n        // @ts-ignore\n        const timer = this.io.setTimeoutFn(() => {\n            delete this.acks[id];\n            for (let i = 0; i < this.sendBuffer.length; i++) {\n                if (this.sendBuffer[i].id === id) {\n                    this.sendBuffer.splice(i, 1);\n                }\n            }\n            ack.call(this, new Error(\"operation has timed out\"));\n        }, timeout);\n        const fn = (...args) => {\n            // @ts-ignore\n            this.io.clearTimeoutFn(timer);\n            ack.apply(this, args);\n        };\n        fn.withError = true;\n        this.acks[id] = fn;\n    }\n    /**\n     * Emits an event and waits for an acknowledgement\n     *\n     * @example\n     * // without timeout\n     * const response = await socket.emitWithAck(\"hello\", \"world\");\n     *\n     * // with a specific timeout\n     * try {\n     *   const response = await socket.timeout(1000).emitWithAck(\"hello\", \"world\");\n     * } catch (err) {\n     *   // the server did not acknowledge the event in the given delay\n     * }\n     *\n     * @return a Promise that will be fulfilled when the server acknowledges the event\n     */\n    emitWithAck(ev, ...args) {\n        return new Promise((resolve, reject) => {\n            const fn = (arg1, arg2) => {\n                return arg1 ? reject(arg1) : resolve(arg2);\n            };\n            fn.withError = true;\n            args.push(fn);\n            this.emit(ev, ...args);\n        });\n    }\n    /**\n     * Add the packet to the queue.\n     * @param args\n     * @private\n     */\n    _addToQueue(args) {\n        let ack;\n        if (typeof args[args.length - 1] === \"function\") {\n            ack = args.pop();\n        }\n        const packet = {\n            id: this._queueSeq++,\n            tryCount: 0,\n            pending: false,\n            args,\n            flags: Object.assign({ fromQueue: true }, this.flags),\n        };\n        args.push((err, ...responseArgs) => {\n            if (packet !== this._queue[0]) {\n                // the packet has already been acknowledged\n                return;\n            }\n            const hasError = err !== null;\n            if (hasError) {\n                if (packet.tryCount > this._opts.retries) {\n                    this._queue.shift();\n                    if (ack) {\n                        ack(err);\n                    }\n                }\n            }\n            else {\n                this._queue.shift();\n                if (ack) {\n                    ack(null, ...responseArgs);\n                }\n            }\n            packet.pending = false;\n            return this._drainQueue();\n        });\n        this._queue.push(packet);\n        this._drainQueue();\n    }\n    /**\n     * Send the first packet of the queue, and wait for an acknowledgement from the server.\n     * @param force - whether to resend a packet that has not been acknowledged yet\n     *\n     * @private\n     */\n    _drainQueue(force = false) {\n        if (!this.connected || this._queue.length === 0) {\n            return;\n        }\n        const packet = this._queue[0];\n        if (packet.pending && !force) {\n            return;\n        }\n        packet.pending = true;\n        packet.tryCount++;\n        this.flags = packet.flags;\n        this.emit.apply(this, packet.args);\n    }\n    /**\n     * Sends a packet.\n     *\n     * @param packet\n     * @private\n     */\n    packet(packet) {\n        packet.nsp = this.nsp;\n        this.io._packet(packet);\n    }\n    /**\n     * Called upon engine `open`.\n     *\n     * @private\n     */\n    onopen() {\n        if (typeof this.auth == \"function\") {\n            this.auth((data) => {\n                this._sendConnectPacket(data);\n            });\n        }\n        else {\n            this._sendConnectPacket(this.auth);\n        }\n    }\n    /**\n     * Sends a CONNECT packet to initiate the Socket.IO session.\n     *\n     * @param data\n     * @private\n     */\n    _sendConnectPacket(data) {\n        this.packet({\n            type: PacketType.CONNECT,\n            data: this._pid\n                ? Object.assign({ pid: this._pid, offset: this._lastOffset }, data)\n                : data,\n        });\n    }\n    /**\n     * Called upon engine or manager `error`.\n     *\n     * @param err\n     * @private\n     */\n    onerror(err) {\n        if (!this.connected) {\n            this.emitReserved(\"connect_error\", err);\n        }\n    }\n    /**\n     * Called upon engine `close`.\n     *\n     * @param reason\n     * @param description\n     * @private\n     */\n    onclose(reason, description) {\n        this.connected = false;\n        delete this.id;\n        this.emitReserved(\"disconnect\", reason, description);\n        this._clearAcks();\n    }\n    /**\n     * Clears the acknowledgement handlers upon disconnection, since the client will never receive an acknowledgement from\n     * the server.\n     *\n     * @private\n     */\n    _clearAcks() {\n        Object.keys(this.acks).forEach((id) => {\n            const isBuffered = this.sendBuffer.some((packet) => String(packet.id) === id);\n            if (!isBuffered) {\n                // note: handlers that do not accept an error as first argument are ignored here\n                const ack = this.acks[id];\n                delete this.acks[id];\n                if (ack.withError) {\n                    ack.call(this, new Error(\"socket has been disconnected\"));\n                }\n            }\n        });\n    }\n    /**\n     * Called with socket packet.\n     *\n     * @param packet\n     * @private\n     */\n    onpacket(packet) {\n        const sameNamespace = packet.nsp === this.nsp;\n        if (!sameNamespace)\n            return;\n        switch (packet.type) {\n            case PacketType.CONNECT:\n                if (packet.data && packet.data.sid) {\n                    this.onconnect(packet.data.sid, packet.data.pid);\n                }\n                else {\n                    this.emitReserved(\"connect_error\", new Error(\"It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)\"));\n                }\n                break;\n            case PacketType.EVENT:\n            case PacketType.BINARY_EVENT:\n                this.onevent(packet);\n                break;\n            case PacketType.ACK:\n            case PacketType.BINARY_ACK:\n                this.onack(packet);\n                break;\n            case PacketType.DISCONNECT:\n                this.ondisconnect();\n                break;\n            case PacketType.CONNECT_ERROR:\n                this.destroy();\n                const err = new Error(packet.data.message);\n                // @ts-ignore\n                err.data = packet.data.data;\n                this.emitReserved(\"connect_error\", err);\n                break;\n        }\n    }\n    /**\n     * Called upon a server event.\n     *\n     * @param packet\n     * @private\n     */\n    onevent(packet) {\n        const args = packet.data || [];\n        if (null != packet.id) {\n            args.push(this.ack(packet.id));\n        }\n        if (this.connected) {\n            this.emitEvent(args);\n        }\n        else {\n            this.receiveBuffer.push(Object.freeze(args));\n        }\n    }\n    emitEvent(args) {\n        if (this._anyListeners && this._anyListeners.length) {\n            const listeners = this._anyListeners.slice();\n            for (const listener of listeners) {\n                listener.apply(this, args);\n            }\n        }\n        super.emit.apply(this, args);\n        if (this._pid && args.length && typeof args[args.length - 1] === \"string\") {\n            this._lastOffset = args[args.length - 1];\n        }\n    }\n    /**\n     * Produces an ack callback to emit with an event.\n     *\n     * @private\n     */\n    ack(id) {\n        const self = this;\n        let sent = false;\n        return function (...args) {\n            // prevent double callbacks\n            if (sent)\n                return;\n            sent = true;\n            self.packet({\n                type: PacketType.ACK,\n                id: id,\n                data: args,\n            });\n        };\n    }\n    /**\n     * Called upon a server acknowledgement.\n     *\n     * @param packet\n     * @private\n     */\n    onack(packet) {\n        const ack = this.acks[packet.id];\n        if (typeof ack !== \"function\") {\n            return;\n        }\n        delete this.acks[packet.id];\n        // @ts-ignore FIXME ack is incorrectly inferred as 'never'\n        if (ack.withError) {\n            packet.data.unshift(null);\n        }\n        // @ts-ignore\n        ack.apply(this, packet.data);\n    }\n    /**\n     * Called upon server connect.\n     *\n     * @private\n     */\n    onconnect(id, pid) {\n        this.id = id;\n        this.recovered = pid && this._pid === pid;\n        this._pid = pid; // defined only if connection state recovery is enabled\n        this.connected = true;\n        this.emitBuffered();\n        this.emitReserved(\"connect\");\n        this._drainQueue(true);\n    }\n    /**\n     * Emit buffered events (received and emitted).\n     *\n     * @private\n     */\n    emitBuffered() {\n        this.receiveBuffer.forEach((args) => this.emitEvent(args));\n        this.receiveBuffer = [];\n        this.sendBuffer.forEach((packet) => {\n            this.notifyOutgoingListeners(packet);\n            this.packet(packet);\n        });\n        this.sendBuffer = [];\n    }\n    /**\n     * Called upon server disconnect.\n     *\n     * @private\n     */\n    ondisconnect() {\n        this.destroy();\n        this.onclose(\"io server disconnect\");\n    }\n    /**\n     * Called upon forced client/server side disconnections,\n     * this method ensures the manager stops tracking us and\n     * that reconnections don't get triggered for this.\n     *\n     * @private\n     */\n    destroy() {\n        if (this.subs) {\n            // clean subscriptions to avoid reconnections\n            this.subs.forEach((subDestroy) => subDestroy());\n            this.subs = undefined;\n        }\n        this.io[\"_destroy\"](this);\n    }\n    /**\n     * Disconnects the socket manually. In that case, the socket will not try to reconnect.\n     *\n     * If this is the last active Socket instance of the {@link Manager}, the low-level connection will be closed.\n     *\n     * @example\n     * const socket = io();\n     *\n     * socket.on(\"disconnect\", (reason) => {\n     *   // console.log(reason); prints \"io client disconnect\"\n     * });\n     *\n     * socket.disconnect();\n     *\n     * @return self\n     */\n    disconnect() {\n        if (this.connected) {\n            this.packet({ type: PacketType.DISCONNECT });\n        }\n        // remove socket from pool\n        this.destroy();\n        if (this.connected) {\n            // fire events\n            this.onclose(\"io client disconnect\");\n        }\n        return this;\n    }\n    /**\n     * Alias for {@link disconnect()}.\n     *\n     * @return self\n     */\n    close() {\n        return this.disconnect();\n    }\n    /**\n     * Sets the compress flag.\n     *\n     * @example\n     * socket.compress(false).emit(\"hello\");\n     *\n     * @param compress - if `true`, compresses the sending data\n     * @return self\n     */\n    compress(compress) {\n        this.flags.compress = compress;\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the event message will be dropped when this socket is not\n     * ready to send messages.\n     *\n     * @example\n     * socket.volatile.emit(\"hello\"); // the server may or may not receive it\n     *\n     * @returns self\n     */\n    get volatile() {\n        this.flags.volatile = true;\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the callback will be called with an error when the\n     * given number of milliseconds have elapsed without an acknowledgement from the server:\n     *\n     * @example\n     * socket.timeout(5000).emit(\"my-event\", (err) => {\n     *   if (err) {\n     *     // the server did not acknowledge the event in the given delay\n     *   }\n     * });\n     *\n     * @returns self\n     */\n    timeout(timeout) {\n        this.flags.timeout = timeout;\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback.\n     *\n     * @example\n     * socket.onAny((event, ...args) => {\n     *   console.log(`got ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    onAny(listener) {\n        this._anyListeners = this._anyListeners || [];\n        this._anyListeners.push(listener);\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback. The listener is added to the beginning of the listeners array.\n     *\n     * @example\n     * socket.prependAny((event, ...args) => {\n     *   console.log(`got event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    prependAny(listener) {\n        this._anyListeners = this._anyListeners || [];\n        this._anyListeners.unshift(listener);\n        return this;\n    }\n    /**\n     * Removes the listener that will be fired when any event is emitted.\n     *\n     * @example\n     * const catchAllListener = (event, ...args) => {\n     *   console.log(`got event ${event}`);\n     * }\n     *\n     * socket.onAny(catchAllListener);\n     *\n     * // remove a specific listener\n     * socket.offAny(catchAllListener);\n     *\n     * // or remove all listeners\n     * socket.offAny();\n     *\n     * @param listener\n     */\n    offAny(listener) {\n        if (!this._anyListeners) {\n            return this;\n        }\n        if (listener) {\n            const listeners = this._anyListeners;\n            for (let i = 0; i < listeners.length; i++) {\n                if (listener === listeners[i]) {\n                    listeners.splice(i, 1);\n                    return this;\n                }\n            }\n        }\n        else {\n            this._anyListeners = [];\n        }\n        return this;\n    }\n    /**\n     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,\n     * e.g. to remove listeners.\n     */\n    listenersAny() {\n        return this._anyListeners || [];\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback.\n     *\n     * Note: acknowledgements sent to the server are not included.\n     *\n     * @example\n     * socket.onAnyOutgoing((event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    onAnyOutgoing(listener) {\n        this._anyOutgoingListeners = this._anyOutgoingListeners || [];\n        this._anyOutgoingListeners.push(listener);\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback. The listener is added to the beginning of the listeners array.\n     *\n     * Note: acknowledgements sent to the server are not included.\n     *\n     * @example\n     * socket.prependAnyOutgoing((event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    prependAnyOutgoing(listener) {\n        this._anyOutgoingListeners = this._anyOutgoingListeners || [];\n        this._anyOutgoingListeners.unshift(listener);\n        return this;\n    }\n    /**\n     * Removes the listener that will be fired when any event is emitted.\n     *\n     * @example\n     * const catchAllListener = (event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * }\n     *\n     * socket.onAnyOutgoing(catchAllListener);\n     *\n     * // remove a specific listener\n     * socket.offAnyOutgoing(catchAllListener);\n     *\n     * // or remove all listeners\n     * socket.offAnyOutgoing();\n     *\n     * @param [listener] - the catch-all listener (optional)\n     */\n    offAnyOutgoing(listener) {\n        if (!this._anyOutgoingListeners) {\n            return this;\n        }\n        if (listener) {\n            const listeners = this._anyOutgoingListeners;\n            for (let i = 0; i < listeners.length; i++) {\n                if (listener === listeners[i]) {\n                    listeners.splice(i, 1);\n                    return this;\n                }\n            }\n        }\n        else {\n            this._anyOutgoingListeners = [];\n        }\n        return this;\n    }\n    /**\n     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,\n     * e.g. to remove listeners.\n     */\n    listenersAnyOutgoing() {\n        return this._anyOutgoingListeners || [];\n    }\n    /**\n     * Notify the listeners for each packet sent\n     *\n     * @param packet\n     *\n     * @private\n     */\n    notifyOutgoingListeners(packet) {\n        if (this._anyOutgoingListeners && this._anyOutgoingListeners.length) {\n            const listeners = this._anyOutgoingListeners.slice();\n            for (const listener of listeners) {\n                listener.apply(this, packet.data);\n            }\n        }\n    }\n}\n","/**\n * Initialize backoff timer with `opts`.\n *\n * - `min` initial timeout in milliseconds [100]\n * - `max` max timeout [10000]\n * - `jitter` [0]\n * - `factor` [2]\n *\n * @param {Object} opts\n * @api public\n */\nexport function Backoff(opts) {\n    opts = opts || {};\n    this.ms = opts.min || 100;\n    this.max = opts.max || 10000;\n    this.factor = opts.factor || 2;\n    this.jitter = opts.jitter > 0 && opts.jitter <= 1 ? opts.jitter : 0;\n    this.attempts = 0;\n}\n/**\n * Return the backoff duration.\n *\n * @return {Number}\n * @api public\n */\nBackoff.prototype.duration = function () {\n    var ms = this.ms * Math.pow(this.factor, this.attempts++);\n    if (this.jitter) {\n        var rand = Math.random();\n        var deviation = Math.floor(rand * this.jitter * ms);\n        ms = (Math.floor(rand * 10) & 1) == 0 ? ms - deviation : ms + deviation;\n    }\n    return Math.min(ms, this.max) | 0;\n};\n/**\n * Reset the number of attempts.\n *\n * @api public\n */\nBackoff.prototype.reset = function () {\n    this.attempts = 0;\n};\n/**\n * Set the minimum duration\n *\n * @api public\n */\nBackoff.prototype.setMin = function (min) {\n    this.ms = min;\n};\n/**\n * Set the maximum duration\n *\n * @api public\n */\nBackoff.prototype.setMax = function (max) {\n    this.max = max;\n};\n/**\n * Set the jitter\n *\n * @api public\n */\nBackoff.prototype.setJitter = function (jitter) {\n    this.jitter = jitter;\n};\n","import { Socket as Engine, installTimerFunctions, nextTick, } from \"engine.io-client\";\nimport { Socket } from \"./socket.js\";\nimport * as parser from \"socket.io-parser\";\nimport { on } from \"./on.js\";\nimport { Backoff } from \"./contrib/backo2.js\";\nimport { Emitter, } from \"@socket.io/component-emitter\";\nexport class Manager extends Emitter {\n    constructor(uri, opts) {\n        var _a;\n        super();\n        this.nsps = {};\n        this.subs = [];\n        if (uri && \"object\" === typeof uri) {\n            opts = uri;\n            uri = undefined;\n        }\n        opts = opts || {};\n        opts.path = opts.path || \"/socket.io\";\n        this.opts = opts;\n        installTimerFunctions(this, opts);\n        this.reconnection(opts.reconnection !== false);\n        this.reconnectionAttempts(opts.reconnectionAttempts || Infinity);\n        this.reconnectionDelay(opts.reconnectionDelay || 1000);\n        this.reconnectionDelayMax(opts.reconnectionDelayMax || 5000);\n        this.randomizationFactor((_a = opts.randomizationFactor) !== null && _a !== void 0 ? _a : 0.5);\n        this.backoff = new Backoff({\n            min: this.reconnectionDelay(),\n            max: this.reconnectionDelayMax(),\n            jitter: this.randomizationFactor(),\n        });\n        this.timeout(null == opts.timeout ? 20000 : opts.timeout);\n        this._readyState = \"closed\";\n        this.uri = uri;\n        const _parser = opts.parser || parser;\n        this.encoder = new _parser.Encoder();\n        this.decoder = new _parser.Decoder();\n        this._autoConnect = opts.autoConnect !== false;\n        if (this._autoConnect)\n            this.open();\n    }\n    reconnection(v) {\n        if (!arguments.length)\n            return this._reconnection;\n        this._reconnection = !!v;\n        if (!v) {\n            this.skipReconnect = true;\n        }\n        return this;\n    }\n    reconnectionAttempts(v) {\n        if (v === undefined)\n            return this._reconnectionAttempts;\n        this._reconnectionAttempts = v;\n        return this;\n    }\n    reconnectionDelay(v) {\n        var _a;\n        if (v === undefined)\n            return this._reconnectionDelay;\n        this._reconnectionDelay = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMin(v);\n        return this;\n    }\n    randomizationFactor(v) {\n        var _a;\n        if (v === undefined)\n            return this._randomizationFactor;\n        this._randomizationFactor = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setJitter(v);\n        return this;\n    }\n    reconnectionDelayMax(v) {\n        var _a;\n        if (v === undefined)\n            return this._reconnectionDelayMax;\n        this._reconnectionDelayMax = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMax(v);\n        return this;\n    }\n    timeout(v) {\n        if (!arguments.length)\n            return this._timeout;\n        this._timeout = v;\n        return this;\n    }\n    /**\n     * Starts trying to reconnect if reconnection is enabled and we have not\n     * started reconnecting yet\n     *\n     * @private\n     */\n    maybeReconnectOnOpen() {\n        // Only try to reconnect if it's the first time we're connecting\n        if (!this._reconnecting &&\n            this._reconnection &&\n            this.backoff.attempts === 0) {\n            // keeps reconnection from firing twice for the same reconnection loop\n            this.reconnect();\n        }\n    }\n    /**\n     * Sets the current transport `socket`.\n     *\n     * @param {Function} fn - optional, callback\n     * @return self\n     * @public\n     */\n    open(fn) {\n        if (~this._readyState.indexOf(\"open\"))\n            return this;\n        this.engine = new Engine(this.uri, this.opts);\n        const socket = this.engine;\n        const self = this;\n        this._readyState = \"opening\";\n        this.skipReconnect = false;\n        // emit `open`\n        const openSubDestroy = on(socket, \"open\", function () {\n            self.onopen();\n            fn && fn();\n        });\n        const onError = (err) => {\n            this.cleanup();\n            this._readyState = \"closed\";\n            this.emitReserved(\"error\", err);\n            if (fn) {\n                fn(err);\n            }\n            else {\n                // Only do this if there is no fn to handle the error\n                this.maybeReconnectOnOpen();\n            }\n        };\n        // emit `error`\n        const errorSub = on(socket, \"error\", onError);\n        if (false !== this._timeout) {\n            const timeout = this._timeout;\n            // set timer\n            const timer = this.setTimeoutFn(() => {\n                openSubDestroy();\n                onError(new Error(\"timeout\"));\n                socket.close();\n            }, timeout);\n            if (this.opts.autoUnref) {\n                timer.unref();\n            }\n            this.subs.push(() => {\n                this.clearTimeoutFn(timer);\n            });\n        }\n        this.subs.push(openSubDestroy);\n        this.subs.push(errorSub);\n        return this;\n    }\n    /**\n     * Alias for open()\n     *\n     * @return self\n     * @public\n     */\n    connect(fn) {\n        return this.open(fn);\n    }\n    /**\n     * Called upon transport open.\n     *\n     * @private\n     */\n    onopen() {\n        // clear old subs\n        this.cleanup();\n        // mark as open\n        this._readyState = \"open\";\n        this.emitReserved(\"open\");\n        // add new subs\n        const socket = this.engine;\n        this.subs.push(on(socket, \"ping\", this.onping.bind(this)), on(socket, \"data\", this.ondata.bind(this)), on(socket, \"error\", this.onerror.bind(this)), on(socket, \"close\", this.onclose.bind(this)), \n        // @ts-ignore\n        on(this.decoder, \"decoded\", this.ondecoded.bind(this)));\n    }\n    /**\n     * Called upon a ping.\n     *\n     * @private\n     */\n    onping() {\n        this.emitReserved(\"ping\");\n    }\n    /**\n     * Called with data.\n     *\n     * @private\n     */\n    ondata(data) {\n        try {\n            this.decoder.add(data);\n        }\n        catch (e) {\n            this.onclose(\"parse error\", e);\n        }\n    }\n    /**\n     * Called when parser fully decodes a packet.\n     *\n     * @private\n     */\n    ondecoded(packet) {\n        // the nextTick call prevents an exception in a user-provided event listener from triggering a disconnection due to a \"parse error\"\n        nextTick(() => {\n            this.emitReserved(\"packet\", packet);\n        }, this.setTimeoutFn);\n    }\n    /**\n     * Called upon socket error.\n     *\n     * @private\n     */\n    onerror(err) {\n        this.emitReserved(\"error\", err);\n    }\n    /**\n     * Creates a new socket for the given `nsp`.\n     *\n     * @return {Socket}\n     * @public\n     */\n    socket(nsp, opts) {\n        let socket = this.nsps[nsp];\n        if (!socket) {\n            socket = new Socket(this, nsp, opts);\n            this.nsps[nsp] = socket;\n        }\n        else if (this._autoConnect && !socket.active) {\n            socket.connect();\n        }\n        return socket;\n    }\n    /**\n     * Called upon a socket close.\n     *\n     * @param socket\n     * @private\n     */\n    _destroy(socket) {\n        const nsps = Object.keys(this.nsps);\n        for (const nsp of nsps) {\n            const socket = this.nsps[nsp];\n            if (socket.active) {\n                return;\n            }\n        }\n        this._close();\n    }\n    /**\n     * Writes a packet.\n     *\n     * @param packet\n     * @private\n     */\n    _packet(packet) {\n        const encodedPackets = this.encoder.encode(packet);\n        for (let i = 0; i < encodedPackets.length; i++) {\n            this.engine.write(encodedPackets[i], packet.options);\n        }\n    }\n    /**\n     * Clean up transport subscriptions and packet buffer.\n     *\n     * @private\n     */\n    cleanup() {\n        this.subs.forEach((subDestroy) => subDestroy());\n        this.subs.length = 0;\n        this.decoder.destroy();\n    }\n    /**\n     * Close the current socket.\n     *\n     * @private\n     */\n    _close() {\n        this.skipReconnect = true;\n        this._reconnecting = false;\n        this.onclose(\"forced close\");\n    }\n    /**\n     * Alias for close()\n     *\n     * @private\n     */\n    disconnect() {\n        return this._close();\n    }\n    /**\n     * Called when:\n     *\n     * - the low-level engine is closed\n     * - the parser encountered a badly formatted packet\n     * - all sockets are disconnected\n     *\n     * @private\n     */\n    onclose(reason, description) {\n        var _a;\n        this.cleanup();\n        (_a = this.engine) === null || _a === void 0 ? void 0 : _a.close();\n        this.backoff.reset();\n        this._readyState = \"closed\";\n        this.emitReserved(\"close\", reason, description);\n        if (this._reconnection && !this.skipReconnect) {\n            this.reconnect();\n        }\n    }\n    /**\n     * Attempt a reconnection.\n     *\n     * @private\n     */\n    reconnect() {\n        if (this._reconnecting || this.skipReconnect)\n            return this;\n        const self = this;\n        if (this.backoff.attempts >= this._reconnectionAttempts) {\n            this.backoff.reset();\n            this.emitReserved(\"reconnect_failed\");\n            this._reconnecting = false;\n        }\n        else {\n            const delay = this.backoff.duration();\n            this._reconnecting = true;\n            const timer = this.setTimeoutFn(() => {\n                if (self.skipReconnect)\n                    return;\n                this.emitReserved(\"reconnect_attempt\", self.backoff.attempts);\n                // check again for the case socket closed in above events\n                if (self.skipReconnect)\n                    return;\n                self.open((err) => {\n                    if (err) {\n                        self._reconnecting = false;\n                        self.reconnect();\n                        this.emitReserved(\"reconnect_error\", err);\n                    }\n                    else {\n                        self.onreconnect();\n                    }\n                });\n            }, delay);\n            if (this.opts.autoUnref) {\n                timer.unref();\n            }\n            this.subs.push(() => {\n                this.clearTimeoutFn(timer);\n            });\n        }\n    }\n    /**\n     * Called upon successful reconnect.\n     *\n     * @private\n     */\n    onreconnect() {\n        const attempt = this.backoff.attempts;\n        this._reconnecting = false;\n        this.backoff.reset();\n        this.emitReserved(\"reconnect\", attempt);\n    }\n}\n","import { url } from \"./url.js\";\nimport { Manager } from \"./manager.js\";\nimport { Socket } from \"./socket.js\";\n/**\n * Managers cache.\n */\nconst cache = {};\nfunction lookup(uri, opts) {\n    if (typeof uri === \"object\") {\n        opts = uri;\n        uri = undefined;\n    }\n    opts = opts || {};\n    const parsed = url(uri, opts.path || \"/socket.io\");\n    const source = parsed.source;\n    const id = parsed.id;\n    const path = parsed.path;\n    const sameNamespace = cache[id] && path in cache[id][\"nsps\"];\n    const newConnection = opts.forceNew ||\n        opts[\"force new connection\"] ||\n        false === opts.multiplex ||\n        sameNamespace;\n    let io;\n    if (newConnection) {\n        io = new Manager(source, opts);\n    }\n    else {\n        if (!cache[id]) {\n            cache[id] = new Manager(source, opts);\n        }\n        io = cache[id];\n    }\n    if (parsed.query && !opts.query) {\n        opts.query = parsed.queryKey;\n    }\n    return io.socket(parsed.path, opts);\n}\n// so that \"lookup\" can be used both as a function (e.g. `io(...)`) and as a\n// namespace (e.g. `io.connect(...)`), for backward compatibility\nObject.assign(lookup, {\n    Manager,\n    Socket,\n    io: lookup,\n    connect: lookup,\n});\n/**\n * Protocol version.\n *\n * @public\n */\nexport { protocol } from \"socket.io-parser\";\n/**\n * Expose constructors for standalone build.\n *\n * @public\n */\nexport { Manager, Socket, lookup as io, lookup as connect, lookup as default, };\nexport { Fetch, NodeXHR, XHR, NodeWebSocket, WebSocket, WebTransport, } from \"engine.io-client\";\n","import { useState, useEffect, useCallback, useRef } from 'react';\r\n// @ts-ignore - types provided by socket.io-client package\r\nimport { io as createSocket, Socket } from 'socket.io-client';\r\nimport { effectsBus } from '../effects/effectsBus';\r\nimport { useGameStore } from '../store/gameStore';\r\n\r\nexport interface DuelMessage {\r\n  type: 'player_action' | 'player_shocked' | 'player_ready' | 'game_start' | 'game_end' | 'sync_state';\r\n  playerId: string;\r\n  data?: any;\r\n  timestamp: number;\r\n}\r\n\r\nexport interface DuelRoom {\r\n  id: string;\r\n  players: string[];\r\n  status: 'waiting' | 'ready' | 'playing' | 'finished';\r\n  createdAt: number;\r\n}\r\n\r\nexport const useDuelConnection = () => {\r\n  const { player } = useGameStore();\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const [currentRoom, setCurrentRoom] = useState<DuelRoom | null>(null);\r\n  const [opponent, setOpponent] = useState<any>(null);\r\n  const [messages, setMessages] = useState<DuelMessage[]>([]);\r\n  \r\n  //  Socket.IO,   ,  \r\n  const socketRef = useRef<Socket | null>(null);\r\n  const simulationIntervalRef = useRef<any>(null);\r\n  const connectionRef = useRef<any>(null); // legacy simulation queue timer\r\n  const messageQueueRef = useRef<DuelMessage[]>([]);\r\n  const aiIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n  const lastAiActionRef = useRef<number>(0);\r\n\r\n  //    \r\n  const connect = useCallback(() => {\r\n    console.log('    ...');\r\n    try {\r\n      const url = (import.meta as any).env?.VITE_BACKEND_URL || 'http://localhost:3001';\r\n      const s = createSocket(url, { transports:['websocket'], query:{ pid: player.id }, timeout: 2500 });\r\n      socketRef.current = s;\r\n      s.on('connect', () => { setIsConnected(true); console.log(' Socket.IO '); });\r\n  s.on('connect_error', (err: any) => { console.warn('Socket connect error, fallback to simulation', err?.message); if (!isConnected) startSimulation(); });\r\n      s.on('duel:update', (payload:any) => {\r\n        setMessages(prev => [...prev, { type:'sync_state', playerId: payload.player.id, data: payload, timestamp: Date.now() }]);\r\n        effectsBus.emit('duelState', { roomId: payload.roomId, players: { [payload.player.id]: { id: payload.player.id, score: payload.player.score, volts: payload.player.volts, streak: payload.player.streak } } });\r\n      });\r\n      s.on('duel:state', (payload:any) => {\r\n        setMessages(prev => [...prev, { type:'sync_state', playerId: player.id, data: payload, timestamp: Date.now() }]);\r\n        const players: any = {};\r\n        Object.values(payload.players || {}).forEach((p:any)=>{ players[p.id]={ id:p.id, score:p.score, volts:p.volts, streak:p.streak }; });\r\n        effectsBus.emit('duelState', { roomId: payload.roomId, players });\r\n      });\r\n    } catch (e) {\r\n      console.warn('Socket init failed, using simulation', e);\r\n      startSimulation();\r\n    }\r\n  }, [player.id, isConnected]);\r\n\r\n  const startSimulation = () => {\r\n    setTimeout(() => {\r\n      setIsConnected(true);\r\n      console.log('   ');\r\n      connectionRef.current = setInterval(() => {\r\n        if (messageQueueRef.current.length > 0) {\r\n          const message = messageQueueRef.current.shift();\r\n          if (message) setMessages(prev => [...prev, message]);\r\n        }\r\n      }, 100);\r\n    }, 600);\r\n  };\r\n\r\n  // \r\n  const disconnect = useCallback(() => {\r\n  if (connectionRef.current) { clearInterval(connectionRef.current); connectionRef.current = null; }\r\n  if (simulationIntervalRef.current) { clearInterval(simulationIntervalRef.current); simulationIntervalRef.current = null; }\r\n  socketRef.current?.disconnect();\r\n    if (aiIntervalRef.current) {\r\n      clearInterval(aiIntervalRef.current);\r\n      aiIntervalRef.current = null;\r\n    }\r\n    setIsConnected(false);\r\n    setCurrentRoom(null);\r\n    setOpponent(null);\r\n    setMessages([]);\r\n    console.log('    ');\r\n  }, []);\r\n\r\n  //  \r\n  const findDuel = useCallback(async (): Promise<DuelRoom> => {\r\n    if (!isConnected) {\r\n      throw new Error('   ');\r\n    }\r\n\r\n    console.log('  ...');\r\n    \r\n    //   \r\n    return new Promise((resolve) => {\r\n      setTimeout(() => {\r\n        const room: DuelRoom = {\r\n          id: `duel_${Date.now()}`,\r\n          players: [player.id, 'bot_opponent'],\r\n          status: 'waiting',\r\n          createdAt: Date.now()\r\n        };\r\n        \r\n        const botOpponent = {\r\n          id: 'bot_opponent',\r\n          name: ` ${Math.floor(Math.random() * 1000)}`,\r\n          level: Math.max(1, player.level - 2 + Math.floor(Math.random() * 5)),\r\n          volts: Math.floor(Math.random() * 500) + 100,\r\n          isReady: false,\r\n          score: 0,\r\n          streak: 0\r\n        };\r\n\r\n        setCurrentRoom(room);\r\n        setOpponent(botOpponent);\r\n        \r\n        console.log('  !', room);\r\n        resolve(room);\r\n      }, 2000 + Math.random() * 3000); // 2-5  \r\n    });\r\n  }, [isConnected, player.id, player.level]);\r\n\r\n  //  \r\n  const sendMessage = useCallback((message: Omit<DuelMessage, 'timestamp'>) => {\r\n    if (!isConnected || !currentRoom) {\r\n      console.warn('    :    ');\r\n      return;\r\n    }\r\n\r\n    const fullMessage: DuelMessage = {\r\n      ...message,\r\n      timestamp: Date.now()\r\n    };\r\n\r\n    console.log('  :', fullMessage);\r\n\r\n    //   \r\n    if (message.type === 'player_ready') {\r\n      setTimeout(() => {\r\n        messageQueueRef.current.push({\r\n          type: 'player_ready',\r\n          playerId: 'bot_opponent',\r\n          timestamp: Date.now()\r\n        });\r\n      }, 1000 + Math.random() * 2000);\r\n    }\r\n\r\n    if (message.type === 'player_action') {\r\n      //        -  \r\n      const now = Date.now();\r\n      const timeSinceLastAi = now - lastAiActionRef.current;\r\n      \r\n      //      2-4  ( )\r\n      if (timeSinceLastAi > 2000 && Math.random() < 0.3) {\r\n        lastAiActionRef.current = now;\r\n        setTimeout(() => {\r\n          const gotShocked = Math.random() < 0.25; // 25%   \r\n          if (gotShocked) {\r\n            messageQueueRef.current.push({\r\n              type: 'player_shocked',\r\n              playerId: 'bot_opponent',\r\n              data: { damage: 20 + Math.random() * 30 },\r\n              timestamp: Date.now()\r\n            });\r\n          } else {\r\n            messageQueueRef.current.push({\r\n              type: 'player_action',\r\n              playerId: 'bot_opponent',\r\n              data: {\r\n                points: Math.floor(Math.random() * 50) + 15, // 15-65 \r\n                volts: Math.floor(Math.random() * 30) + 10   // 10-40 \r\n              },\r\n              timestamp: Date.now()\r\n            });\r\n          }\r\n        }, 800 + Math.random() * 1500); // 0.8-2.3  \r\n      }\r\n    }\r\n  }, [isConnected, currentRoom]);\r\n\r\n  //   \r\n  const setReady = useCallback(() => {\r\n    sendMessage({\r\n      type: 'player_ready',\r\n      playerId: player.id\r\n    });\r\n    \r\n    //       \r\n    setTimeout(() => {\r\n      aiIntervalRef.current = setInterval(() => {\r\n        const now = Date.now();\r\n        const shouldAct = Math.random() < 0.4; // 40%    2-3 \r\n        \r\n        if (shouldAct) {\r\n          const gotShocked = Math.random() < 0.25; // 25%   \r\n          if (gotShocked) {\r\n            messageQueueRef.current.push({\r\n              type: 'player_shocked',\r\n              playerId: 'bot_opponent',\r\n              data: { damage: 20 + Math.random() * 30 },\r\n              timestamp: now\r\n            });\r\n          } else {\r\n            messageQueueRef.current.push({\r\n              type: 'player_action',\r\n              playerId: 'bot_opponent',\r\n              data: {\r\n                points: Math.floor(Math.random() * 50) + 15, // 15-65   \r\n                volts: Math.floor(Math.random() * 30) + 10   // 10-40 \r\n              },\r\n              timestamp: now\r\n            });\r\n          }\r\n        }\r\n      }, 2000 + Math.random() * 1500); //  2-3.5 \r\n    }, 3000); //   3   \r\n  }, [sendMessage, player.id]);\r\n\r\n  //  \r\n  const sendPlayerAction = useCallback((points: number, volts: number) => {\r\n    sendMessage({\r\n      type: 'player_action',\r\n      playerId: player.id,\r\n      data: { points, volts }\r\n    });\r\n  }, [sendMessage, player.id]);\r\n\r\n  //  \r\n  const sendPlayerShocked = useCallback((damage: number) => {\r\n    sendMessage({\r\n      type: 'player_shocked',\r\n      playerId: player.id,\r\n      data: { damage }\r\n    });\r\n  }, [sendMessage, player.id]);\r\n\r\n  //  \r\n  const leaveDuel = useCallback(() => {\r\n    if (currentRoom) {\r\n      sendMessage({\r\n        type: 'game_end',\r\n        playerId: player.id,\r\n        data: { reason: 'left' }\r\n      });\r\n    }\r\n    \r\n    //   \r\n    if (aiIntervalRef.current) {\r\n      clearInterval(aiIntervalRef.current);\r\n      aiIntervalRef.current = null;\r\n    }\r\n    \r\n    setCurrentRoom(null);\r\n    setOpponent(null);\r\n    setMessages([]);\r\n  }, [currentRoom, sendMessage, player.id]);\r\n\r\n  //   \r\n  useEffect(() => {\r\n    return () => {\r\n      disconnect();\r\n    };\r\n  }, [disconnect]);\r\n\r\n  return {\r\n    isConnected,\r\n    currentRoom,\r\n    opponent,\r\n    messages,\r\n    connect,\r\n    disconnect,\r\n    findDuel,\r\n    setReady,\r\n    sendPlayerAction,\r\n    sendPlayerShocked,\r\n    leaveDuel,\r\n    setOpponent //    \r\n  };\r\n};\r\n","import React, { useState, useEffect, useCallback } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useGameStore } from '../store/gameStore';\r\nimport { hapticManager } from '../utils/hapticManager';\r\nimport { useDuelConnection } from '../hooks/useDuelConnection';\r\n\r\ninterface DuelPlayer {\r\n  id: string;\r\n  name: string;\r\n  volts: number;\r\n  level: number;\r\n  isReady: boolean;\r\n  isAlive: boolean;\r\n  score: number;\r\n  streak: number;\r\n}\r\n\r\ninterface DuelState {\r\n  status: 'connecting' | 'searching' | 'found' | 'ready' | 'countdown' | 'playing' | 'finished';\r\n  timeLeft: number;\r\n  winner: string | null;\r\n  roundNumber: number;\r\n  maxRounds: number;\r\n}\r\n\r\nexport const DuelScreen: React.FC = () => {\r\n  const { player, endGame } = useGameStore();\r\n  const {\r\n    isConnected,\r\n    currentRoom,\r\n    opponent: connectedOpponent,\r\n    messages,\r\n    connect,\r\n    disconnect,\r\n    findDuel,\r\n    setReady,\r\n    sendPlayerAction,\r\n    sendPlayerShocked,\r\n    leaveDuel,\r\n    setOpponent\r\n  } = useDuelConnection();\r\n\r\n  const [duelState, setDuelState] = useState<DuelState>({\r\n    status: 'connecting',\r\n    timeLeft: 60,\r\n    winner: null,\r\n    roundNumber: 1,\r\n    maxRounds: 3\r\n  });\r\n\r\n  const [playerState, setPlayerState] = useState<DuelPlayer>({\r\n    id: player.id,\r\n    name: player.name,\r\n    volts: player.volts,\r\n    level: player.level,\r\n    isReady: false,\r\n    isAlive: true,\r\n    score: 0,\r\n    streak: 0\r\n  });\r\n\r\n  const [countdownTimer, setCountdownTimer] = useState<number>(0);\r\n  const [gameTimer, setGameTimer] = useState<number>(0);\r\n\r\n  //     \r\n  useEffect(() => {\r\n    connect();\r\n    return () => {\r\n      disconnect();\r\n    };\r\n  }, [connect, disconnect]);\r\n\r\n  //   \r\n  useEffect(() => {\r\n    if (isConnected && duelState.status === 'connecting') {\r\n      setDuelState(prev => ({ ...prev, status: 'searching' }));\r\n      findDuel().then(() => {\r\n        setDuelState(prev => ({ ...prev, status: 'found' }));\r\n        hapticManager.medium();\r\n      });\r\n    }\r\n  }, [isConnected, duelState.status, findDuel]);\r\n\r\n  //   \r\n  useEffect(() => {\r\n    const lastMessage = messages[messages.length - 1];\r\n    if (!lastMessage) return;\r\n\r\n    switch (lastMessage.type) {\r\n      case 'player_ready':\r\n        if (lastMessage.playerId !== player.id) {\r\n          setOpponent((prev: DuelPlayer | null) => prev ? { ...prev, isReady: true } : null);\r\n        }\r\n        break;\r\n\r\n      case 'player_action':\r\n        if (lastMessage.playerId !== player.id && connectedOpponent) {\r\n          const { points, volts } = lastMessage.data;\r\n          setOpponent((prev: DuelPlayer | null) => prev ? {\r\n            ...prev,\r\n            score: prev.score + points,\r\n            volts: prev.volts + volts,\r\n            streak: prev.streak + 1\r\n          } : null);\r\n        }\r\n        break;\r\n\r\n      case 'player_shocked':\r\n        if (lastMessage.playerId !== player.id && connectedOpponent) {\r\n          const { damage } = lastMessage.data;\r\n          setOpponent((prev: DuelPlayer | null) => prev ? {\r\n            ...prev,\r\n            volts: Math.max(0, prev.volts - damage),\r\n            streak: 0\r\n          } : null);\r\n        }\r\n        break;\r\n\r\n      case 'game_start':\r\n        setDuelState(prev => ({ ...prev, status: 'countdown' }));\r\n        setCountdownTimer(3);\r\n        break;\r\n\r\n      case 'game_end':\r\n        setDuelState(prev => ({ ...prev, status: 'finished' }));\r\n        break;\r\n    }\r\n  }, [messages, player.id, connectedOpponent, setOpponent]);\r\n\r\n  //    \r\n  useEffect(() => {\r\n    if (duelState.status === 'found' && \r\n        playerState.isReady && \r\n        connectedOpponent?.isReady) {\r\n      setDuelState(prev => ({ ...prev, status: 'countdown' }));\r\n      setCountdownTimer(3);\r\n    }\r\n  }, [duelState.status, playerState.isReady, connectedOpponent?.isReady]);\r\n\r\n  //    \r\n  useEffect(() => {\r\n    if (duelState.status === 'countdown' && countdownTimer > 0) {\r\n      const timer = setTimeout(() => {\r\n        setCountdownTimer(prev => prev - 1);\r\n        hapticManager.light();\r\n      }, 1000);\r\n\r\n      return () => clearTimeout(timer);\r\n    } else if (duelState.status === 'countdown' && countdownTimer === 0) {\r\n      setDuelState(prev => ({ ...prev, status: 'playing' }));\r\n      setGameTimer(duelState.timeLeft);\r\n      hapticManager.heavy();\r\n    }\r\n  }, [duelState.status, countdownTimer, duelState.timeLeft]);\r\n\r\n  //  \r\n  useEffect(() => {\r\n    if (duelState.status === 'playing' && gameTimer > 0) {\r\n      const timer = setTimeout(() => {\r\n        setGameTimer(prev => prev - 1);\r\n      }, 1000);\r\n\r\n      return () => clearTimeout(timer);\r\n    } else if (duelState.status === 'playing' && gameTimer === 0) {\r\n      //   -    \r\n      const winner = playerState.score > (connectedOpponent?.score || 0) ? playerState.id : \r\n                    (connectedOpponent?.score || 0) > playerState.score ? connectedOpponent?.id : null;\r\n      \r\n      setDuelState(prev => ({ \r\n        ...prev, \r\n        status: 'finished',\r\n        winner \r\n      }));\r\n    }\r\n  }, [duelState.status, gameTimer, playerState.score, connectedOpponent?.score]);\r\n\r\n  const handlePlayerReady = () => {\r\n    setPlayerState(prev => ({ ...prev, isReady: true }));\r\n    setReady();\r\n    hapticManager.medium();\r\n  };\r\n\r\n  const handlePlayerClick = useCallback(() => {\r\n    if (duelState.status !== 'playing') return;\r\n\r\n    //   \r\n    const points = Math.floor(Math.random() * 80) + 20;\r\n    const gotShocked = Math.random() < 0.25; // 25%   \r\n\r\n    if (gotShocked) {\r\n      const damage = 30;\r\n      setPlayerState(prev => ({\r\n        ...prev,\r\n        volts: Math.max(0, prev.volts - damage),\r\n        streak: 0\r\n      }));\r\n      sendPlayerShocked(damage);\r\n      hapticManager.heavy();\r\n    } else {\r\n      setPlayerState(prev => ({\r\n        ...prev,\r\n        score: prev.score + points,\r\n        volts: prev.volts + points,\r\n        streak: prev.streak + 1\r\n      }));\r\n      sendPlayerAction(points, points);\r\n      hapticManager.light();\r\n    }\r\n  }, [duelState.status, sendPlayerAction, sendPlayerShocked]);\r\n\r\n  const handleBackToMenu = () => {\r\n    hapticManager.light();\r\n    leaveDuel();\r\n    endGame();\r\n  };\r\n\r\n  const getStatusText = () => {\r\n    switch (duelState.status) {\r\n      case 'connecting': return '  ...';\r\n      case 'searching': return ' ...';\r\n      case 'found': return ' !';\r\n      case 'ready': return '!';\r\n      case 'countdown': return `  ${countdownTimer}`;\r\n      case 'playing': return `: ${gameTimer}`;\r\n      case 'finished': \r\n        if (!duelState.winner) return '!';\r\n        return duelState.winner === playerState.id ? '!' : '';\r\n      default: return '';\r\n    }\r\n  };\r\n\r\n  const getConnectionStatus = () => {\r\n    if (!isConnected) return '  ';\r\n    if (!currentRoom) return ' ';\r\n    return '  ';\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-background-dark to-background-darker\">\r\n      {/* Header */}\r\n      <div className=\"bg-black/40 border-b border-white/10 p-4\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <button\r\n            onClick={handleBackToMenu}\r\n            className=\"text-gray-400 hover:text-white transition-colors\"\r\n          >\r\n             \r\n          </button>\r\n          <h1 className=\"text-xl font-bold text-primary-orange\">  REAL-TIME</h1>\r\n          <div className=\"text-sm text-gray-400\">\r\n            {getConnectionStatus()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Status Bar */}\r\n      <div className=\"bg-black/30 p-4 text-center\">\r\n        <motion.div\r\n          className=\"text-2xl font-bold text-white\"\r\n          animate={{ scale: duelState.status === 'countdown' ? [1, 1.2, 1] : 1 }}\r\n          transition={{ duration: 0.5, repeat: duelState.status === 'countdown' ? Infinity : 0 }}\r\n        >\r\n          {getStatusText()}\r\n        </motion.div>\r\n        {currentRoom && (\r\n          <div className=\"text-sm text-gray-400 mt-2\">\r\n            : {currentRoom.id.slice(-8)}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Players Comparison */}\r\n      {(duelState.status === 'found' || duelState.status === 'ready' || \r\n        duelState.status === 'countdown' || duelState.status === 'playing' || \r\n        duelState.status === 'finished') && connectedOpponent && (\r\n        <div className=\"flex justify-between items-center p-4 bg-black/20\">\r\n          {/* Player */}\r\n          <motion.div \r\n            className=\"glass-effect p-4 rounded-xl flex-1 mr-2\"\r\n            animate={{ \r\n              borderColor: playerState.isReady ? '#10B981' : '#6B7280',\r\n              boxShadow: playerState.streak > 0 ? '0 0 20px #10B981' : 'none'\r\n            }}\r\n          >\r\n            <div className=\"text-center\">\r\n              <div className=\"text-lg font-bold text-green-400\">{playerState.name}</div>\r\n              <div className=\"text-sm text-gray-300\"> {playerState.level}</div>\r\n              <div className=\"text-2xl font-bold text-white mt-2\">{playerState.score}</div>\r\n              <div className=\"text-xs text-gray-400\"></div>\r\n              <div className=\"text-sm text-yellow-400 mt-1\">\r\n                : {playerState.streak}\r\n              </div>\r\n              <div className=\"text-sm text-blue-400\">\r\n                {playerState.volts}\r\n              </div>\r\n              {playerState.isReady && (\r\n                <div className=\"text-xs text-green-400 mt-1\"> </div>\r\n              )}\r\n            </div>\r\n          </motion.div>\r\n\r\n          {/* VS */}\r\n          <div className=\"px-4\">\r\n            <div className=\"text-3xl font-bold text-red-400\">VS</div>\r\n          </div>\r\n\r\n          {/* Opponent */}\r\n          <motion.div \r\n            className=\"glass-effect p-4 rounded-xl flex-1 ml-2\"\r\n            animate={{ \r\n              borderColor: connectedOpponent.isReady ? '#10B981' : '#6B7280',\r\n              boxShadow: connectedOpponent.streak > 0 ? '0 0 20px #EF4444' : 'none'\r\n            }}\r\n          >\r\n            <div className=\"text-center\">\r\n              <div className=\"text-lg font-bold text-red-400\">{connectedOpponent.name}</div>\r\n              <div className=\"text-sm text-gray-300\"> {connectedOpponent.level}</div>\r\n              <div className=\"text-2xl font-bold text-white mt-2\">{connectedOpponent.score}</div>\r\n              <div className=\"text-xs text-gray-400\"></div>\r\n              <div className=\"text-sm text-yellow-400 mt-1\">\r\n                : {connectedOpponent.streak}\r\n              </div>\r\n              <div className=\"text-sm text-blue-400\">\r\n                {connectedOpponent.volts}\r\n              </div>\r\n              {connectedOpponent.isReady && (\r\n                <div className=\"text-xs text-green-400 mt-1\"> </div>\r\n              )}\r\n            </div>\r\n          </motion.div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Game Area */}\r\n      <div className=\"flex-1 flex flex-col items-center justify-center p-4\">\r\n        <AnimatePresence mode=\"wait\">\r\n          {(duelState.status === 'connecting' || duelState.status === 'searching') && (\r\n            <motion.div\r\n              key=\"searching\"\r\n              initial={{ opacity: 0, scale: 0.8 }}\r\n              animate={{ opacity: 1, scale: 1 }}\r\n              exit={{ opacity: 0, scale: 0.8 }}\r\n              className=\"text-center\"\r\n            >\r\n              <div className=\"text-6xl mb-4\">\r\n                {duelState.status === 'connecting' ? '' : ''}\r\n              </div>\r\n              <div className=\"text-xl text-gray-300 mb-4\">\r\n                {duelState.status === 'connecting' \r\n                  ? '  ...' \r\n                  : '  ...'}\r\n              </div>\r\n              <div className=\"animate-spin text-4xl\"></div>\r\n            </motion.div>\r\n          )}\r\n\r\n          {duelState.status === 'found' && (\r\n            <motion.div\r\n              key=\"found\"\r\n              initial={{ opacity: 0, y: 20 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              exit={{ opacity: 0, y: -20 }}\r\n              className=\"text-center\"\r\n            >\r\n              <div className=\"text-6xl mb-4\"></div>\r\n              <div className=\"text-xl text-white mb-6\"> !</div>\r\n              <div className=\"text-lg text-gray-300 mb-4\">\r\n                {connectedOpponent?.name} ( {connectedOpponent?.level})\r\n              </div>\r\n              <motion.button\r\n                onClick={handlePlayerReady}\r\n                disabled={playerState.isReady}\r\n                className={`px-8 py-4 rounded-xl font-bold text-lg transition-colors ${\r\n                  playerState.isReady \r\n                    ? 'bg-green-600 text-white cursor-default' \r\n                    : 'bg-orange-600 hover:bg-orange-500 text-white'\r\n                }`}\r\n                whileHover={{ scale: playerState.isReady ? 1 : 1.05 }}\r\n                whileTap={{ scale: playerState.isReady ? 1 : 0.95 }}\r\n              >\r\n                {playerState.isReady ? ' !  ...' : '  !'}\r\n              </motion.button>\r\n            </motion.div>\r\n          )}\r\n\r\n          {duelState.status === 'countdown' && (\r\n            <motion.div\r\n              key=\"countdown\"\r\n              initial={{ opacity: 0, scale: 2 }}\r\n              animate={{ opacity: 1, scale: 1 }}\r\n              exit={{ opacity: 0, scale: 0 }}\r\n              className=\"text-center\"\r\n            >\r\n              <motion.div\r\n                className=\"text-9xl font-bold text-red-400\"\r\n                animate={{ scale: [1, 1.2, 1] }}\r\n                transition={{ duration: 0.5 }}\r\n              >\r\n                {countdownTimer || ''}\r\n              </motion.div>\r\n            </motion.div>\r\n          )}\r\n\r\n          {duelState.status === 'playing' && (\r\n            <motion.div\r\n              key=\"playing\"\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n              className=\"w-full max-w-md\"\r\n            >\r\n              <div \r\n                className=\"w-full h-48 bg-orange-500 rounded-lg cursor-pointer flex items-center justify-center hover:bg-orange-600 transition-colors\"\r\n                onClick={handlePlayerClick}\r\n              >\r\n                <span className=\"text-white text-2xl font-bold\">  </span>\r\n              </div>\r\n              <div className=\"text-center mt-4 text-white\">\r\n                 Real-time !  ! \r\n              </div>\r\n              <div className=\"text-center mt-2 text-gray-400 text-sm\">\r\n                : {gameTimer} |  : {playerState.score} | : {connectedOpponent?.score || 0}\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n\r\n          {duelState.status === 'finished' && (\r\n            <motion.div\r\n              key=\"finished\"\r\n              initial={{ opacity: 0, scale: 0.8 }}\r\n              animate={{ opacity: 1, scale: 1 }}\r\n              exit={{ opacity: 0, scale: 0.8 }}\r\n              className=\"text-center\"\r\n            >\r\n              <div className=\"text-6xl mb-4\">\r\n                {duelState.winner === playerState.id ? '' : \r\n                 duelState.winner === connectedOpponent?.id ? '' : ''}\r\n              </div>\r\n              <div className=\"text-3xl font-bold text-white mb-4\">\r\n                {getStatusText()}\r\n              </div>\r\n              <div className=\"text-lg text-gray-300 mb-6\">\r\n                 : {playerState.score} - {connectedOpponent?.score || 0}\r\n              </div>\r\n              {duelState.winner === playerState.id && (\r\n                <div className=\"text-green-400 text-lg mb-4\">\r\n                  +{Math.floor(playerState.score * 0.1)}   !\r\n                </div>\r\n              )}\r\n              <motion.button\r\n                onClick={handleBackToMenu}\r\n                className=\"px-8 py-4 bg-orange-600 hover:bg-orange-500 text-white rounded-xl font-bold text-lg transition-colors\"\r\n                whileHover={{ scale: 1.05 }}\r\n                whileTap={{ scale: 0.95 }}\r\n              >\r\n                  \r\n              </motion.button>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { useGameStore } from '../store/gameStore';\r\nimport { useTelegram } from './TelegramProvider';\r\nimport { hapticManager } from '../utils/hapticManager';\r\n\r\ninterface TelegramContact {\r\n  id: number;\r\n  firstName: string;\r\n  lastName?: string;\r\n  username?: string;\r\n  photoUrl?: string;\r\n  level?: number;\r\n  totalGames?: number;\r\n  wins?: number;\r\n}\r\n\r\ninterface DuelInvite {\r\n  id: string;\r\n  fromUserId: number;\r\n  toUserId: number;\r\n  status: 'pending' | 'accepted' | 'declined' | 'expired';\r\n  createdAt: number;\r\n  expiresAt: number;\r\n}\r\n\r\nexport const DuelInviteScreen: React.FC = () => {\r\n  const { player, goToMenu } = useGameStore();\r\n  const { webApp, user, isInTelegram } = useTelegram();\r\n  const [contacts, setContacts] = useState<TelegramContact[]>([]);\r\n  const [pendingInvites, setPendingInvites] = useState<DuelInvite[]>([]);\r\n  const [selectedContact, setSelectedContact] = useState<TelegramContact | null>(null);\r\n  const [inviteStatus, setInviteStatus] = useState<'idle' | 'sending' | 'sent' | 'waiting'>('idle');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  //       \r\n  useEffect(() => {\r\n    if (isInTelegram && webApp && user) {\r\n      loadRealPlayers(user.id);\r\n    } else {\r\n      setContacts([]);\r\n    }\r\n  }, [isInTelegram, webApp, user]);\r\n\r\n  const loadRealPlayers = async (userId: number) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const response = await fetch(`http://localhost:3001/api/duels/players/${userId}`);\r\n      const data = await response.json();\r\n      \r\n      if (data.success) {\r\n        setContacts(data.players);\r\n        console.log(`  ${data.players.length}  `);\r\n      } else {\r\n        console.error('  :', data.error);\r\n        setContacts([]);\r\n      }\r\n    } catch (error) {\r\n      console.error('  :', error);\r\n      setContacts([]);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const sendDuelInvite = async (contact: TelegramContact) => {\r\n    if (!isInTelegram || !webApp || !user) {\r\n      alert('    Telegram!');\r\n      return;\r\n    }\r\n\r\n    setInviteStatus('sending');\r\n    hapticManager.medium();\r\n\r\n    try {\r\n      const response = await fetch('http://localhost:3001/api/duels/invite', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          fromUserId: user.id,\r\n          toUserId: contact.id,\r\n          message: `${user.first_name} ( ${player.level})    !`\r\n        })\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (result.success) {\r\n        const invite: DuelInvite = {\r\n          id: result.duelId,\r\n          fromUserId: user.id,\r\n          toUserId: contact.id,\r\n          status: 'pending',\r\n          createdAt: Date.now(),\r\n          expiresAt: Date.now() + (5 * 60 * 1000)\r\n        };\r\n\r\n        setPendingInvites(prev => [...prev, invite]);\r\n        setInviteStatus('sent');\r\n\r\n        if (webApp.showAlert) {\r\n          webApp.showAlert(`  ${contact.firstName}!  ...`);\r\n        }\r\n\r\n        setTimeout(() => {\r\n          setInviteStatus('waiting');\r\n        }, 2000);\r\n      } else {\r\n        throw new Error(result.error || '  ');\r\n      }\r\n    } catch (error) {\r\n      console.error('  :', error);\r\n      setInviteStatus('idle');\r\n      \r\n      if (webApp?.showAlert) {\r\n        webApp.showAlert('  .   .');\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleContactSelect = (contact: TelegramContact) => {\r\n    setSelectedContact(contact);\r\n    hapticManager.light();\r\n  };\r\n\r\n  const handleSendInvite = () => {\r\n    if (selectedContact) {\r\n      sendDuelInvite(selectedContact);\r\n    }\r\n  };\r\n\r\n  const handleBackToMenu = () => {\r\n    hapticManager.light();\r\n    goToMenu();\r\n  };\r\n\r\n  const getContactDisplayName = (contact: TelegramContact) => {\r\n    const fullName = contact.lastName \r\n      ? `${contact.firstName} ${contact.lastName}`\r\n      : contact.firstName;\r\n    \r\n    return contact.username ? `${fullName} (@${contact.username})` : fullName;\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-background-dark to-background-darker\">\r\n      {/* Header */}\r\n      <div className=\"bg-black/40 border-b border-white/10 p-4\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <button\r\n            onClick={handleBackToMenu}\r\n            className=\"text-gray-400 hover:text-white transition-colors\"\r\n          >\r\n             \r\n          </button>\r\n          <h1 className=\"text-white text-xl font-bold\">   </h1>\r\n          <div></div>\r\n        </div>\r\n\r\n        {/*   -Telegram  */}\r\n        {!isInTelegram && (\r\n          <div className=\"text-sm text-yellow-400 mt-2 text-center\">\r\n                  Telegram\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/*   */}\r\n      <div className=\"p-4\">\r\n        {isInTelegram ? (\r\n          <>\r\n            <div className=\"text-white text-lg mb-4 font-bold\">\r\n                :\r\n            </div>\r\n            \r\n            {isLoading ? (\r\n              <div className=\"text-center py-8\">\r\n                <div className=\"animate-spin text-orange-400 text-4xl mb-4\"></div>\r\n                <div className=\"text-gray-400\"> ...</div>\r\n              </div>\r\n            ) : contacts.length > 0 ? (\r\n              <div className=\"space-y-3\">\r\n                {contacts.map((contact) => (\r\n                  <motion.div\r\n                    key={contact.id}\r\n                    className={`glass-effect p-4 rounded-xl cursor-pointer transition-all ${\r\n                      selectedContact?.id === contact.id \r\n                        ? 'border-2 border-green-400 bg-green-400/10' \r\n                        : 'border border-white/20 hover:border-orange-400'\r\n                    }`}\r\n                    onClick={() => handleContactSelect(contact)}\r\n                    whileHover={{ scale: 1.02 }}\r\n                    whileTap={{ scale: 0.98 }}\r\n                  >\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <div className=\"w-12 h-12 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center text-white font-bold text-lg\">\r\n                          {contact.firstName.charAt(0)}\r\n                        </div>\r\n                        <div>\r\n                          <div className=\"text-white font-medium\">\r\n                            {getContactDisplayName(contact)}\r\n                          </div>\r\n                          <div className=\"text-gray-400 text-sm\">\r\n                             {contact.level || 1}  : {contact.wins || 0}/{contact.totalGames || 0}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      \r\n                      {selectedContact?.id === contact.id && (\r\n                        <div className=\"text-green-400 text-2xl\"></div>\r\n                      )}\r\n                    </div>\r\n                  </motion.div>\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center text-gray-400 py-8\">\r\n                <div className=\"text-4xl mb-4\"></div>\r\n                <div className=\"text-lg mb-2\">  </div>\r\n                <div className=\"text-sm\">\r\n                        !\r\n                </div>\r\n              </div>\r\n            )}\r\n          </>\r\n        ) : (\r\n          <div className=\"text-center py-12\">\r\n            <div className=\"text-6xl mb-4\"></div>\r\n            <div className=\"text-xl text-white mb-4\">   Telegram</div>\r\n            <div className=\"text-gray-400 mb-6\">\r\n                    Telegram\r\n            </div>\r\n            <a \r\n              href=\"https://orspiritus.github.io/tigerrosette/\"\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n              className=\"bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors\"\r\n            >\r\n                 Telegram\r\n            </a>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/*    */}\r\n      {selectedContact && inviteStatus === 'idle' && (\r\n        <div className=\"fixed bottom-6 left-4 right-4\">\r\n          <motion.button\r\n            onClick={handleSendInvite}\r\n            className=\"w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-4 rounded-xl font-bold text-lg\"\r\n            whileHover={{ scale: 1.02 }}\r\n            whileTap={{ scale: 0.98 }}\r\n            initial={{ opacity: 0, y: 50 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n          >\r\n                 {selectedContact.firstName}\r\n          </motion.button>\r\n        </div>\r\n      )}\r\n\r\n      {/*   */}\r\n      {inviteStatus === 'waiting' && (\r\n        <div className=\"fixed bottom-6 left-4 right-4\">\r\n          <div className=\"bg-black/60 backdrop-blur-sm rounded-xl p-4 text-center\">\r\n            <div className=\"text-white text-lg mb-2\">  ...</div>\r\n            <div className=\"text-gray-400 text-sm\">\r\n                5 \r\n            </div>\r\n            <div className=\"mt-3\">\r\n              <div className=\"animate-pulse text-orange-400\"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/*   */}\r\n      {pendingInvites.length > 0 && (\r\n        <div className=\"p-4 mt-4\">\r\n          <div className=\"text-white text-lg mb-3 font-bold\">\r\n              :\r\n          </div>\r\n          {pendingInvites.map((invite) => {\r\n            const contact = contacts.find(c => c.id === invite.toUserId);\r\n            const timeLeft = Math.max(0, invite.expiresAt - Date.now());\r\n            const minutesLeft = Math.floor(timeLeft / 60000);\r\n            \r\n            return (\r\n              <div key={invite.id} className=\"glass-effect p-3 rounded-lg mb-2\">\r\n                <div className=\"text-white\">\r\n                  {contact ? getContactDisplayName(contact) : ' '}\r\n                </div>\r\n                <div className=\"text-sm text-gray-400\">\r\n                  : {invite.status}  : {minutesLeft}\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { useGameStore } from '../store/gameStore';\r\nimport { useTelegram } from './TelegramProvider';\r\nimport { hapticManager } from '../utils/hapticManager';\r\n\r\ninterface IncomingDuelInvite {\r\n  id: string;\r\n  fromUserId: number;\r\n  fromUserName: string;\r\n  fromUserLevel: number;\r\n  message: string;\r\n  receivedAt: number;\r\n  expiresAt: number;\r\n}\r\n\r\nexport const DuelInviteReceiver: React.FC = () => {\r\n  const { player, startMultiplayerMode } = useGameStore();\r\n  const { webApp, user, isInTelegram } = useTelegram();\r\n  const [incomingInvites, setIncomingInvites] = useState<IncomingDuelInvite[]>([]);\r\n  const [respondingTo, setRespondingTo] = useState<string | null>(null);\r\n\r\n  //   \r\n  useEffect(() => {\r\n    if (isInTelegram && webApp) {\r\n      //  URL    \r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      const inviteId = urlParams.get('duel') || urlParams.get('duel_invite');\r\n      \r\n      console.log(' URL parameters:', window.location.search);\r\n      console.log(' Duel ID found:', inviteId);\r\n      \r\n      if (inviteId) {\r\n        console.log(' Found duel ID in URL, fetching duel info...');\r\n        fetchDuelInfo(inviteId);\r\n      }\r\n\r\n      //         WebApp\r\n      console.log('   ...');\r\n    }\r\n  }, [isInTelegram, webApp]);\r\n\r\n  // Fetch real duel information from backend\r\n  const fetchDuelInfo = async (duelId: string) => {\r\n    try {\r\n      console.log(' Fetching duel info for ID:', duelId);\r\n      const response = await fetch(`http://localhost:3001/api/duels/info/${duelId}`);\r\n      const data = await response.json();\r\n      \r\n      if (data.success && data.duel) {\r\n        console.log(' Duel info received:', data.duel);\r\n        const duelInfo = data.duel;\r\n        \r\n        // Create incoming invite from real duel data\r\n        const realInvite = {\r\n          id: duelId,\r\n          fromUserId: duelInfo.player1_id,\r\n          fromUserName: duelInfo.fromUser?.firstName || '',\r\n          fromUserLevel: duelInfo.fromUser?.level || 1,\r\n          message: `    ${duelInfo.fromUser?.firstName || ''}!`,\r\n          receivedAt: Date.now(),\r\n          expiresAt: new Date(duelInfo.expires_at).getTime()\r\n        };\r\n        \r\n        handleIncomingInvite(realInvite);\r\n      } else {\r\n        console.error(' Failed to fetch duel info:', data.error);\r\n        // Fallback to mock data if backend call fails\r\n        const fallbackInvite = {\r\n          id: duelId,\r\n          fromUserId: 12345,\r\n          fromUserName: '',\r\n          fromUserLevel: 1,\r\n          message: '  !',\r\n          receivedAt: Date.now(),\r\n          expiresAt: Date.now() + (5 * 60 * 1000)\r\n        };\r\n        handleIncomingInvite(fallbackInvite);\r\n      }\r\n    } catch (error) {\r\n      console.error(' Error fetching duel info:', error);\r\n      // Fallback to mock data if request fails\r\n      const fallbackInvite = {\r\n        id: duelId,\r\n        fromUserId: 12345,\r\n        fromUserName: '',\r\n        fromUserLevel: 1,\r\n        message: '  !',\r\n        receivedAt: Date.now(),\r\n        expiresAt: Date.now() + (5 * 60 * 1000)\r\n      };\r\n      handleIncomingInvite(fallbackInvite);\r\n    }\r\n  };\r\n\r\n  const handleIncomingInvite = (invite: any) => {\r\n    const newInvite: IncomingDuelInvite = {\r\n      id: invite.inviteId || invite.id,\r\n      fromUserId: invite.fromUser?.id || invite.fromUserId,\r\n      fromUserName: invite.fromUser?.name || invite.fromUserName,\r\n      fromUserLevel: invite.fromUser?.level || invite.fromUserLevel,\r\n      message: invite.message,\r\n      receivedAt: Date.now(),\r\n      expiresAt: Date.now() + (5 * 60 * 1000) // 5   \r\n    };\r\n\r\n    setIncomingInvites(prev => [...prev, newInvite]);\r\n    \r\n    //  \r\n    if (webApp?.showAlert) {\r\n      webApp.showAlert(`      ${newInvite.fromUserName}!`);\r\n    }\r\n    \r\n    // \r\n    hapticManager.heavy();\r\n  };\r\n\r\n  const respondToInvite = async (invite: IncomingDuelInvite, accept: boolean) => {\r\n    setRespondingTo(invite.id);\r\n    hapticManager.medium();\r\n\r\n    try {\r\n      if (accept) {\r\n        //  \r\n        if (webApp?.sendData) {\r\n          const response = {\r\n            type: 'duel_response',\r\n            inviteId: invite.id,\r\n            accepted: true,\r\n            fromUserId: user?.id,\r\n            fromUserName: user?.first_name,\r\n            fromUserLevel: player.level\r\n          };\r\n          \r\n          webApp.sendData(JSON.stringify(response));\r\n        }\r\n\r\n        //  \r\n        if (webApp?.showAlert) {\r\n          webApp.showAlert(` !     ${invite.fromUserName}...`);\r\n        }\r\n\r\n        //    \r\n        setIncomingInvites(prev => prev.filter(inv => inv.id !== invite.id));\r\n        \r\n        //   \r\n        setTimeout(() => {\r\n          startMultiplayerMode('duel');\r\n        }, 2000);\r\n\r\n      } else {\r\n        //  \r\n        if (webApp?.sendData) {\r\n          const response = {\r\n            type: 'duel_response',\r\n            inviteId: invite.id,\r\n            accepted: false,\r\n            fromUserId: user?.id\r\n          };\r\n          \r\n          webApp.sendData(JSON.stringify(response));\r\n        }\r\n\r\n        //  \r\n        if (webApp?.showAlert) {\r\n          webApp.showAlert(`  ${invite.fromUserName} .`);\r\n        }\r\n\r\n        //    \r\n        setIncomingInvites(prev => prev.filter(inv => inv.id !== invite.id));\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('   :', error);\r\n    } finally {\r\n      setRespondingTo(null);\r\n    }\r\n  };\r\n\r\n  //    \r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      const now = Date.now();\r\n      setIncomingInvites(prev => prev.filter(invite => invite.expiresAt > now));\r\n    }, 30000); //   30 \r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  if (incomingInvites.length === 0) {\r\n    return null; //      \r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\r\n      <motion.div\r\n        className=\"bg-gradient-to-br from-gray-900 to-black rounded-2xl p-6 max-w-md w-full border border-orange-400/30\"\r\n        initial={{ scale: 0.8, opacity: 0 }}\r\n        animate={{ scale: 1, opacity: 1 }}\r\n        exit={{ scale: 0.8, opacity: 0 }}\r\n      >\r\n        <div className=\"text-center mb-6\">\r\n          <div className=\"text-4xl mb-2\"></div>\r\n          <h2 className=\"text-2xl font-bold text-white mb-2\">  !</h2>\r\n          <div className=\"text-orange-400 text-sm\">\r\n            {incomingInvites.length}  \r\n          </div>\r\n        </div>\r\n\r\n        {incomingInvites.map((invite) => {\r\n          const timeLeft = Math.max(0, invite.expiresAt - Date.now());\r\n          const minutesLeft = Math.floor(timeLeft / 60000);\r\n          const secondsLeft = Math.floor((timeLeft % 60000) / 1000);\r\n\r\n          return (\r\n            <motion.div\r\n              key={invite.id}\r\n              className=\"bg-black/40 rounded-xl p-4 mb-4 border border-white/10\"\r\n              initial={{ x: -20, opacity: 0 }}\r\n              animate={{ x: 0, opacity: 1 }}\r\n            >\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <div>\r\n                  <div className=\"text-white font-bold text-lg\">\r\n                    {invite.fromUserName}\r\n                  </div>\r\n                  <div className=\"text-gray-400 text-sm\">\r\n                     {invite.fromUserLevel}\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-right\">\r\n                  <div className=\"text-orange-400 text-sm font-medium\">\r\n                     {minutesLeft}:{secondsLeft.toString().padStart(2, '0')}\r\n                  </div>\r\n                  <div className=\"text-gray-500 text-xs\"> </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"text-gray-300 text-sm mb-4 bg-black/20 rounded-lg p-3\">\r\n                   60 <br/>\r\n                  ,    <br/>\r\n                   !\r\n              </div>\r\n\r\n              <div className=\"flex space-x-3\">\r\n                <motion.button\r\n                  onClick={() => respondToInvite(invite, false)}\r\n                  disabled={respondingTo === invite.id}\r\n                  className=\"flex-1 bg-gray-600 hover:bg-gray-500 text-white py-3 px-4 rounded-xl font-medium transition-colors disabled:opacity-50\"\r\n                  whileHover={{ scale: 1.02 }}\r\n                  whileTap={{ scale: 0.98 }}\r\n                >\r\n                  {respondingTo === invite.id ? '...' : ' '}\r\n                </motion.button>\r\n                \r\n                <motion.button\r\n                  onClick={() => respondToInvite(invite, true)}\r\n                  disabled={respondingTo === invite.id}\r\n                  className=\"flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-400 hover:to-emerald-400 text-white py-3 px-4 rounded-xl font-medium transition-all disabled:opacity-50\"\r\n                  whileHover={{ scale: 1.02 }}\r\n                  whileTap={{ scale: 0.98 }}\r\n                >\r\n                  {respondingTo === invite.id ? ' ...' : ' '}\r\n                </motion.button>\r\n              </div>\r\n            </motion.div>\r\n          );\r\n        })}\r\n\r\n        <div className=\"text-center text-gray-400 text-xs mt-4\">\r\n               5 \r\n        </div>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { LevelConfig } from '../utils/levelSystem';\r\nimport { getOutletImageByLevel } from '../utils/levelSystem';\r\nimport { hapticManager } from '../utils/hapticManager';\r\n\r\ninterface LevelUpNotificationProps {\r\n  isVisible: boolean;\r\n  newLevel: LevelConfig;\r\n  voltsReward: number;\r\n  onClose: () => void;\r\n}\r\n\r\nexport const LevelUpNotification: React.FC<LevelUpNotificationProps> = ({\r\n  isVisible,\r\n  newLevel,\r\n  voltsReward,\r\n  onClose\r\n}) => {\r\n  //     \r\n  useEffect(() => {\r\n    if (isVisible) {\r\n      hapticManager.levelUp();\r\n    }\r\n  }, [isVisible]);\r\n  \r\n  // Check if outlet image changed with this level\r\n  if (!newLevel || !newLevel.level) {\r\n    if (isVisible) {\r\n      console.warn('LevelUpNotification: newLevel is invalid', newLevel);\r\n    }\r\n    return null;\r\n  }\r\n  \r\n  const newOutletImage = getOutletImageByLevel(newLevel.level);\r\n  const previousOutletImage = getOutletImageByLevel(newLevel.level - 1);\r\n  const outletImageChanged = newOutletImage !== previousOutletImage;\r\n  return (\r\n    <AnimatePresence>\r\n      {isVisible && (\r\n        <motion.div\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: 1 }}\r\n          exit={{ opacity: 0 }}\r\n          className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50\"\r\n          onClick={onClose}\r\n        >\r\n          <motion.div\r\n            initial={{ scale: 0.5, opacity: 0, rotateY: -90 }}\r\n            animate={{ scale: 1, opacity: 1, rotateY: 0 }}\r\n            exit={{ scale: 0.5, opacity: 0, rotateY: 90 }}\r\n            transition={{ \r\n              type: \"spring\", \r\n              stiffness: 300, \r\n              damping: 20,\r\n              duration: 0.6 \r\n            }}\r\n            className=\"glass-effect p-8 max-w-md mx-4 text-center relative overflow-hidden\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            {/* Background sparkles */}\r\n            <div className=\"absolute inset-0 pointer-events-none\">\r\n              {[...Array(20)].map((_, i) => (\r\n                <motion.div\r\n                  key={i}\r\n                  className=\"absolute w-1 h-1 bg-yellow-300 rounded-full\"\r\n                  style={{\r\n                    left: `${Math.random() * 100}%`,\r\n                    top: `${Math.random() * 100}%`,\r\n                  }}\r\n                  animate={{\r\n                    opacity: [0, 1, 0],\r\n                    scale: [0, 1, 0],\r\n                  }}\r\n                  transition={{\r\n                    duration: 2,\r\n                    repeat: Infinity,\r\n                    delay: Math.random() * 2,\r\n                  }}\r\n                />\r\n              ))}\r\n            </div>\r\n\r\n            {/* Level up content */}\r\n            <motion.div\r\n              animate={{\r\n                scale: [1, 1.1, 1],\r\n              }}\r\n              transition={{\r\n                duration: 0.6,\r\n                delay: 0.3,\r\n              }}\r\n            >\r\n              <div className=\"text-6xl mb-4\"></div>\r\n              \r\n              <motion.h2 \r\n                className=\"text-3xl font-bold text-primary-orange mb-2\"\r\n                animate={{ \r\n                  textShadow: [\r\n                    \"0 0 10px rgba(255, 107, 53, 0.5)\",\r\n                    \"0 0 20px rgba(255, 107, 53, 0.8)\",\r\n                    \"0 0 10px rgba(255, 107, 53, 0.5)\"\r\n                  ]\r\n                }}\r\n                transition={{ duration: 1.5, repeat: Infinity }}\r\n              >\r\n                 !\r\n              </motion.h2>\r\n              \r\n              <div className=\"mb-4\">\r\n                <div className=\"text-5xl font-bold text-accent-blue mb-2\">\r\n                  {newLevel.level}\r\n                </div>\r\n                <div className=\"text-xl text-yellow-300 font-semibold mb-1\">\r\n                  {newLevel.title}\r\n                </div>\r\n                <div className=\"text-sm text-gray-300 italic\">\r\n                  {newLevel.description}\r\n                </div>\r\n              </div>\r\n\r\n              <motion.div \r\n                className=\"glass-effect p-4 rounded-lg bg-gradient-to-r from-yellow-500/20 to-orange-500/20\"\r\n                animate={{ \r\n                  boxShadow: [\r\n                    \"0 0 20px rgba(255, 193, 7, 0.3)\",\r\n                    \"0 0 30px rgba(255, 193, 7, 0.6)\",\r\n                    \"0 0 20px rgba(255, 193, 7, 0.3)\"\r\n                  ]\r\n                }}\r\n                transition={{ duration: 2, repeat: Infinity }}\r\n              >\r\n                <div className=\"text-lg font-bold text-yellow-300 mb-1\">\r\n                    :\r\n                </div>\r\n                <div className=\"text-2xl font-bold text-white\">\r\n                  +{voltsReward} \r\n                </div>\r\n                \r\n                {/* Show outlet upgrade notification */}\r\n                {outletImageChanged && (\r\n                  <div className=\"mt-3 pt-3 border-t border-yellow-400/30\">\r\n                    <div className=\"text-sm font-bold text-blue-300 mb-2\">\r\n                         !\r\n                    </div>\r\n                    <div className=\"flex items-center justify-center space-x-4\">\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-xs text-gray-400\">:</div>\r\n                        <img \r\n                          src={previousOutletImage} \r\n                          alt=\" \"\r\n                          className=\"w-8 h-8 rounded border border-gray-600\"\r\n                        />\r\n                      </div>\r\n                      <div className=\"text-yellow-400\"></div>\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-xs text-gray-400\">:</div>\r\n                        <img \r\n                          src={newOutletImage} \r\n                          alt=\" \"\r\n                          className=\"w-8 h-8 rounded border border-blue-400\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </motion.div>\r\n            </motion.div>\r\n\r\n            {/* Close button */}\r\n            <motion.button\r\n              onClick={onClose}\r\n              className=\"mt-6 px-6 py-3 bg-primary-orange hover:bg-primary-orange/80 text-white font-bold rounded-lg transition-colors\"\r\n              whileHover={{ scale: 1.05 }}\r\n              whileTap={{ scale: 0.95 }}\r\n            >\r\n              \r\n            </motion.button>\r\n\r\n            {/* Confetti effect */}\r\n            <div className=\"absolute inset-0 pointer-events-none overflow-hidden\">\r\n              {[...Array(15)].map((_, i) => (\r\n                <motion.div\r\n                  key={`confetti-${i}`}\r\n                  className=\"absolute w-2 h-2 rounded-full\"\r\n                  style={{\r\n                    backgroundColor: ['#FFD700', '#FF6B35', '#00D4FF', '#E8FF00', '#8A2BE2'][i % 5],\r\n                    left: `${50 + (Math.random() - 0.5) * 60}%`,\r\n                    top: '20%',\r\n                  }}\r\n                  animate={{\r\n                    y: ['0vh', '80vh'],\r\n                    x: [(Math.random() - 0.5) * 200, (Math.random() - 0.5) * 400],\r\n                    rotate: [0, 360],\r\n                    opacity: [1, 0],\r\n                  }}\r\n                  transition={{\r\n                    duration: 3,\r\n                    delay: Math.random() * 0.5,\r\n                    ease: \"easeOut\",\r\n                  }}\r\n                />\r\n              ))}\r\n            </div>\r\n          </motion.div>\r\n        </motion.div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n};\r\n","import React, { useEffect, useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useGameStore } from '../store/gameStore';\r\n\r\ninterface DropNotification {\r\n  id: string;\r\n  message: string;\r\n  timestamp: number;\r\n}\r\n\r\nexport const ItemDropNotification: React.FC = () => {\r\n  const { aiElectrician } = useGameStore();\r\n  const [notifications, setNotifications] = useState<DropNotification[]>([]);\r\n\r\n  useEffect(() => {\r\n    //      \r\n    if (aiElectrician.lastMessage && aiElectrician.messageTime) {\r\n      const isItemDrop = aiElectrician.lastMessage.includes('') || \r\n                        aiElectrician.lastMessage.includes('') || \r\n                        aiElectrician.lastMessage.includes('') || \r\n                        aiElectrician.lastMessage.includes('') ||\r\n                        aiElectrician.lastMessage.includes('');\r\n\r\n      if (isItemDrop) {\r\n        const newNotification: DropNotification = {\r\n          id: `${aiElectrician.messageTime}-${Math.random()}`,\r\n          message: aiElectrician.lastMessage,\r\n          timestamp: aiElectrician.messageTime\r\n        };\r\n\r\n        setNotifications(prev => [...prev, newNotification]);\r\n\r\n        //    5 \r\n        setTimeout(() => {\r\n          setNotifications(prev => prev.filter(n => n.id !== newNotification.id));\r\n        }, 5000);\r\n      }\r\n    }\r\n  }, [aiElectrician.lastMessage, aiElectrician.messageTime]);\r\n\r\n  return (\r\n    <div className=\"fixed top-20 right-4 z-50 space-y-2 pointer-events-none\">\r\n      <AnimatePresence>\r\n        {notifications.map((notification) => (\r\n          <motion.div\r\n            key={notification.id}\r\n            initial={{ opacity: 0, x: 300, scale: 0.8 }}\r\n            animate={{ opacity: 1, x: 0, scale: 1 }}\r\n            exit={{ opacity: 0, x: 300, scale: 0.8 }}\r\n            transition={{ \r\n              type: \"spring\", \r\n              stiffness: 400, \r\n              damping: 25,\r\n              duration: 0.5 \r\n            }}\r\n            className=\"glass-effect bg-gradient-to-r from-yellow-900/30 to-orange-900/30 border border-yellow-500/50 rounded-lg p-4 max-w-xs\"\r\n          >\r\n            <div className=\"flex items-center space-x-2\">\r\n              <motion.div\r\n                animate={{ \r\n                  rotate: [0, 10, -10, 0],\r\n                  scale: [1, 1.1, 1]\r\n                }}\r\n                transition={{ \r\n                  duration: 0.6,\r\n                  repeat: 2,\r\n                  ease: \"easeInOut\"\r\n                }}\r\n                className=\"text-2xl\"\r\n              >\r\n                \r\n              </motion.div>\r\n              <div>\r\n                <div className=\"text-xs text-yellow-300 font-semibold mb-1\">\r\n                  !\r\n                </div>\r\n                <div className=\"text-sm text-white font-medium\">\r\n                  {notification.message}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/*    */}\r\n            <motion.div\r\n              className=\"h-1 bg-yellow-500/30 rounded-full mt-3 overflow-hidden\"\r\n              initial={{ width: \"100%\" }}\r\n            >\r\n              <motion.div\r\n                className=\"h-full bg-gradient-to-r from-yellow-400 to-orange-400\"\r\n                initial={{ width: \"100%\" }}\r\n                animate={{ width: \"0%\" }}\r\n                transition={{ duration: 5, ease: \"linear\" }}\r\n              />\r\n            </motion.div>\r\n          </motion.div>\r\n        ))}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n};\r\n","// Central WebGPU manager: adapter/device/context setup, feature detection, fallback chain\r\n// Minimal fallbacks for WebGPU types (ignored if real types exist)\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ntype GPUDevice = any; // fallback\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ntype GPUCanvasContext = { configure(o:any): void; getCurrentTexture(): { createView(): any } };\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ntype GPUTextureFormat = any;\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ntype GPUAdapter = { requestDevice(): Promise<GPUDevice>; name?: string; features?: Iterable<string> };\r\nexport interface WebGPUInitResult {\r\n  ok: boolean;\r\n  reason?: string;\r\n  adapterName?: string;\r\n  features?: string[];\r\n  device?: GPUDevice;\r\n  context?: GPUCanvasContext;\r\n  format?: GPUTextureFormat;\r\n}\r\n\r\nexport class WebGPUManager {\r\n  private static _instance: WebGPUManager | null = null;\r\n  private device: GPUDevice | null = null;\r\n  private context: GPUCanvasContext | null = null;\r\n  private format: GPUTextureFormat | null = null;\r\n  private adapterName: string | undefined;\r\n  private features: string[] = [];\r\n  private initialized = false;\r\n\r\n  static get instance() {\r\n    if (!this._instance) this._instance = new WebGPUManager();\r\n    return this._instance;\r\n  }\r\n\r\n  async init(canvas: HTMLCanvasElement): Promise<WebGPUInitResult> {\r\n    if (this.initialized) {\r\n      return { ok: !!this.device, adapterName: this.adapterName, features: this.features, device: this.device!, context: this.context!, format: this.format! };\r\n    }\r\n    if (!(navigator as any).gpu) {\r\n      return { ok: false, reason: 'WebGPU not supported' };\r\n    }\r\n    try {\r\n      const adapter: GPUAdapter | null = await (navigator as any).gpu.requestAdapter();\r\n      if (!adapter) return { ok: false, reason: 'No adapter' };\r\n      const device = await adapter.requestDevice();\r\n      const context = canvas.getContext('webgpu') as GPUCanvasContext | null;\r\n      if (!context) return { ok: false, reason: 'No context' };\r\n      const format = (navigator as any).gpu.getPreferredCanvasFormat();\r\n      context.configure({ device, format, alphaMode: 'premultiplied' });\r\n      this.device = device;\r\n      this.context = context;\r\n      this.format = format;\r\n      this.adapterName = (adapter as any).name;\r\n      this.features = Array.from((adapter as any).features || []);\r\n      this.initialized = true;\r\n      return { ok: true, adapterName: this.adapterName, features: this.features, device, context, format };\r\n    } catch (e: any) {\r\n      return { ok: false, reason: e?.message || 'init error' };\r\n    }\r\n  }\r\n\r\n  getDevice() { return this.device; }\r\n  getContext() { return this.context; }\r\n  getFormat() { return this.format; }\r\n  getInfo() { return { adapterName: this.adapterName, features: this.features }; }\r\n}\r\n","// Simple CPU-driven particle system with optional WebGPU instanced rendering placeholder\r\nexport interface Particle {\r\n  x: number; y: number; vx: number; vy: number; life: number; maxLife: number;\r\n}\r\n\r\nexport class ParticleSystem {\r\n  particles: Particle[] = [];\r\n  max: number;\r\n  constructor(max = 500) { this.max = max; }\r\n\r\n  spawnBurst(x: number, y: number, count = 40) {\r\n    for (let i = 0; i < count && this.particles.length < this.max; i++) {\r\n      const angle = Math.random() * Math.PI * 2;\r\n      const speed = 30 + Math.random() * 70;\r\n      this.particles.push({\r\n        x, y,\r\n        vx: Math.cos(angle) * speed,\r\n        vy: Math.sin(angle) * speed,\r\n        life: 0,\r\n        maxLife: 0.6 + Math.random() * 0.8,\r\n      });\r\n    }\r\n  }\r\n\r\n  update(dt: number) {\r\n    const g = 40;\r\n    for (let i = this.particles.length - 1; i >= 0; i--) {\r\n      const p = this.particles[i];\r\n      p.life += dt;\r\n      if (p.life > p.maxLife) { this.particles.splice(i, 1); continue; }\r\n      p.vy += g * dt;\r\n      p.x += p.vx * dt;\r\n      p.y += p.vy * dt;\r\n    }\r\n  }\r\n\r\n  draw2D(ctx: CanvasRenderingContext2D) {\r\n    ctx.save();\r\n    for (const p of this.particles) {\r\n      const t = p.life / p.maxLife;\r\n      const alpha = 1 - t;\r\n      const size = 4 + 12 * (1 - t);\r\n      const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, size);\r\n      grad.addColorStop(0, `rgba(255,180,80,${alpha})`);\r\n      grad.addColorStop(1, `rgba(255,80,0,0)`);\r\n      ctx.fillStyle = grad;\r\n      ctx.beginPath();\r\n      ctx.arc(p.x, p.y, size, 0, Math.PI * 2);\r\n      ctx.fill();\r\n    }\r\n    ctx.restore();\r\n  }\r\n}\r\n","// Procedural lightning bolt generation (2D fallback) - can be ported to WebGPU later\r\nexport interface Segment { x1:number; y1:number; x2:number; y2:number; }\r\n\r\nexport function generateLightning(x1:number, y1:number, x2:number, y2:number, displace = 90, min = 4): Segment[] {\r\n  const segments: Segment[] = [];\r\n  const recurse = (ax:number, ay:number, bx:number, by:number, disp:number) => {\r\n    if (disp < min) { segments.push({ x1:ax, y1:ay, x2:bx, y2:by }); return; }\r\n    const mx = (ax + bx) / 2;\r\n    const my = (ay + by) / 2;\r\n    const offset = (Math.random() - 0.5) * disp;\r\n    const nx = mx + (by - ay) * 0.2 * (offset / disp);\r\n    const ny = my - (bx - ax) * 0.2 * (offset / disp);\r\n    recurse(ax, ay, nx, ny, disp / 2);\r\n    recurse(nx, ny, bx, by, disp / 2);\r\n  };\r\n  recurse(x1, y1, x2, y2, displace);\r\n  return segments;\r\n}\r\n\r\nexport function drawLightning(ctx: CanvasRenderingContext2D, segs: Segment[], alpha = 1) {\r\n  ctx.save();\r\n  ctx.globalCompositeOperation = 'lighter';\r\n  ctx.lineWidth = 2;\r\n  ctx.strokeStyle = `rgba(255,200,100,${alpha})`;\r\n  ctx.beginPath();\r\n  for (const s of segs) ctx.lineTo(s.x1, s.y1), ctx.lineTo(s.x2, s.y2);\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\n","import React, { useRef, useState, useEffect } from 'react';\r\nimport { WebGPUManager } from '../webgpu/WebGPUManager';\r\nimport { ParticleSystem } from '../webgpu/ParticleSystem';\r\nimport { generateLightning, drawLightning } from '../webgpu/LightningEffect';\r\nimport { effectsBus } from '../effects/effectsBus';\r\n\r\ninterface WebGPUStatus { supported: boolean; message: string; adapterInfo?: { name?: string; features?: string[] }; reason?: string }\r\n\r\nexport const WebGPUCanvas: React.FC = () => {\r\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\r\n  const [status, setStatus] = useState<WebGPUStatus>({ supported: true, message: 'Initializing...' });\r\n  const [fps, setFps] = useState(0);\r\n  const framesRef = useRef(0);\r\n  const lastFpsUpdateRef = useRef(performance.now());\r\n  const lastTimeRef = useRef(performance.now());\r\n  const particleRef = useRef<ParticleSystem | null>(null);\r\n  const lightningRef = useRef<{ segs: any[]; t: number } | null>(null);\r\n  // Detect Telegram Mini App environment early\r\n  const isTelegramMiniApp = typeof window !== 'undefined' && (window as any).Telegram?.WebApp;\r\n  const targetParticleMaxRef = useRef(isTelegramMiniApp ? 300 : 500);\r\n  const adaptAccumulatorRef = useRef(0);\r\n  // WebGPU pipeline refs\r\n  const wgpuReadyRef = useRef(false);\r\n  const deviceRef = useRef<any>(null);\r\n  const contextRef = useRef<any>(null);\r\n  const pipelineRef = useRef<any>(null);\r\n  const formatRef = useRef<any>(null);\r\n\r\n  const ensurePipeline = () => {\r\n    if (!wgpuReadyRef.current || !deviceRef.current || !contextRef.current || pipelineRef.current) return;\r\n    const device = deviceRef.current;\r\n    const format = formatRef.current;\r\n    const shader = device.createShaderModule({\r\n      code: `struct VSOut { @builtin(position) pos: vec4f, @location(0) col: vec3f };\r\n      @vertex fn vs(@builtin(vertex_index) i:u32) -> VSOut {\r\n        var positions = array<vec2f,3>(vec2f(0.0,0.8), vec2f(-0.8,-0.8), vec2f(0.8,-0.8));\r\n        var colors = array<vec3f,3>(vec3f(1,0.4,0.1), vec3f(0.1,0.6,1), vec3f(0.2,1,0.4));\r\n        var out: VSOut; out.pos = vec4f(positions[i],0,1); out.col = colors[i]; return out; }\r\n      @fragment fn fs(in:VSOut) -> @location(0) vec4f { return vec4f(in.col,1); }`\r\n    });\r\n    pipelineRef.current = device.createRenderPipeline({\r\n      layout: 'auto',\r\n      vertex: { module: shader, entryPoint: 'vs' },\r\n      fragment: { module: shader, entryPoint: 'fs', targets: [{ format }] },\r\n      primitive: { topology: 'triangle-list' }\r\n    });\r\n  };\r\n\r\n  // Main animation / metrics loop (covers fallback rendering)\r\n  useEffect(() => {\r\n    let raf: number;\r\n    const loop = () => {\r\n      const now = performance.now();\r\n      const dt = (now - lastTimeRef.current) / 1000;\r\n      lastTimeRef.current = now;\r\n      framesRef.current++;\r\n      if (now - lastFpsUpdateRef.current > 500) {\r\n        const delta = now - lastFpsUpdateRef.current;\r\n        const recentFps = Math.round((framesRef.current * 1000) / delta);\r\n        setFps(recentFps);\r\n        // Adaptive particle budget: raise if fps>50, lower if <30\r\n        adaptAccumulatorRef.current += delta;\r\n        if (adaptAccumulatorRef.current > 2000) { // every ~2s\r\n          adaptAccumulatorRef.current = 0;\r\n          if (recentFps < 30) targetParticleMaxRef.current = Math.max(200, Math.floor(targetParticleMaxRef.current * 0.8));\r\n          else if (recentFps > 55) targetParticleMaxRef.current = Math.min(2000, Math.floor(targetParticleMaxRef.current * 1.15));\r\n          if (particleRef.current) particleRef.current.max = targetParticleMaxRef.current;\r\n        }\r\n        framesRef.current = 0;\r\n        lastFpsUpdateRef.current = now;\r\n      }\r\n      // If WebGPU supported, render triangle each frame\r\n      if (status.supported && wgpuReadyRef.current && deviceRef.current && contextRef.current) {\r\n        ensurePipeline();\r\n        if (pipelineRef.current) {\r\n          try {\r\n            const device = deviceRef.current;\r\n            const context = contextRef.current;\r\n            const encoder = device.createCommandEncoder();\r\n            const view = context.getCurrentTexture().createView();\r\n            const pass = encoder.beginRenderPass({\r\n              colorAttachments: [{\r\n                view,\r\n                clearValue: { r: 0.04, g: 0.04, b: 0.07, a: 1 },\r\n                loadOp: 'clear',\r\n                storeOp: 'store'\r\n              }]\r\n            });\r\n            pass.setPipeline(pipelineRef.current);\r\n            pass.draw(3);\r\n            pass.end();\r\n            device.queue.submit([encoder.finish()]);\r\n          } catch (e) {\r\n            console.warn('WebGPU frame error', e);\r\n          }\r\n        }\r\n      }\r\n      // Fallback effects when WebGPU unsupported\r\n      const canvas = canvasRef.current;\r\n      if (canvas && !status.supported) {\r\n        const ctx = canvas.getContext('2d');\r\n        if (ctx) {\r\n          if (!particleRef.current) particleRef.current = new ParticleSystem(targetParticleMaxRef.current);\r\n          // spawn bursts\r\n            if (Math.random() < 0.07) {\r\n            const x = Math.random() * canvas.width;\r\n            const y = Math.random() * canvas.height * 0.6;\r\n            particleRef.current.spawnBurst(x, y, 20 + Math.random()*20);\r\n            if (Math.random() < 0.35) {\r\n              const lx = Math.random() * canvas.width;\r\n              lightningRef.current = { segs: generateLightning(lx, 0, lx + (Math.random()-0.5)*140, canvas.height * (0.4+Math.random()*0.4)), t: 0 };\r\n            }\r\n          }\r\n          particleRef.current.update(dt);\r\n          ctx.fillStyle = '#090910';\r\n          ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n          particleRef.current.draw2D(ctx);\r\n          if (lightningRef.current) {\r\n            lightningRef.current.t += dt * 3.2;\r\n            const alpha = 1 - lightningRef.current.t;\r\n            if (alpha > 0) drawLightning(ctx, lightningRef.current.segs, alpha); else lightningRef.current = null;\r\n          }\r\n        }\r\n      }\r\n      raf = requestAnimationFrame(loop);\r\n    };\r\n    raf = requestAnimationFrame(loop);\r\n    return () => cancelAnimationFrame(raf);\r\n  }, [status.supported]);\r\n\r\n  // Init path (manager -> triangle fallback -> 2D fallback)\r\n  useEffect(() => {\r\n    if (!canvasRef.current) return;\r\n    let mounted = true;\r\n    const canvas = canvasRef.current;\r\n    (async () => {\r\n      const mgr = WebGPUManager.instance;\r\n  const res = await mgr.init(canvas);\r\n      if (res.ok) {\r\n        if (mounted) setStatus({ supported: true, message: 'WebGPU ready', adapterInfo: { name: res.adapterName, features: res.features } });\r\n  // store refs for render loop\r\n  deviceRef.current = mgr.getDevice();\r\n  contextRef.current = mgr.getContext();\r\n  formatRef.current = mgr.getFormat();\r\n  wgpuReadyRef.current = true;\r\n        return;\r\n      }\r\n      // If manager failed, attempt inline minimal triangle (reuse old logic)\r\n      const tri = await (async () => {\r\n        if (!('gpu' in navigator)) return { supported: false, message: 'WebGPU not supported', reason: 'Navigator.gpu missing (browser build / flag disabled)' };\r\n        try {\r\n          const adapter = await (navigator as any).gpu.requestAdapter();\r\n          if (!adapter) return { supported: false, message: 'No adapter', reason: 'requestAdapter() returned null (sandbox / driver / context restrictions)' };\r\n          const device = await adapter.requestDevice();\r\n          const ctx = canvas.getContext('webgpu') as any;\r\n          if (!ctx) return { supported: false, message: 'No context', reason: 'getContext(\"webgpu\") failed  experimental in this WebView' };\r\n          const format = (navigator as any).gpu.getPreferredCanvasFormat();\r\n          ctx.configure({ device, format, alphaMode: 'premultiplied' });\r\n          const shader = device.createShaderModule({ code: `@vertex fn v(@builtin(vertex_index) i:u32)->@builtin(position) vec4f{var p=array<vec2f,3>(vec2f(0.0,0.6),vec2f(-0.6,-0.6),vec2f(0.6,-0.6));return vec4f(p[i],0,1);} @fragment fn f()->@location(0) vec4f{return vec4f(1,0.5,0.15,1);}` });\r\n          const pipe = device.createRenderPipeline({ layout:'auto', vertex:{ module:shader, entryPoint:'v'}, fragment:{ module:shader, entryPoint:'f', targets:[{format}] }, primitive:{ topology:'triangle-list'} });\r\n          const draw = () => {\r\n            const enc = device.createCommandEncoder();\r\n            const view = ctx.getCurrentTexture().createView();\r\n            const pass = enc.beginRenderPass({ colorAttachments:[{ view, clearValue:{r:0.05,g:0.05,b:0.08,a:1}, loadOp:'clear', storeOp:'store'}]});\r\n            pass.setPipeline(pipe); pass.draw(3); pass.end(); device.queue.submit([enc.finish()]);\r\n            if (mounted && status.supported) requestAnimationFrame(draw); // Only continue if still marked supported\r\n          };\r\n          requestAnimationFrame(draw);\r\n          return { supported: true, message: 'WebGPU (triangle)' } as WebGPUStatus;\r\n  } catch (e:any) { return { supported:false, message:'Inline init failed', reason: e?.message }; }\r\n      })();\r\n      if (mounted) setStatus(tri);\r\n      if (!tri.supported) {\r\n        // final fallback is handled by animation loop which sees supported=false\r\n        if (isTelegramMiniApp && tri.reason && !tri.reason.includes('Telegram')) {\r\n          // Enrich reason for Mini App context to reduce confusion\r\n          setStatus(prev => ({ ...prev, reason: prev.reason ? prev.reason + ' (Telegram WebView: WebGPU  )' : 'Telegram WebView: WebGPU ' }));\r\n        }\r\n      }\r\n    })();\r\n\r\n    const handleResize = () => {\r\n      if (!canvasRef.current) return;\r\n      const parent = canvasRef.current.parentElement;\r\n      if (!parent) return;\r\n      const width = parent.clientWidth;\r\n      const height = Math.min(300, Math.round(width * 0.75));\r\n      canvasRef.current.width = width * window.devicePixelRatio;\r\n      canvasRef.current.height = height * window.devicePixelRatio;\r\n      canvasRef.current.style.width = width + 'px';\r\n      canvasRef.current.style.height = height + 'px';\r\n    };\r\n    handleResize();\r\n    window.addEventListener('resize', handleResize);\r\n    return () => { mounted = false; window.removeEventListener('resize', handleResize); };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const unsubLevel = effectsBus.on('levelUp', ({ level }) => {\r\n      const c = canvasRef.current; if (!c) return; if (!particleRef.current) particleRef.current = new ParticleSystem(targetParticleMaxRef.current);\r\n      particleRef.current.spawnBurst(c.width*0.5, c.height*0.4, 80 + level*5);\r\n    });\r\n    const unsubShock = effectsBus.on('shock', ({ severity }) => {\r\n      const c = canvasRef.current; if (!c) return; if (!particleRef.current) particleRef.current = new ParticleSystem(targetParticleMaxRef.current);\r\n      const mult = severity==='critical'?2.2:severity==='severe'?1.6:severity==='moderate'?1.2:1;\r\n      for (let i=0;i<5*mult;i++) particleRef.current.spawnBurst(Math.random()*c.width, Math.random()*c.height*0.5, 10*mult);\r\n    });\r\n    const unsubStage = effectsBus.on('stageAdvance', ({ stage }) => {\r\n      const c = canvasRef.current; if (!c) return; if (!particleRef.current) particleRef.current = new ParticleSystem(targetParticleMaxRef.current);\r\n      particleRef.current.spawnBurst(c.width*0.5, c.height*0.2, 120 + stage*15);\r\n    });\r\n    const unsubDrop = effectsBus.on('itemDrop', ({ level }) => {\r\n      const c = canvasRef.current; if (!c) return; if (!particleRef.current) particleRef.current = new ParticleSystem(targetParticleMaxRef.current);\r\n      particleRef.current.spawnBurst(c.width*(0.3+Math.random()*0.4), c.height*0.3, 60 + level*20);\r\n    });\r\n    const unsubAi = effectsBus.on('aiAttack', ({ voltage }) => {\r\n      const c = canvasRef.current; if (!c) return; if (!particleRef.current) particleRef.current = new ParticleSystem(targetParticleMaxRef.current);\r\n      particleRef.current.spawnBurst(c.width*0.5, c.height*0.1, 100 + Math.min(100, Math.floor(voltage/5)));\r\n    });\r\n    return () => { unsubLevel(); unsubShock(); unsubStage(); unsubDrop(); unsubAi(); };\r\n  }, []);\r\n\r\n  return (\r\n    <div style={{ border: '1px solid #333', padding: 8, borderRadius: 8, background: '#111', color: '#eee', fontFamily: 'monospace' }}>\r\n      <div style={{ marginBottom: 6, fontSize: 12, display: 'flex', gap: 12, flexWrap: 'wrap' }}>\r\n        <span>WebGPU: {status.message}</span>\r\n        <span>FPS: {fps}</span>\r\n        {status.adapterInfo?.name && <span>GPU: {status.adapterInfo.name}</span>}\r\n      </div>\r\n      <canvas ref={canvasRef} width={400} height={300} style={{ width: '100%', display: 'block', borderRadius: 4 }} />\r\n  {!status.supported && (\r\n        <div style={{ color: '#f66', marginTop: 8, fontSize: 11, lineHeight:1.4 }}>\r\n          <div><strong>Fallback Canvas2D mode.</strong></div>\r\n          <div>: {status.reason || ''}</div>\r\n          <div style={{opacity:0.8}}>  WebGPU:\r\n            <ul style={{margin:'4px 0 0 16px', padding:0}}>\r\n              <li>Chrome / Edge 113+: chrome://flags  \"Unsafe WebGPU\"  Enabled</li>\r\n              <li>  ( adapter null)</li>\r\n              <li>    Telegram WebView</li>\r\n              <li>HTTPS origin  (localhost )</li>\r\n      {isTelegramMiniApp && <li> Telegram Mini App WebGPU      </li>}\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default WebGPUCanvas;\r\n","import React, { useEffect, useState, Suspense } from 'react';\r\nimport { useGameStore } from './store/gameStore';\r\nimport { MainMenu } from './components/MainMenu';\r\nimport { GameScreen } from './components/GameScreen';\r\nimport { MultiplayerScreen } from './components/MultiplayerScreen';\r\nimport { DuelScreen } from './components/DuelScreen';\r\nimport { DuelInviteScreen } from './components/DuelInviteScreen';\r\nimport { DuelInviteReceiver } from './components/DuelInviteReceiver';\r\nimport { LevelUpNotification } from './components/LevelUpNotification';\r\nimport { ItemDropNotification } from './components/ItemDropNotification';\r\nimport { TelegramProvider } from './components/TelegramProvider';\r\nimport WebGPUCanvas from './components/WebGPUCanvas';\r\nconst BabylonStage = React.lazy(() => import('./components/BabylonStage'));\r\nconst BabylonStageAdvanced = React.lazy(() => import('./components/BabylonStageAdvanced'));\r\n\r\nfunction App() {\r\n  const { gameState, levelUpNotification, hideLevelUpNotification } = useGameStore();\r\n\r\n  useEffect(() => {\r\n    // Initialize Telegram WebApp\r\n    if (typeof window !== 'undefined' && window.Telegram?.WebApp) {\r\n      const webApp = window.Telegram.WebApp;\r\n      \r\n      //  \r\n      webApp.ready();\r\n      webApp.expand();\r\n      \r\n      //   \r\n      webApp.setHeaderColor('#FF6B35'); //   TigerRozetka\r\n      webApp.setBackgroundColor('#1A1A1A'); //  \r\n      \r\n      //   \r\n      webApp.enableClosingConfirmation();\r\n      \r\n      //    ()\r\n      if (webApp.MainButton) {\r\n        webApp.MainButton.setText(' ');\r\n        webApp.MainButton.color = '#FF6B35';\r\n        webApp.MainButton.textColor = '#FFFFFF';\r\n      }\r\n      \r\n      //   \r\n      console.log('Telegram WebApp initialized:', {\r\n        platform: webApp.platform,\r\n        version: webApp.version,\r\n        colorScheme: webApp.colorScheme,\r\n        user: webApp.initDataUnsafe?.user\r\n      });\r\n    } else {\r\n      console.log('Running outside Telegram environment');\r\n    }\r\n  }, []);\r\n\r\n  console.log('App rendering, mode:', gameState.mode);\r\n\r\n  const [renderMode, setRenderMode] = useState<'webgpu' | 'babylon' | 'both'>('both');\r\n\r\n  return (\r\n    <TelegramProvider>\r\n      <div className=\"App\">\r\n        {gameState.mode === 'menu' && (\r\n          <>\r\n            <MainMenu />\r\n            <div style={{margin:'8px 0', display:'flex', gap:8, flexWrap:'wrap', fontSize:12}}>\r\n              <span style={{opacity:0.7}}>Render Engines:</span>\r\n              {['webgpu','babylon','both'].map(m => (\r\n                <button key={m} onClick={()=>setRenderMode(m as any)} style={{\r\n                  padding:'4px 10px', border:'1px solid #444', background: renderMode===m? '#FF6B35':'#222', color:'#fff', borderRadius:4, cursor:'pointer'\r\n                }}>{m}</button>\r\n              ))}\r\n            </div>\r\n            <div style={{ display:'grid', gap:16, margin:'16px auto', maxWidth: 860, gridTemplateColumns:'repeat(auto-fit,minmax(380px,1fr))' }}>\r\n              {(renderMode==='webgpu' || renderMode==='both') && <WebGPUCanvas />}\r\n              {(renderMode==='babylon' || renderMode==='both') && (\r\n                <Suspense fallback={<div style={{color:'#888', fontSize:12}}>Loading Babylon...</div>}>\r\n                  <div style={{display:'flex', flexDirection:'column', gap:12}}>\r\n                    <BabylonStage />\r\n                    <BabylonStageAdvanced />\r\n                  </div>\r\n                </Suspense>\r\n              )}\r\n            </div>\r\n          </>\r\n        )}\r\n        {gameState.mode === 'single' && <GameScreen />}\r\n        {gameState.mode === 'multiplayer' && <MultiplayerScreen />}\r\n        {gameState.mode === 'duel-invite' && <DuelInviteScreen />}\r\n        {gameState.mode === 'duel' && <DuelScreen />}\r\n        \r\n        {/*      */}\r\n        <DuelInviteReceiver />\r\n        \r\n        {/* Item Drop Notification - Global */}\r\n        <ItemDropNotification />\r\n        \r\n        {/* Level Up Notification - Global */}\r\n        {levelUpNotification.level && (\r\n          <LevelUpNotification\r\n            isVisible={levelUpNotification.isVisible}\r\n            newLevel={levelUpNotification.level}\r\n            voltsReward={levelUpNotification.voltsReward || 0}\r\n            onClose={hideLevelUpNotification}\r\n          />\r\n        )}\r\n      </div>\r\n    </TelegramProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\nimport App from './App.tsx';\r\nimport './index.css';\r\n\r\n//  Telegram Mini App\r\n//  WebApp   \r\nif (typeof window !== 'undefined' && window.Telegram?.WebApp) {\r\n  const tg = window.Telegram.WebApp;\r\n  \r\n  //  \r\n  tg.ready();\r\n  tg.expand();\r\n  \r\n  //   \r\n  tg.setHeaderColor('#000000');\r\n  tg.setBackgroundColor('#000000');\r\n  \r\n  //   \"\" (   )\r\n  tg.BackButton.hide();\r\n  \r\n  //     \r\n  if (tg.HapticFeedback) {\r\n    tg.HapticFeedback.selectionChanged();\r\n  }\r\n  \r\n  console.log('Telegram WebApp initialized:', {\r\n    version: tg.version,\r\n    platform: tg.platform,\r\n    colorScheme: tg.colorScheme,\r\n    user: tg.initDataUnsafe?.user\r\n  });\r\n}\r\n\r\nReactDOM.createRoot(document.getElementById('root')!).render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n);\r\n"],"file":"assets/index-rhFFGTpy.js"}