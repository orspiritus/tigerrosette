var de=Object.defineProperty;var ue=(r,a,t)=>a in r?de(r,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[a]=t;var C=(r,a,t)=>ue(r,typeof a!="symbol"?a+"":a,t);import{j as e,m as c,A as F}from"./motion-3WHHzQTP.js";import{a as xe,r as x,g as me,R as ee}from"./vendor-CIP6LD3P.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var q={},W=xe;q.createRoot=W.createRoot,q.hydrateRoot=W.hydrateRoot;const he={},z=r=>{let a;const t=new Set,s=(d,g)=>{const h=typeof d=="function"?d(a):d;if(!Object.is(h,a)){const f=a;a=g??(typeof h!="object"||h===null)?h:Object.assign({},a,h),t.forEach(v=>v(a,f))}},i=()=>a,u={setState:s,getState:i,getInitialState:()=>m,subscribe:d=>(t.add(d),()=>t.delete(d)),destroy:()=>{(he?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},m=a=r(s,i,u);return u},ge=r=>r?z(r):z;var te={exports:{}},se={},ae={exports:{}},re={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $=x;function fe(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var pe=typeof Object.is=="function"?Object.is:fe,ve=$.useState,be=$.useEffect,ye=$.useLayoutEffect,je=$.useDebugValue;function we(r,a){var t=a(),s=ve({inst:{value:t,getSnapshot:a}}),i=s[0].inst,n=s[1];return ye(function(){i.value=t,i.getSnapshot=a,D(i)&&n({inst:i})},[r,t,a]),be(function(){return D(i)&&n({inst:i}),r(function(){D(i)&&n({inst:i})})},[r]),je(t),t}function D(r){var a=r.getSnapshot;r=r.value;try{var t=a();return!pe(r,t)}catch{return!0}}function Ne(r,a){return a()}var ke=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Ne:we;re.useSyncExternalStore=$.useSyncExternalStore!==void 0?$.useSyncExternalStore:ke;ae.exports=re;var Se=ae.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O=x,Ce=Se;function Ee(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var Te=typeof Object.is=="function"?Object.is:Ee,Me=Ce.useSyncExternalStore,Ae=O.useRef,Ie=O.useEffect,Re=O.useMemo,Fe=O.useDebugValue;se.useSyncExternalStoreWithSelector=function(r,a,t,s,i){var n=Ae(null);if(n.current===null){var l={hasValue:!1,value:null};n.current=l}else l=n.current;n=Re(function(){function u(f){if(!m){if(m=!0,d=f,f=s(f),i!==void 0&&l.hasValue){var v=l.value;if(i(v,f))return g=v}return g=f}if(v=g,Te(d,f))return v;var p=s(f);return i!==void 0&&i(v,p)?(d=f,v):(d=f,g=p)}var m=!1,d,g,h=t===void 0?null:t;return[function(){return u(a())},h===null?void 0:function(){return u(h())}]},[a,t,s,i]);var o=Me(r,n[0],n[1]);return Ie(function(){l.hasValue=!0,l.value=o},[o]),Fe(o),o};te.exports=se;var $e=te.exports;const Le=me($e),ie={},{useDebugValue:Pe}=ee,{useSyncExternalStoreWithSelector:_e}=Le;let G=!1;const He=r=>r;function Oe(r,a=He,t){(ie?"production":void 0)!=="production"&&t&&!G&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),G=!0);const s=_e(r.subscribe,r.getState,r.getServerState||r.getInitialState,a,t);return Pe(s),s}const K=r=>{(ie?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const a=typeof r=="function"?ge(r):r,t=(s,i)=>Oe(a,s,i);return Object.assign(t,a),t},Ue=r=>r?K(r):K,M=[{level:1,requiredExperience:0,voltsReward:0,title:"Новичок",description:"Первые шаги с электричеством"},{level:2,requiredExperience:100,voltsReward:50,title:"Ученик",description:"Осваиваете основы"},{level:3,requiredExperience:250,voltsReward:75,title:"Практикант",description:"⚠️ Опасно! Теперь удар током отнимает очки"},{level:4,requiredExperience:500,voltsReward:100,title:"Любитель",description:"🔥 Критично! Напряжение отнимается от очков"},{level:5,requiredExperience:850,voltsReward:150,title:"Энтузиаст",description:"Проявляете смелость в опасной игре"},{level:6,requiredExperience:1300,voltsReward:200,title:"Смельчак",description:"Не боитесь рисковать"},{level:7,requiredExperience:1900,voltsReward:250,title:"Храбрец",description:"Идете на оправданный риск"},{level:8,requiredExperience:2600,voltsReward:300,title:"Отважный",description:"Покоряете сложности"},{level:9,requiredExperience:3450,voltsReward:400,title:"Безрассудный",description:"Играете с опасностью"},{level:10,requiredExperience:4500,voltsReward:500,title:"Профессионал",description:"Мастерски владеете риском"},{level:11,requiredExperience:5800,voltsReward:600,title:"Эксперт",description:"Знаете все тонкости"},{level:12,requiredExperience:7400,voltsReward:750,title:"Мастер",description:"Превосходите ожидания"},{level:13,requiredExperience:9300,voltsReward:900,title:"Виртуоз",description:"Играете как художник"},{level:14,requiredExperience:11600,voltsReward:1100,title:"Гуру",description:"Достигли просветления"},{level:15,requiredExperience:14400,voltsReward:1300,title:"Сенсей",description:"Учите других"},{level:16,requiredExperience:17800,voltsReward:1500,title:"Легенда",description:"О вас слагают легенды"},{level:17,requiredExperience:21900,voltsReward:1750,title:"Миф",description:"Недостижимый идеал"},{level:18,requiredExperience:26800,voltsReward:2e3,title:"Титан",description:"Сверхчеловеческие способности"},{level:19,requiredExperience:32600,voltsReward:2300,title:"Бог Электричества",description:"Повелеваете молниями"},{level:20,requiredExperience:4e4,voltsReward:2500,title:"Зевс",description:"Абсолютная власть над током"}];function H(r){let a=M[0];for(let t=M.length-1;t>=0;t--)if(r>=M[t].requiredExperience){a=M[t];break}return a}function ne(r){const a=H(r),t=M.findIndex(i=>i.level===a.level)+1;if(t>=M.length)return{current:r,required:r,remaining:0,nextLevel:null};const s=M[t];return{current:r-a.requiredExperience,required:s.requiredExperience-a.requiredExperience,remaining:s.requiredExperience-r,nextLevel:s}}function De(r){const{current:a,required:t}=ne(r);return t===0?100:Math.min(100,a/t*100)}const T={SAFE_CLICK:10,RISKY_CLICK:15,EXTREME_CLICK:25,STREAK_5:50,STREAK_10:100,STREAK_25:250,STREAK_50:500,SHOCK_SURVIVAL:5};function A(r){const a="/tigerrosette/";return r<=5?`${a}Media/Pictures/tigrrozetka_1.png`:r<=10?`${a}Media/Pictures/tigrrozetka_2.png`:r<=15?`${a}Media/Pictures/tigrrozetka_3.png`:`${a}Media/Pictures/tigrrozetka_4.png`}const Y="http://localhost:3001/api";class qe{constructor(){C(this,"token",null);this.token=localStorage.getItem("auth_token"),this.initializeTelegramAuth()}initializeTelegramAuth(){var a,t;if(typeof window<"u"&&((a=window.Telegram)!=null&&a.WebApp)){const s=window.Telegram.WebApp;(t=s.initDataUnsafe)!=null&&t.user&&this.authenticateWithTelegram(s.initData)}}async authenticateWithTelegram(a){try{const s=await(await fetch(`${Y}/auth/telegram`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initData:a})})).json();s.token&&(this.token=s.token,localStorage.setItem("auth_token",s.token))}catch(t){console.error("Telegram authentication failed:",t)}}async makeRequest(a,t={}){try{const s={"Content-Type":"application/json",...t.headers};this.token&&(s.Authorization=`Bearer ${this.token}`);const i=await fetch(`${Y}${a}`,{...t,headers:s}),n=await i.json();return i.ok?{success:!0,data:n}:{error:n.error||`HTTP ${i.status}`}}catch(s){return console.error("API request failed:",s),{error:s instanceof Error?s.message:"Network error"}}}async submitScore(a){return this.makeRequest("/game/score",{method:"POST",body:JSON.stringify(a)})}async getUserStats(){return this.makeRequest("/game/stats")}async getLeaderboard(a="level",t=10){return this.makeRequest(`/game/leaderboard?type=${a}&limit=${t}`)}async refillEnergy(){return this.makeRequest("/game/refill-energy",{method:"POST"})}isAuthenticated(){return!!this.token}setToken(a){this.token=a,localStorage.setItem("auth_token",a)}clearToken(){this.token=null,localStorage.removeItem("auth_token")}}const N=new qe,Be={mode:"menu",isPlaying:!1,isPaused:!1,gameTime:0,score:0},Ve={id:"player1",name:"Смельчак",volts:0,level:1,experience:0,streak:0,totalClicks:0,successfulClicks:0,shockedClicks:0,luckCoefficient:50,luckIndicatorHidden:!1,luckHiddenUntil:0,survivalTime:0},X={difficulty:"easy",aiPattern:"regular",currentRisk:"low",streakCount:0,timeInSafeZone:0,lastClickTime:0,dangerLevel:0,warningSignsActive:!1},We={volume:.7,enabled:!0,backgroundMusicEnabled:!0},ze=[{id:"first_click",name:"Первое прикосновение",description:"Нажми на розетку впервые",icon:"⚡",requirement:1,progress:0,completed:!1,reward:50,category:"special"},{id:"survivor_5",name:"Живчик",description:"Серия из 5 успешных нажатий",icon:"🏃",requirement:5,progress:0,completed:!1,reward:100,category:"streak"},{id:"survivor_25",name:"Неубиваемый",description:"Серия из 25 успешных нажатий",icon:"�",requirement:25,progress:0,completed:!1,reward:500,category:"streak"},{id:"risk_taker",name:"Безрассудный",description:"50 нажатий в режиме High Risk",icon:"🔥",requirement:50,progress:0,completed:!1,reward:500,category:"risk"},{id:"time_survivor",name:"Выживальщик",description:"Выживи 5 минут без поражения",icon:"⏰",requirement:300,progress:0,completed:!1,reward:1e3,category:"survival"}],E=Ue((r,a)=>({gameState:Be,player:Ve,singleMode:X,achievements:ze,sounds:We,showElectricSparks:!1,sparksIntensity:"medium",showScreenShake:!1,levelUpNotification:{isVisible:!1,level:null,voltsReward:0},startSingleMode:t=>{r({gameState:{...a().gameState,mode:"single",isPlaying:!0,gameTime:0,score:0},singleMode:{...X,difficulty:t}})},clickOutlet:()=>{const t=a(),s=Date.now(),i=s-t.singleMode.lastClickTime;let n="low";i<1e3?n="extreme":i<2e3?n="high":i<3e3&&(n="medium");const l=Math.min(100,t.singleMode.streakCount*2+(n==="extreme"?40:n==="high"?25:n==="medium"?15:5)+(t.player.luckCoefficient<30?20:0)),o=l>60;r({player:{...t.player,totalClicks:t.player.totalClicks+1},singleMode:{...t.singleMode,lastClickTime:s,currentRisk:n,dangerLevel:l,warningSignsActive:o}}),a().updateLuckCoefficient()},updateScore:t=>{const s=a(),i=s.gameState.score+t.totalPoints,n=s.player.volts+t.totalPoints,l=t.reason!=="Поражение током",o=l?s.player.streak+1:0,u=l?s.singleMode.streakCount+1:0;let m=0;l?(m=T.SAFE_CLICK,t.riskMultiplier>=2&&(m=T.RISKY_CLICK),t.riskMultiplier>=3&&(m=T.EXTREME_CLICK),o===5&&(m+=T.STREAK_5),o===10&&(m+=T.STREAK_10),o===25&&(m+=T.STREAK_25),o===50&&(m+=T.STREAK_50)):m=T.SHOCK_SURVIVAL;const d=l?s.player.successfulClicks+1:s.player.successfulClicks,g=l?s.player.shockedClicks:s.player.shockedClicks+1,h=d+g,f=h>0?Math.round(d/h*100):50;r({gameState:{...s.gameState,score:i},player:{...s.player,volts:n,streak:o,successfulClicks:d,shockedClicks:g,luckCoefficient:f},singleMode:{...s.singleMode,streakCount:u}});const{addExperience:v}=a();v(m);const{unlockAchievement:p}=a();s.player.totalClicks===0&&p("first_click"),o===5&&p("survivor_5"),o===10&&p("survivor_10"),o===25&&p("survivor_25")},calculateShockImpact:t=>{let s,i,n,l;t<50?(s=Math.floor(t*.1)+1,i="mild",n=1e3,l=2e3):t<150?(s=Math.floor(t*.15)+5,i="moderate",n=1500,l=3e3):t<300?(s=Math.floor(t*.2)+10,i="severe",n=2e3,l=5e3):(s=Math.floor(t*.25)+20,i="critical",n=3e3,l=8e3);const o=Math.floor(t*.7);return{damage:s,voltsDrained:o,duration:n,severity:i,luckHideDuration:l}},triggerShock:()=>{const t=a();if(!t.gameState.isPlaying)return;const s=t.calculateShockImpact(t.player.volts);r({player:{...t.player,volts:Math.max(0,t.player.volts-s.voltsDrained),shockedClicks:t.player.shockedClicks+1,totalClicks:t.player.totalClicks+1,streak:0,luckIndicatorHidden:!0,luckHiddenUntil:Date.now()+s.luckHideDuration},showElectricSparks:!0,sparksIntensity:s.severity==="critical"?"extreme":s.severity==="severe"?"high":s.severity==="moderate"?"medium":"low",showScreenShake:!0,gameState:{...t.gameState,score:Math.max(0,t.gameState.score-s.damage)},singleMode:{...t.singleMode,streakCount:0}}),setTimeout(()=>{r({showElectricSparks:!1,showScreenShake:!1})},s.duration),a().updateLuckCoefficient()},endGame:()=>{r({gameState:{...a().gameState,mode:"menu",isPlaying:!1}})},unlockAchievement:t=>{const s=a(),i=s.achievements.find(n=>n.id===t);i&&!i.completed&&r({achievements:s.achievements.map(n=>n.id===t?{...n,completed:!0,progress:n.requirement}:n),player:{...s.player,volts:s.player.volts+i.reward}})},updatePlayerStats:t=>{const s=a();r({player:{...s.player,...t}})},addExperience:t=>{const s=a(),i=s.player.experience+t,n=H(s.player.experience),l=H(i);if(l.level>n.level){const o=s.player.volts+l.voltsReward;r({player:{...s.player,experience:i,level:l.level,volts:o}});const{showLevelUpNotification:u}=a();u(l,l.voltsReward)}else r({player:{...s.player,experience:i}})},getCurrentLevelInfo:()=>{const t=a();return{currentLevel:H(t.player.experience),progressInfo:ne(t.player.experience)}},showLevelUpNotification:(t,s)=>{r({levelUpNotification:{isVisible:!0,level:t,voltsReward:s}})},hideLevelUpNotification:()=>{r({levelUpNotification:{isVisible:!1,level:null,voltsReward:0}})},updateLuckCoefficient:()=>{const t=a(),s=t.player.totalClicks,i=t.player.successfulClicks,n=s>0?Math.round(i/s*100):50,l=t.player.luckIndicatorHidden&&Date.now()>=t.player.luckHiddenUntil;r({player:{...t.player,luckCoefficient:n,luckIndicatorHidden:l?!1:t.player.luckIndicatorHidden}})},submitGameToServer:async()=>{const t=a();if(!N.isAuthenticated())return console.warn("User not authenticated, skipping server submission"),{success:!1,error:"Not authenticated"};try{const s={score:t.gameState.score,level:Ge(t.singleMode.difficulty),timePlayed:Math.floor(t.gameState.gameTime/1e3)};console.log("Submitting game data to server:",s);const i=await N.submitScore(s);if(i.error)return console.error("Failed to submit score:",i.error),{success:!1,error:i.error};if(i.data){const n=i.data;if(r({player:{...t.player,volts:n.totalVolts,experience:n.totalExperience,level:n.newLevel}}),n.leveledUp){const{showLevelUpNotification:l}=a();l({level:n.newLevel},n.levelUpReward)}return console.log("Successfully submitted score and synced with server"),{success:!0}}return{success:!0}}catch(s){const i=s instanceof Error?s.message:"Unknown error";return console.error("Error submitting game to server:",i),{success:!1,error:i}}},syncWithServer:async()=>{if(!N.isAuthenticated())return{success:!1,error:"Not authenticated"};try{const t=await N.getUserStats();if(t.error)return{success:!1,error:t.error};if(t.data){const s=t.data;return r({player:{...a().player,volts:s.totalVolts,experience:s.totalExperience,level:s.level}}),console.log("Successfully synced with server"),{success:!0}}return{success:!0}}catch(t){const s=t instanceof Error?t.message:"Unknown error";return console.error("Error syncing with server:",s),{success:!1,error:s}}},loadStatsFromServer:async()=>{if(!N.isAuthenticated())return{success:!1,error:"Not authenticated"};try{const t=await N.getUserStats();if(t.error)return{success:!1,error:t.error};if(t.data){const s=t.data;return r({player:{...a().player,volts:s.totalVolts,experience:s.totalExperience,level:s.level}}),console.log("Successfully loaded stats from server"),{success:!0}}return{success:!0}}catch(t){const s=t instanceof Error?t.message:"Unknown error";return console.error("Error loading stats from server:",s),{success:!1,error:s}}}}));function Ge(r){switch(r){case"easy":return 1;case"medium":return 2;case"hard":return 3;case"extreme":return 4;default:return 1}}class Ke{constructor(){C(this,"hapticFeedback",null);C(this,"isEnabled",!0);C(this,"isTelegramEnvironment",!1);this.initializeTelegramHaptics()}initializeTelegramHaptics(){var a;try{if(typeof window<"u"&&((a=window.Telegram)!=null&&a.WebApp)){this.isTelegramEnvironment=!0;const t=window.Telegram.WebApp;t.HapticFeedback?(this.hapticFeedback=t.HapticFeedback,console.log("Telegram Haptic Feedback initialized")):console.log("HapticFeedback not available in this Telegram version")}else console.log("Not in Telegram environment, haptics disabled")}catch(t){console.warn("Failed to initialize Telegram haptics:",t)}}setEnabled(a){this.isEnabled=a}isAvailable(){return(this.isTelegramEnvironment&&this.hapticFeedback!==null||typeof window<"u"&&"navigator"in window&&"vibrate"in navigator)&&this.isEnabled}light(){this.isAvailable()?this.hapticFeedback.impactOccurred("light"):this.fallbackVibration(50)}medium(){this.isAvailable()?this.hapticFeedback.impactOccurred("medium"):this.fallbackVibration(100)}heavy(){this.isAvailable()?this.hapticFeedback.impactOccurred("heavy"):this.fallbackVibration(150)}soft(){this.isAvailable()?this.hapticFeedback.impactOccurred("soft"):this.fallbackVibration(30)}rigid(){this.isAvailable()?this.hapticFeedback.impactOccurred("rigid"):this.fallbackVibration(200)}success(){this.isAvailable()?this.hapticFeedback.notificationOccurred("success"):this.customPattern([100,50,100])}error(){this.isAvailable()?this.hapticFeedback.notificationOccurred("error"):this.customPattern([200,100,200,100,200])}warning(){this.isAvailable()?this.hapticFeedback.notificationOccurred("warning"):this.customPattern([150,50,150])}selection(){this.isAvailable()?this.hapticFeedback.selectionChanged():this.fallbackVibration(25)}outletPress(){this.medium()}survivalSuccess(){this.success()}electricShock(){this.isEnabled&&(this.rigid(),setTimeout(()=>{this.isEnabled&&this.heavy()},50))}electricWarning(){this.isEnabled&&(this.light(),setTimeout(()=>{this.isEnabled&&this.light()},100))}levelUp(){this.success(),setTimeout(()=>this.medium(),150),setTimeout(()=>this.success(),300)}dangerWarning(){this.isEnabled&&(this.light(),setTimeout(()=>{this.isEnabled&&this.light()},100))}extremeDangerWarning(){this.isEnabled&&(this.light(),setTimeout(()=>{this.isEnabled&&this.medium()},150),setTimeout(()=>{this.isEnabled&&this.heavy()},300))}rewardReceived(){this.light(),setTimeout(()=>this.medium(),100)}streakAchievement(a){a>=25?(this.heavy(),setTimeout(()=>this.heavy(),200),setTimeout(()=>this.heavy(),400)):a>=10?(this.medium(),setTimeout(()=>this.medium(),150)):a>=5&&(this.light(),setTimeout(()=>this.light(),100))}itemUsed(){this.soft()}shopPurchase(){this.medium(),setTimeout(()=>this.light(),100)}gameInvitation(){this.warning(),setTimeout(()=>this.light(),500),setTimeout(()=>this.light(),1e3)}roundStart(){this.light()}gameEnd(a){a?(this.success(),setTimeout(()=>this.medium(),200),setTimeout(()=>this.success(),400)):this.error()}fallbackVibration(a){if("navigator"in window&&"vibrate"in navigator)try{navigator.vibrate(a),console.log(`🔹 Fallback vibration: ${a}ms`)}catch(t){console.warn("Vibration not supported:",t)}else console.log(`📳 Haptic feedback: ${a}ms (visual only)`),this.visualFeedback(a)}visualFeedback(a){const t=document.createElement("div");if(t.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: #FF6B35;
      color: white;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      z-index: 10000;
      pointer-events: none;
      animation: pulse 0.3s ease-in-out;
    `,t.textContent=`📳 ${a}ms`,!document.querySelector("#haptic-style")){const s=document.createElement("style");s.id="haptic-style",s.textContent=`
        @keyframes pulse {
          0% { transform: scale(0.8); opacity: 0; }
          50% { transform: scale(1.1); opacity: 1; }
          100% { transform: scale(1); opacity: 0.8; }
        }
      `,document.head.appendChild(s)}document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},Math.max(a,500))}customPattern(a){if("navigator"in window&&"vibrate"in navigator)try{navigator.vibrate(a),console.log(`🔹 Vibration pattern: [${a.join(", ")}]ms`)}catch(t){console.warn("Vibration pattern not supported:",t)}else console.log(`📳 Haptic pattern: [${a.join(", ")}]ms (visual only)`),this.visualPatternFeedback(a)}visualPatternFeedback(a){let t=0;for(let s=0;s<a.length;s+=2){const i=a[s],n=a[s+1]||0;setTimeout(()=>{this.visualFeedback(i)},t),t+=i+n}}test(){this.medium(),setTimeout(()=>this.light(),200),setTimeout(()=>this.heavy(),400)}}const b=new Ke,Ye=({onClose:r})=>{const{player:a,singleMode:t,gameState:s}=E();return e.jsx(c.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50",onClick:r,children:e.jsxs(c.div,{initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.9},className:"glass-effect p-6 max-w-2xl mx-auto relative max-h-[90vh] overflow-y-auto",onClick:i=>i.stopPropagation(),children:[e.jsx("button",{onClick:r,className:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors text-2xl",children:"✕"}),e.jsx("h3",{className:"text-2xl font-bold text-center mb-6 text-primary-orange",children:"📊 Система очков и уровней"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"ТЕКУЩАЯ СЕРИЯ"}),e.jsx("div",{className:"text-xl font-bold text-yellow-400",children:t.streakCount})]}),e.jsxs("div",{className:"text-center glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"КОЭФФИЦИЕНТ УДАЧИ"}),e.jsxs("div",{className:`text-xl font-bold ${a.luckCoefficient>=70?"text-green-400":a.luckCoefficient>=50?"text-yellow-400":a.luckCoefficient>=30?"text-orange-400":"text-red-400"}`,children:[a.luckCoefficient,"%"]})]}),e.jsxs("div",{className:"text-center glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"ТЕКУЩИЙ СЧЕТ"}),e.jsxs("div",{className:"text-xl font-bold text-green-400",children:[s.score,"⚡"]})]}),e.jsxs("div",{className:"text-center glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"ВСЕГО ВОЛЬТ"}),e.jsxs("div",{className:"text-xl font-bold text-blue-400",children:[a.volts,"⚡"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"🍀 Статистика удачи"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"УСПЕШНЫХ"}),e.jsx("div",{className:"text-lg font-bold text-green-400",children:a.successfulClicks})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"УДАРОВ ТОКОМ"}),e.jsx("div",{className:"text-lg font-bold text-red-400",children:a.shockedClicks})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"ВСЕГО КЛИКОВ"}),e.jsx("div",{className:"text-lg font-bold text-blue-400",children:a.totalClicks})]})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsx("div",{className:"text-sm text-gray-300",children:"💡 Удача рассчитывается как процент успешных нажатий"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"📈 Система опыта и уровней"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-green-400 font-bold",children:"🟢 Безопасное нажатие:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+10 опыта"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-yellow-400 font-bold",children:"🟡 Рискованное (2x+):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+15 опыта"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"🔴 Экстремальное (3x+):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+25 опыта"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-orange-400 font-bold",children:"💥 Поражение током:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+5 опыта"})]})]}),e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("div",{className:"text-sm text-yellow-400 font-semibold",children:"🏆 За повышение уровня вы получаете бонусные вольты!"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Уровень 2: +50⚡ • Уровень 5: +150⚡ • Уровень 10: +500⚡"}),e.jsx("div",{className:"text-xs text-blue-300 mt-2",children:"🎨 Изображение розетки меняется каждые 5 уровней!"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"⚡ Базовые очки за нажатие"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-green-400 font-bold",children:"🟢 Безопасное нажатие:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"+10⚡ (базовые очки)"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"💥 Поражение током:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"-8⚡ до -25⚡ (случайно)"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"🎯 Множители за риск"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-green-400 font-bold",children:"🟢 Лёгкий (15% риск):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×1.0 (базовые очки)"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-yellow-400 font-bold",children:"🟡 Средний (25% риск):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×1.5 множитель"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-orange-400 font-bold",children:"🟠 Сложный (35% риск):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×2.0 множитель"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"🔴 Экстрим (50% риск):"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×3.0 множитель"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"🔥 Бонусы за серии"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-gray-400 font-bold",children:"0-4 нажатий:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×1.0 (без бонуса)"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-yellow-400 font-bold",children:"5+ нажатий:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×1.2 бонус"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-orange-400 font-bold",children:"10+ нажатий:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×1.5 бонус"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"25+ нажатий:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×2.0 бонус"})]}),e.jsxs("div",{className:"glass-effect p-3 rounded-lg",children:[e.jsx("div",{className:"text-purple-400 font-bold",children:"50+ нажатий:"}),e.jsx("div",{className:"text-sm text-gray-300",children:"×3.0 бонус"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"🧮 Формула расчёта"}),e.jsx("div",{className:"glass-effect p-4 rounded-lg bg-gradient-to-r from-blue-500/10 to-purple-500/10",children:e.jsxs("div",{className:"text-center text-lg font-mono",children:[e.jsx("span",{className:"text-white",children:"Итоговые очки"})," =",e.jsx("span",{className:"text-green-400",children:" 10⚡"})," ×",e.jsx("span",{className:"text-orange-400",children:" Риск"})," ×",e.jsx("span",{className:"text-yellow-400",children:" Серия"})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-accent-blue mb-3",children:"💡 Примеры расчётов"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-green-400 font-bold",children:"🟢 Безопасная игра:"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["10⚡ × 1.0 (низкий риск) × 1.2 (5+ серия) = ",e.jsx("span",{className:"text-white font-bold",children:"12⚡"})]})]}),e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-orange-400 font-bold",children:"🟠 Рискованная игра:"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["10⚡ × 2.0 (высокий риск) × 1.5 (10+ серия) = ",e.jsx("span",{className:"text-white font-bold",children:"30⚡"})]})]}),e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"🔴 Экстремальная игра:"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["10⚡ × 3.0 (экстрим риск) × 2.0 (25+ серия) = ",e.jsx("span",{className:"text-white font-bold",children:"60⚡"})]})]}),e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-bold",children:"💥 Поражение током:"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["Случайно от 8⚡ до 25⚡ + ",e.jsx("span",{className:"text-red-400",children:"серия сбрасывается"})]})]})]})]})]}),e.jsx("div",{className:"mt-6 text-center text-xs text-gray-400",children:"💡 Совет: Балансируйте между риском и безопасностью для максимального заработка!"})]})})},Xe=()=>{const{player:r,getCurrentLevelInfo:a}=E(),{currentLevel:t,progressInfo:s}=a(),i=De(r.experience),n=A(t.level),l=s.nextLevel?A(s.nextLevel.level):null,o=l&&l!==n;return e.jsxs("div",{className:"glass-effect p-4 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:A(t.level),alt:`Розетка уровня ${t.level}`,className:"w-12 h-12 rounded-lg border-2 border-primary-orange shadow-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide",children:"Уровень"}),e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("span",{className:"text-2xl font-bold text-primary-orange",children:t.level}),e.jsx("span",{className:"text-sm text-gray-300",children:t.title})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Опыт"}),e.jsx("div",{className:"text-lg font-bold text-accent-blue",children:r.experience.toLocaleString()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[e.jsx("span",{children:s.current}),e.jsx("span",{children:s.nextLevel?`${s.remaining} до ${s.nextLevel.level} уровня`:"Максимум"}),e.jsx("span",{children:s.required})]}),e.jsxs("div",{className:"relative w-full bg-gray-700 rounded-full h-2 overflow-hidden",children:[e.jsx(c.div,{className:"h-full bg-gradient-to-r from-accent-blue to-primary-orange rounded-full",initial:{width:0},animate:{width:`${i}%`},transition:{duration:.8,ease:"easeOut"}}),i>0&&e.jsx(c.div,{className:"absolute top-0 right-0 w-1 h-full bg-white opacity-80",style:{right:`${100-i}%`},animate:{opacity:[.8,.3,.8]},transition:{repeat:1/0,duration:1.5}})]})]}),e.jsx("div",{className:"text-xs text-gray-400 italic text-center",children:t.description}),s.nextLevel&&e.jsxs("div",{className:"text-center pt-2 border-t border-gray-600",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Следующий уровень"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-accent-lime font-semibold",children:s.nextLevel.title}),e.jsx("span",{className:"text-gray-400",children:" • "}),e.jsxs("span",{className:"text-yellow-400",children:["+",s.nextLevel.voltsReward,"⚡"]})]}),o&&e.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-2",children:[e.jsx("span",{className:"text-xs text-blue-300",children:"🎨 Новая розетка:"}),e.jsx("img",{src:l,alt:`Розетка уровня ${s.nextLevel.level}`,className:"w-6 h-6 rounded border border-blue-400 shadow-sm"})]})]})]})},Je=({isVisible:r,onClose:a})=>{const[t,s]=x.useState(!0),[i,n]=x.useState(null);x.useEffect(()=>{const u=localStorage.getItem("hapticEnabled");if(u!==null){const m=JSON.parse(u);s(m),b.setEnabled(m)}},[]);const l=()=>{const u=!t;s(u),b.setEnabled(u),localStorage.setItem("hapticEnabled",JSON.stringify(u)),u&&b.test()},o=(u,m)=>{n(u),m(),setTimeout(()=>n(null),500)};return r?e.jsx(c.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:a,children:e.jsxs(c.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl p-6 max-w-sm w-full border border-primary-orange/20",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary-orange",children:"Вибрация"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white text-2xl",children:"×"})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center p-4 bg-gray-800/50 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Включить вибрацию"}),e.jsx("p",{className:"text-sm text-gray-400",children:b.isAvailable()?"Поддерживается вашим устройством":"Недоступно на вашем устройстве"})]}),e.jsx(c.button,{onClick:l,className:`w-12 h-6 rounded-full p-1 transition-colors ${t?"bg-primary-orange":"bg-gray-600"}`,whileTap:{scale:.95},children:e.jsx(c.div,{className:"w-4 h-4 bg-white rounded-full",animate:{x:t?24:0},transition:{type:"spring",stiffness:500,damping:30}})})]})}),t&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Тест вибрации"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300",children:"Игровые события"}),e.jsx(c.button,{onClick:()=>o("press",()=>b.outletPress()),className:`w-full p-3 rounded-lg border transition-colors ${i==="press"?"bg-blue-500/30 border-blue-400 text-blue-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"🔌 Нажатие на розетку"}),e.jsx(c.button,{onClick:()=>o("success",()=>b.survivalSuccess()),className:`w-full p-3 rounded-lg border transition-colors ${i==="success"?"bg-green-500/30 border-green-400 text-green-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"✅ Успешное выживание"}),e.jsx(c.button,{onClick:()=>o("shock",()=>b.electricShock()),className:`w-full p-3 rounded-lg border transition-colors ${i==="shock"?"bg-red-500/30 border-red-400 text-red-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"⚡ Удар током"}),e.jsx(c.button,{onClick:()=>o("levelup",()=>b.levelUp()),className:`w-full p-3 rounded-lg border transition-colors ${i==="levelup"?"bg-yellow-500/30 border-yellow-400 text-yellow-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"🆙 Повышение уровня"})]}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300",children:"Интенсивность"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(c.button,{onClick:()=>o("light",()=>b.light()),className:`p-2 rounded-lg border text-sm transition-colors ${i==="light"?"bg-gray-500/30 border-gray-400 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"Легкая"}),e.jsx(c.button,{onClick:()=>o("medium",()=>b.medium()),className:`p-2 rounded-lg border text-sm transition-colors ${i==="medium"?"bg-gray-500/30 border-gray-400 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"Средняя"}),e.jsx(c.button,{onClick:()=>o("heavy",()=>b.heavy()),className:`p-2 rounded-lg border text-sm transition-colors ${i==="heavy"?"bg-gray-500/30 border-gray-400 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"Сильная"}),e.jsx(c.button,{onClick:()=>o("rigid",()=>b.rigid()),className:`p-2 rounded-lg border text-sm transition-colors ${i==="rigid"?"bg-gray-500/30 border-gray-400 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-300 hover:bg-gray-600/50"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:"Резкая"})]})]})]}),e.jsx("div",{className:"mt-6 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-300 text-center",children:"💡 Вибрация доступна только в Telegram Mini App на поддерживаемых устройствах"})})]})}):null},le=x.createContext({webApp:null,user:null,isInTelegram:!1,platform:"unknown",colorScheme:"dark"}),Qe=()=>x.useContext(le),Ze=({children:r})=>{const[a,t]=x.useState(null),[s,i]=x.useState(null),[n,l]=x.useState(!1),[o,u]=x.useState("unknown"),[m,d]=x.useState("dark");x.useEffect(()=>{var h,f,v;if(typeof window<"u"&&((h=window.Telegram)!=null&&h.WebApp)){const p=window.Telegram.WebApp;p.ready(),p.expand(),t(p),l(!0),u(p.platform||"unknown"),d(p.colorScheme||"dark"),(f=p.initDataUnsafe)!=null&&f.user&&(i(p.initDataUnsafe.user),console.log("Telegram user:",p.initDataUnsafe.user)),p.setHeaderColor("#000000"),p.setBackgroundColor("#000000"),p.disableClosingConfirmation(),console.log("Telegram WebApp initialized successfully"),p.ready(),p.expand(),console.log("Telegram WebApp Context initialized:",{platform:p.platform,colorScheme:p.colorScheme,user:(v=p.initDataUnsafe)==null?void 0:v.user,version:p.version})}},[]);const g={webApp:a,user:s,isInTelegram:n,platform:o,colorScheme:m};return e.jsx(le.Provider,{value:g,children:r})},et=()=>{var i;const{user:r,isInTelegram:a,platform:t,colorScheme:s}=Qe();return a?e.jsx(c.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-500/30 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[r!=null&&r.photo_url?e.jsx("img",{src:r.photo_url,alt:"Avatar",className:"w-8 h-8 rounded-full border border-blue-400/50"}):e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:((i=r==null?void 0:r.first_name)==null?void 0:i[0])||"?"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-white",children:[r==null?void 0:r.first_name," ",r==null?void 0:r.last_name,(r==null?void 0:r.is_premium)&&e.jsx("span",{className:"ml-1 text-yellow-400",children:"⭐"})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["@",(r==null?void 0:r.username)||"no_username"," • ",t]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:`text-xs px-2 py-1 rounded-full border ${s==="dark"?"bg-gray-800 border-gray-600 text-gray-300":"bg-gray-200 border-gray-400 text-gray-700"}`,children:[s==="dark"?"🌙":"☀️"," ",s]})})]})}):e.jsx("div",{className:"text-xs text-gray-500 text-center p-2",children:"💻 Веб-версия (не в Telegram)"})};function B(){const[r,a]=x.useState({data:null,loading:!1,error:null}),[t,s]=x.useState({data:null,loading:!1,error:null}),[i,n]=x.useState({data:null,loading:!1,error:null}),l=x.useCallback(async d=>{a({data:null,loading:!0,error:null});try{const g=await N.submitScore(d);return g.error?(a({data:null,loading:!1,error:g.error}),{success:!1,error:g.error}):(a({data:g.data,loading:!1,error:null}),{success:!0,data:g.data})}catch(g){const h=g instanceof Error?g.message:"Unknown error";return a({data:null,loading:!1,error:h}),{success:!1,error:h}}},[]),o=x.useCallback(async()=>{s({data:null,loading:!0,error:null});try{const d=await N.getUserStats();return d.error?(s({data:null,loading:!1,error:d.error}),{success:!1,error:d.error}):(s({data:d.data,loading:!1,error:null}),{success:!0,data:d.data})}catch(d){const g=d instanceof Error?d.message:"Unknown error";return s({data:null,loading:!1,error:g}),{success:!1,error:g}}},[]),u=x.useCallback(async(d="level",g=10)=>{n({data:null,loading:!0,error:null});try{const h=await N.getLeaderboard(d,g);return h.error?(n({data:null,loading:!1,error:h.error}),{success:!1,error:h.error}):(n({data:h.data,loading:!1,error:null}),{success:!0,data:h.data})}catch(h){const f=h instanceof Error?h.message:"Unknown error";return n({data:null,loading:!1,error:f}),{success:!1,error:f}}},[]),m=x.useCallback(async()=>{try{const d=await N.refillEnergy();return d.error?{success:!1,error:d.error}:{success:!0,data:d.data}}catch(d){return{success:!1,error:d instanceof Error?d.message:"Unknown error"}}},[]);return{submitScore:l,getUserStats:o,getLeaderboard:u,refillEnergy:m,submitState:r,statsState:t,leaderboardState:i,isAuthenticated:N.isAuthenticated()}}function tt(){const[r,a]=x.useState(navigator.onLine);return x.useState(()=>{const t=()=>a(!0),s=()=>a(!1);return window.addEventListener("online",t),window.addEventListener("offline",s),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}}),{isOnline:r}}const st=()=>{const{startSingleMode:r,player:a,addExperience:t,loadStatsFromServer:s}=E(),{isAuthenticated:i}=B(),[n,l]=x.useState(!1),[o,u]=x.useState(!1),[m,d]=x.useState(!1);x.useEffect(()=>{(async()=>{if(i&&!m){d(!0);try{const v=await s();v.success?console.log("✅ Статистика загружена с сервера"):console.warn("⚠️ Не удалось загрузить статистику с сервера:",v.error)}catch(v){console.error("❌ Ошибка при загрузке статистики:",v)}finally{d(!1)}}})()},[i,s,m]);const g=()=>{t(100)},h=f=>{b.medium(),r(f)};return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-background-dark to-background-darker",children:[e.jsxs(c.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},transition:{duration:.8},className:"text-center mb-8",children:[e.jsx("h1",{className:"text-6xl font-bold text-primary-orange tiger-stripes bg-clip-text text-transparent mb-4",children:"ТИГР"}),e.jsx("h2",{className:"text-4xl font-bold text-accent-blue mb-2",children:"РОЗЕТКА"}),e.jsx("p",{className:"text-lg text-gray-300",children:"Telegram Mini App Game"})]}),e.jsx(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"mb-6",children:e.jsx(Xe,{})}),i&&m&&e.jsxs(c.div,{initial:{opacity:0},animate:{opacity:1},className:"mb-4 text-center text-blue-400 text-sm",children:[e.jsx("span",{className:"inline-block animate-spin mr-2",children:"⏳"}),"Синхронизация с сервером..."]}),!i&&e.jsx(c.div,{initial:{opacity:0},animate:{opacity:1},className:"mb-4 text-center text-yellow-400 text-sm",children:"⚠️ Игра в автономном режиме"}),e.jsx(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.25},className:"mb-4 w-full max-w-md",children:e.jsx(et,{})}),e.jsxs(c.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.3},className:"glass-effect p-6 mb-8 text-center",children:[e.jsxs("div",{className:"text-sm text-gray-300 mb-2",children:["Добро пожаловать, ",a.name,"!"]}),e.jsxs("div",{className:"flex justify-center space-x-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"ВОЛЬТЫ"}),e.jsxs("div",{className:"text-xl font-bold text-primary-orange",children:[a.volts,"⚡"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"УРОВЕНЬ"}),e.jsx("div",{className:"text-xl font-bold text-accent-blue",children:a.level})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"ВСЕГО НАЖАТИЙ"}),e.jsx("div",{className:"text-xl font-bold text-accent-lime",children:a.totalClicks})]})]})]}),e.jsxs(c.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},className:"w-full max-w-md space-y-4",children:[e.jsx("h3",{className:"text-2xl font-bold text-center text-white mb-6",children:"Выберите сложность"}),e.jsx(c.button,{onClick:()=>h("easy"),className:"w-full glass-effect p-4 rounded-xl hover:bg-green-500/20 transition-colors",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-green-400",children:"ЛЁГКИЙ"}),e.jsx("div",{className:"text-sm text-gray-300",children:"15% шанс разряда • 2 сек предупреждение"})]}),e.jsx("div",{className:"text-2xl",children:"🟢"})]})}),e.jsx(c.button,{onClick:()=>h("medium"),className:"w-full glass-effect p-4 rounded-xl hover:bg-yellow-500/20 transition-colors",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-400",children:"СРЕДНИЙ"}),e.jsx("div",{className:"text-sm text-gray-300",children:"25% шанс разряда • 1.5 сек предупреждение"})]}),e.jsx("div",{className:"text-2xl",children:"🟡"})]})}),e.jsx(c.button,{onClick:()=>h("hard"),className:"w-full glass-effect p-4 rounded-xl hover:bg-orange-500/20 transition-colors",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-orange-400",children:"СЛОЖНЫЙ"}),e.jsx("div",{className:"text-sm text-gray-300",children:"35% шанс разряда • 1 сек предупреждение"})]}),e.jsx("div",{className:"text-2xl",children:"🟠"})]})}),e.jsx(c.button,{onClick:()=>h("extreme"),className:"w-full glass-effect p-4 rounded-xl hover:bg-red-500/20 transition-colors",whileHover:{scale:1.02,x:10},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-lg font-bold text-red-400",children:"ЭКСТРИМ"}),e.jsx("div",{className:"text-sm text-gray-300",children:"50% шанс разряда • 0.5 сек предупреждение"})]}),e.jsx("div",{className:"text-2xl",children:"🔴"})]})}),e.jsx(c.button,{onClick:()=>{b.light(),l(!0)},className:"w-full glass-effect p-3 rounded-xl hover:bg-blue-500/20 transition-colors border border-blue-400/30",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:"📊"}),e.jsx("span",{className:"text-lg font-semibold text-blue-400",children:"Очки и уровни"})]})}),e.jsx(c.button,{onClick:()=>{b.light(),u(!0)},className:"w-full glass-effect p-3 rounded-xl hover:bg-purple-500/20 transition-colors border border-purple-400/30",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:"📳"}),e.jsx("span",{className:"text-lg font-semibold text-purple-400",children:"Вибрация"})]})})]}),n&&e.jsx(Ye,{onClose:()=>l(!1)}),o&&e.jsx(Je,{isVisible:o,onClose:()=>u(!1)}),e.jsxs(c.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:1},className:"mt-8 text-center text-gray-400 text-sm space-y-2",children:[e.jsx("p",{children:"⚡ Играй осторожно! ⚡"}),e.jsx("p",{className:"mt-2",children:"v1.0.0 | Single Mode"}),e.jsx("button",{onClick:()=>{b.light(),g()},className:"mt-2 px-3 py-1 text-xs bg-purple-600/30 hover:bg-purple-600/50 text-purple-300 rounded transition-colors",children:"🔧 +100 опыта (тест)"})]})]})};class at{constructor(){C(this,"audioContext",null);C(this,"sounds",new Map);C(this,"volume",.7);C(this,"enabled",!0);this.init()}async init(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(a){console.warn("Web Audio API not supported:",a)}}async loadSound(a,t){if(this.audioContext)try{const i=await(await fetch(t)).arrayBuffer(),n=await this.audioContext.decodeAudioData(i);this.sounds.set(a,n)}catch(s){console.warn(`Failed to load sound ${a}:`,s)}}playSound(a,t=1){if(!this.enabled||!this.audioContext)return;const s=this.sounds.get(a);if(!s)return;const i=this.audioContext.createBufferSource(),n=this.audioContext.createGain();i.buffer=s,n.gain.value=this.volume*t,i.connect(n),n.connect(this.audioContext.destination),i.start()}generateSparkSound(a){if(!this.enabled||!this.audioContext)return;const t={low:.1,medium:.2,high:.3,extreme:.5}[a],s={low:2e3,medium:3e3,high:4e3,extreme:5e3}[a],i=this.audioContext.sampleRate*t,n=this.audioContext.createBuffer(1,i,this.audioContext.sampleRate),l=n.getChannelData(0);for(let m=0;m<i;m++){const d=m/this.audioContext.sampleRate,g=Math.exp(-d*10),h=(Math.random()*2-1)*g,f=Math.sin(2*Math.PI*s*d*(1+Math.random()*.5));l[m]=h*f*.3}const o=this.audioContext.createBufferSource(),u=this.audioContext.createGain();o.buffer=n,u.gain.value=this.volume*(a==="extreme"?.8:.5),o.connect(u),u.connect(this.audioContext.destination),o.start()}generateShockSound(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext.sampleRate*.8,s=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),i=s.getChannelData(0);for(let o=0;o<t;o++){const u=o/this.audioContext.sampleRate,m=Math.exp(-u*3),d=Math.sin(2*Math.PI*100*u),g=Math.sin(2*Math.PI*800*u)*.5,h=(Math.random()*2-1)*.3;i[o]=(d+g+h)*m*.6}const n=this.audioContext.createBufferSource(),l=this.audioContext.createGain();n.buffer=s,l.gain.value=this.volume,n.connect(l),l.connect(this.audioContext.destination),n.start()}generateWarningSound(){if(!this.enabled||!this.audioContext)return;const a=.3,t=this.audioContext.sampleRate*a,s=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),i=s.getChannelData(0);for(let o=0;o<t;o++){const u=o/this.audioContext.sampleRate,m=1e3+Math.sin(u*20)*200,d=Math.sin(Math.PI*u/a);i[o]=Math.sin(2*Math.PI*m*u)*d*.4}const n=this.audioContext.createBufferSource(),l=this.audioContext.createGain();n.buffer=s,l.gain.value=this.volume*.6,n.connect(l),l.connect(this.audioContext.destination),n.start()}setVolume(a){this.volume=Math.max(0,Math.min(1,a))}setEnabled(a){this.enabled=a}getVolume(){return this.volume}isEnabled(){return this.enabled}}const J=new at,rt=({score:r,reason:a,isVisible:t,position:s,type:i,experience:n=0})=>{const l=()=>{switch(i){case"success":return r>=30?"text-yellow-300":r>=20?"text-green-300":"text-blue-300";case"shock":return"text-red-300";case"bonus":return"text-purple-300";default:return"text-white"}},o=()=>{switch(i){case"success":return r>=30?"🔥":r>=20?"⚡":"✨";case"shock":return"💥";case"bonus":return"🎉";default:return"⚡"}};return e.jsx(F,{children:t&&e.jsx(c.div,{className:`absolute pointer-events-none z-50 ${l()}`,initial:{opacity:0,scale:.5,x:s.x,y:s.y},animate:{opacity:[0,1,1,0],scale:[.5,1.2,1,.8],y:s.y-80,x:s.x+(Math.random()-.5)*40},transition:{duration:2,ease:"easeOut"},children:e.jsx("div",{className:"bg-black/80 backdrop-blur-sm rounded-lg px-3 py-2 border border-current",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:o()}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-lg",children:["+",r,"⚡"]}),n>0&&e.jsxs("div",{className:"text-xs text-blue-300",children:["+",n," опыта"]}),e.jsx("div",{className:"text-xs opacity-80",children:a})]})]})})})})},it=({isActive:r,intensity:a="medium",onComplete:t})=>{const[s,i]=x.useState([]);x.useEffect(()=>{r?n():i([])},[r,a]);const n=()=>{const l={low:6,medium:12,high:18,extreme:25}[a],o=["#3B82F6","#EF4444","#FFFFFF","#FBBF24","#8B5CF6"],u=[];for(let m=0;m<l;m++)u.push({id:m,x:Math.random()*100,y:Math.random()*100,angle:Math.random()*360,length:20+Math.random()*60,delay:Math.random()*.3,color:o[Math.floor(Math.random()*o.length)]});i(u),setTimeout(()=>{i([]),t==null||t()},1e3)};return e.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[e.jsx(F,{children:s.map(l=>e.jsxs(c.div,{className:"absolute",style:{left:`${l.x}%`,top:`${l.y}%`,transform:`rotate(${l.angle}deg)`},initial:{opacity:0,scale:0},animate:{opacity:[0,1,.7,0],scale:[0,1,.8,0],x:[0,Math.cos(l.angle*Math.PI/180)*l.length],y:[0,Math.sin(l.angle*Math.PI/180)*l.length]},transition:{duration:.6,delay:l.delay,ease:"easeOut"},children:[e.jsx("div",{className:"w-1 bg-gradient-to-r opacity-90 rounded-full shadow-lg",style:{height:`${l.length}px`,backgroundColor:l.color,boxShadow:`0 0 8px ${l.color}, 0 0 16px ${l.color}40`}}),e.jsx("div",{className:"absolute top-0 left-0 w-1 blur-sm opacity-60 rounded-full",style:{height:`${l.length}px`,backgroundColor:l.color}})]},l.id))}),e.jsx(F,{children:r&&e.jsx(c.svg,{className:"absolute inset-0 w-full h-full",initial:{opacity:0},animate:{opacity:[0,1,.8,.2,.9,0]},transition:{duration:.8,times:[0,.1,.3,.5,.7,1]},children:Array.from({length:3},(l,o)=>{const u=20+Math.random()*60,m=20+Math.random()*60,d=5+Math.floor(Math.random()*5);let g=`M ${u} ${m}`,h=u,f=m;for(let v=0;v<d;v++)h+=(Math.random()-.5)*40,f+=(Math.random()-.5)*40,g+=` L ${h} ${f}`;return e.jsx(c.path,{d:g,stroke:"#FFFFFF",strokeWidth:Math.random()*2+1,fill:"none",opacity:.8,filter:"drop-shadow(0 0 4px #3B82F6)",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.3,delay:o*.1,ease:"easeOut"}},o)})})}),e.jsx(F,{children:r&&e.jsx(c.div,{className:"absolute inset-0 bg-white mix-blend-screen",initial:{opacity:0},animate:{opacity:[0,.4,.1,.3,0]},transition:{duration:.5,times:[0,.1,.3,.6,1]}})})]})},nt=()=>{const{player:r}=E(),[a,t]=x.useState(A(r.level)),[s,i]=x.useState(!1);return x.useEffect(()=>{const n=A(r.level);console.log(`Player level: ${r.level}, Image path: ${n}`),n!==a&&(i(!0),setTimeout(()=>{t(n),i(!1)},300))},[r.level,a]),{currentImage:a,isAnimating:s}},lt=({className:r="",onShock:a})=>{const{clickOutlet:t,singleMode:s,gameState:i,updateScore:n,triggerShock:l}=E(),{currentImage:o,isAnimating:u}=nt(),[m,d]=x.useState([]),[g,h]=x.useState(!1),[f,v]=x.useState(1),[p,I]=x.useState(!1),[w,S]=x.useState({visible:!1,score:0,reason:"",type:"success"}),L=x.useCallback((y,P,k)=>{S({visible:!0,score:y,reason:P,type:k}),setTimeout(()=>{S(j=>({...j,visible:!1}))},2e3)},[]),V=x.useCallback(y=>{const P={low:3,medium:6,high:12,extreme:20}[y],k=Array.from({length:P},(j,R)=>({id:`spark-${Date.now()}-${R}`,x:Math.random()*200-100,y:Math.random()*200-100,intensity:y,duration:300+Math.random()*200,color:y==="extreme"?"#E8FF00":y==="high"?"#00D4FF":y==="medium"?"#8A2BE2":"#FF6B35"}));d(j=>[...j,...k]),k.forEach(j=>{setTimeout(()=>{d(R=>R.filter(_=>_.id!==j.id))},j.duration)})},[]),oe=x.useCallback(()=>{if(!i.isPlaying)return;s.warningSignsActive&&(s.dangerLevel>80?b.extremeDangerWarning():s.dangerLevel>60&&b.dangerWarning()),b.outletPress(),h(!0),t();const y={easy:.15,medium:.25,hard:.35,extreme:.5}[s.difficulty];if(Math.random()<y)I(!0),v(3),a==null||a(),b.electricShock(),J.generateShockSound(),l(),setTimeout(()=>{I(!1)},1e3),setTimeout(()=>{const k=window.lastPenaltyMessage;if(k)L(0,k,"shock"),window.lastPenaltyMessage=null;else{const j={basePoints:8,riskMultiplier:1,streakBonus:0,timeBonus:0,totalPoints:8+Math.floor(Math.random()*17),reason:"Поражение током"};n(j),L(j.totalPoints,j.reason,"shock")}},100);else{const k=s.currentRisk==="extreme"?"extreme":s.currentRisk==="high"?"high":s.currentRisk==="medium"?"medium":"low";V(k),v(2),b.survivalSuccess(),J.generateSparkSound(k);const j=10,R={low:1,medium:1.5,high:2,extreme:3}[s.currentRisk],_=s.streakCount>=25?3:s.streakCount>=10?2:s.streakCount>=5?1.5:1,ce=Math.floor(j*R*_),U={basePoints:j,riskMultiplier:R,streakBonus:_,timeBonus:0,totalPoints:ce,reason:`Выживание (${s.currentRisk} риск)`};n(U),L(U.totalPoints,U.reason,"success"),s.streakCount>0&&s.streakCount%5===0&&b.streakAchievement(s.streakCount)}setTimeout(()=>{h(!1),v(1)},200)},[i.isPlaying,s,t,V,n]);return e.jsxs("div",{className:`relative ${r}`,children:[e.jsxs(c.button,{onClick:oe,disabled:!i.isPlaying,className:"relative w-64 h-64 rounded-2xl overflow-hidden disabled:opacity-50 bg-gray-800",whileTap:{scale:.95},whileHover:{scale:1.05},animate:{scale:g?.9:1,filter:`brightness(${f}) saturate(${f})`,rotateY:u?[0,180,360]:0},transition:{rotateY:{duration:.6,ease:"easeInOut"}},style:{boxShadow:`0 0 ${20*f}px rgba(255, 107, 53, ${.5*f})`},children:[e.jsx("img",{src:o,alt:"Tiger Outlet",className:"absolute inset-0 w-full h-full object-cover rounded-2xl",onError:y=>{console.error("Image failed to load:",o),console.error("Error event:",y),console.error("Current window location:",window.location.href),console.error("Trying full path:",`${window.location.origin}${o}`),y.currentTarget.style.display="none"},onLoad:()=>{console.log("Image loaded successfully:",o)}}),e.jsx("div",{className:"absolute inset-0 tiger-stripes opacity-20 mix-blend-overlay"}),e.jsx(c.div,{className:"absolute inset-0 rounded-2xl",animate:{boxShadow:s.warningSignsActive?`0 0 ${30*f}px #FF0000, inset 0 0 ${30*f}px #FF0000`:`0 0 ${15*f}px #FF6B35, inset 0 0 ${15*f}px #FF6B35`},transition:{duration:s.warningSignsActive?.1:.2}}),s.dangerLevel>50&&e.jsx(c.div,{className:"absolute -top-12 left-1/2 transform -translate-x-1/2",initial:{opacity:0,scale:0},animate:{opacity:[.7,1,.7,1],scale:[.8,1.2,.8,1.2]},transition:{duration:1,repeat:1/0,ease:"easeInOut"},children:e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-bold ${s.dangerLevel>80?"bg-red-500 text-white":s.dangerLevel>70?"bg-orange-500 text-white":"bg-yellow-500 text-black"}`,children:s.dangerLevel>80?"🔴 КРИТИЧНО":s.dangerLevel>70?"🟠 ОПАСНО":"🟡 РИСК"})}),e.jsx(it,{isActive:p,intensity:"extreme",onComplete:()=>I(!1)})]}),e.jsx(F,{children:m.map(y=>e.jsx(c.div,{className:"absolute w-2 h-2 rounded-full pointer-events-none",style:{backgroundColor:y.color,boxShadow:`0 0 10px ${y.color}`,left:"50%",top:"50%"},initial:{x:0,y:0,scale:0,opacity:1},animate:{x:y.x,y:y.y,scale:[0,1.5,.8,0],opacity:[1,1,.5,0],rotate:[0,180,360]},transition:{duration:y.duration/1e3,ease:"easeOut"}},y.id))}),e.jsx("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2",children:e.jsxs("div",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.currentRisk==="extreme"?"bg-red-500 text-white":s.currentRisk==="high"?"bg-orange-500 text-white":s.currentRisk==="medium"?"bg-yellow-500 text-black":"bg-green-500 text-white"}`,children:[s.currentRisk==="extreme"?"ЭКСТРИМ":s.currentRisk==="high"?"ВЫСОКИЙ":s.currentRisk==="medium"?"СРЕДНИЙ":"НИЗКИЙ"," РИСК"]})}),e.jsx(rt,{score:w.score,reason:w.reason,isVisible:w.visible,position:{x:0,y:-32},type:w.type})]})},ot=({className:r=""})=>{const{isAuthenticated:a}=B(),{isOnline:t}=tt(),i=t?a?{text:"Подключено к серверу",color:"text-green-400",icon:"✅",bgColor:"bg-green-500/10"}:{text:"Автономный режим",color:"text-yellow-400",icon:"⚠️",bgColor:"bg-yellow-500/10"}:{text:"Нет подключения",color:"text-red-400",icon:"❌",bgColor:"bg-red-500/10"};return e.jsx(c.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:`glass-effect p-2 rounded-lg ${i.bgColor} ${r}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:i.icon}),e.jsx("span",{className:`text-xs font-medium ${i.color}`,children:i.text})]})})},ct=()=>{const{player:r,gameState:a,singleMode:t}=E();return e.jsxs("div",{className:"fixed top-0 left-0 right-0 z-10 bg-black/20 backdrop-blur-sm border-b border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center p-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(c.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"СЧЁТ"}),e.jsx("div",{className:"text-xl font-bold text-accent-lime",children:a.score.toLocaleString()})]}),e.jsxs(c.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"ВОЛЬТЫ"}),e.jsxs("div",{className:"text-xl font-bold text-primary-orange",children:[r.volts.toLocaleString(),"⚡"]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs(c.div,{className:"glass-effect px-4 py-2",animate:{scale:t.streakCount>0?[1,1.1,1]:1,boxShadow:t.streakCount>=5?"0 0 20px #E8FF00":"0 0 10px rgba(255,255,255,0.2)"},transition:{duration:.3},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"СЕРИЯ"}),e.jsx("div",{className:`text-xl font-bold ${t.streakCount>=25?"text-red-400":t.streakCount>=10?"text-orange-400":t.streakCount>=5?"text-yellow-400":"text-white"}`,children:t.streakCount})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(c.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},animate:{opacity:r.luckIndicatorHidden&&Date.now()<r.luckHiddenUntil?.3:1},transition:{duration:.3},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"УДАЧА"}),e.jsx("div",{className:`text-sm font-bold ${r.luckIndicatorHidden&&Date.now()<r.luckHiddenUntil?"text-gray-500":r.luckCoefficient>=70?"text-green-400":r.luckCoefficient>=50?"text-yellow-400":r.luckCoefficient>=30?"text-orange-400":"text-red-400"}`,children:r.luckIndicatorHidden&&Date.now()<r.luckHiddenUntil?"???":`${r.luckCoefficient}%`})]}),e.jsxs(c.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"СЛОЖНОСТЬ"}),e.jsx("div",{className:`text-sm font-bold ${t.difficulty==="extreme"?"text-red-400":t.difficulty==="hard"?"text-orange-400":t.difficulty==="medium"?"text-yellow-400":"text-green-400"}`,children:t.difficulty==="extreme"?"ЭКСТРИМ":t.difficulty==="hard"?"СЛОЖНЫЙ":t.difficulty==="medium"?"СРЕДНИЙ":"ЛЁГКИЙ"})]}),e.jsxs(c.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"НАЖАТИЙ"}),e.jsx("div",{className:"text-lg font-bold text-accent-blue",children:r.totalClicks})]}),e.jsx(ot,{})]})]}),t.warningSignsActive&&e.jsx(c.div,{className:"bg-yellow-500/80 text-black px-4 py-2 text-center font-bold",initial:{opacity:0,y:-20},animate:{opacity:[0,1,.7,1,.7,1],y:0},transition:{duration:.5},children:"⚠️ ОПАСНОСТЬ! ВЫСОКИЙ РИСК РАЗРЯДА! ⚠️"}),t.dangerLevel>30&&e.jsxs(c.div,{className:`px-4 py-1 text-center text-xs font-semibold ${t.dangerLevel>70?"bg-red-500/60 text-white":t.dangerLevel>50?"bg-orange-500/60 text-white":"bg-yellow-500/60 text-black"}`,initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:["🔥 УРОВЕНЬ ОПАСНОСТИ: ",t.dangerLevel,"% 🔥"]})]})},dt=({isActive:r,intensity:a="medium",duration:t=500,onComplete:s})=>{const i={low:5,medium:10,high:15,extreme:20}[a];return x.useEffect(()=>{if(r&&s){const n=setTimeout(s,t);return()=>clearTimeout(n)}},[r,t,s]),r?e.jsx(c.div,{className:"fixed inset-0 pointer-events-none z-50",initial:{x:0,y:0},animate:{x:[0,-i,i,-i,i,0],y:[0,i,-i,i,-i,0]},transition:{duration:t/1e3,times:[0,.1,.2,.3,.4,1],ease:"easeInOut"},children:e.jsx(c.div,{className:"absolute inset-0 bg-red-500 mix-blend-multiply",initial:{opacity:0},animate:{opacity:[0,.3,0,.2,0]},transition:{duration:t/1e3}})}):null},ut=()=>{const{gameState:r,singleMode:a,endGame:t,player:s,submitGameToServer:i}=E(),{isAuthenticated:n}=B(),[l,o]=x.useState(0),[u,m]=x.useState(!1),[d,g]=x.useState(!1),[h,f]=x.useState(!1),v=x.useCallback(()=>{f(!0),setTimeout(()=>{f(!1)},600)},[]);x.useEffect(()=>{if(!r.isPlaying)return;const w=setInterval(()=>{o(S=>S+1)},1e3);return()=>clearInterval(w)},[r.isPlaying]),x.useEffect(()=>{l>=600&&m(!0)},[l]);const p=async()=>{if(m(!1),o(0),n&&r.score>0){g(!0);try{const w=E.getState();w.gameState.gameTime=l*1e3;const S=await i();S.success?console.log("✅ Игра успешно сохранена на сервер"):console.warn("⚠️ Не удалось сохранить игру на сервер:",S.error)}catch(w){console.error("❌ Ошибка при сохранении игры:",w)}finally{g(!1)}}t()},I=w=>{const S=Math.floor(w/60),L=w%60;return`${S.toString().padStart(2,"0")}:${L.toString().padStart(2,"0")}`};return u?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background-dark to-background-darker",children:e.jsxs(c.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"glass-effect p-8 text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold text-primary-orange mb-4",children:"Игра окончена!"}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Время игры:"}),e.jsx("span",{className:"font-bold",children:I(l)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Финальный счёт:"}),e.jsx("span",{className:"font-bold text-accent-lime",children:r.score.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Получено вольт:"}),e.jsxs("span",{className:"font-bold text-primary-orange",children:[r.score,"⚡"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Всего нажатий:"}),e.jsx("span",{className:"font-bold text-accent-blue",children:s.totalClicks})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Лучшая серия:"}),e.jsx("span",{className:"font-bold text-yellow-400",children:s.streak})]})]}),n&&r.score>0&&e.jsx("div",{className:"mb-4 text-center",children:d?e.jsxs("div",{className:"text-blue-400 text-sm",children:[e.jsx("span",{className:"inline-block animate-spin mr-2",children:"⏳"}),"Сохранение результатов..."]}):e.jsx("div",{className:"text-green-400 text-sm",children:"✅ Результаты будут сохранены на сервер"})}),!n&&r.score>0&&e.jsx("div",{className:"mb-4 text-center text-yellow-400 text-sm",children:"⚠️ Результаты сохраняются только локально"}),e.jsx(c.button,{onClick:p,disabled:d,className:"w-full glass-effect p-3 rounded-xl hover:bg-primary-orange/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",whileHover:{scale:d?1:1.05},whileTap:{scale:d?1:.95},children:e.jsx("span",{className:"font-bold",children:d?"Сохранение...":"Вернуться в меню"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{isActive:h}),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background-dark to-background-darker relative",children:[e.jsx(ct,{}),e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen pt-24 pb-8",children:[e.jsx(c.div,{className:"glass-effect px-6 py-3 mb-8",animate:{scale:l%10===0&&l>0?[1,1.1,1]:1},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"ВРЕМЯ ИГРЫ"}),e.jsx("div",{className:"text-2xl font-bold text-white font-mono",children:I(l)})]})}),e.jsx(lt,{className:"mb-8",onShock:v}),e.jsx("div",{className:"flex space-x-4 text-center",children:e.jsxs(c.div,{className:"glass-effect px-4 py-2",whileHover:{scale:1.05},children:[e.jsx("div",{className:"text-xs text-gray-300",children:"ПОСЛЕДНИЙ РИСК"}),e.jsx("div",{className:`text-sm font-bold ${a.currentRisk==="extreme"?"text-red-400":a.currentRisk==="high"?"text-orange-400":a.currentRisk==="medium"?"text-yellow-400":"text-green-400"}`,children:a.currentRisk==="extreme"?"ЭКСТРИМ":a.currentRisk==="high"?"ВЫСОКИЙ":a.currentRisk==="medium"?"СРЕДНИЙ":"НИЗКИЙ"})]})}),e.jsx(c.button,{onClick:p,className:"mt-8 glass-effect px-6 py-3 rounded-xl hover:bg-red-500/20 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx("span",{className:"text-red-300 font-bold",children:"Завершить игру"})})]}),e.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden",children:e.jsx(c.div,{className:"absolute inset-0 opacity-10",animate:{backgroundPosition:["0% 0%","100% 100%"]},transition:{duration:20,repeat:1/0,ease:"linear"},style:{backgroundImage:`
              linear-gradient(0deg, transparent 24%, rgba(255, 107, 53, 0.05) 25%, rgba(255, 107, 53, 0.05) 26%, transparent 27%, transparent 74%, rgba(255, 107, 53, 0.05) 75%, rgba(255, 107, 53, 0.05) 76%, transparent 77%, transparent),
              linear-gradient(90deg, transparent 24%, rgba(255, 107, 53, 0.05) 25%, rgba(255, 107, 53, 0.05) 26%, transparent 27%, transparent 74%, rgba(255, 107, 53, 0.05) 75%, rgba(255, 107, 53, 0.05) 76%, transparent 77%, transparent)
            `,backgroundSize:"50px 50px"}})})]})]})},xt=({isVisible:r,newLevel:a,voltsReward:t,onClose:s})=>{if(x.useEffect(()=>{r&&b.levelUp()},[r]),!a||!a.level)return r&&console.warn("LevelUpNotification: newLevel is invalid",a),null;const i=A(a.level),n=A(a.level-1),l=i!==n;return e.jsx(F,{children:r&&e.jsx(c.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",onClick:s,children:e.jsxs(c.div,{initial:{scale:.5,opacity:0,rotateY:-90},animate:{scale:1,opacity:1,rotateY:0},exit:{scale:.5,opacity:0,rotateY:90},transition:{type:"spring",stiffness:300,damping:20,duration:.6},className:"glass-effect p-8 max-w-md mx-4 text-center relative overflow-hidden",onClick:o=>o.stopPropagation(),children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(20)].map((o,u)=>e.jsx(c.div,{className:"absolute w-1 h-1 bg-yellow-300 rounded-full",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`},animate:{opacity:[0,1,0],scale:[0,1,0]},transition:{duration:2,repeat:1/0,delay:Math.random()*2}},u))}),e.jsxs(c.div,{animate:{scale:[1,1.1,1]},transition:{duration:.6,delay:.3},children:[e.jsx("div",{className:"text-6xl mb-4",children:"🎉"}),e.jsx(c.h2,{className:"text-3xl font-bold text-primary-orange mb-2",animate:{textShadow:["0 0 10px rgba(255, 107, 53, 0.5)","0 0 20px rgba(255, 107, 53, 0.8)","0 0 10px rgba(255, 107, 53, 0.5)"]},transition:{duration:1.5,repeat:1/0},children:"НОВЫЙ УРОВЕНЬ!"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-5xl font-bold text-accent-blue mb-2",children:a.level}),e.jsx("div",{className:"text-xl text-yellow-300 font-semibold mb-1",children:a.title}),e.jsx("div",{className:"text-sm text-gray-300 italic",children:a.description})]}),e.jsxs(c.div,{className:"glass-effect p-4 rounded-lg bg-gradient-to-r from-yellow-500/20 to-orange-500/20",animate:{boxShadow:["0 0 20px rgba(255, 193, 7, 0.3)","0 0 30px rgba(255, 193, 7, 0.6)","0 0 20px rgba(255, 193, 7, 0.3)"]},transition:{duration:2,repeat:1/0},children:[e.jsx("div",{className:"text-lg font-bold text-yellow-300 mb-1",children:"Награда за уровень:"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:["+",t,"⚡ Вольт"]}),l&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-yellow-400/30",children:[e.jsx("div",{className:"text-sm font-bold text-blue-300 mb-2",children:"🎨 Новое изображение розетки!"}),e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Было:"}),e.jsx("img",{src:n,alt:"Предыдущая розетка",className:"w-8 h-8 rounded border border-gray-600"})]}),e.jsx("div",{className:"text-yellow-400",children:"→"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Стало:"}),e.jsx("img",{src:i,alt:"Новая розетка",className:"w-8 h-8 rounded border border-blue-400"})]})]})]})]})]}),e.jsx(c.button,{onClick:s,className:"mt-6 px-6 py-3 bg-primary-orange hover:bg-primary-orange/80 text-white font-bold rounded-lg transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Продолжить"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[...Array(15)].map((o,u)=>e.jsx(c.div,{className:"absolute w-2 h-2 rounded-full",style:{backgroundColor:["#FFD700","#FF6B35","#00D4FF","#E8FF00","#8A2BE2"][u%5],left:`${50+(Math.random()-.5)*60}%`,top:"20%"},animate:{y:["0vh","80vh"],x:[(Math.random()-.5)*200,(Math.random()-.5)*400],rotate:[0,360],opacity:[1,0]},transition:{duration:3,delay:Math.random()*.5,ease:"easeOut"}},`confetti-${u}`))})]})})})};function mt(){const{gameState:r,levelUpNotification:a,hideLevelUpNotification:t}=E();return x.useEffect(()=>{var s,i;if(typeof window<"u"&&((s=window.Telegram)!=null&&s.WebApp)){const n=window.Telegram.WebApp;n.ready(),n.expand(),n.setHeaderColor("#FF6B35"),n.setBackgroundColor("#1A1A1A"),n.enableClosingConfirmation(),n.MainButton&&(n.MainButton.setText("🎮 Играть"),n.MainButton.color="#FF6B35",n.MainButton.textColor="#FFFFFF"),console.log("Telegram WebApp initialized:",{platform:n.platform,version:n.version,colorScheme:n.colorScheme,user:(i=n.initDataUnsafe)==null?void 0:i.user})}else console.log("Running outside Telegram environment")},[]),console.log("App rendering, mode:",r.mode),e.jsx(Ze,{children:e.jsxs("div",{className:"App",children:[r.mode==="menu"&&e.jsx(st,{}),r.mode==="single"&&e.jsx(ut,{}),a.level&&e.jsx(xt,{isVisible:a.isVisible,newLevel:a.level,voltsReward:a.voltsReward||0,onClose:t})]})})}var Q,Z;if(typeof window<"u"&&((Q=window.Telegram)!=null&&Q.WebApp)){const r=window.Telegram.WebApp;r.ready(),r.expand(),r.setHeaderColor("#000000"),r.setBackgroundColor("#000000"),r.BackButton.hide(),r.HapticFeedback&&r.HapticFeedback.selectionChanged(),console.log("Telegram WebApp initialized:",{version:r.version,platform:r.platform,colorScheme:r.colorScheme,user:(Z=r.initDataUnsafe)==null?void 0:Z.user})}q.createRoot(document.getElementById("root")).render(e.jsx(ee.StrictMode,{children:e.jsx(mt,{})}));
//# sourceMappingURL=index-DrUEiwyp.js.map
